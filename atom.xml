<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>火柴的博客</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2016-08-05T03:35:04.955Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>CH</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>mongodb分片配置</title>
    <link href="http://yoursite.com/2016/08/05/mongodb%E5%88%86%E7%89%87%E9%85%8D%E7%BD%AE/"/>
    <id>http://yoursite.com/2016/08/05/mongodb分片配置/</id>
    <published>2016-08-05T03:10:23.000Z</published>
    <updated>2016-08-05T03:35:04.955Z</updated>
    
    <content type="html"><![CDATA[<p>MongoDB &#x662F;&#x7531;C++&#x8BED;&#x8A00;&#x7F16;&#x5199;&#x7684;&#xFF0C;&#x662F;&#x4E00;&#x4E2A;&#x57FA;&#x4E8E;&#x5206;&#x5E03;&#x5F0F;&#x6587;&#x4EF6;&#x5B58;&#x50A8;&#x7684;&#x5F00;&#x6E90;&#x6570;&#x636E;&#x5E93;&#x7CFB;&#x7EDF;&#x3002;<br>&#x5728;&#x9AD8;&#x8D1F;&#x8F7D;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6DFB;&#x52A0;&#x66F4;&#x591A;&#x7684;&#x8282;&#x70B9;&#xFF0C;&#x53EF;&#x4EE5;&#x4FDD;&#x8BC1;&#x670D;&#x52A1;&#x5668;&#x6027;&#x80FD;&#x3002;<br>MongoDB &#x65E8;&#x5728;&#x4E3A;WEB&#x5E94;&#x7528;&#x63D0;&#x4F9B;&#x53EF;&#x6269;&#x5C55;&#x7684;&#x9AD8;&#x6027;&#x80FD;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x3002;<br>&#x8FD9;&#x91CC;&#x5E9F;&#x8BDD;&#x4E0D;&#x591A;&#x8BF4;&#xFF0C;&#x76F4;&#x63A5;&#x5F00;&#x59CB;&#x914D;&#x7F6E;mongodb&#x5206;&#x7247;<br> <a id="more"></a></p>
<!-- toc -->
<!-- tocstop -->
<p></p><h2 id="yum&#x5B89;&#x88C5;mongodb&#x914D;&#x7F6E;&#x597D;yum&#x6E90;">yum&#x5B89;&#x88C5;mongodb(&#x914D;&#x7F6E;&#x597D;yum&#x6E90;)</h2><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># yum -y install mongodb-server mongodb</span></div></pre></td></tr></table></figure><p></p>
<p></p><h2 id="&#x521B;&#x5EFA;&#x6240;&#x9700;&#x8981;&#x7684;&#x76EE;&#x5F55;">&#x521B;&#x5EFA;&#x6240;&#x9700;&#x8981;&#x7684;&#x76EE;&#x5F55;</h2><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># mkdir /home/mongdb/config/{log,data} -pv</span></div><div class="line"><span class="comment"># mkdir /home/mongdb/shard{1,2,3}/{data,log} -pv</span></div></pre></td></tr></table></figure><p></p>
<p></p><h2 id="&#x5206;&#x522B;&#x542F;&#x52A8;config&#x670D;&#x52A1;&#x5668;">&#x5206;&#x522B;&#x542F;&#x52A8;config&#x670D;&#x52A1;&#x5668;</h2><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># mongod --configsvr --dbpath=/home/mongdb/config/data/ --port 27100 --logpath=/home/mongdb/config/log/confdb.log --fork --directoryperdb</span></div></pre></td></tr></table></figure><p></p>
<p></p><h2 id="&#x542F;&#x52A8;&#x8DEF;&#x7531;&#x670D;&#x52A1;&#x5668;">&#x542F;&#x52A8;&#x8DEF;&#x7531;&#x670D;&#x52A1;&#x5668;</h2><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># mongos --configdb 192.168.16.90:27100,192.168.16.91:27100,192.168.16.92:27100 --port 27000 --logpath=/home/mongdb/config/confdb.log --fork</span></div></pre></td></tr></table></figure><p></p>
<p></p><h2 id="&#x6BCF;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x5206;&#x522B;&#x542F;&#x52A8;&#x591A;&#x4E2A;&#x526F;&#x672C;&#x96C6;">&#x6BCF;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x5206;&#x522B;&#x542F;&#x52A8;&#x591A;&#x4E2A;&#x526F;&#x672C;&#x96C6;</h2><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># mongod --shardsvr --replSet shard1 --port 27001 --dbpath /home/mongdb/shard1/data --logpath /home/mongdb/shard1/log/shard1.log --directoryperdb --fork</span></div><div class="line"><span class="comment"># mongod --shardsvr --replSet shard2 --port 27002 --dbpath /home/mongdb/shard2/data --logpath /home/mongdb/shard1/log/shard2.log --directoryperdb --fork</span></div><div class="line"><span class="comment"># mongod --shardsvr --replSet shard3 --port 27003 --dbpath /home/mongdb/shard3/data --logpath /home/mongdb/shard1/log/shard3.log --directoryperdb --fork</span></div></pre></td></tr></table></figure><p></p>
<p></p><h2 id="&#x914D;&#x7F6E;shard1&#x767B;&#x9646;90&#x6CA1;&#x6709;&#x663E;&#x5F0F;&#x6307;&#x5B9A;&#x4E3B;&#x8282;&#x70B9;&#x65F6;&#x4F1A;&#x9009;&#x62E9;&#x767B;&#x9646;&#x7684;&#x673A;&#x5668;&#x4E3A;&#x4E3B;&#x8282;&#x70B9;">&#x914D;&#x7F6E;shard1&#xFF08;&#x767B;&#x9646;90&#xFF0C;&#x6CA1;&#x6709;&#x663E;&#x5F0F;&#x6307;&#x5B9A;&#x4E3B;&#x8282;&#x70B9;&#x65F6;&#xFF0C;&#x4F1A;&#x9009;&#x62E9;&#x767B;&#x9646;&#x7684;&#x673A;&#x5668;&#x4E3A;&#x4E3B;&#x8282;&#x70B9;&#xFF09;</h2><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">mongo --port 27001</div><div class="line">&gt; use admin</div><div class="line">switched to db admin</div><div class="line">&gt; rs.initiate({</div><div class="line">... _id: <span class="string">&apos;shard1&apos;</span>,</div><div class="line">... members: [</div><div class="line">... {_id: 90,host: <span class="string">&apos;192.168.16.90:27001&apos;</span>},</div><div class="line">... {_id: 91,host: <span class="string">&apos;192.169.16.91:27001&apos;</span>},</div><div class="line">... {_id: 92,host: <span class="string">&apos;192.168.16.92:27001&apos;</span>,arbiterOnly: <span class="literal">true</span>}</div><div class="line">... ]</div><div class="line">... });</div></pre></td></tr></table></figure><p></p>
<p></p><h2 id="&#x914D;&#x7F6E;shard2&#x767B;&#x5F55;91">&#x914D;&#x7F6E;shard2(&#x767B;&#x5F55;91)</h2><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">mongo --port 27002</div><div class="line">shard1:SECONDARY&gt; use admin</div><div class="line">switched to db admin</div><div class="line">shard1:SECONDARY&gt; rs.initiate({</div><div class="line">... _id: <span class="string">&apos;shard2&apos;</span>,</div><div class="line">...  members: [</div><div class="line">... {_id: 90,host: <span class="string">&apos;192.168.16.90:27001&apos;</span>,arbiterOnly: <span class="literal">true</span>},</div><div class="line">... {_id: 91,host: <span class="string">&apos;192.169.16.91:27001&apos;</span>},</div><div class="line">... {_id: 92,host: <span class="string">&apos;192.168.16.92:27001&apos;</span>}</div><div class="line">... ]</div><div class="line">... });</div></pre></td></tr></table></figure><p></p>
<p></p><h2 id="&#x914D;&#x7F6E;shard3&#x767B;&#x5F55;92">&#x914D;&#x7F6E;shard3(&#x767B;&#x5F55;92)</h2><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mongo --port 27003</div><div class="line">shard1:SECONDARY&gt; use admin</div><div class="line">rs.initiate({ _id: <span class="string">&apos;shard3&apos;</span>,  members: [ {_id: 90,host: <span class="string">&apos;192.168.16.90:27003&apos;</span>}, {_id: 91,host: <span class="string">&apos;192.169.16.91:27003&apos;</span>,arbiterOnly: <span class="literal">true</span>}, {_id: 92,host: <span class="string">&apos;192.168.16.92:27003&apos;</span>} ] });</div></pre></td></tr></table></figure><p></p>
<p></p><h2 id="&#x8BBE;&#x7F6E;&#x8DEF;&#x7531;&#x5230;&#x5206;&#x7247;&#x96C6;&#x7FA4;&#x914D;&#x7F6E;">&#x8BBE;&#x7F6E;&#x8DEF;&#x7531;&#x5230;&#x5206;&#x7247;&#x96C6;&#x7FA4;&#x914D;&#x7F6E;</h2><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">db.runCommand({addShard: <span class="string">&apos;shard2/192.168.16.90:27002,192.168.16.91:27002,192.168.16.92:27002&apos;</span>});</div><div class="line">{ <span class="string">&quot;shardAdded&quot;</span> : <span class="string">&quot;shard2&quot;</span>, <span class="string">&quot;ok&quot;</span> : 1 }</div><div class="line">mongos&gt; db.runCommand({addShard: <span class="string">&apos;shard3/192.168.16.90:27003,192.168.16.91:27003,192.168.16.92:27003&apos;</span>});</div><div class="line">{ <span class="string">&quot;shardAdded&quot;</span> : <span class="string">&quot;shard3&quot;</span>, <span class="string">&quot;ok&quot;</span> : 1 }</div><div class="line">mongos&gt; db.runCommand({addShard: <span class="string">&apos;shard1/192.168.16.90:27001,192.168.16.91:27001,192.168.16.92:27001&apos;</span>});</div></pre></td></tr></table></figure><p></p>
<p></p><h2 id="&#x67E5;&#x770B;&#x914D;&#x7F6E;&#x597D;&#x7684;shard">&#x67E5;&#x770B;&#x914D;&#x7F6E;&#x597D;&#x7684;shard</h2><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">mongos&gt; db.runCommand({listshards: 1});</div><div class="line">{</div><div class="line">	<span class="string">&quot;shards&quot;</span> : [</div><div class="line">		{</div><div class="line">			<span class="string">&quot;_id&quot;</span> : <span class="string">&quot;shard1&quot;</span>,</div><div class="line">			<span class="string">&quot;host&quot;</span> : <span class="string">&quot;shard1/192.168.16.90:27001,192.168.16.91:27001&quot;</span></div><div class="line">		},</div><div class="line">		{</div><div class="line">			<span class="string">&quot;_id&quot;</span> : <span class="string">&quot;shard2&quot;</span>,</div><div class="line">			<span class="string">&quot;host&quot;</span> : <span class="string">&quot;shard2/192.168.16.91:27002,192.168.16.92:27002&quot;</span></div><div class="line">		},</div><div class="line">		{</div><div class="line">			<span class="string">&quot;_id&quot;</span> : <span class="string">&quot;shard3&quot;</span>,</div><div class="line">			<span class="string">&quot;host&quot;</span> : <span class="string">&quot;shard3/192.168.16.90:27003,192.168.16.92:27003&quot;</span></div><div class="line">		}</div><div class="line">	],</div><div class="line">	<span class="string">&quot;ok&quot;</span> : 1</div><div class="line">}</div></pre></td></tr></table></figure><p></p>
<p></p><h2 id="&#x6D4B;&#x8BD5;&#x5206;&#x7247;">&#x6D4B;&#x8BD5;&#x5206;&#x7247;</h2><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">mongos&gt; use admin</div><div class="line">mongos&gt; db.runCommand({enablesharding: <span class="string">&apos;dbtest&apos;</span>});</div><div class="line">mongos&gt; db.runCommand({shardcollection: <span class="string">&apos;dbtest.coll1&apos;</span>, key: {id: 1}});</div><div class="line">mongos&gt; use dbtest;</div><div class="line">mongos&gt; <span class="keyword">for</span>(var i=0; i&lt;10000; i++) db.coll1.insert({id: i, s: <span class="string">&apos;str_&apos;</span> + i});</div><div class="line">mongos&gt; db.coll1.stats()</div><div class="line">	<span class="string">&quot;shard1&quot;</span> : {</div><div class="line">	<span class="string">&quot;ns&quot;</span> : <span class="string">&quot;dbtest.coll1&quot;</span>,</div><div class="line">	<span class="string">&quot;count&quot;</span> : 1,</div><div class="line">	<span class="string">&quot;size&quot;</span> : 47,</div><div class="line">	<span class="string">&quot;avgObjSize&quot;</span> : 47,</div><div class="line">	<span class="string">&quot;storageSize&quot;</span> : 4096,</div><div class="line">	<span class="string">&quot;capped&quot;</span> : <span class="literal">false</span>,</div><div class="line">	<span class="string">&quot;wiredTiger&quot;</span> : {</div><div class="line"></div><div class="line">	<span class="string">&quot;shard2&quot;</span> : {</div><div class="line">	<span class="string">&quot;ns&quot;</span> : <span class="string">&quot;dbtest.coll1&quot;</span>,</div><div class="line">	<span class="string">&quot;count&quot;</span> : 9979,</div><div class="line">	<span class="string">&quot;size&quot;</span> : 497892,</div><div class="line">	<span class="string">&quot;avgObjSize&quot;</span> : 49,</div><div class="line">	<span class="string">&quot;storageSize&quot;</span> : 4096,</div><div class="line">	<span class="string">&quot;capped&quot;</span> : <span class="literal">false</span>,</div><div class="line">	<span class="string">&quot;wiredTiger&quot;</span> : {</div><div class="line">	</div><div class="line">	<span class="string">&quot;shard3&quot;</span> : {</div><div class="line">	<span class="string">&quot;ns&quot;</span> : <span class="string">&quot;dbtest.coll1&quot;</span>,</div><div class="line">	<span class="string">&quot;count&quot;</span> : 20,</div><div class="line">	<span class="string">&quot;size&quot;</span> : 951,</div><div class="line">	<span class="string">&quot;avgObjSize&quot;</span> : 47,</div><div class="line">	<span class="string">&quot;storageSize&quot;</span> : 16384,</div><div class="line">	<span class="string">&quot;capped&quot;</span> : <span class="literal">false</span>,</div><div class="line">	<span class="string">&quot;wiredTiger&quot;</span> : {</div></pre></td></tr></table></figure><p></p>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x8FD9;&#x91CC;&#x5206;&#x7247;&#x5DF2;&#x7ECF;&#x751F;&#x6548;&#xFF0C;&#x53EA;&#x662F;&#x5206;&#x914D;&#x4E0D;&#x5747;&#x5300;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x6570;&#x636E;&#x90FD;&#x5B58;&#x5728;&#x4E86;shard2&#x4E2D;&#x4E86;</p>
<p></p><h2 id="&#x4F7F;&#x7528;hashed-shard-key&#x7B97;&#x6CD5;&#x4FDD;&#x8BC1;&#x6587;&#x6863;&#x5747;&#x5300;&#x5206;&#x5E03;">&#x4F7F;&#x7528;hashed shard key&#x7B97;&#x6CD5;&#x4FDD;&#x8BC1;&#x6587;&#x6863;&#x5747;&#x5300;&#x5206;&#x5E03;</h2><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mongo --port 27000</div><div class="line">use admin</div><div class="line">sh.shardCollection(<span class="string">&apos;dbtest.coll1&apos;</span>, {id: <span class="string">&apos;hashed&apos;</span>});</div></pre></td></tr></table></figure><p></p>
<p></p><h2 id="&#x5BA2;&#x6237;&#x7AEF;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8FDE;&#x63A5;&#x8DEF;&#x7531;&#x8282;&#x70B9;&#x6765;&#x5B9E;&#x73B0;&#x6570;&#x636E;&#x7684;&#x5206;&#x7247;">&#x5BA2;&#x6237;&#x7AEF;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8FDE;&#x63A5;&#x8DEF;&#x7531;&#x8282;&#x70B9;&#x6765;&#x5B9E;&#x73B0;&#x6570;&#x636E;&#x7684;&#x5206;&#x7247;</h2><br>    &#x8FD9;&#x91CC;&#x8FDE;&#x63A5;&#x4EFB;&#x4F55;&#x4E00;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x7684;27000&#x7AEF;&#x53E3;&#x90FD;&#x884C;&#x3002;<p></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;MongoDB 是由C++语言编写的，是一个基于分布式文件存储的开源数据库系统。&lt;br&gt;在高负载的情况下，添加更多的节点，可以保证服务器性能。&lt;br&gt;MongoDB 旨在为WEB应用提供可扩展的高性能数据存储解决方案。&lt;br&gt;这里废话不多说，直接开始配置mongodb分片&lt;br&gt;
    
    </summary>
    
      <category term="数据库" scheme="http://yoursite.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
      <category term="mongodb" scheme="http://yoursite.com/tags/mongodb/"/>
    
  </entry>
  
  <entry>
    <title>一次处理故障的记录</title>
    <link href="http://yoursite.com/2016/08/04/%E4%B8%80%E6%AC%A1%E5%A4%84%E7%90%86%E6%95%85%E9%9A%9C%E7%9A%84%E8%AE%B0%E5%BD%95/"/>
    <id>http://yoursite.com/2016/08/04/一次处理故障的记录/</id>
    <published>2016-08-04T09:25:39.000Z</published>
    <updated>2016-08-05T01:20:17.223Z</updated>
    
    <content type="html"><![CDATA[<!-- toc -->
<!-- tocstop -->
<p>&#x670D;&#x52A1;&#x5668;&#x4E0D;&#x505C;&#x7684;&#x5411;&#x5916;&#x53D1;&#x5305;&#xFF0C;&#x4E14;CPU&#x6301;&#x7EED;100%&#xFF0C;&#x8FDC;&#x7A0B;&#x767B;&#x5F55;&#x540E;&#x67E5;&#x770B;&#x53D1;&#x73B0;&#x6709;&#x4E00;&#x957F;&#x5EA6;&#x4E3A;10&#x7684;&#x968F;&#x673A;&#x5B57;&#x7B26;&#x4E32;&#x8FDB;&#x7A0B;&#xFF0C;<br>kill&#x6389;&#xFF0C;&#x4F1A;&#x91CD;&#x65B0;&#x751F;&#x6210;&#x53E6;&#x5916;&#x957F;&#x5EA6;&#x4E3A;10&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x8FDB;&#x7A0B;&#x3002;&#x5220;&#x9664;&#x6587;&#x4EF6;&#x4E5F;&#x4F1A;&#x91CD;&#x590D;&#x751F;&#x6210;&#xFF0C;&#x975E;&#x5E38;&#x75DB;&#x82E6;&#x3002;&#x67E5;&#x9605;crond&#x76F8;&#x5173;&#x65E5;&#x5FD7;&#xFF0C;<br>&#x53D1;&#x73B0;&#x5B9E;&#x9645;&#x6267;&#x884C;&#x7684;&#x5185;&#x5BB9;&#x4E3A;/lib/libudev.so &#xFF0C;&#x4EE5;&#x6B64;&#x4E3A;&#x5173;&#x952E;&#x5B57;&#x8FDB;&#x884C;&#x67E5;&#x8BE2;&#xFF0C;&#x627E;&#x5230;&#x5982;&#x4E0B;&#x5185;&#x5BB9;&#xFF1A;<br>&#x7DB2;&#x8DEF;&#x6D41;&#x91CF;&#x66B4;&#x589E;&#xFF0C;&#x4F7F;&#x7528; top &#x89C0;&#x5BDF;&#x6709;&#x81F3;&#x5C11;&#x4E00;&#x500B; 10 &#x500B;&#x96A8;&#x6A5F;&#x5B57;&#x6BCD;&#x7D44;&#x6210;&#x7684;&#x7A0B;&#x5E8F;&#x57F7;&#x884C;&#xFF0C;&#x4F54;&#x7528;&#x5927;&#x91CF; CPU &#x4F7F;&#x7528;&#x7387;&#x3002;&#x522A;&#x9664;&#x9019;&#x4E9B;&#x7A0B;&#x5E8F;&#xFF0C;&#x99AC;&#x4E0A;&#x53C8;&#x7522;&#x751F;&#x65B0;&#x7684;&#x7A0B;&#x5E8F;&#x3002;<br> <a id="more"></a></p>
<p>&#x6AA2;&#x67E5; cat /etc/crontab &#x53D1;&#x73B0;&#x5B9A;&#x65F6;&#x4EFB;&#x52A1; &#x6BCF;&#x4E09;&#x5206;&#x9418;&#x57F7;&#x884C;gcc.sh</p>
<pre><code># */3 * * * * root /etc/cron.hourly/gcc.sh
</code></pre><p>&#x67E5;&#x770B;&#x75C5;&#x6BD2;&#x7A0B;&#x5F0F; gcc.sh&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x75C5;&#x6BD2;&#x672C;&#x9AD4;&#x662F; /lib/libudev.so&#x3002;<br>    [root@deyu ~]# cat /etc/cron.hourly/gcc.sh</p>
<pre><code>#!/bin/sh
PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:/usr/X11R6/bin
for i in `cat /proc/net/dev|grep :|awk -F: {&apos;print $1&apos;}`; do ifconfig $i up&amp; done
cp /lib/libudev.so /lib/libudev.so.6
/lib/libudev.so.6
</code></pre><p>&#x522A;&#x9664;&#x4E0A;&#x4E00;&#x884C;&#x4F8B;&#x884C;&#x5DE5;&#x4F5C; gcc.sh&#xFF0C;&#x4E26;&#x8A2D;&#x5B9A; /etc/crontab &#x7121;&#x6CD5;&#x8B8A;&#x52D5;&#xFF0C;&#x5426;&#x5247;&#x99AC;&#x4E0A;&#x53C8;&#x6703;&#x7522;&#x751F;&#x3002;</p>
<pre><code># rm -f /etc/cron.hourly/gcc.sh ; chattr +i /etc/crontab
</code></pre><p>&#x4F7F;&#x7528; top &#x67E5;&#x770B;&#x75C5;&#x6BD2;&#x70BA; mtyxkeaofa&#xFF0C;id &#x70BA; 16621&#xFF0C;&#x4E0D;&#x8981;&#x76F4;&#x63A5;&#x6BBA;&#x6389;&#x7A0B;&#x5E8F;&#xFF0C;&#x5426;&#x5247;&#x6703;&#x518D;&#x7522;&#x751F;&#xFF0C;&#x800C;&#x662F;&#x505C;&#x6B62;&#x5176;&#x904B;&#x4F5C;&#x3002;</p>
<pre><code># kill -STOP 16621
</code></pre><p>&#x522A;&#x9664; /etc/init.d &#x5167;&#x7684;&#x6A94;&#x6848;&#x3002;</p>
<pre><code># find /etc -name &apos;*mtyxkeaofa*&apos; | xargs rm -f
</code></pre><p>&#x522A;&#x9664; /usr/bin &#x5167;&#x7684;&#x6A94;&#x6848;&#x3002;</p>
<pre><code># rm -f /usr/bin/mtyxkeaofa
</code></pre><p>&#x67E5;&#x770B; /usr/bin &#x6700;&#x8FD1;&#x8B8A;&#x52D5;&#x7684;&#x6A94;&#x6848;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x75C5;&#x6BD2;&#x4E5F;&#x4E00;&#x4F75;&#x522A;&#x9664;&#xFF0C;&#x5176;&#x4ED6;&#x53EF;&#x7591;&#x7684;&#x76EE;&#x9304;&#x4E5F;&#x4E00;&#x6A23;&#x3002;</p>
<pre><code># ls -lt /usr/bin | head
</code></pre><p>&#x73FE;&#x5728;&#x6BBA;&#x6389;&#x75C5;&#x6BD2;&#x7A0B;&#x5E8F;&#xFF0C;&#x5C31;&#x4E0D;&#x6703;&#x518D;&#x7522;&#x751F;&#x3002;</p>
<pre><code># pkill mtyxkeaofa
</code></pre><p>&#x522A;&#x9664;&#x75C5;&#x6BD2;&#x672C;&#x9AD4;&#x3002;</p>
<pre><code># rm -f /lib/libudev.so
</code></pre><p>&#x4F7F;&#x7528;&#x6B64;&#x65B9;&#x6CD5; &#x53EF;&#x4EE5;&#x5B8C;&#x5168;&#x6E05;&#x9664;&#x6B64;&#x75C5;&#x6BD2;&#x3002;</p>
]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;
&lt;!-- tocstop --&gt;
&lt;p&gt;服务器不停的向外发包，且CPU持续100%，远程登录后查看发现有一长度为10的随机字符串进程，&lt;br&gt;kill掉，会重新生成另外长度为10的字符串进程。删除文件也会重复生成，非常痛苦。查阅crond相关日志，&lt;br&gt;发现实际执行的内容为/lib/libudev.so ，以此为关键字进行查询，找到如下内容：&lt;br&gt;網路流量暴增，使用 top 觀察有至少一個 10 個隨機字母組成的程序執行，佔用大量 CPU 使用率。刪除這些程序，馬上又產生新的程序。&lt;br&gt;
    
    </summary>
    
      <category term="故障处理" scheme="http://yoursite.com/categories/%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/"/>
    
    
      <category term="故障" scheme="http://yoursite.com/tags/%E6%95%85%E9%9A%9C/"/>
    
  </entry>
  
</feed>

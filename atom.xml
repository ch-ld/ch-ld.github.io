<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>火柴的博客</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.chen-hao.com.cn/"/>
  <updated>2017-06-02T08:04:23.486Z</updated>
  <id>http://www.chen-hao.com.cn/</id>
  
  <author>
    <name>火柴</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>jenkins部署及构建方式</title>
    <link href="http://www.chen-hao.com.cn/jenkins%E9%83%A8%E7%BD%B2%E5%8F%8A%E6%9E%84%E5%BB%BA%E6%96%B9%E5%BC%8F.html"/>
    <id>http://www.chen-hao.com.cn/jenkins部署及构建方式.html</id>
    <published>2017-06-02T05:08:19.000Z</published>
    <updated>2017-06-02T08:04:23.486Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>jenkins&#x662F;&#x57FA;&#x4E8E;java&#x5F00;&#x53D1;&#x7684;&#x4E00;&#x79CD;&#x6301;&#x7EED;&#x96C6;&#x6210;&#x5DE5;&#x5177;&#xFF0C;&#x5B83;&#x7684;&#x5DE5;&#x4F5C;&#x5B8C;&#x5168;&#x5C31;&#x662F;&#x4F9D;&#x9760;&#x63D2;&#x4EF6;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x4F60;&#x60F3;&#x4F7F;&#x7528;&#x4EC0;&#x4E48;&#x529F;&#x80FD;&#xFF0C;&#x4F60;&#x5C31;&#x627E;&#x5230;&#x4EC0;&#x4E48;&#x6837;&#x7684;&#x63D2;&#x4EF6;&#x3002;&#x5728;&#x5DE5;&#x4F5C;&#x4E2D;&#x90E8;&#x7F72;jenkins&#x7684;&#x6700;&#x5927;&#x597D;&#x5904;&#x5C31;&#x662F;&#x6BCF;&#x6B21;&#x5728;&#x5F00;&#x53D1;&#x3001;&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;&#xFF0C;&#x90FD;&#x65E0;&#x987B;&#x8FD0;&#x7EF4;&#x90E8;&#x7F72;&#xFF0C;&#x800C;&#x662F;&#x76F8;&#x5173;&#x7684;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#xFF0C;&#x6D4B;&#x8BD5;&#x4EBA;&#x5458;&#x767B;&#x5F55;jenkins&#x4F20;&#x5165;&#x9700;&#x8981;&#x90E8;&#x7F72;&#x7684;tag&#x5373;&#x53EF;&#xFF0C;&#x6574;&#x4E2A;&#x90E8;&#x7F72;&#x8FC7;&#x7A0B;&#x65E0;&#x987B;&#x8FD0;&#x7EF4;&#x53C2;&#x4E0E;&#xFF0C;&#x4ECE;&#x800C;&#x89E3;&#x653E;&#x8FD0;&#x7EF4;&#x52B3;&#x52A8;&#x529B;&#x3002;<br><a id="more"></a></p>
</blockquote>
<p></p><h3 id="jenkins&#x5B89;&#x88C5;"> jenkins&#x5B89;&#x88C5;</h3><p></p>
<h4 id="&#x73AF;&#x5883;&#x51C6;&#x5907;">&#x73AF;&#x5883;&#x51C6;&#x5907;</h4><br>1. Centos 7.1  &#x5DF2;&#x5173;&#x95ED; iptables&#x3001;selinux<br>2. Java JDK 1.8<br>3. gitlab&#x90E8;&#x7F72;&#xFF0C;&#x63A8;&#x8350;&#x6587;&#x7AE0;&#xFF1A; <a href="http://chen-hao.com.cn/%E6%90%AD%E5%BB%BA%E5%86%85%E7%BD%91gitlab%E4%BB%93%E5%BA%93.html#more" target="_blank" rel="external">&#x642D;&#x5EFA;&#x5185;&#x7F51;gitlab&#x4ED3;&#x5E93;</a><br><br><h4 id="&#x5B89;&#x88C5;jenkins">&#x5B89;&#x88C5;jenkins</h4><br>&#x5B98;&#x7F51;&#xFF1A; <a href="https://www.jenkins.io" target="_blank" rel="external">https://www.jenkins.io</a><br><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /etc/yum.repos.d/</div><div class="line">wget http://pkg.jenkins.io/redhat/jenkins.repo</div><div class="line">rpm --import http://pkg.jenkins.io/redhat/jenkins.io.key</div><div class="line">yum install -y jenkins</div><div class="line">systemctl start jenkins</div></pre></td></tr></table></figure><br><br><h4 id="&#x914D;&#x7F6E;jenkins">&#x914D;&#x7F6E;jenkins</h4><br>&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x6253;&#x5F00;&#x8F93;&#x5165; <a href="http://IP:8080/" target="_blank" rel="external">http://IP:8080/</a>        &#x5373;&#x53EF;&#x8BBF;&#x95EE;jenkins<br><img src="/uploads/jenkins1.png" class="blockquote-center"><br>&#x9996;&#x6B21;&#x8BBF;&#x95EE;&#xFF0C;&#x9700;&#x8981;&#x89E3;&#x9501;jenkins&#xFF0C;&#x628A;/var/lib/jenkins/secrets/initialAdminPassword&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x590D;&#x5236;&#x5230;administrator password&#x4E0B;&#x65B9;&#x5373;&#x53EF;&#x3002;<br><br><img src="/uploads/jenkins2.png" class="blockquote-center"><br>&#x70B9;&#x51FB;&#x7B2C;&#x4E00;&#x4E2A;&#x5B89;&#x88C5;&#x4E00;&#x4E9B;&#x9ED8;&#x8BA4;&#x63D2;&#x4EF6;&#x5373;&#x53EF;&#xFF0C;&#x5B89;&#x88C5;&#x65F6;&#x95F4;&#x53EF;&#x80FD;&#x6BD4;&#x8F83;&#x4E45;&#xFF0C;&#x8010;&#x5FC3;&#x7B49;&#x5F85;&#x4E00;&#x4E0B;&#x5373;&#x53EF;<br><img src="/uploads/jenkins3.png" class="blockquote-center"><br>&#x9ED8;&#x8BA4;&#x63D2;&#x4EF6;&#x5B89;&#x88C5;&#x5B8C;&#x6210;&#x4E4B;&#x540E;&#xFF0C;&#x914D;&#x7F6E;&#x4E0B;&#x7528;&#x6237;&#x5BC6;&#x7801;&#x90AE;&#x7BB1;&#x5373;&#x53EF;<br><img src="/uploads/jenkins7.png" class="blockquote-center"><br><br><h4 id="&#x63D2;&#x4EF6;&#x5B89;&#x88C5;">&#x63D2;&#x4EF6;&#x5B89;&#x88C5;</h4><br>&#x70B9;&#x51FB; &#x3010;&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;&#x3011; &#x2013;&gt; &#x3010;&#x7BA1;&#x7406;&#x63D2;&#x4EF6;&#x3011; &#x5B89;&#x88C5;&#x4E00;&#x4E9B;&#x5FC5;&#x8981;&#x63D2;&#x4EF6;<br><img src="/uploads/jenkins8.png" class="blockquote-center"><br>&#x8FD9;&#x91CC;&#x8BF4;&#x660E;&#x4E00;&#x4E0B;&#x6211;&#x5B89;&#x88C5;&#x7684;&#x4E00;&#x4E9B;&#x63D2;&#x4EF6;:<br><br>ssh &#x63D2;&#x4EF6;: SSH plugin<br>Android &#x4E13;&#x7528;&#xFF1A;Gradle plugin (&#x9ED8;&#x8BA4;&#x5DF2;&#x7ECF;&#x5B89;&#x88C5;&#xFF09;<br>Git &#x63D2;&#x4EF6;&#xFF1A;Git plugin&#x3001;Git client plugin<br>Gitlab &#x63D2;&#x4EF6;&#xFF1A;GitLab Plugin &#x548C; Gitlab Hook Plugin&#x3001;GitLab Logo Plugin<br>sonar &#x63D2;&#x4EF6;&#xFF1A;SonarQube Plugin&#x3001;Sonargraph Integration Jenkins Plugin&#x3001;Sonargraph Plugin<br>Parameter &#x63D2;&#x4EF6;: Git Parameter Plug-In&#xFF08;&#x7528;&#x4E8E;&#x7ED9;git&#x4F20;&#x53C2;&#xFF0C;&#x53EF;&#x9009;&#x62E9;&#x5177;&#x4F53;&#x90E8;&#x7F72;&#x54EA;&#x4E00;&#x4E2A;&#x5206;&#x652F;&#xFF09;<br>Maven &#x63D2;&#x4EF6;&#xFF1A; Maven Integration plugin&#xFF08;&#x7528;&#x4E8E;maven&#x6784;&#x5EFA;&#x9879;&#x76EE;&#xFF09;<br><br><br><h4 id="&#x624B;&#x52A8;&#x4E0B;&#x8F7D;jenkins&#x63D2;&#x4EF6;">&#x624B;&#x52A8;&#x4E0B;&#x8F7D;jenkins&#x63D2;&#x4EF6;</h4><br>&#x5927;&#x5BB6;&#x90FD;&#x77E5;&#x9053;&#xFF0C;&#x56E0;&#x4E3A;&#x5929;&#x671D;&#x7F51;&#x7EDC;&#x539F;&#x56E0;&#xFF0C;&#x53EF;&#x80FD;&#x6709;&#x5F88;&#x591A;&#x63D2;&#x4EF6;&#x6211;&#x4EEC;&#x5B89;&#x88C5;&#x4E0D;&#x4E0A;&#xFF0C;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x5C31;&#x9700;&#x8981;&#x6211;&#x4EEC;&#x624B;&#x52A8;&#x4E0B;&#x8F7D;&#xFF0C;&#x7136;&#x540E;&#x4E0A;&#x4F20;&#x63D2;&#x4EF6;&#x4E86;&#x3002;<br><br>&#x63D2;&#x4EF6;&#x5730;&#x5740;&#xFF1A; <a href="http://updates.jenkins-ci.org/download/plugins/" target="_blank" rel="external">http://updates.jenkins-ci.org/download/plugins/</a><br>&#x70B9;&#x51FB; &#x3010;&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;&#x3011; &#x2013;&gt; &#x3010;&#x7BA1;&#x7406;&#x63D2;&#x4EF6;&#x3011; &#x2013;&gt; &#x3010;&#x9AD8;&#x7EA7;&#x3011;<br><img src="/uploads/jenkins4.png" class="blockquote-center"><br><br><h4 id="jenkins&#x90AE;&#x7BB1;&#x914D;&#x7F6E;">jenkins&#x90AE;&#x7BB1;&#x914D;&#x7F6E;</h4><br>&#x70B9;&#x51FB; &#x3010;&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;&#x3011; &#x2013;&gt; &#x3010;&#x7CFB;&#x7EDF;&#x914D;&#x7F6E;&#x3011;&#x2013;&gt; &#x3010;Jenkins Location&#x3011;<br><img src="/uploads/jenkins5.png" class="blockquote-center"><br>&#x4E4B;&#x540E;&#x518D;&#x5728;&#x4E0B;&#x9762;&#x627E;&#x5230; &#x3010;&#x90AE;&#x4EF6;&#x901A;&#x77E5;&#x3011;&#x914D;&#x7F6E;&#x4E0B;&#x5373;&#x53EF;<br><img src="/uploads/jenkins6.png" class="blockquote-center"><br><br><h4 id="&#x5BC6;&#x94A5;&#x914D;&#x7F6E;">&#x5BC6;&#x94A5;&#x914D;&#x7F6E;</h4><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># ssh-keygen -t rsa -b 4096</span></div><div class="line">Generating public/private rsa key pair.</div><div class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/root/.ssh/id_rsa): </div><div class="line">Created directory <span class="string">&apos;/root/.ssh&apos;</span>.</div><div class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase): </div><div class="line">Enter same passphrase again: </div><div class="line">Your identification has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.</div><div class="line">Your public key has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.pub.</div><div class="line">The key fingerprint is:</div><div class="line">df:2e:3c:f3:3f:7d:ff:f8:5f:26:46:82:42:fb:a5:34 root@zhmysql1</div><div class="line">The key<span class="string">&apos;s randomart image is:</span></div><div class="line">+--[ RSA 4096]----+</div><div class="line">|                 |</div><div class="line">|                 |</div><div class="line">|        .        |</div><div class="line">|       . . .     |</div><div class="line">|        S E o .  |</div><div class="line">|         = = o   |</div><div class="line">|         .+ . o.o|</div><div class="line">|          =. ..++|</div><div class="line">|           =o.ooX|</div><div class="line">+-----------------+</div></pre></td></tr></table></figure><br><br><img src="/uploads/jenkins9.png" class="blockquote-center"><br><img src="/uploads/jenkins10.png" class="blockquote-center"><br>&#x5728;&#x6D4F;&#x89C8;&#x6253;&#x5F00;&#x4E4B;&#x524D;&#x90E8;&#x7F72;&#x7684;gitlab&#xFF0C;&#x5C06;&#x670D;&#x52A1;&#x5668;&#x7684;&#x516C;&#x94A5;&#x914D;&#x7F6E;&#x4E0B;<br><img src="/uploads/jenkins11.png" class="blockquote-center"><br><br><h4 id="&#x73AF;&#x5883;&#x914D;&#x7F6E;">&#x73AF;&#x5883;&#x914D;&#x7F6E;</h4>

<p>&#x70B9;&#x51FB; &#x3010;&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;&#x3011; &#x2013;&gt; &#x3010;Global Tool Configuration&#x3011;<br><img src="/uploads/jenkins12.png" class="blockquote-center"><br><img src="/uploads/jenkins13.png" class="blockquote-center"></p>
<p></p><h3 id="jenkins&#x6784;&#x5EFA;">jenkins&#x6784;&#x5EFA;</h3><br>&#x5C31;&#x76EE;&#x524D;&#x6240;&#x77E5;&#x9053;&#x7684;&#xFF0C;jenkins&#x6709;3&#x79CD;&#x6784;&#x5EFA;&#x65B9;&#x5F0F;:<p></p>
<ol>
<li>jenkins&#x53C2;&#x6570;&#x5316;&#x6784;&#x5EFA;&#xFF1A;&#x7528;&#x4E8E;&#x6D4B;&#x8BD5;&#x73AF;&#x5883;&#x9884;&#x4E0A;&#x7EBF;&#x73AF;&#x5883;&#x90E8;&#x7F72;&#xFF0C;&#x5F00;&#x53D1;push&#x4EE3;&#x7801;&#x6216;&#x8005;&#x5408;&#x5E76;&#x4EE3;&#x7801;&#x5230;gitlab&#x9879;&#x76EE;&#x7684;master&#x5206;&#x652F;&#x4E4B;&#x540E;&#xFF0C;&#x5E76;&#x4E0D;&#x4F1A;&#x90E8;&#x7F72;&#x4EE3;&#x7801;&#xFF0C;&#x800C;&#x662F;&#x9700;&#x8981;&#x767B;&#x5F55;&#x5230;jenkins&#x7684;web&#x754C;&#x9762;&#xFF0C;&#x70B9;&#x51FB;&#x6784;&#x5EFA;&#x6309;&#x94AE;&#xFF0C;&#x4F20;&#x5165;&#x5BF9;&#x5E94;&#x7684;&#x53C2;&#x6570;&#xFF08;&#x6BD4;&#x5982;&#x53C2;&#x6570;&#x9700;&#x8981;&#x6784;&#x5EFA;&#x7684;tag&#xFF0C;&#x9700;&#x8981;&#x90E8;&#x7F72;&#x7684;&#x5206;&#x652F;&#xFF09;&#x7136;&#x540E;&#x624D;&#x4F1A;&#x90E8;&#x7F72;&#x3002;</li>
<li>jenkins&#x89E6;&#x53D1;&#x5F0F;&#x6784;&#x5EFA;&#xFF1A;&#x7528;&#x4E8E;&#x5F00;&#x53D1;&#x73AF;&#x5883;&#x90E8;&#x7F72;&#xFF0C;&#x5F00;&#x53D1;&#x4EBA;&#x5458;push&#x4EE3;&#x7801;&#x6216;&#x8005;&#x5408;&#x5E76;&#x4EE3;&#x7801;&#x5230;gitlab&#x9879;&#x76EE;&#x7684;master&#x5206;&#x652F;&#xFF0C;jenkins&#x5C31;&#x90E8;&#x7F72;&#x4EE3;&#x7801;&#x5230;&#x5BF9;&#x5E94;&#x670D;&#x52A1;&#x5668;&#x3002;</li>
<li>jenkins&#x5B9A;&#x65F6;&#x6784;&#x5EFA;&#xFF1A;&#x7528;&#x4E8E;APP&#x81EA;&#x52A8;&#x6253;&#x5305;&#xFF0C;&#x5B9A;&#x65F6;&#x6784;&#x5EFA;&#x662F;&#x5728;&#x53C2;&#x6570;&#x5316;&#x6784;&#x5EFA;&#x7684;&#x57FA;&#x7840;&#x4E0A;&#x6DFB;&#x52A0;&#x7684;&#xFF0C;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x53EF;&#x4EE5;&#x767B;&#x5F55;jenkins&#x624B;&#x52A8;&#x4F20;&#x5165;tag&#x8FDB;&#x884C;&#x6253;&#x5305;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x624B;&#x52A8;&#x6253;&#x5305;&#xFF0C;&#x90A3;&#x4E48;jenkins&#x5C31;&#x6BCF;&#x5929;&#x51CC;&#x6668;&#x4ECE;gitlab&#x62C9;&#x53D6;&#x6700;&#x65B0;&#x7684;APP&#x4EE3;&#x7801;&#x6253;&#x5305;&#x3002;</li>
</ol>
<p></p><h4 id="&#x53C2;&#x6570;&#x5316;&#x6784;&#x5EFA;">&#x53C2;&#x6570;&#x5316;&#x6784;&#x5EFA;</h4><br>&#x8FD9;&#x91CC;&#x5148;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x9879;&#x76EE;<br><img src="/uploads/jenkins17.png" class="blockquote-center"><br><img src="/uploads/jenkins14.png" class="blockquote-center"><br><img src="/uploads/jenkins15.png" class="blockquote-center"><br><img src="/uploads/jenkins16.png" class="blockquote-center"><br><img src="/uploads/jenkins18.png" class="blockquote-center"><br>&#x57FA;&#x672C;&#x4E0A;&#x4E00;&#x4E2A;&#x9879;&#x76EE;&#x6784;&#x5EFA;&#x5C31;&#x90E8;&#x7F72;&#x5B8C;&#x4E86;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x770B;&#x4E0B;&#x6548;&#x679C;<br><img src="/uploads/jenkins19.gif" class="blockquote-center"><p></p>
<p></p><h4 id="&#x89E6;&#x53D1;&#x5F0F;&#x6784;&#x5EFA;">&#x89E6;&#x53D1;&#x5F0F;&#x6784;&#x5EFA;</h4><br>&#x5373;gitlab&#x6709;&#x63D0;&#x4EA4;&#x64CD;&#x4F5C;&#xFF0C;&#x5219;&#x81EA;&#x52A8;&#x90E8;&#x7F72;&#xFF0C;&#x8FD9;&#x91CC;&#x53EA;&#x9700;&#x8981;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x8BA4;&#x8BC1;&#x7684;token&#x5373;&#x53EF;&#xFF0C;gitlab&#x8C03;&#x7528;&#x89E6;&#x53D1;&#x5668;&#xFF0C;&#x9700;&#x8981;&#x4F7F;&#x7528; JENKINS_URL/job/new_cms/build?token=TOKEN_NAME&#x5373;&#x53EF;<br><img src="/uploads/jenkins20.png" class="blockquote-center"><br>&#x70B9;&#x51FB; &#x3010;&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;&#x3011; &#x2013;&gt; &#x3010;&#x7BA1;&#x7406;&#x7528;&#x6237;&#x3011; &#x67E5;&#x770B;&#x7528;&#x6237;Token<br><img src="/uploads/jenkins21.png" class="blockquote-center"><br>&#x6839;&#x636E;&#x89E6;&#x53D1;&#x5668;&#x9A8C;&#x8BC1;&#x4EE4;&#x724C;&#x548C;&#x7528;&#x6237;id+token&#x4F1A;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x4E0B;&#x9762;&#x7684;url&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x8BBF;&#x95EE;&#x8FD9;&#x4E2A;URL&#x5730;&#x5740;jenkins&#x5C31;&#x4F1A;&#x81EA;&#x52A8;&#x90E8;&#x7F72;&#x5BF9;&#x5E94;&#x9879;&#x76EE;&#x7684;&#x4EE3;&#x7801;&#x3002;<br><a href="http://admin:fd27d8b8a7c707df89f9574b18980dc5@http://42.159.244.183:8080/job/jenkins_trigger/build?token=test" target="_blank" rel="external">http://admin:fd27d8b8a7c707df89f9574b18980dc5@http://42.159.244.183:8080/job/jenkins_trigger/build?token=test</a><p></p>
<p>gitlab&#x914D;&#x7F6E;webhooks&#xFF0C;&#x6BCF;&#x6B21;&#x63D0;&#x4EA4;&#x4EE3;&#x7801;&#x5C31;&#x8BBF;&#x95EE;&#x8FD9;&#x4E2A;url&#xFF0C;&#x6267;&#x884C;&#x6784;&#x5EFA;</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;jenkins是基于java开发的一种持续集成工具，它的工作完全就是依靠插件，也就是说你想使用什么功能，你就找到什么样的插件。在工作中部署jenkins的最大好处就是每次在开发、测试代码，都无须运维部署，而是相关的开发人员，测试人员登录jenkins传入需要部署的tag即可，整个部署过程无须运维参与，从而解放运维劳动力。&lt;br&gt;
    
    </summary>
    
      <category term="自动化" scheme="http://www.chen-hao.com.cn/categories/%E8%87%AA%E5%8A%A8%E5%8C%96/"/>
    
    
      <category term="jenkins" scheme="http://www.chen-hao.com.cn/tags/jenkins/"/>
    
  </entry>
  
  <entry>
    <title>jenkins+sonar 代码质量分析</title>
    <link href="http://www.chen-hao.com.cn/jenkins-sonar-%E4%BB%A3%E7%A0%81%E8%B4%A8%E9%87%8F%E5%88%86%E6%9E%90.html"/>
    <id>http://www.chen-hao.com.cn/jenkins-sonar-代码质量分析.html</id>
    <published>2017-06-02T02:08:44.000Z</published>
    <updated>2017-06-02T08:00:14.528Z</updated>
    
    <content type="html"><![CDATA[<p>Sonar&#x662F;&#x4E00;&#x4E2A;&#x7528;&#x4E8E;&#x4EE3;&#x7801;&#x8D28;&#x91CF;&#x7BA1;&#x7406;&#x7684;&#x5F00;&#x6E90;&#x5E73;&#x53F0;&#xFF0C;&#x7528;&#x4E8E;&#x7BA1;&#x7406;&#x6E90;&#x4EE3;&#x7801;&#x7684;&#x8D28;&#x91CF;&#xFF0C;&#x53EF;&#x4EE5;&#x4ECE;&#x4E03;&#x4E2A;&#x7EF4;&#x5EA6;&#x68C0;&#x6D4B;&#x4EE3;&#x7801;&#x8D28;&#x91CF;&#x3002;<br>&#x901A;&#x8FC7;&#x63D2;&#x4EF6;&#x5F62;&#x5F0F;&#xFF0C;&#x53EF;&#x4EE5;&#x652F;&#x6301;&#x5305;&#x62EC;java,C#,C/C++,PL/SQL,Cobol,JavaScrip,Groovy&#x7B49;&#x7B49;&#x4E8C;&#x5341;&#x51E0;&#x79CD;&#x7F16;&#x7A0B;&#x8BED;&#x8A00;&#x7684;&#x4EE3;&#x7801;&#x8D28;&#x91CF;&#x7BA1;&#x7406;&#x4E0E;&#x68C0;&#x6D4B;&#x3002;<br><a id="more"></a></p>
<p></p><h4 id="&#x5B89;&#x88C5;&#x524D;&#x51C6;&#x5907;">&#x5B89;&#x88C5;&#x524D;&#x51C6;&#x5907;</h4><p></p>
<ol>
<li>Centos 7.1 &#xFF0C;&#x5DF2;&#x5173;&#x95ED; iptables&#x3001;selinux</li>
<li>&#x5185;&#x7F51;gitlab&#x90E8;&#x7F72;&#xFF0C;&#x63A8;&#x8350;&#x6587;&#x7AE0;&#xFF1A; <a href="http://chen-hao.com.cn/%E6%90%AD%E5%BB%BA%E5%86%85%E7%BD%91gitlab%E4%BB%93%E5%BA%93.html#more" target="_blank" rel="external">&#x642D;&#x5EFA;&#x5185;&#x7F51;gitlab&#x4ED3;&#x5E93;</a></li>
<li>&#x5B89;&#x88C5;JDK1.8&#xFF08;&#x8FD9;&#x91CC;&#x5C31;&#x6682;&#x4E0D;&#x6F14;&#x793A;&#xFF09;</li>
<li>jenkins&#x90E8;&#x7F72;&#xFF0C;&#x63A8;&#x8350;&#x6587;&#x7AE0;: </li>
<li>&#x5B89;&#x88C5;MySQL&#x6570;&#x636E;&#x5E93;&#xFF08;&#x63A8;&#x8350;&#x7248;&#x672C;5.6+&#xFF09;</li>
</ol>
<p></p><h4 id="sonarqube-&#x5B89;&#x88C5;">sonarqube &#x5B89;&#x88C5;</h4><p></p>
<p></p><h5 id="&#x4E0B;&#x8F7D;&#x5B89;&#x88C5;&#x5305;">&#x4E0B;&#x8F7D;&#x5B89;&#x88C5;&#x5305;</h5><br>&#x5B98;&#x7F51;&#xFF1A; <a href="https://www.sonarqube.org/downloads/" target="_blank" rel="external">https://www.sonarqube.org/downloads/</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /tmp</div><div class="line">wget https://sonarsource.bintray.com/Distribution/sonarqube/sonarqube-5.6.6.zip</div><div class="line">mkdir /usr/<span class="built_in">local</span>/sonar</div><div class="line">unzip /tmp/sonarqube-5.6.6.zip <span class="_">-d</span> /usr/<span class="built_in">local</span>/sonar</div></pre></td></tr></table></figure><p></p>
<p></p><h5 id="&#x914D;&#x7F6E;sonar&#x542F;&#x52A8;&#x811A;&#x672C;">&#x914D;&#x7F6E;sonar&#x542F;&#x52A8;&#x811A;&#x672C;</h5><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">vim /etc/init.d/sonar</div><div class="line"><span class="meta">#!/bin/sh</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># rc file for SonarQube</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># chkconfig: 345 96 10</span></div><div class="line"><span class="comment"># description: SonarQube system (www.sonarsource.org)</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">### BEGIN INIT INFO</span></div><div class="line"><span class="comment"># Provides: sonar</span></div><div class="line"><span class="comment"># Required-Start: $network</span></div><div class="line"><span class="comment"># Required-Stop: $network</span></div><div class="line"><span class="comment"># Default-Start: 3 4 5</span></div><div class="line"><span class="comment"># Default-Stop: 0 1 2 6</span></div><div class="line"><span class="comment"># Short-Description: SonarQube system (www.sonarsource.org)</span></div><div class="line"><span class="comment"># Description: SonarQube system (www.sonarsource.org)</span></div><div class="line"><span class="comment">### END INIT INFO</span></div><div class="line"></div><div class="line">/usr/bin/sonar $*</div></pre></td></tr></table></figure><p></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">chmod +x /etc/init.d/sonar</div><div class="line">ln <span class="_">-s</span> /usr/<span class="built_in">local</span>/sonar/sonarqube-5.6.6/bin/linux-x86-64/sonar.sh /usr/sbin/sonar</div><div class="line">chkconfig sonar on</div></pre></td></tr></table></figure>
<p></p><h5 id="&#x6570;&#x636E;&#x5E93;&#x914D;&#x7F6E;">&#x6570;&#x636E;&#x5E93;&#x914D;&#x7F6E;</h5><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">CREATE DATABASE sonar CHARACTER SET utf8 COLLATE utf8_general_ci;</div><div class="line">GRANT ALL PRIVILEGES ON sonar.* TO <span class="string">&apos;sonar&apos;</span>@<span class="string">&apos;localhost&apos;</span> IDENTIFIED BY <span class="string">&apos;123456&apos;</span> WITH GRANT OPTION;</div><div class="line">GRANT ALL PRIVILEGES ON sonar.* TO <span class="string">&apos;sonar&apos;</span>@<span class="string">&apos;127.0.0.1&apos;</span> IDENTIFIED BY <span class="string">&apos;123456&apos;</span> WITH GRANT OPTION;</div><div class="line">FLUSH PRIVILEGES;</div></pre></td></tr></table></figure><p></p>
<p></p><h5 id="&#x914D;&#x7F6E;sonar&#x53C2;&#x6570;">&#x914D;&#x7F6E;sonar&#x53C2;&#x6570;</h5><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/sonar/sonarqube-5.6.6/conf</div><div class="line">cp sonar.properties{,.bak}</div><div class="line"></div><div class="line">vim sonar.properties</div><div class="line">sonar.jdbc.username=sonar</div><div class="line">sonar.jdbc.password=123456</div><div class="line">sonar.jdbc.url=jdbc:mysql://10.204.220.4:3306/sonar?useUnicode=<span class="literal">true</span>&amp;characterEncoding=utf8&amp;rewriteBatchedStatements=<span class="literal">true</span>&amp;useConfigs=maxPerformance</div><div class="line"><span class="comment"># &#x8FD9;&#x91CC;&#x6211;&#x53EA;&#x4FEE;&#x6539;&#x4E86;&#x4EE5;&#x4E0A;3&#x9879;&#xFF0C;&#x5176;&#x4ED6;&#x914D;&#x7F6E;&#x4FEE;&#x6539;&#x8BF7;&#x53C2;&#x8003; https://docs.sonarqube.org/display/SONAR/Installing+the+Server</span></div></pre></td></tr></table></figure><p></p>
<p></p><h5 id="&#x5B89;&#x88C5;sonarqube-scanner">&#x5B89;&#x88C5;SonarQube Scanner</h5><br>&#x4E0B;&#x8F7D;&#x5730;&#x5740;&#xFF1A; <a href="https://sonarsource.bintray.com/Distribution/sonar-scanner-cli/" target="_blank" rel="external">https://sonarsource.bintray.com/Distribution/sonar-scanner-cli/</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /tmp</div><div class="line">wget https://sonarsource.bintray.com/Distribution/sonar-scanner-cli/sonar-scanner-2.8.zip</div><div class="line">unzip sonar-scanner-2.8.zip <span class="_">-d</span> /usr/<span class="built_in">local</span>/sonar/</div><div class="line">ln <span class="_">-s</span> /usr/<span class="built_in">local</span>/sonar/sonar-scanner-2.8/bin/sonar-scanner /usr/bin/sonar-scanner</div><div class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/sonar/sonar-scanner-2.8/conf</div><div class="line">cp sonar-scanner.properties{,.bak}</div><div class="line"></div><div class="line">vim sonar-scanner.properties</div><div class="line">sonar.jdbc.url=jdbc:mysql://10.204.220.4:3306/sonar?useUnicode=<span class="literal">true</span>&amp;characterEncoding=utf8&amp;rewriteBatchedStatements=<span class="literal">true</span>&amp;useConfigs=maxPerformance</div><div class="line">sonar.jdbc.username=sonar</div><div class="line">sonar.jdbc.password=123456</div></pre></td></tr></table></figure><p></p>
<p></p><h5 id="&#x5B89;&#x88C5;sonarqube-runner">&#x5B89;&#x88C5;SonarQube runner</h5><br>&#x4E0B;&#x8F7D;&#x5730;&#x5740;&#xFF1A; <a href="http://repo1.maven.org/maven2/org/codehaus/sonar/runner/sonar-runner-dist/" target="_blank" rel="external">http://repo1.maven.org/maven2/org/codehaus/sonar/runner/sonar-runner-dist/</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /tmp</div><div class="line">wget http://repo1.maven.org/maven2/org/codehaus/sonar/runner/sonar-runner-dist/2.4/sonar-runner-dist-2.4.zip</div><div class="line">unzip /tmp/sonar-runner-dist-2.4.zip <span class="_">-d</span> /usr/bin/sonar</div><div class="line">ln <span class="_">-s</span> /usr/<span class="built_in">local</span>/sonar/sonar-runner-2.4/bin/sonar-runner /usr/bin/sonar-runner</div><div class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/sonar/sonar-runner-2.4/conf</div><div class="line">cp sonar-runner.properties{,.bak}</div><div class="line"></div><div class="line">vim sonar-runner.properties</div><div class="line">sonar.jdbc.url=jdbc:mysql://10.204.220.4:3306/sonar?useUnicode=<span class="literal">true</span>&amp;characterEncoding=utf8&amp;rewriteBatchedStatements=<span class="literal">true</span>&amp;useConfigs=maxPerformance</div><div class="line">sonar.jdbc.username=sonar</div><div class="line">sonar.jdbc.password=123456</div></pre></td></tr></table></figure><p></p>
<p></p><h5 id="&#x6DFB;&#x52A0;&#x73AF;&#x5883;&#x53D8;&#x91CF;">&#x6DFB;&#x52A0;&#x73AF;&#x5883;&#x53D8;&#x91CF;</h5><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">vim /etc/profile.d/sonar.sh</div><div class="line"><span class="built_in">export</span> SONAR_HOME=/usr/<span class="built_in">local</span>/sonar/sonarqube-5.6.6</div><div class="line"><span class="built_in">export</span> SONAR_RUNNER_HOME=/usr/<span class="built_in">local</span>/sonar/sonar-runner-2.4</div><div class="line"><span class="built_in">export</span> PATH=<span class="variable">$SONAR_RUNNER_HOME</span>/bin:<span class="variable">$PATH</span></div><div class="line"></div><div class="line">. /etc/profile.d/sonar.sh</div></pre></td></tr></table></figure><p></p>
<p></p><h5 id="&#x542F;&#x52A8;sonar">&#x542F;&#x52A8;sonar</h5><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">/usr/sbin/sonar start</div><div class="line">/usr/sbin/sonar status</div><div class="line"><span class="comment"># &#x9700;&#x8981;&#x7B49; 2-3 &#x5206;&#x949F;, &#x9996;&#x6B21;&#x542F;&#x52A8;&#x9700;&#x8981;&#x7A0D;&#x7B49;&#x4E00;&#x4E0B;</span></div><div class="line">ss -tanlp | grep 9000</div></pre></td></tr></table></figure><p></p>
<ul>
<li>&#x7528;&#x6D4F;&#x89C8;&#x5668;&#x767B;&#x5F55; <a href="http://IP:9000" target="_blank" rel="external">http://IP:9000</a> &#x9ED8;&#x8BA4;&#x7528;&#x6237;&#x662F; admin admin<br><img src="/uploads/sonar1.png" class="blockquote-center"> </li>
</ul>
<p></p><h5 id="&#x5B89;&#x88C5;&#x5FC5;&#x5907;&#x63D2;&#x4EF6;">&#x5B89;&#x88C5;&#x5FC5;&#x5907;&#x63D2;&#x4EF6;</h5><br><img src="/uploads/sonar2.png" class="blockquote-center"><br>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x53BB;&#x66F4;&#x65B0;&#x4E2D;&#x5FC3;&#x53EF;&#x4EE5;&#x5B89;&#x88C5;&#x4E2D;&#x6587;&#x5305;&#xFF0C;&#x70B9;&#x51FB;&#x67E5;&#x627E;&#x5B89;&#x88C5;&#x5373;&#x53EF;<br><img src="/uploads/sonar3.png" class="blockquote-center"> <p></p>
<p>&#x8FD9;&#x91CC;&#x6211;&#x5B89;&#x88C5;&#x7684;&#x63D2;&#x4EF6;&#xFF1A;</p>
<ol>
<li>chinese     &#x4E2D;&#x6587;&#x652F;&#x6301;</li>
<li>php      php&#x4EE3;&#x7801;&#x652F;&#x6301;</li>
<li>Android     Android&#x652F;&#x6301;</li>
</ol>
<p>&#x5B89;&#x88C5;&#x6210;&#x529F;&#x540E;&#xFF0C;&#x91CD;&#x542F; sonarqube &#x670D;&#x52A1;&#xFF0C;&#x518D;&#x6B21;&#x8BBF;&#x95EE;  <a href="http://ip:9000/" target="_blank" rel="external">http://ip:9000/</a>    &#x5373;&#x53EF;&#x770B;&#x5230;&#x4E2D;&#x6587;&#x754C;&#x9762;</p>
<p></p><h4 id="&#x96C6;&#x6210;jenkins&#x914D;&#x7F6E;">&#x96C6;&#x6210;jenkins&#x914D;&#x7F6E;</h4><p></p>
<p></p><h5 id="&#x8BBE;&#x7F6E;sonar-&#x4E2D;-token">&#x8BBE;&#x7F6E;sonar &#x4E2D; token</h5><br>&#x7528; admin &#x7528;&#x6237;&#x767B;&#x9646; sonarQube&#xFF0C;&#x3010;&#x914D;&#x7F6E;&#x3011;&#x2013;&gt;&#x3010;&#x6743;&#x9650;&#x3011; &#x2013;&gt;&#x3010;&#x7528;&#x6237;&#x3011;<br><img src="/uploads/sonar4.png" class="blockquote-center"><br>&#x8F93;&#x5165;admin,&#x5F97;&#x5230;token,&#x590D;&#x5236;&#x6B64;token<br><img src="/uploads/sonar5.png" class="blockquote-center"> <p></p>
<p></p><h5 id="jenkins&#x5B89;&#x88C5;sonar&#x76F8;&#x5173;&#x63D2;&#x4EF6;">jenkins&#x5B89;&#x88C5;sonar&#x76F8;&#x5173;&#x63D2;&#x4EF6;</h5><br>&#x6253;&#x5F00;jenkins &#x3010;&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;&#x3011;&#x2013;&gt; &#x3010;&#x7BA1;&#x7406;&#x63D2;&#x4EF6;&#x3011;  &#x67E5;&#x627E; sonar &#x76F8;&#x5173;&#x6240;&#x6709;&#x63D2;&#x4EF6;<br><img src="/uploads/sonar6.png" class="blockquote-center"><br>&#x8FD9;&#x91CC;&#x56E0;&#x4E3A;&#x6211;&#x4E4B;&#x524D;&#x90FD;&#x5B89;&#x88C5;&#x8FC7;&#xFF0C;&#x6240;&#x4EE5;&#x5C31;&#x6CA1;&#x6709;&#x663E;&#x793A;&#x76F8;&#x5173;&#x63D2;&#x4EF6;&#xFF0C;&#x5168;&#x90E8;&#x5B89;&#x88C5;&#x5373;&#x53EF;<p></p>
<p></p><h5 id="jenkins&#x914D;&#x7F6E;sonar&#x63D2;&#x4EF6;">Jenkins&#x914D;&#x7F6E;Sonar&#x63D2;&#x4EF6;</h5><br>&#x70B9;&#x51FB;&#x3010;&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;&#x3011; &#x2013;&gt; &#x3010;&#x7CFB;&#x7EDF;&#x8BBE;&#x7F6E;]&#x3011; &#x914D;&#x7F6E; Sonar&#xFF0C;&#x8BBE;&#x7F6E;&#x5B8C;&#x4FDD;&#x5B58;<br><img src="/uploads/sonar7.png" class="blockquote-center"> <p></p>
<p></p><h5 id="&#x914D;&#x7F6E;-sonar-scanner&#x626B;&#x63CF;&#x5668;">&#x914D;&#x7F6E; Sonar Scanner&#x626B;&#x63CF;&#x5668;</h5><br>&#x70B9;&#x51FB;&#x3010;&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;&#x3011; &#x2013;&gt; &#x3010;Global Tool Configuration&#x3011;<br><img src="/uploads/sonar8.png" class="blockquote-center"> <p></p>
<p></p><h4 id="&#x6574;&#x5408;&#x6D4B;&#x8BD5;">&#x6574;&#x5408;&#x6D4B;&#x8BD5;</h4><br>&#x5728;jenkins&#x4E2D;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x6D4B;&#x8BD5;&#x9879;&#x76EE;&#xFF0C;&#x5176;&#x4E2D;&#x7684;jenkins&#x914D;&#x7F6E;&#x6BB5;&#x8BE6;&#x60C5;&#x53C2;&#x8003;&#x6211;&#x7684;jenkins&#x90E8;&#x7F72;<br>&#x8FD9;&#x91CC;&#x589E;&#x52A0;&#x4E00;&#x4E2A;&#x6784;&#x5EFA;&#x540E;&#x64CD;&#x4F5C;<br><img src="/uploads/sonar9.png" class="blockquote-center"><br><img src="/uploads/sonar10.png" class="blockquote-center"><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">sonar.projectKey=demo</div><div class="line">sonar.projectName=java demo</div><div class="line">sonar.projectVersion=1.0</div><div class="line">sonar.sources=./</div><div class="line">sonar.language=java</div><div class="line">sonar.dynamicAnalysis=<span class="literal">false</span></div><div class="line">sonar.sourceEncoding=UTF-8</div></pre></td></tr></table></figure><p></p>
<p><img src="/uploads/sonar11.gif" class="blockquote-center"> </p>
<p>&#x57FA;&#x672C;jenkins &#x7ED3;&#x5408; sonar &#x7684;&#x914D;&#x7F6E;&#x5B8C;&#x6210;&#x4E86;&#x3002;</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Sonar是一个用于代码质量管理的开源平台，用于管理源代码的质量，可以从七个维度检测代码质量。&lt;br&gt;通过插件形式，可以支持包括java,C#,C/C++,PL/SQL,Cobol,JavaScrip,Groovy等等二十几种编程语言的代码质量管理与检测。&lt;br&gt;
    
    </summary>
    
      <category term="自动化" scheme="http://www.chen-hao.com.cn/categories/%E8%87%AA%E5%8A%A8%E5%8C%96/"/>
    
    
      <category term="sonar" scheme="http://www.chen-hao.com.cn/tags/sonar/"/>
    
  </entry>
  
  <entry>
    <title>搭建内网gitlab仓库</title>
    <link href="http://www.chen-hao.com.cn/%E6%90%AD%E5%BB%BA%E5%86%85%E7%BD%91gitlab%E4%BB%93%E5%BA%93.html"/>
    <id>http://www.chen-hao.com.cn/搭建内网gitlab仓库.html</id>
    <published>2017-06-01T07:22:55.000Z</published>
    <updated>2017-06-01T07:58:14.068Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>GitLab &#x662F;&#x4E00;&#x4E2A;&#x7528;&#x4E8E;&#x4ED3;&#x5E93;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;&#x7684;&#x5F00;&#x6E90;&#x9879;&#x76EE;&#x3002;&#x4F7F;&#x7528;Git&#x4F5C;&#x4E3A;&#x4EE3;&#x7801;&#x7BA1;&#x7406;&#x5DE5;&#x5177;&#xFF0C;&#x5E76;&#x5728;&#x6B64;&#x57FA;&#x7840;&#x4E0A;&#x642D;&#x5EFA;&#x8D77;&#x6765;&#x7684;web&#x670D;&#x52A1;&#x3002;<br><a id="more"></a></p>
</blockquote>
<h4 id="&#x90E8;&#x7F72;&#x73AF;&#x5883;"> &#x90E8;&#x7F72;&#x73AF;&#x5883; </h4><br><h5 id="&#x5B89;&#x88C5;&#x4F9D;&#x8D56;&#x8F6F;&#x4EF6;"> &#x5B89;&#x88C5;&#x4F9D;&#x8D56;&#x8F6F;&#x4EF6; </h5><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">yum -y install curl policycoreutils openssh-server openssh-clients postfix</div><div class="line">systemctl <span class="built_in">enable</span> postfix</div><div class="line">systemctl start postfix</div></pre></td></tr></table></figure><br><br><h5 id="&#x914D;&#x7F6E;gitlab-yum&#x6E90;">&#x914D;&#x7F6E;gitlab yum&#x6E90;</h5><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">vim /etc/yum.repos.d/gitlab-ce.repo</div><div class="line">[gitlab-ce]</div><div class="line">name=gitlab-ce</div><div class="line">baseurl=http://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7</div><div class="line">repo_gpgcheck=0</div><div class="line">gpgcheck=0</div><div class="line">enabled=1</div><div class="line">gpgkey=https://packages.gitlab.com/gpg.key</div></pre></td></tr></table></figure><br><br><h4 id="&#x5B89;&#x88C5;gitlab-ce">&#x5B89;&#x88C5;gitlab-ce</h4><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install gitlab-ce</div></pre></td></tr></table></figure><br><br><h5 id="&#x914D;&#x7F6E;gitlab-ce">&#x914D;&#x7F6E;gitlab-ce</h5><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">grep -v <span class="string">&quot;#&quot;</span> /etc/gitlab/gitlab.rb | grep -v <span class="string">&quot;^$&quot;</span></div><div class="line">external_url <span class="string">&apos;http://42.159.144.159:9000&apos;</span></div><div class="line">unicorn[<span class="string">&apos;port&apos;</span>] = 9001</div><div class="line"><span class="comment"># &#x5B9A;&#x4E49;gitlab&#x76D1;&#x542C;&#x7684;&#x7AEF;&#x53E3;</span></div><div class="line">unicorn[<span class="string">&apos;listen&apos;</span>] = <span class="string">&apos;0.0.0.0&apos;</span></div><div class="line"><span class="comment"># &#x5B9A;&#x4E49;gitlab&#x7684;IP</span></div><div class="line">gitlab_rails[<span class="string">&apos;gitlab_email_enabled&apos;</span>] = <span class="literal">true</span></div><div class="line">gitlab_rails[<span class="string">&apos;smtp_enable&apos;</span>] = <span class="literal">true</span></div><div class="line">gitlab_rails[<span class="string">&apos;smtp_address&apos;</span>] = <span class="string">&quot;smtp.mxhichina.com&quot;</span></div><div class="line">gitlab_rails[<span class="string">&apos;smtp_port&apos;</span>] = 25</div><div class="line">gitlab_rails[<span class="string">&apos;smtp_user_name&apos;</span>] = <span class="string">&quot;test@test.com&quot;</span></div><div class="line">gitlab_rails[<span class="string">&apos;smtp_password&apos;</span>] = <span class="string">&quot;password&quot;</span></div><div class="line">gitlab_rails[<span class="string">&apos;smtp_domain&apos;</span>] = <span class="string">&quot;smtp.mxhichina.com&quot;</span></div><div class="line">gitlab_rails[<span class="string">&apos;smtp_authentication&apos;</span>] = <span class="string">&quot;plain&quot;</span></div><div class="line">gitlab_rails[<span class="string">&apos;smtp_enable_starttls_auto&apos;</span>] = <span class="literal">true</span></div><div class="line">gitlab_rails[<span class="string">&apos;gitlab_email_from&apos;</span>] = <span class="string">&quot;test@test.com&quot;</span></div><div class="line">user[<span class="string">&apos;git_user_email&apos;</span>] = <span class="string">&quot;test@test.com&quot;</span></div><div class="line">gitlab_rails[<span class="string">&apos;manage_backup_path&apos;</span>] = <span class="literal">true</span></div><div class="line"><span class="comment"># &#x542F;&#x7528;gitlab&#x5907;&#x4EFD;&#x529F;&#x80FD;</span></div><div class="line">gitlab_rails[<span class="string">&apos;backup_path&apos;</span>] = <span class="string">&quot;/data/gitlab_backup&quot;</span></div><div class="line"><span class="comment"># gitlab&#x7684;&#x5907;&#x4EFD;</span></div><div class="line">gitlab_rails[<span class="string">&apos;backup_keep_time&apos;</span>] = 2592000</div><div class="line"><span class="comment"># gitlab&#x5907;&#x4EFD;&#x65F6;&#x95F4;&#xFF0C;&#x79D2;&#x4E3A;&#x5355;&#x4F4D;</span></div><div class="line"><span class="comment"># &#x8FD9;&#x91CC;&#x7684;&#x90AE;&#x7BB1;&#x914D;&#x7F6E;&#x9700;&#x8981;&#x66FF;&#x6362;&#x4E3A;&#x81EA;&#x5DF1;&#x7684;</span></div></pre></td></tr></table></figure><br><br><h5 id="&#x8F7D;&#x5165;&#x914D;&#x7F6E;&#x5E76;&#x542F;&#x52A8;&#x670D;&#x52A1;">&#x8F7D;&#x5165;&#x914D;&#x7F6E;&#x5E76;&#x542F;&#x52A8;&#x670D;&#x52A1;</h5><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">gitlab-ctl reconfigure</div><div class="line">gitlab-ctl start</div></pre></td></tr></table></figure><br><br>&#x542F;&#x52A8;&#x5B8C;&#x6BD5;&#x4E4B;&#x540E;&#x8BBF;&#x95EE;&#x4E4B;&#x524D;&#x914D;&#x7F6E;&#x7684;IP+port&#x5373;&#x53EF;&#xFF0C;&#x9996;&#x6B21;&#x8BBF;&#x95EE;&#x9700;&#x8BBE;&#x7F6E;root&#x7528;&#x6237;&#x5BC6;&#x7801;&#x3002;<br><br><h4 id="&#x5907;&#x4EFD;&#x76F8;&#x5173;">&#x5907;&#x4EFD;&#x76F8;&#x5173;</h4>

<p></p><h5 id="&#x5907;&#x4EFD;">&#x5907;&#x4EFD;</h5><br>&#x5728; gitlab.rb &#x914D;&#x7F6E;&#x4E2D;&#x5F00;&#x542F;gitlab&#x5907;&#x4EFD;&#x5373;&#x53EF;&#xFF0C;&#x4F46;&#x662F;&#x6709;&#x4E00;&#x4E2A;gitlab&#x5BC6;&#x94A5;&#x6587;&#x4EF6;&#x3002;<br>&#x8FD9;&#x4E2A;&#x5BC6;&#x94A5;&#x5305;&#x542B;&#x4E86;&#x6570;&#x636E;&#x5E93;&#x52A0;&#x5BC6;&#x5BC6;&#x94A5;&#x548C;&#x5BC6;&#x94A5;&#x53D8;&#x91CF;&#x3002;&#x5982;&#x679C;&#x4E0D;&#x80FD;&#x6062;&#x590D;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x90A3;&#x4E48;&#x7528;&#x6237;&#x7684;&#x5BC6;&#x7801;&#x5C31;&#x65E0;&#x6CD5;&#x8BBF;&#x95EE;gitlab&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x6253;&#x5F00;&#x9879;&#x76EE;&#x4F1A;&#x62A5;http 500&#x9519;&#x8BEF;&#x3002;<br>&#x6240;&#x4EE5;&#x9700;&#x8981;&#x989D;&#x5916;&#x5199;&#x4E00;&#x4E2A;&#x811A;&#x672C;&#x6765;&#x5907;&#x4EFD;gitlab-secrets.json&#x6587;&#x4EF6;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># gitlab &#x5907;&#x4EFD;&#x811A;&#x672C;</span></div><div class="line"></div><div class="line">JSON_DIR=<span class="string">&apos;/data/gitlab_backup_json&apos;</span></div><div class="line"></div><div class="line"><span class="comment"># gitlab&#x547D;&#x4EE4;&#x5907;&#x4EFD;</span></div><div class="line">/bin/gitlab-rake gitlab:backup:create</div><div class="line"><span class="comment"># &#x5907;&#x4EFD;&#x914D;&#x7F6E;&#x5728; /etc/gitlab/gitlab.rb &#x6587;&#x4EF6;&#x4E2D;&#x914D;&#x7F6E;</span></div><div class="line"></div><div class="line"><span class="comment">#&#x5907;&#x4EFD; json,&#x5426;&#x5219;&#x53EF;&#x80FD;&#x5728;&#x6062;&#x590D;&#x7684;&#x65F6;&#x5019;&#x5BFC;&#x81F4;&#x7528;&#x6237;&#x5BC6;&#x7801;&#x9519;&#x8BEF;&#x95EE;&#x9898;</span></div><div class="line">mkdir <span class="variable">$JSON_DIR</span>/`date +%F`</div><div class="line">cp /etc/gitlab/gitlab-secrets.json <span class="variable">$JSON_DIR</span>/`date +%F`</div></pre></td></tr></table></figure><p></p>
<p>&#x4E4B;&#x540E;&#x52A0;&#x5165;crontab&#x4EFB;&#x52A1;&#x5373;&#x53EF;&#x5B9E;&#x73B0;&#x6BCF;&#x5929;&#x5907;&#x4EFD;</p>
<p></p><h5 id="&#x6062;&#x590D;">&#x6062;&#x590D;</h5><br>&#x6062;&#x590D;&#x5907;&#x4EFD;&#x64CD;&#x4F5C;&#x5982;&#x4E0B;<br>1.&#x6839;&#x636E;&#x5907;&#x4EFD;&#x6587;&#x4EF6;&#x7684;&#x7F16;&#x53F7;&#x6267;&#x884C;&#x5982;&#x4E0B;&#x547D;&#x4EE4;&#x5373;&#x53EF;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gitlab-rake gitlab:backup:restore BACKUP=1470648720</div></pre></td></tr></table></figure><p></p>
<p>2.&#x590D;&#x5236;gitlab-secrets.json&#x6587;&#x4EF6;&#x5230;/etc/gitlab/gitlab-secrets.json&#x76EE;&#x5F55;&#xFF0C;&#x4E0D;&#x7136;&#x6253;&#x5F00;gitlab&#x9879;&#x76EE;&#x4F1A;&#x62A5;500&#x9519;&#x8BEF;<br>3.&#x91CD;&#x542F;gitlab&#x670D;&#x52A1;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gitlab-ctl restart</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;GitLab 是一个用于仓库管理系统的开源项目。使用Git作为代码管理工具，并在此基础上搭建起来的web服务。&lt;br&gt;
    
    </summary>
    
      <category term="自动化" scheme="http://www.chen-hao.com.cn/categories/%E8%87%AA%E5%8A%A8%E5%8C%96/"/>
    
    
      <category term="gitlab" scheme="http://www.chen-hao.com.cn/tags/gitlab/"/>
    
  </entry>
  
  <entry>
    <title>自动化部署</title>
    <link href="http://www.chen-hao.com.cn/%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2.html"/>
    <id>http://www.chen-hao.com.cn/自动化部署.html</id>
    <published>2017-06-01T07:06:47.000Z</published>
    <updated>2017-06-02T08:09:38.735Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>&#x672C;&#x6587;&#x4E3B;&#x8981;&#x8BB0;&#x5F55;&#x7EBF;&#x4E0A;&#x7684;&#x81EA;&#x52A8;&#x5316;&#x53D1;&#x5E03;&#x7684;&#x6D41;&#x7A0B;<br> <a id="more"></a></p>
</blockquote>
<p></p><h4 id="&#x4EE3;&#x7801;&#x7BA1;&#x7406;gitlab">&#x4EE3;&#x7801;&#x7BA1;&#x7406;gitlab</h4><p></p>
<ol>
<li>&#x89C4;&#x8303;&#x6765;&#x8BF4;&#xFF0C;&#x4EFB;&#x4F55;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x5FC5;&#x987B;&#x4E25;&#x683C;&#x4E0E; git &#x4ED3;&#x5E93;&#x4E00;&#x81F4;&#x3002;&#x5373;&#x4E00;&#x5207;&#x63D0;&#x4EA4;&#x5230; master&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x5FC5;&#x987B;&#x77ED;&#x65F6;&#x95F4;&#x5185;&#x4E0A;&#x7EBF;&#xFF0C;&#x53CD;&#x8FC7;&#x6765;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x5728;&#x8FD0;&#x884C;&#x7684;&#x4EE3;&#x7801;&#x4E00;&#x5B9A;&#x662F;&#x5728; git &#x4ED3;&#x5E93;&#x91CC;&#x7684;&#x3002;</li>
<li>&#x5408;&#x7406;&#x4F7F;&#x7528; git &#x5206;&#x652F;&#x3002;master &#x5206;&#x652F;&#x8868;&#x793A;&#x5F53;&#x524D;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x5728;&#x4F7F;&#x7528;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x4E0D;&#x662F;&#x8C01;&#x90FD;&#x53EF;&#x4EE5;&#x63D0;&#x4EA4;&#x7684;&#xFF0C;&#x5FC5;&#x987B;&#x662F;&#x6388;&#x6743;&#x4EBA;&#x5458;&#x624D;&#x80FD;&#x63D0;&#x4EA4;&#x4EE3;&#x7801;&#x5230; master&#x3002;&#x800C;&#x9879;&#x76EE;&#x4E2D;&#xFF0C;&#x6839;&#x636E;&#x4E0D;&#x540C;&#x7684;&#x5F00;&#x53D1;&#x5468;&#x671F;&#xFF0C;&#x8BBE;&#x5B9A;&#x591A;&#x4E2A; &#x5F00;&#x53D1;&#x7279;&#x6027; &#x5206;&#x652F;&#xFF0C;&#x4E00;&#x822C;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x63D0;&#x4EA4;&#x4EE3;&#x7801;&#x5230;&#x5BF9;&#x5E94;&#x7684; &#x5F00;&#x53D1;&#x7279;&#x6027; &#x5206;&#x652F;&#x3002;<br>&#x6D4B;&#x8BD5;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x628A;&#x7279;&#x6027;&#x5206;&#x652F;&#x53D1;&#x5E03;&#x5230;&#x6D4B;&#x8BD5;&#x73AF;&#x5883;&#xFF0C;&#x6D4B;&#x8BD5;&#x4E0D;&#x901A;&#x8FC7;&#xFF0C;&#x7EE7;&#x7EED;&#x4FEE;&#x6539;&#x7279;&#x6027;&#x5206;&#x652F;&#x4EE3;&#x7801;&#x63D0;&#x4EA4;&#x91CD;&#x65B0;&#x53D1;&#x5E03;&#x5230;&#x6D4B;&#x8BD5;&#x73AF;&#x5883;&#x3002;&#x6D4B;&#x8BD5;&#x9A8C;&#x6536;&#x901A;&#x8FC7;&#xFF0C;merge &#x5230; master &#x5206;&#x652F;&#xFF0C;&#x518D;&#x628A; master &#x5206;&#x652F;&#x53D1;&#x5E03;&#x5230;&#x9884;&#x53D1;&#x5E03;&#x73AF;&#x5883;&#x6D4B;&#x8BD5;&#xFF0C;&#x9A8C;&#x6536;&#x901A;&#x8FC7;&#xFF0C;&#x5C06; master &#x5206;&#x652F;&#x53D1;&#x5E03;&#x5230;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x3002;</li>
</ol>
<p>&#x76F8;&#x5173;&#x6587;&#x7AE0;&#xFF1A; <a href="http://chen-hao.com.cn/%E6%90%AD%E5%BB%BA%E5%86%85%E7%BD%91gitlab%E4%BB%93%E5%BA%93.html#more" target="_blank" rel="external">&#x642D;&#x5EFA;&#x5185;&#x7F51;gitlab&#x4ED3;&#x5E93;</a></p>
<p></p><h4 id="&#x81EA;&#x52A8;&#x5316;&#x53D1;&#x5E03;ansible">&#x81EA;&#x52A8;&#x5316;&#x53D1;&#x5E03;ansible</h4><p></p>
<ol>
<li>&#x81EA;&#x52A8;&#x5316;&#x7684;&#x90E8;&#x7F72;&#x4E3B;&#x8981;&#x5C31;&#x662F;&#x670D;&#x52A1;&#x5668;&#x4EE3;&#x7801;&#x7684;&#x66F4;&#x65B0;&#xFF1A;java&#x3001;php</li>
<li>PHP&#x90E8;&#x7F72;&#x53D1;&#x5E03;&#x7684;&#x6548;&#x7387;&#x4E5F;&#x76F8;&#x5BF9;&#x7B80;&#x5355;&#xFF0C;PHP&#x6587;&#x4EF6;&#x53D1;&#x5230;&#x7EBF;&#x4E0A;&#x5373;&#x53EF;&#x8FD0;&#x884C;&#xFF0C;&#x4E0D;&#x7528;&#x590D;&#x6742;&#x7684;&#x7F16;&#x8BD1;&#x3001;&#x6253;&#x5305;&#x548C;&#x542F;&#x505C;&#x52A8;&#x4F5C;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x83B7;&#x53D6;&#x5230;&#x6700;&#x65B0;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x4E00;&#x4E2A;rsync&#x64CD;&#x4F5C;&#x5373;&#x53EF;&#x3002;<br>&#x4F46;&#x662F;&#x5BF9;&#x4E8E;Java&#x5E94;&#x7528;&#x6765;&#x8BF4;&#x6574;&#x4E2A;&#x73AF;&#x8282;&#x5C31;&#x6CA1;&#x6709;&#x8FD9;&#x4E48;&#x7B80;&#x5355;&#x4E86;&#xFF0C;Java&#x6587;&#x4EF6;&#x6D89;&#x53CA;&#x5230;&#x7F16;&#x8BD1;&#x3001;&#x4E8C;&#x65B9;&#x5305;&#x3001;&#x4E09;&#x65B9;&#x5305;&#x4F9D;&#x8D56;&#xFF0C;&#x7136;&#x540E;&#x7F16;&#x8BD1;&#x6253;&#x5305;&#x540E;&#xFF0C;&#x5C06;&#x8F6F;&#x4EF6;&#x5305;&#x53D1;&#x5E03;&#x5230;&#x5236;&#x5B9A;&#x7684;&#x673A;&#x5668;&#x4E0A;&#xFF0C;&#x7136;&#x540E;&#x8FD8;&#x8981;&#x91CD;&#x542F;Java&#x8FDB;&#x7A0B;&#xFF0C;&#x6700;&#x65B0;&#x7684;&#x6587;&#x4EF6;&#x624D;&#x80FD;&#x5F97;&#x4EE5;&#x6267;&#x884C;&#xFF0C;&#x671F;&#x95F4;&#x8FD8;&#x4F1A;&#x6D89;&#x53CA;&#x670D;&#x52A1;&#x7684;&#x6CE8;&#x518C;&#x548C;&#x4E0B;&#x7EBF;&#x95EE;&#x9898;&#x7B49;&#x7B49;&#xFF0C;&#x8FD9;&#x4E9B;&#x90FD;&#x662F;&#x9700;&#x8981;&#x8003;&#x8651;&#x7684;&#x3002;</li>
</ol>
<p>&#x76F8;&#x5173;&#x6587;&#x7AE0;&#xFF1A; &#x5F85;&#x5B8C;&#x5584;</p>
<p></p><h4 id="&#x9879;&#x76EE;&#x6784;&#x5EFA;maven">&#x9879;&#x76EE;&#x6784;&#x5EFA;maven</h4><br>java&#x548C;Android&#x4EE3;&#x7801;&#x90FD;&#x4F1A;&#x6709;&#x4E00;&#x4E9B;jar&#x5305;&#x7684;&#x4F9D;&#x8D56;&#xFF0C;&#x8FD9;&#x4E2A;&#x5305;&#x5728;&#x7F16;&#x8BD1;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x53BB;&#x4E2D;&#x592E;&#x4ED3;&#x5E93;&#x4E0B;&#x8F7D;&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x4F1A;&#x6709;&#x4E00;&#x4E9B;&#x5185;&#x90E8;&#x7684;jar&#x5305;&#x5B58;&#x653E;&#xFF0C;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x5C31;&#x9700;&#x8981;&#x5728;&#x4F01;&#x4E1A;&#x5185;&#x90E8;&#x6709;&#x4E00;&#x4E2A;&#x79C1;&#x670D;&#x4E86;&#x3002;<p></p>
<p>&#x76F8;&#x5173;&#x6587;&#x7AE0;&#xFF1A;<a href="http://www.fblinux.com/?p=455" target="_blank" rel="external">maven&#x4ECB;&#x7ECD;&#x53CA;&#x79C1;&#x670D;&#x642D;&#x5EFA;</a></p>
<p></p><h4 id="&#x96C6;&#x6210;&#x5DE5;&#x5177;jenkins">&#x96C6;&#x6210;&#x5DE5;&#x5177;jenkins</h4><br>jenkins&#x662F;&#x4E00;&#x4E2A;&#x6301;&#x7EED;&#x96C6;&#x6210;&#x5DE5;&#x5177;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x4E00;&#x4E2A;&#x8C03;&#x5EA6;&#x5E73;&#x53F0;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x7684;&#x76EE;&#x7684;&#x53EA;&#x662F;&#x81EA;&#x52A8;&#x5316;&#x90E8;&#x7F72;&#x7684;&#x8BDD;&#xFF0C;&#x76F4;&#x63A5;&#x81EA;&#x5DF1;&#x5199;&#x811A;&#x672C;&#x6216;&#x8005;&#x7528;Ansible&#x3001;Salt&#x3001;Puppet&#x3001;Chef&#x3001;Fabric&#x7B49;&#x81EA;&#x52A8;&#x5316;&#x90E8;&#x7F72;&#x5DE5;&#x5177;&#x5C31;&#x884C;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x662F;&#x60F3;&#x5728;job&#x4E2D;&#x52A0;&#x5165;&#x81EA;&#x52A8;&#x8BDD;&#x90E8;&#x7F72;&#x6D41;&#x7A0B;&#x7684;&#x8BDD;&#xFF0C;&#x53EF;&#x4EE5;&#x5148;&#x5199;&#x597D;&#x81EA;&#x52A8;&#x5316;&#x90E8;&#x7F72;&#x811A;&#x672C;&#x7136;&#x540E;&#x5728;jenkins&#x6784;&#x5EFA;&#x4EFB;&#x52A1;&#x7684;Execute Shell&#x4E2D;&#x8C03;&#x7528;&#x76F8;&#x5E94;&#x7684;Script&#x3002;<p></p>
<p>&#x76F8;&#x5173;&#x6587;&#x7AE0;:    <a href="http://chen-hao.com.cn/jenkins%E9%83%A8%E7%BD%B2%E5%8F%8A%E6%9E%84%E5%BB%BA%E6%96%B9%E5%BC%8F.html#more" target="_blank" rel="external">jenkins&#x90E8;&#x7F72;&#x53CA;&#x6784;&#x5EFA;&#x65B9;&#x5F0F;</a></p>
<p></p><h4 id="&#x4EE3;&#x7801;&#x8D28;&#x91CF;&#x7BA1;&#x7406;sonarqube">&#x4EE3;&#x7801;&#x8D28;&#x91CF;&#x7BA1;&#x7406;sonarqube</h4><br>&#x73B0;&#x5728;&#x7684;&#x4EE3;&#x7801;&#x8D28;&#x91CF;&#x7BA1;&#x7406;&#xFF0C;&#x65E0;&#x975E;&#x5C31;&#x662F;&#x4EBA;&#x4E3A;cide review&#xFF0C;&#x548C;&#x7B2C;&#x4E09;&#x65B9;&#x4EE3;&#x7801;&#x626B;&#x63CF;&#x5DE5;&#x5177;&#xFF08;&#x5BA1;&#x6838;&#x7684;&#x7ED3;&#x679C;&#x8FD8;&#x9700;&#x8981;&#x4EBA;&#x4E3A;&#x7684;&#x9A8C;&#x8BC1;&#xFF09;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x662F;&#x901A;&#x8FC7; jenkins &#x7ED3;&#x5408; sonarqube&#x505A;&#x7684;&#x4E00;&#x4E2A;&#x4EE3;&#x7801;&#x8D28;&#x91CF;&#x5206;&#x6790;&#x5E73;&#x53F0;&#x3002;<p></p>
<p>&#x76F8;&#x5173;&#x6587;&#x7AE0;&#xFF1A; <a href="http://chen-hao.com.cn/jenkins-sonar-%E4%BB%A3%E7%A0%81%E8%B4%A8%E9%87%8F%E5%88%86%E6%9E%90.html#more" target="_blank" rel="external">jenkins+sonar &#x4EE3;&#x7801;&#x8D28;&#x91CF;&#x5206;&#x6790;</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;本文主要记录线上的自动化发布的流程&lt;br&gt;
    
    </summary>
    
      <category term="自动化" scheme="http://www.chen-hao.com.cn/categories/%E8%87%AA%E5%8A%A8%E5%8C%96/"/>
    
    
      <category term="自动化" scheme="http://www.chen-hao.com.cn/tags/%E8%87%AA%E5%8A%A8%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>解决故障的处理思路</title>
    <link href="http://www.chen-hao.com.cn/%E8%A7%A3%E5%86%B3%E6%95%85%E9%9A%9C%E7%9A%84%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF.html"/>
    <id>http://www.chen-hao.com.cn/解决故障的处理思路.html</id>
    <published>2017-01-17T03:45:15.000Z</published>
    <updated>2017-01-17T05:41:35.047Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>&#x5728;&#x6709;&#x90A3;&#x4E48;&#x4E00;&#x77AC;&#x95F4;&#xFF0C;&#x9047;&#x5230;&#x670D;&#x52A1;&#x5668;&#x6545;&#x969C;&#x53EF;&#x80FD;&#x4F1A;&#x624B;&#x8DB3;&#x65E0;&#x63AA;&#xFF0C;&#x5B8C;&#x5168;&#x4E0D;&#x77E5;&#x9053;&#x81EA;&#x5DF1;&#x5E94;&#x8BE5;&#x5E72;&#x4E9B;&#x4EC0;&#x4E48;&#xFF0C;&#x8BE5;&#x5982;&#x4F55;&#x5904;&#x7406;&#x3002;&#x8FD9;&#x91CC;&#x5C31;&#x7B80;&#x5355;&#x8BB0;&#x5F55;&#x4E00;&#x4E0B;&#x89E3;&#x51B3;&#x670D;&#x52A1;&#x5668;&#x6545;&#x969C;&#x7684;&#x601D;&#x8DEF;&#xFF0C;&#x4EE5;&#x4FBF;&#x4ECA;&#x540E;&#x8FC5;&#x901F;&#x5B9A;&#x4F4D;&#x95EE;&#x9898;&#x3002;<br><a id="more"></a></p>
</blockquote>
<p></p><h4 id="&#x95EE;&#x9898;&#x7684;&#x524D;&#x56E0;&#x540E;&#x679C;">&#x95EE;&#x9898;&#x7684;&#x524D;&#x56E0;&#x540E;&#x679C;</h4><br>&#x5C3D;&#x53EF;&#x80FD;&#x641E;&#x6E05;&#x695A;&#x95EE;&#x9898;&#x7684;&#x524D;&#x56E0;&#x540E;&#x679C;&#xFF0C;&#x4E0D;&#x8981;&#x4E00;&#x4E0B;&#x5B50;&#x5C31;&#x624E;&#x5230;&#x670D;&#x52A1;&#x5668;&#x524D;&#x9762;&#xFF0C;&#x4F60;&#x9700;&#x8981;&#x5148;&#x641E;&#x660E;&#x767D;&#x5BF9;&#x8FD9;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x6709;&#x591A;&#x5C11;&#x5DF2;&#x77E5;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x8FD8;&#x6709;&#x6545;&#x969C;&#x7684;&#x5177;&#x4F53;&#x60C5;&#x51B5;&#x3002;&#x4E0D;&#x7136;&#x4F60;&#x5F88;&#x53EF;&#x80FD;&#x5C31;&#x662F;&#x5728;&#x65E0;&#x7684;&#x653E;&#x77E2;<br>&#x5FC5;&#x987B;&#x641E;&#x6E05;&#x695A;&#x7684;&#x95EE;&#x9898;&#x6709;&#xFF1A;<p></p>
<ul>
<li>&#x6545;&#x969C;&#x7684;&#x8868;&#x73B0;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;&#x65E0;&#x54CD;&#x5E94;&#xFF1F;&#x62A5;&#x9519;&#xFF1F;</li>
<li>&#x6545;&#x969C;&#x662F;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x53D1;&#x73B0;&#x7684;&#xFF1F;</li>
<li>&#x6545;&#x969C;&#x662F;&#x5426;&#x53EF;&#x91CD;&#x73B0;&#xFF1F;</li>
<li>&#x6709;&#x6CA1;&#x6709;&#x51FA;&#x73B0;&#x7684;&#x89C4;&#x5F8B;&#xFF08;&#x6BD4;&#x5982;&#x6BCF;&#x5C0F;&#x65F6;&#x51FA;&#x73B0;&#x4E00;&#x6B21;&#xFF09;&#xFF1F;</li>
<li>&#x6700;&#x540E;&#x4E00;&#x6B21;&#x5BF9;&#x6574;&#x4E2A;&#x5E73;&#x53F0;&#x8FDB;&#x884C;&#x66F4;&#x65B0;&#x7684;&#x5185;&#x5BB9;&#x662F;&#x4EC0;&#x4E48;&#xFF08;&#x4EE3;&#x7801;&#x3001;&#x670D;&#x52A1;&#x5668;&#x7B49;&#xFF09;&#xFF1F;</li>
<li>&#x6545;&#x969C;&#x5F71;&#x54CD;&#x7684;&#x7279;&#x5B9A;&#x7528;&#x6237;&#x7FA4;&#x662F;&#x4EC0;&#x4E48;&#x6837;&#x7684;(&#x5DF2;&#x767B;&#x5F55;&#x7684;, &#x9000;&#x51FA;&#x7684;, &#x67D0;&#x4E2A;&#x5730;&#x57DF;&#x7684;&#x2026;)&#xFF1F;</li>
<li>&#x57FA;&#x7840;&#x67B6;&#x6784;&#xFF08;&#x7269;&#x7406;&#x7684;&#x3001;&#x903B;&#x8F91;&#x7684;&#xFF09;&#x7684;&#x6587;&#x6863;&#x662F;&#x5426;&#x80FD;&#x627E;&#x5230;?</li>
<li>&#x662F;&#x5426;&#x6709;&#x76D1;&#x63A7;&#x5E73;&#x53F0;&#x53EF;&#x7528;? </li>
<li>&#x662F;&#x5426;&#x6709;&#x65E5;&#x5FD7;&#x53EF;&#x4EE5;&#x67E5;&#x770B;?</li>
</ul>
<p></p><h4 id="&#x6709;&#x8C01;&#x5728;">&#x6709;&#x8C01;&#x5728;?</h4><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">w</div><div class="line">last</div><div class="line">who /var/<span class="built_in">log</span>/wtmp</div></pre></td></tr></table></figure><p></p>
<p>&#x7528;&#x8FD9;&#x4E09;&#x4E2A;&#x547D;&#x4EE4;&#x770B;&#x770B;&#x90FD;&#x6709;&#x8C01;&#x5728;&#x7EBF;&#xFF0C;&#x6709;&#x54EA;&#x4E9B;&#x7528;&#x6237;&#x8BBF;&#x95EE;&#x8FC7;&#x3002;</p>
<p></p><h4 id="&#x4E4B;&#x524D;&#x53D1;&#x751F;&#x4E86;&#x4EC0;&#x4E48;">&#x4E4B;&#x524D;&#x53D1;&#x751F;&#x4E86;&#x4EC0;&#x4E48;?</h4><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">history</span></div></pre></td></tr></table></figure><p></p>
<p>&#x67E5;&#x770B;&#x4E00;&#x4E0B;&#x4E4B;&#x524D;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x6267;&#x884C;&#x8FC7;&#x7684;&#x547D;&#x4EE4;&#x3002;&#x770B;&#x4E00;&#x4E0B;&#x603B;&#x662F;&#x6CA1;&#x9519;&#x7684;&#xFF0C;&#x52A0;&#x4E0A;&#x524D;&#x9762;&#x770B;&#x7684;&#x8C01;&#x767B;&#x5F55;&#x8FC7;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x5E94;&#x8BE5;&#x6709;&#x70B9;&#x7528;&#x3002;</p>
<p></p><h4 id="&#x73B0;&#x5728;&#x5728;&#x8FD0;&#x884C;&#x7684;&#x8FDB;&#x7A0B;&#x662F;&#x5565;">&#x73B0;&#x5728;&#x5728;&#x8FD0;&#x884C;&#x7684;&#x8FDB;&#x7A0B;&#x662F;&#x5565;?</h4><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pstree <span class="_">-a</span></div><div class="line">ps aux</div></pre></td></tr></table></figure><p></p>
<p>&#x8FD9;&#x90FD;&#x662F;&#x67E5;&#x770B;&#x73B0;&#x6709;&#x8FDB;&#x7A0B;&#x7684;&#x3002; ps aux &#x7684;&#x7ED3;&#x679C;&#x6BD4;&#x8F83;&#x6742;&#x4E71;&#xFF0C; pstree -a &#x7684;&#x7ED3;&#x679C;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#x660E;&#x4E86;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6B63;&#x5728;&#x8FD0;&#x884C;&#x7684;&#x8FDB;&#x7A0B;&#x53CA;&#x76F8;&#x5173;&#x7528;&#x6237;&#x3002;</p>
<p></p><h4 id="&#x76D1;&#x542C;&#x7684;&#x7F51;&#x7EDC;&#x670D;&#x52A1;">&#x76D1;&#x542C;&#x7684;&#x7F51;&#x7EDC;&#x670D;&#x52A1;</h4><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">netstat -auntlp</div></pre></td></tr></table></figure><p></p>
<p>&#x627E;&#x5230;&#x6240;&#x6709;&#x6B63;&#x5728;&#x8FD0;&#x884C;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x68C0;&#x67E5;&#x5B83;&#x4EEC;&#x662F;&#x5426;&#x5E94;&#x8BE5;&#x8FD0;&#x884C;&#x3002;&#x67E5;&#x770B;&#x5404;&#x4E2A;&#x76D1;&#x542C;&#x7AEF;&#x53E3;&#x3002;</p>
<p></p><h4 id="cpu-&#x548C;&#x5185;&#x5B58;">CPU &#x548C;&#x5185;&#x5B58;</h4><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">free -m</div><div class="line">uptime</div><div class="line">top/htop</div></pre></td></tr></table></figure><p></p>
<p><code>&#x6CE8;&#x610F;&#x4EE5;&#x4E0B;&#x95EE;&#x9898;:</code></p>
<ol>
<li>&#x8FD8;&#x6709;&#x7A7A;&#x4F59;&#x7684;&#x5185;&#x5B58;&#x5417;? &#x670D;&#x52A1;&#x5668;&#x662F;&#x5426;&#x6B63;&#x5728;&#x5185;&#x5B58;&#x548C;&#x786C;&#x76D8;&#x4E4B;&#x95F4;&#x8FDB;&#x884C;swap?</li>
<li>&#x8FD8;&#x6709;&#x5269;&#x4F59;&#x7684;CPU&#x5417;? &#x670D;&#x52A1;&#x5668;&#x662F;&#x51E0;&#x6838;&#x7684;? &#x662F;&#x5426;&#x6709;&#x67D0;&#x4E9B;CPU&#x6838;&#x8D1F;&#x8F7D;&#x8FC7;&#x591A;&#x4E86;?</li>
<li>&#x670D;&#x52A1;&#x5668;&#x6700;&#x5927;&#x7684;&#x8D1F;&#x8F7D;&#x6765;&#x81EA;&#x4EC0;&#x4E48;&#x5730;&#x65B9;? &#x5E73;&#x5747;&#x8D1F;&#x8F7D;&#x662F;&#x591A;&#x5C11;?</li>
</ol>
<p></p><h4 id="&#x786C;&#x4EF6;">&#x786C;&#x4EF6;</h4><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">lspci</div><div class="line">dmidecode</div><div class="line">ethtool</div></pre></td></tr></table></figure><p></p>
<p><code>&#x6709;&#x5F88;&#x591A;&#x670D;&#x52A1;&#x5668;&#x53EF;&#x80FD;&#x662F;&#x786C;&#x4EF6;&#x6545;&#x969C;&#xFF0C;&#x5177;&#x4F53;&#x770B;&#x4E00;&#x4E0B;:</code></p>
<ol>
<li>RAID &#x5361; (&#x662F;&#x5426;&#x5E26;BBU&#x5907;&#x7528;&#x7535;&#x6C60;?)</li>
<li>CPU&#x3001;&#x7A7A;&#x4F59;&#x7684;&#x5185;&#x5B58;&#x63D2;&#x69FD;?</li>
<li>&#x7F51;&#x5361;&#x662F;&#x5426;&#x8BBE;&#x7F6E;&#x597D;? &#x662F;&#x5426;&#x6B63;&#x8FD0;&#x884C;&#x5728;&#x534A;&#x53CC;&#x5DE5;&#x72B6;&#x6001;? &#x901F;&#x5EA6;&#x662F;10MBps? &#x6709;&#x6CA1;&#x6709; TX/RX &#x62A5;&#x9519;?</li>
</ol>
<p></p><h4 id="io&#x6027;&#x80FD;">IO&#x6027;&#x80FD;</h4><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">iostat -kx 2</div><div class="line">vmstat 2 10</div><div class="line">mpstat 2 10</div><div class="line">dstat --top-io --top-bio</div></pre></td></tr></table></figure><p></p>
<p><code>&#x5177;&#x4F53;&#x5173;&#x6CE8;&#x4EE5;&#x4E0B;&#x95EE;&#x9898;:</code></p>
<ol>
<li>&#x662F;&#x5426;&#x5F00;&#x542F;&#x4E86;swap&#x4EA4;&#x6362;&#x6A21;&#x5F0F; (si/so)?</li>
<li>CPU&#x88AB;&#x8C01;&#x5360;&#x7528;&#xFF1A;&#x7CFB;&#x7EDF;&#x8FDB;&#x7A0B;? &#x7528;&#x6237;&#x8FDB;&#x7A0B;? &#x865A;&#x62DF;&#x673A;?</li>
<li>&#x670D;&#x52A1;&#x5668;&#x786C;&#x76D8;&#x662F;&#x5426;&#x5DF2;&#x6EE1;?</li>
</ol>
<p></p><h4 id="&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;">&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;</h4><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">mount</div><div class="line">cat /etc/fstab</div><div class="line">vgs/pvs/lvs</div><div class="line">df -h</div><div class="line">lsof</div></pre></td></tr></table></figure><p></p>
<p><code>&#x5177;&#x4F53;&#x5173;&#x6CE8;&#x4EE5;&#x4E0B;&#x95EE;&#x9898;:</code></p>
<ol>
<li>&#x4E00;&#x5171;&#x6302;&#x8F7D;&#x4E86;&#x591A;&#x5C11;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;?</li>
<li>&#x6709;&#x6CA1;&#x6709;&#x67D0;&#x4E2A;&#x670D;&#x52A1;&#x4E13;&#x7528;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;? \</li>
<li>&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x7684;&#x6302;&#x8F7D;&#x9009;&#x9879;&#x662F;&#x4EC0;&#x4E48;&#xFF1A; noatime? default? &#x6709;&#x6CA1;&#x6709;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x88AB;&#x91CD;&#x65B0;&#x6302;&#x8F7D;&#x4E3A;&#x53EA;&#x8BFB;&#x6A21;&#x5F0F;&#x4E86;&#xFF1F;</li>
<li>&#x662F;&#x5426;&#x6709;&#x5927;&#x6587;&#x4EF6;&#x88AB;&#x5220;&#x9664;&#x4F46;&#x6CA1;&#x6709;&#x6E05;&#x7A7A;?</li>
<li>&#x5982;&#x679C;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#x6709;&#x95EE;&#x9898;&#xFF0C;&#x4F60;&#x662F;&#x5426;&#x8FD8;&#x6709;&#x7A7A;&#x95F4;&#x6765;&#x6269;&#x5C55;&#x4E00;&#x4E2A;&#x5206;&#x533A;&#xFF1F;</li>
</ol>
<p></p><h4 id="&#x5185;&#x6838;-&#x4E2D;&#x65AD;&#x548C;&#x7F51;&#x7EDC;">&#x5185;&#x6838;&#x3001;&#x4E2D;&#x65AD;&#x548C;&#x7F51;&#x7EDC;</h4><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">sysctl <span class="_">-a</span> | grep ...</div><div class="line">cat /proc/interrupts</div><div class="line">cat /proc/net/ip_conntrack /* may take some time on busy servers */</div><div class="line">ss <span class="_">-s</span></div></pre></td></tr></table></figure><p></p>
<p><code>&#x5177;&#x4F53;&#x5173;&#x6CE8;&#x4EE5;&#x4E0B;&#x95EE;&#x9898;:</code></p>
<ol>
<li>&#x5185;&#x6838;&#x662F;&#x5426;&#x505A;&#x4EC0;&#x4E48;&#x76F8;&#x5173;&#x4F18;&#x5316;&#xFF1F;</li>
<li>&#x4F60;&#x7684;&#x4E2D;&#x65AD;&#x8BF7;&#x6C42;&#x662F;&#x5426;&#x662F;&#x5747;&#x8861;&#x5730;&#x5206;&#x914D;&#x7ED9;CPU&#x5904;&#x7406;&#xFF0C;&#x8FD8;&#x662F;&#x4F1A;&#x6709;&#x67D0;&#x4E2A;CPU&#x7684;&#x6838;&#x56E0;&#x4E3A;&#x5927;&#x91CF;&#x7684;&#x7F51;&#x7EDC;&#x4E2D;&#x65AD;&#x8BF7;&#x6C42;&#x6216;&#x8005;RAID&#x8BF7;&#x6C42;&#x800C;&#x8FC7;&#x8F7D;&#x4E86;&#xFF1F;</li>
<li>&#x5728;&#x4E0D;&#x540C;&#x72B6;&#x6001;&#x4E0B;(TIME_WAIT, &#x2026;)TCP&#x8FDE;&#x63A5;&#x65F6;&#x95F4;&#x7684;&#x8BBE;&#x7F6E;&#x662F;&#x600E;&#x6837;&#x7684;&#xFF1F;</li>
</ol>
<p></p><h4 id="&#x7CFB;&#x7EDF;&#x65E5;&#x5FD7;">&#x7CFB;&#x7EDF;&#x65E5;&#x5FD7;</h4><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">dmesg</div><div class="line">less /var/<span class="built_in">log</span>/messages</div><div class="line">less /var/<span class="built_in">log</span>/secure</div><div class="line">less /var/<span class="built_in">log</span>/auth</div></pre></td></tr></table></figure><p></p>
<p><code>&#x5177;&#x4F53;&#x5173;&#x6CE8;&#x4EE5;&#x4E0B;&#x95EE;&#x9898;:</code></p>
<ol>
<li>&#x67E5;&#x770B;&#x9519;&#x8BEF;&#x548C;&#x8B66;&#x544A;&#x6D88;&#x606F;&#xFF0C;&#x6BD4;&#x5982;&#x770B;&#x770B;&#x662F;&#x4E0D;&#x662F;&#x5F88;&#x591A;&#x5173;&#x4E8E;&#x8FDE;&#x63A5;&#x6570;&#x8FC7;&#x591A;&#x5BFC;&#x81F4;&#xFF1F;</li>
<li>&#x770B;&#x770B;&#x662F;&#x5426;&#x6709;&#x786C;&#x4EF6;&#x9519;&#x8BEF;&#x6216;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x9519;&#x8BEF;?</li>
</ol>
<p></p><h4 id="&#x5B9A;&#x65F6;&#x4EFB;&#x52A1;">&#x5B9A;&#x65F6;&#x4EFB;&#x52A1;</h4><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ls /etc/cron* + cat</div><div class="line"><span class="keyword">for</span> user <span class="keyword">in</span> $(cat /etc/passwd | cut <span class="_">-f</span>1 <span class="_">-d</span>:); <span class="keyword">do</span> crontab <span class="_">-l</span> -u <span class="variable">$user</span>; <span class="keyword">done</span></div></pre></td></tr></table></figure><p></p>
<p><code>&#x5177;&#x4F53;&#x5173;&#x6CE8;&#x4EE5;&#x4E0B;&#x95EE;&#x9898;:</code></p>
<ol>
<li>&#x662F;&#x5426;&#x6709;&#x67D0;&#x4E2A;&#x5B9A;&#x65F6;&#x4EFB;&#x52A1;&#x8FD0;&#x884C;&#x8FC7;&#x4E8E;&#x9891;&#x7E41;?</li>
<li>&#x662F;&#x5426;&#x6709;&#x4E9B;&#x7528;&#x6237;&#x63D0;&#x4EA4;&#x4E86;&#x9690;&#x85CF;&#x7684;&#x5B9A;&#x65F6;&#x4EFB;&#x52A1;?</li>
<li>&#x5728;&#x51FA;&#x73B0;&#x6545;&#x969C;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x662F;&#x5426;&#x6B63;&#x597D;&#x6709;&#x67D0;&#x4E2A;&#x5907;&#x4EFD;&#x4EFB;&#x52A1;&#x5728;&#x6267;&#x884C;&#xFF1F;</li>
</ol>
<p></p><h4 id="&#x5E94;&#x7528;&#x7CFB;&#x7EDF;&#x65E5;&#x5FD7;">&#x5E94;&#x7528;&#x7CFB;&#x7EDF;&#x65E5;&#x5FD7;</h4><br>&#x8FD9;&#x4E2A;&#x8981;&#x6D89;&#x53CA;&#x7684;&#x5C31;&#x6BD4;&#x8F83;&#x591A;&#x4E86;&#xFF0C;&#x4E0D;&#x8FC7;&#x4E00;&#x822C;&#x662F;&#x5E94;&#x7528;&#x6545;&#x969C;&#x6211;&#x4EEC;&#x67E5;&#x770B;&#x76F8;&#x5173;&#x7684;&#x5E94;&#x7528;&#x65E5;&#x5FD7;&#x5373;&#x53EF;&#x3002;<br>&#x4F8B;&#x5982;&#xFF1A;<br>Apache &amp; Nginx; &#x67E5;&#x627E;&#x8BBF;&#x95EE;&#x548C;&#x9519;&#x8BEF;&#x65E5;&#x5FD7;, &#x76F4;&#x63A5;&#x627E; 5xx &#x9519;&#x8BEF;, &#x518D;&#x770B;&#x770B;&#x662F;&#x5426;&#x6709; limit_zone &#x9519;&#x8BEF;&#x3002;<br>MySQL; &#x5728;mysql.log&#x627E;&#x9519;&#x8BEF;&#x6D88;&#x606F;&#xFF0C;&#x770B;&#x770B;&#x6709;&#x6CA1;&#x6709;&#x7ED3;&#x6784;&#x635F;&#x574F;&#x7684;&#x8868;&#xFF0C; &#x662F;&#x5426;&#x6709;innodb&#x4FEE;&#x590D;&#x8FDB;&#x7A0B;&#x5728;&#x8FD0;&#x884C;&#xFF0C;&#x662F;&#x5426;&#x6709;disk/index/query &#x95EE;&#x9898;.<br>PHP-FPM; &#x5982;&#x679C;&#x8BBE;&#x5B9A;&#x4E86; php-slow &#x65E5;&#x5FD7;, &#x76F4;&#x63A5;&#x627E;&#x9519;&#x8BEF;&#x4FE1;&#x606F; (php, mysql, memcache, &#x2026;)&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x8BBE;&#x5B9A;&#xFF0C;&#x8D76;&#x7D27;&#x8BBE;&#x5B9A;&#x3002;<br>HA-Proxy; &#x540E;&#x7AEF;&#x7684;&#x72B6;&#x51B5;&#x5982;&#x4F55;&#xFF1F;&#x5065;&#x5EB7;&#x72B6;&#x51B5;&#x68C0;&#x67E5;&#x662F;&#x5426;&#x6210;&#x529F;&#xFF1F;&#x662F;&#x524D;&#x7AEF;&#x8FD8;&#x662F;&#x540E;&#x7AEF;&#x7684;&#x961F;&#x5217;&#x5927;&#x5C0F;&#x8FBE;&#x5230;&#x6700;&#x5927;&#x503C;&#x4E86;&#xFF1F;<p></p>
<p></p><h4 id="&#x7ED3;&#x8BBA;">&#x7ED3;&#x8BBA;</h4><br>&#x7ECF;&#x8FC7;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x5904;&#x7406;&#x4E4B;&#x540E;&#xFF0C;&#x5E94;&#x8BE5;&#x5BF9;&#x5982;&#x4E0B;&#x60C5;&#x51B5;&#x6BD4;&#x8F83;&#x6E05;&#x695A;&#x4E86;&#xFF1A;<p></p>
<ol>
<li>&#x5728;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x8FD0;&#x884C;&#x7684;&#x90FD;&#x662F;&#x4E9B;&#x5565;&#xFF1F;</li>
<li>&#x8FD9;&#x4E2A;&#x6545;&#x969C;&#x770B;&#x8D77;&#x6765;&#x662F;&#x548C; IO/&#x786C;&#x4EF6;/&#x7F51;&#x7EDC; &#x6216;&#x8005; &#x7CFB;&#x7EDF;&#x914D;&#x7F6E; (&#x6709;&#x95EE;&#x9898;&#x7684;&#x4EE3;&#x7801;&#x3001;&#x7CFB;&#x7EDF;&#x5185;&#x6838;&#x8C03;&#x4F18;, &#x2026;)&#x76F8;&#x5173;&#xFF1F;</li>
<li>&#x8FD9;&#x4E2A;&#x6545;&#x969C;&#x662F;&#x5426;&#x6709;&#x4F60;&#x719F;&#x6089;&#x7684;&#x4E00;&#x4E9B;&#x7279;&#x5F81;&#xFF1F;&#x6BD4;&#x5982;&#x5BF9;&#x6570;&#x636E;&#x5E93;&#x7D22;&#x5F15;&#x4F7F;&#x7528;&#x4E0D;&#x5F53;&#xFF0C;&#x6216;&#x8005;&#x592A;&#x591A;&#x7684;apache&#x540E;&#x53F0;&#x8FDB;&#x7A0B;&#xFF1F;</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;在有那么一瞬间，遇到服务器故障可能会手足无措，完全不知道自己应该干些什么，该如何处理。这里就简单记录一下解决服务器故障的思路，以便今后迅速定位问题。&lt;br&gt;
    
    </summary>
    
      <category term="故障记录" scheme="http://www.chen-hao.com.cn/categories/%E6%95%85%E9%9A%9C%E8%AE%B0%E5%BD%95/"/>
    
    
      <category term="故障" scheme="http://www.chen-hao.com.cn/tags/%E6%95%85%E9%9A%9C/"/>
    
  </entry>
  
  <entry>
    <title>Tomcat-集群方案</title>
    <link href="http://www.chen-hao.com.cn/Tomcat-%E9%9B%86%E7%BE%A4%E6%96%B9%E6%A1%88.html"/>
    <id>http://www.chen-hao.com.cn/Tomcat-集群方案.html</id>
    <published>2017-01-13T05:50:03.000Z</published>
    <updated>2017-01-16T03:17:16.469Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>&#x591A;&#x4E2A;<code>tomcat</code>&#x8981;&#x4E00;&#x8D77;&#x534F;&#x540C;&#x5DE5;&#x4F5C;&#x6709;&#x591A;&#x79CD;&#x529E;&#x6CD5;&#xFF0C;&#x8FD9;&#x91CC;&#x603B;&#x7ED3;&#x4E00;&#x4E0B;&#x51E0;&#x79CD;&#x65B9;&#x6848;&#x7684;&#x4F18;&#x7F3A;&#x70B9;&#xFF0C;&#x4EE5;&#x53CA;&#x5404;&#x81EA;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x6CD5;&#x3002;<br><a id="more"></a></p>
</blockquote>
<h4 id="&#x96C6;&#x7FA4;&#x65B9;&#x6848;">&#x96C6;&#x7FA4;&#x65B9;&#x6848;</h4>

<table>
<thead>
<tr>
<th>&#x65B9;&#x6848;</th>
<th>&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;</th>
<th>&#x9002;&#x7528;&#x573A;&#x666F;</th>
<th>&#x4F18;&#x70B9;</th>
<th>&#x7F3A;&#x70B9;</th>
</tr>
</thead>
<tbody>
<tr>
<td>session sticky</td>
<td>&#x57FA;&#x4E8E;&#x4E03;&#x5C42;&#x7684;&#x6E90;&#x5730;&#x5740;hash</td>
<td>&#x5C0F;&#x578B;&#x89C4;&#x6A21;</td>
<td>&#x914D;&#x7F6E;&#x7B80;&#x5355;</td>
<td>&#x540E;&#x7AEF;&#x4EFB;&#x4F55;&#x8282;&#x70B9;&#x6389;&#x7EBF;&#xFF0C;session&#x4E22;&#x5931;</td>
</tr>
<tr>
<td>session cluster</td>
<td>tomcat&#x81EA;&#x5E26;&#x96C6;&#x7FA4;&#x65B9;&#x6848;</td>
<td>&#x4E2D;&#x5C0F;&#x578B;&#x89C4;&#x6A21;</td>
<td>&#x914D;&#x7F6E;&#x7B80;&#x5355;</td>
<td>&#x5360;&#x7528;&#x5185;&#x5B58;&#x5927;&#xFF0C;&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x90FD;&#x8981;&#x6301;&#x6709;&#x6574;&#x4E2A;&#x96C6;&#x7FA4;&#x7684;&#x4F1A;&#x8BDD;&#x4FE1;&#x606F;</td>
</tr>
<tr>
<td>session server</td>
<td>&#x5229;&#x7528;memcached&#x6216;redis&#x5C06;session&#x96C6;&#x4E2D;&#x7BA1;&#x7406;</td>
<td>&#x4EFB;&#x4F55;&#x89C4;&#x6A21;</td>
<td>&#x6027;&#x80FD;&#x8F83;&#x597D;</td>
<td>&#x914D;&#x7F6E;&#x590D;&#x6742;</td>
</tr>
</tbody>
</table>
<h4 id="session-stickey">session stickey</h4>

<table>
<thead>
<tr>
<th>&#x4E3B;&#x673A;&#x540D;</th>
<th>IP&#x5730;&#x5740;</th>
<th>&#x7528;&#x9014;</th>
</tr>
</thead>
<tbody>
<tr>
<td>nginx</td>
<td>192.168.4.207</td>
<td>&#x524D;&#x7AEF;&#x8D1F;&#x8F7D; ip_hash</td>
</tr>
<tr>
<td>tomcat1</td>
<td>192.168.4.208</td>
<td>&#x6D4B;&#x8BD5;&#x8282;&#x70B9;1</td>
</tr>
<tr>
<td>tomcat2</td>
<td>192.168.4.207</td>
<td>&#x6D4B;&#x8BD5;&#x8282;&#x70B9;2</td>
</tr>
</tbody>
</table>
<p>&#x5229;&#x7528;<code>nginx/haproxy/httpd</code>&#x57FA;&#x4E8E;&#x8BBF;&#x95EE;ip&#x7684;hash&#x8DEF;&#x7531;&#x7B56;&#x7565;&#xFF0C;&#x4FDD;&#x8BC1;&#x8BBF;&#x95EE;&#x7684;ip&#x59CB;&#x7EC8;&#x88AB;&#x8DEF;&#x7531;&#x5230;&#x540C;&#x4E00;&#x4E2A;tomcat&#x4E0A;&#x3002;</p>
<p></p><h5 id="nginx&#x914D;&#x7F6E;">nginx&#x914D;&#x7F6E;</h5><br>&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x7684;&#x662F;nginx1.8&#xFF0C;&#x5177;&#x4F53;&#x5B89;&#x88C5;&#x6B65;&#x9AA4;&#x6682;&#x4E14;&#x4E0D;&#x8868;&#x3002;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">vim /etc/nginx/nginx.conf</div><div class="line">http {</div><div class="line">...</div><div class="line">    upstream tomcat_cluster {</div><div class="line">        server 192.168.4.208:8080 weight=1;</div><div class="line">        server 192.168.4.209:8080 weight=1;</div><div class="line">        <span class="comment">#ip_hash;</span></div><div class="line">        <span class="comment">#&#x8FD9;&#x91CC;&#x5148;&#x7981;&#x7528;ip hash&#xFF0C;&#x770B;&#x770B;&#x6709;&#x4EC0;&#x4E48;&#x6548;&#x679C;</span></div><div class="line">        }</div><div class="line">   ...</div><div class="line">   server {</div><div class="line">       location / {</div><div class="line">       proxy_pass http://tomcat_cluster;</div><div class="line">       }</div><div class="line">   }</div><div class="line">   ......	</div><div class="line">}</div></pre></td></tr></table></figure><p></p>
<p></p><h5 id="tomcat&#x914D;&#x7F6E;">tomcat&#x914D;&#x7F6E;</h5><br>&#x540C;&#x6837;&#x5B89;&#x88C5;&#x597D;JDK&#x548C;tomcat&#xFF0C;&#x5206;&#x522B;&#x5728;tomcat1&#x548C;tomcat2&#x7684;/webapps/ROOT&#x76EE;&#x5F55;&#x4E0B;&#x521B;&#x5EFA;index.jsp&#x6587;&#x4EF6;&#x3002;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">vim index.jsp </div><div class="line">&lt;%@page language=<span class="string">&quot;java&quot;</span> %&gt;</div><div class="line">    &lt;html&gt;</div><div class="line">        &lt;head&gt;&lt;title&gt;Tomcat111&lt;/title&gt;&lt;/head&gt;</div><div class="line">             &lt;body&gt;</div><div class="line">                 &lt;h1&gt;&lt;font color=<span class="string">&quot;red&quot;</span>&gt;TomcatA.chen-hao.com.cn&lt;/font&gt;&lt;/h1&gt;</div><div class="line">                 &lt;table align=<span class="string">&quot;centre&quot;</span> border=<span class="string">&quot;1&quot;</span>&gt;</div><div class="line">                 &lt;tr&gt;</div><div class="line">                 &lt;td&gt;Session ID&lt;/td&gt;</div><div class="line">                 &lt;% session.setAttribute(<span class="string">&quot;chen-hao.com.cn&quot;</span>,<span class="string">&quot;chen-hao.com.cn&quot;</span>); %&gt;</div><div class="line">                 &lt;td&gt;&lt;%= session.getId() %&gt;&lt;/td&gt;</div><div class="line">                 &lt;/tr&gt;</div><div class="line">                 &lt;tr&gt;</div><div class="line">                 &lt;td&gt;Created on&lt;/td&gt;</div><div class="line">                 &lt;td&gt;&lt;%= session.getCreationTime() %&gt;&lt;/td&gt;</div><div class="line">                 &lt;/tr&gt;</div><div class="line">                 &lt;/table&gt;</div><div class="line">             &lt;/body&gt;</div><div class="line">    &lt;/html&gt;</div></pre></td></tr></table></figure><p></p>
<p>tomcat2 &#x9700;&#x4FEE;&#x6539;<code>&lt;head&gt;&lt;title&gt;Tomcat222&lt;/title&gt;&lt;/head&gt;</code>&#xFF0C;&#x5176;&#x4ED6;&#x4FDD;&#x6301;&#x4E00;&#x81F4;&#x5373;&#x53EF;&#x3002;</p>
<p></p><h5 id="&#x9A8C;&#x8BC1;1">&#x9A8C;&#x8BC1;1</h5><p></p>
<ul>
<li>&#x6CE8;&#x91CA;&#x6389;ip hash&#xFF0C;&#x9A8C;&#x8BC1;&#x5982;&#x4E0B;</li>
</ul>
<p><img src="/uploads/tomcat1.gif" class="blockquote-center"> </p>
<ul>
<li>&#x5F00;&#x542F;ip hash,&#x9A8C;&#x8BC1;&#x5982;&#x4E0B;</li>
</ul>
<p><img src="/uploads/tomcat2.gif" class="blockquote-center"></p>
<h4 id="session-cluster">session cluster</h4>

<table>
<thead>
<tr>
<th>&#x4E3B;&#x673A;&#x540D;</th>
<th>IP&#x5730;&#x5740;</th>
<th>&#x7528;&#x9014;</th>
</tr>
</thead>
<tbody>
<tr>
<td>nginx</td>
<td>192.168.4.207</td>
<td>&#x524D;&#x7AEF;&#x8D1F;&#x8F7D; &#x8F6E;&#x5E8F;&#x8C03;&#x5EA6;</td>
</tr>
<tr>
<td>tomcat1</td>
<td>192.168.4.208</td>
<td>&#x6D4B;&#x8BD5;&#x8282;&#x70B9;1</td>
</tr>
<tr>
<td>tomcat2</td>
<td>192.168.4.207</td>
<td>&#x6D4B;&#x8BD5;&#x8282;&#x70B9;2</td>
</tr>
</tbody>
</table>
<p>&#x4F7F;&#x7528;tomcat&#x81EA;&#x5E26;&#x7684;cluster&#x65B9;&#x5F0F;&#xFF0C;&#x591A;&#x4E2A;tomcat&#x95F4;&#x81EA;&#x52A8;&#x5B9E;&#x65F6;&#x590D;&#x5236;session&#x4FE1;&#x606F;&#x3002;<br>&#x53C2;&#x8003;&#x5B98;&#x65B9;&#x6587;&#x6863;&#xFF1A;<a href="http://tomcat.apache.org/tomcat-7.0-doc/cluster-howto.html" target="_blank" rel="external">http://tomcat.apache.org/tomcat-7.0-doc/cluster-howto.html</a></p>
<p></p><h5 id="tomcat&#x7684;&#x914D;&#x7F6E;">tomcat&#x7684;&#x914D;&#x7F6E;</h5><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">vim conf/server.xml</div><div class="line"></div><div class="line">&lt;Engine name=<span class="string">&quot;Catalina&quot;</span> defaultHost=<span class="string">&quot;localhost&quot;</span> jvmRoute=<span class="string">&quot;Tomcat222&quot;</span>&gt;</div><div class="line"></div><div class="line">&lt;Cluster className=<span class="string">&quot;org.apache.catalina.ha.tcp.SimpleTcpCluster&quot;</span></div><div class="line">truetrue channelSendOptions=<span class="string">&quot;8&quot;</span>&gt;</div><div class="line"></div><div class="line">  &lt;Manager className=<span class="string">&quot;org.apache.catalina.ha.session.DeltaManager&quot;</span></div><div class="line">truetrue   expireSessionsOnShutdown=<span class="string">&quot;false&quot;</span></div><div class="line">truetrue   notifyListenersOnReplication=<span class="string">&quot;true&quot;</span>/&gt;</div><div class="line"></div><div class="line">  &lt;Channel className=<span class="string">&quot;org.apache.catalina.tribes.group.GroupChannel&quot;</span>&gt;</div><div class="line">true&lt;Membership className=<span class="string">&quot;org.apache.catalina.tribes.membership.McastService&quot;</span></div><div class="line">truetruetruetrueaddress=<span class="string">&quot;228.0.0.4&quot;</span></div><div class="line">truetruetruetrueport=<span class="string">&quot;45564&quot;</span></div><div class="line">truetruetruetruefrequency=<span class="string">&quot;500&quot;</span></div><div class="line">truetruetruetruedropTime=<span class="string">&quot;3000&quot;</span>/&gt;</div><div class="line">true&lt;Receiver className=<span class="string">&quot;org.apache.catalina.tribes.transport.nio.NioReceiver&quot;</span></div><div class="line">truetruetrue  address=<span class="string">&quot;auto&quot;</span></div><div class="line">truetruetrue  port=<span class="string">&quot;4000&quot;</span></div><div class="line">truetruetrue  autoBind=<span class="string">&quot;100&quot;</span></div><div class="line">truetruetrue  selectorTimeout=<span class="string">&quot;5000&quot;</span></div><div class="line">truetruetrue  maxThreads=<span class="string">&quot;6&quot;</span>/&gt;</div><div class="line"></div><div class="line">true&lt;Sender className=<span class="string">&quot;org.apache.catalina.tribes.transport.ReplicationTransmitter&quot;</span>&gt;</div><div class="line">true  &lt;Transport className=<span class="string">&quot;org.apache.catalina.tribes.transport.nio.PooledParallelSender&quot;</span>/&gt;</div><div class="line">true&lt;/Sender&gt;</div><div class="line">true&lt;Interceptor className=<span class="string">&quot;org.apache.catalina.tribes.group.interceptors.TcpFailureDetector&quot;</span>/&gt;</div><div class="line">true&lt;Interceptor className=<span class="string">&quot;org.apache.catalina.tribes.group.interceptors.MessageDispatch15Interceptor&quot;</span>/&gt;</div><div class="line">  &lt;/Channel&gt;</div><div class="line"></div><div class="line">  &lt;Valve className=<span class="string">&quot;org.apache.catalina.ha.tcp.ReplicationValve&quot;</span></div><div class="line">truetrue filter=<span class="string">&quot;&quot;</span>/&gt;</div><div class="line">  &lt;Valve className=<span class="string">&quot;org.apache.catalina.ha.session.JvmRouteBinderValve&quot;</span>/&gt;</div><div class="line"></div><div class="line">  &lt;Deployer className=<span class="string">&quot;org.apache.catalina.ha.deploy.FarmWarDeployer&quot;</span></div><div class="line">truetruetruetempDir=<span class="string">&quot;/tmp/war-temp/&quot;</span></div><div class="line">truetruetruedeployDir=<span class="string">&quot;/tmp/war-deploy/&quot;</span></div><div class="line">truetruetruewatchDir=<span class="string">&quot;/tmp/war-listen/&quot;</span></div><div class="line">truetruetruewatchEnabled=<span class="string">&quot;false&quot;</span>/&gt;</div><div class="line"></div><div class="line">  &lt;ClusterListener className=<span class="string">&quot;org.apache.catalina.ha.session.ClusterSessionListener&quot;</span>/&gt;</div><div class="line">&lt;/Cluster&gt;</div></pre></td></tr></table></figure><p></p>
<p>tomcat1&#x548C;tomcat2&#x914D;&#x7F6E;&#x4E00;&#x6837;&#xFF0C;&#x53EA;&#x9700;&#x5206;&#x522B;&#x4FEE;&#x6539;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;Engine name=<span class="string">&quot;Catalina&quot;</span> defaultHost=<span class="string">&quot;localhost&quot;</span> jvmRoute=<span class="string">&quot;Tomcat222&quot;</span>&gt;</div></pre></td></tr></table></figure></p>
<p>&#x5176;&#x4E2D;&#xFF1A;<br>Cluster&#xFF1A;&#x5B9A;&#x4E49;&#x96C6;&#x7FA4;&#xFF1B;&#x53EF;&#x653E;&#x5728;Engine&#x6216;Host&#x914D;&#x7F6E;&#x6BB5;&#x4F46;&#x751F;&#x6548;&#x8303;&#x56F4;&#x4E0D;&#x7528;&#xFF1B;<br>Channel: &#x662F;&#x505A;&#x6210;&#x5458;&#x5173;&#x7CFB;&#x5224;&#x65AD;&#x548C;&#x53D1;&#x9001;&#x3001;&#x63A5;&#x6536;session&#x4FE1;&#x606F;&#xFF1B;<br>Manager&#xFF1A;&#x4F1A;&#x8BDD;&#x7BA1;&#x7406;&#x5668;&#xFF0C;tomcat&#x652F;&#x6301;&#x591A;&#x79CD;&#x7BA1;&#x7406;&#x5668;&#xFF1B;<br>Membership&#xFF1A;&#x5B9A;&#x4E49;&#x96C6;&#x7FA4;&#x6210;&#x5458;&#xFF1B;<br>Receiver&#xFF1A;&#x4F1A;&#x8BDD;&#x63A5;&#x6536;&#x5668;&#xFF1B;<br>Sender&#xFF1A;&#x4F1A;&#x8BDD;&#x53D1;&#x9001;&#x5668;&#xFF1B;<br>&#x6CE8;&#x610F;&#x51E0;&#x70B9;:</p>
<ol>
<li>&#x786E;&#x4FDD;&#x5728;web.xml&#x4E2D;&#x6DFB;&#x52A0;<distributables>&#xFF1B;</distributables></li>
<li>&#x786E;&#x4FDD;<engine>&#x4E0A;&#x9762;&#x6709;jvmRoute=&#x201D;Tomcat222&#x201D;&#x5C5E;&#x6027;&#xFF1B;</engine></li>
<li>&#x786E;&#x4FDD;&#x5404;&#x8282;&#x70B9;&#x95F4;&#x65F6;&#x95F4;&#x662F;&#x540C;&#x6B65;&#x7684;&#xFF1B;</li>
</ol>
<p></p><h5 id="&#x9A8C;&#x8BC1;2">&#x9A8C;&#x8BC1;2</h5><br>&#x8FD9;&#x91CC;&#x518D;&#x8BBF;&#x95EE;&#x524D;&#x7AEF;nginx&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF1A;<br><img src="/uploads/tomcat3.gif" class="blockquote-center"><br>&#x65E0;&#x8BBA;&#x600E;&#x4E48;&#x5237;&#x65B0;SessionID&#x90FD;&#x4E0D;&#x4F1A;&#x53D8;<p></p>
<p></p><h4 id="session-server">session server</h4><br>&#x5229;&#x7528;<code>memcached/redis</code>&#x628A;&#x591A;&#x4E2A;tomcat&#x7684;session&#x96C6;&#x4E2D;&#x7BA1;&#x7406;&#xFF0C;&#x524D;&#x7AEF;&#x5728;&#x5229;&#x7528;nginx&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x548C;&#x52A8;&#x9759;&#x6001;&#x8D44;&#x6E90;&#x5206;&#x79BB;&#xFF0C;&#x5728;&#x517C;&#x987E;&#x7CFB;&#x7EDF;&#x6C34;&#x5E73;&#x6269;&#x5C55;&#x7684;&#x540C;&#x65F6;&#x53C8;&#x80FD;&#x4FDD;&#x8BC1;&#x8F83;&#x9AD8;&#x7684;&#x6027;&#x80FD;&#x3002;<p></p>
<p></p><h5 id="gradle&#x914D;&#x7F6E;">gradle&#x914D;&#x7F6E;</h5><br>&#x7531;&#x4E8E;&#x6E90;&#x7801;&#x6784;&#x5EFA;&#x57FA;&#x4E8E; gradle&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x5148;&#x914D;&#x7F6E; gradle &#x73AF;&#x5883;&#x3002;<br>&#x5B98;&#x7F51;&#x4E0B;&#x8F7D;&#x5730;&#x5740;&#xFF1A;<br><a href="https://gradle.org/gradle-download/" target="_blank" rel="external">https://gradle.org/gradle-download/</a><p></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">curl <span class="_">-s</span> https://get.sdkman.io | bash</div><div class="line">chmod +x /root/.sdkman/bin/sdkman-init.sh</div><div class="line">. /root/.bash_profile</div><div class="line">sdk install gradle 3.3</div></pre></td></tr></table></figure>
<p>&#x786E;&#x8BA4;gradle&#x5B89;&#x88C5;&#x6210;&#x529F;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">gradle</div><div class="line">Starting a Gradle Daemon (subsequent builds will be faster)</div><div class="line">:<span class="built_in">help</span></div><div class="line"></div><div class="line">Welcome to Gradle 3.3.</div><div class="line"></div><div class="line">To run a build, run gradle &lt;task&gt; ...</div><div class="line"></div><div class="line">To see a list of available tasks, run gradle tasks</div><div class="line"></div><div class="line">To see a list of <span class="built_in">command</span>-line options, run gradle --help</div><div class="line"></div><div class="line">To see more detail about a task, run gradle <span class="built_in">help</span> --task &lt;task&gt;</div><div class="line"></div><div class="line">BUILD SUCCESSFUL</div><div class="line"></div><div class="line">Total time: 3.283 secs</div></pre></td></tr></table></figure></p>
<p></p><h5 id="&#x7F16;&#x8BD1;tomcat-redis-session-manager">&#x7F16;&#x8BD1;tomcat-redis-session-manager</h5><br>&#x8BA9;Tomcat&#x628A;&#x4F1A;&#x8BDD;Session&#x4FDD;&#x5B58;&#x5230;Redis&#x6570;&#x636E;&#x5E93;&#x4E2D;&#xFF0C;&#x9700;&#x8981;&#x4F7F;&#x7528;tomcat-redis-session-manager&#x8FD9;&#x6837;&#x7684;&#x7B2C;&#x4E09;&#x65B9;&#x5E93;&#x3002;<br>&#x4E3B;&#x9875;&#x89C1;&#xFF1A; <a href="https://github.com/jcoleman/tomcat-redis-session-manager" target="_blank" rel="external">https://github.com/jcoleman/tomcat-redis-session-manager</a><br>&#x6309;&#x7167;&#x81EA;&#x5DF1;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x7F16;&#x8BD1;&#x591A;&#x6B21;&#x672A;&#x6210;&#x529F;&#xFF0C;&#x8FD9;&#x91CC;&#x76F4;&#x63A5;&#x8D34;&#x51FA;&#x4E00;&#x4E2A;&#x7F16;&#x8BD1;&#x6210;&#x529F;&#x7684;&#x914D;&#x7F6E;&#x3002;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div></pre></td><td class="code"><pre><div class="line">vim build.gradle</div><div class="line"></div><div class="line">apply plugin: <span class="string">&apos;java&apos;</span></div><div class="line">apply plugin: <span class="string">&apos;maven&apos;</span></div><div class="line">apply plugin: <span class="string">&apos;signing&apos;</span></div><div class="line"></div><div class="line">group = <span class="string">&apos;com.orangefunction&apos;</span></div><div class="line">version = <span class="string">&apos;2.0.0&apos;</span></div><div class="line"></div><div class="line">repositories {</div><div class="line">  mavenCentral()</div><div class="line">}</div><div class="line"></div><div class="line">compileJava {</div><div class="line">  <span class="built_in">source</span>Compatibility = 1.7</div><div class="line">  targetCompatibility = 1.7</div><div class="line">}</div><div class="line"></div><div class="line">dependencies {</div><div class="line">  compile group: <span class="string">&apos;org.apache.tomcat&apos;</span>, name: <span class="string">&apos;tomcat-catalina&apos;</span>, version: <span class="string">&apos;7.0.27&apos;</span></div><div class="line">  compile group: <span class="string">&apos;redis.clients&apos;</span>, name: <span class="string">&apos;jedis&apos;</span>, version: <span class="string">&apos;2.5.2&apos;</span></div><div class="line">  compile group: <span class="string">&apos;org.apache.commons&apos;</span>, name: <span class="string">&apos;commons-pool2&apos;</span>, version: <span class="string">&apos;2.2&apos;</span></div><div class="line">  //compile group: <span class="string">&apos;commons-codec&apos;</span>, name: <span class="string">&apos;commons-codec&apos;</span>, version: <span class="string">&apos;1.9&apos;</span></div><div class="line"></div><div class="line">  <span class="built_in">test</span>Compile group: <span class="string">&apos;junit&apos;</span>, name: <span class="string">&apos;junit&apos;</span>, version: <span class="string">&apos;4.+&apos;</span></div><div class="line">  <span class="built_in">test</span>Compile <span class="string">&apos;org.hamcrest:hamcrest-core:1.3&apos;</span></div><div class="line">  <span class="built_in">test</span>Compile <span class="string">&apos;org.hamcrest:hamcrest-library:1.3&apos;</span></div><div class="line">  <span class="built_in">test</span>Compile <span class="string">&apos;org.mockito:mockito-all:1.9.5&apos;</span></div><div class="line">  <span class="built_in">test</span>Compile group: <span class="string">&apos;org.apache.tomcat&apos;</span>, name: <span class="string">&apos;tomcat-coyote&apos;</span>, version: <span class="string">&apos;7.0.27&apos;</span></div><div class="line">}</div><div class="line"></div><div class="line">task javadocJar(<span class="built_in">type</span>: Jar, dependsOn: javadoc) {</div><div class="line">  classifier = <span class="string">&apos;javadoc&apos;</span></div><div class="line">  from <span class="string">&apos;build/docs/javadoc&apos;</span></div><div class="line">}</div><div class="line"></div><div class="line">task sourcesJar(<span class="built_in">type</span>: Jar) {</div><div class="line">  from <span class="built_in">source</span>Sets.main.allSource</div><div class="line">  classifier = <span class="string">&apos;sources&apos;</span></div><div class="line">}</div><div class="line"></div><div class="line">artifacts {</div><div class="line">  archives jar</div><div class="line"></div><div class="line">  archives javadocJar</div><div class="line">  archives sourcesJar</div><div class="line">}</div><div class="line"></div><div class="line">//signing</div><div class="line"> // sign configurations.archives</div><div class="line">  //required = <span class="literal">false</span></div><div class="line">//}</div><div class="line"></div><div class="line"></div><div class="line">uploadArchives {</div><div class="line">  repositories {</div><div class="line">    mavenDeployer {</div><div class="line">      beforeDeployment { MavenDeployment deployment -&gt; signing.signPom(deployment) }</div><div class="line"></div><div class="line">      //repository(url: <span class="string">&quot;https://oss.sonatype.org/service/local/staging/deploy/maven2/&quot;</span>) {</div><div class="line">        //authentication(userName: sonatypeUsername, password: sonatypePassword)</div><div class="line">      //}</div><div class="line">      //repository(url: <span class="string">&quot;https://oss.sonatype.org/content/repositories/snapshots&quot;</span>) {</div><div class="line">      //  authentication(userName: sonatypeUsername, password: sonatypePassword)</div><div class="line">      //}</div><div class="line"></div><div class="line">      pom.project {</div><div class="line">        name <span class="string">&apos;tomcat-redis-session-manager&apos;</span></div><div class="line">        packaging <span class="string">&apos;jar&apos;</span></div><div class="line">        description <span class="string">&apos;Tomcat Redis Session Manager is a Tomcat extension to store sessions in Redis&apos;</span></div><div class="line">        url <span class="string">&apos;https://github.com/jcoleman/tomcat-redis-session-manager&apos;</span></div><div class="line"></div><div class="line">        issueManagement {</div><div class="line">          url <span class="string">&apos;https://github.com:jcoleman/tomcat-redis-session-manager/issues&apos;</span></div><div class="line">          system <span class="string">&apos;GitHub Issues&apos;</span></div><div class="line">        }</div><div class="line"></div><div class="line">        scm {</div><div class="line">          url <span class="string">&apos;https://github.com:jcoleman/tomcat-redis-session-manager&apos;</span></div><div class="line">          connection <span class="string">&apos;scm:git:git://github.com/jcoleman/tomcat-redis-session-manager.git&apos;</span></div><div class="line">          developerConnection <span class="string">&apos;scm:git:git@github.com:jcoleman/tomcat-redis-session-manager.git&apos;</span></div><div class="line">        }</div><div class="line"></div><div class="line">        licenses {</div><div class="line">          license {</div><div class="line">            name <span class="string">&apos;MIT&apos;</span></div><div class="line">            url <span class="string">&apos;http://opensource.org/licenses/MIT&apos;</span></div><div class="line">            distribution <span class="string">&apos;repo&apos;</span></div><div class="line">          }</div><div class="line">        }</div><div class="line"></div><div class="line">        developers {</div><div class="line">          developer {</div><div class="line">            id <span class="string">&apos;jcoleman&apos;</span></div><div class="line">            name <span class="string">&apos;James Coleman&apos;</span></div><div class="line">            email <span class="string">&apos;jtc331@gmail.com&apos;</span></div><div class="line">            url <span class="string">&apos;https://github.com/jcoleman&apos;</span></div><div class="line">          }</div><div class="line">        }</div><div class="line">      }</div><div class="line">    }</div><div class="line">  }</div><div class="line">}</div></pre></td></tr></table></figure><p></p>
<p>&#x6267;&#x884C;&#x7F16;&#x8BD1;&#x547D;&#x4EE4;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">gradle build --stacktrace</div><div class="line">:compileJava</div><div class="line">Download https://repo1.maven.org/maven2/org/apache/tomcat/tomcat-catalina/7.0.27/tomcat-catalina-7.0.27.pom</div><div class="line">Download https://repo1.maven.org/maven2/org/apache/tomcat/tomcat-servlet-api/7.0.27/tomcat-servlet-api-7.0.27.pom</div><div class="line">Download https://repo1.maven.org/maven2/org/apache/tomcat/tomcat-juli/7.0.27/tomcat-juli-7.0.27.pom</div><div class="line">Download https://repo1.maven.org/maven2/org/apache/tomcat/tomcat-annotations-api/7.0.27/tomcat-annotations-api-7.0.27.pom</div><div class="line">Download https://repo1.maven.org/maven2/org/apache/tomcat/tomcat-api/7.0.27/tomcat-api-7.0.27.pom</div><div class="line">Download https://repo1.maven.org/maven2/org/apache/tomcat/tomcat-util/7.0.27/tomcat-util-7.0.27.pom</div><div class="line">Download https://repo1.maven.org/maven2/org/apache/tomcat/tomcat-catalina/7.0.27/tomcat-catalina-7.0.27.jar</div><div class="line">Download https://repo1.maven.org/maven2/redis/clients/jedis/2.5.2/jedis-2.5.2.jar</div><div class="line">Download https://repo1.maven.org/maven2/org/apache/commons/commons-pool2/2.2/commons-pool2-2.2.jar</div><div class="line">Download https://repo1.maven.org/maven2/org/apache/tomcat/tomcat-servlet-api/7.0.27/tomcat-servlet-api-7.0.27.jar</div><div class="line">Download https://repo1.maven.org/maven2/org/apache/tomcat/tomcat-juli/7.0.27/tomcat-juli-7.0.27.jar</div><div class="line">Download https://repo1.maven.org/maven2/org/apache/tomcat/tomcat-annotations-api/7.0.27/tomcat-annotations-api-7.0.27.jar</div><div class="line">Download https://repo1.maven.org/maven2/org/apache/tomcat/tomcat-api/7.0.27/tomcat-api-7.0.27.jar</div><div class="line">Download https://repo1.maven.org/maven2/org/apache/tomcat/tomcat-util/7.0.27/tomcat-util-7.0.27.jar</div><div class="line">warning: [options] bootstrap class path not <span class="built_in">set</span> <span class="keyword">in</span> conjunction with -source 1.7</div><div class="line">1 warning</div><div class="line">:processResources UP-TO-DATE</div><div class="line">:classes</div><div class="line">:jar</div><div class="line">:javadoc</div><div class="line">:javadocJar</div><div class="line">:sourcesJar</div><div class="line">:assemble</div><div class="line">:compileTestJava UP-TO-DATE</div><div class="line">:processTestResources UP-TO-DATE</div><div class="line">:<span class="built_in">test</span>Classes UP-TO-DATE</div><div class="line">:<span class="built_in">test</span> UP-TO-DATE</div><div class="line">:check UP-TO-DATE</div><div class="line">:build</div><div class="line"></div><div class="line">BUILD SUCCESSFUL</div></pre></td></tr></table></figure></p>
<p>&#x5728;tomcat-redis-session-manager/build/libs/&#x76EE;&#x5F55;&#x4E0B;&#x67E5;&#x770B;&#x662F;&#x5426;&#x751F;&#x6210;tomcat-redis-session-manager&#x7684;jar&#x5305;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /work/tomcat-redis-session-manager/build/libs/</div><div class="line">ls</div><div class="line">tomcat-redis-session-manager-2.0.0.jar  tomcat-redis-session-manager-2.0.0-javadoc.jar  tomcat-redis-session-manager-2.0.0-sources.jar</div></pre></td></tr></table></figure></p>
<p>&#x6B64;&#x65F6;&#x53EA;&#x9700;&#x8981;&#x5C06;tomcat-redis-session-manager-2.0.0.jar&#x4EE5;&#x53CA;&#x53E6;&#x5916;&#x4E24;&#x4E2A;&#x4F9D;&#x8D56;&#x5305;&#xFF1A;jedis- 2.5.2.jar&#xFF0C;commons-pool2-2.2.jar&#x4E00;&#x5E76;&#x62F7;&#x5165;tomcat&#x7684;lib&#x76EE;&#x5F55;&#x4E0B;&#x5373;&#x53EF;&#xFF08;&#x4F9D;&#x8D56;&#x5305;&#x53EF;&#x4EE5;&#x5728;gradle&#x7684;&#x7528;&#x6237;&#x76EE;&#x5F55;&#x4E0B;&#x627E;&#x5230;&#xFF09;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">find / -name <span class="string">&apos;jedis-2.5.2.jar&apos;</span></div><div class="line">/root/.gradle/caches/modules-2/files-2.1/redis.clients/jedis/2.5.2/83d833f48052456f197ba55ef2a82<span class="built_in">fc</span>4909880b/jedis-2.5.2.jar</div><div class="line">find -name <span class="string">&apos;commons-pool2-2.2.jar&apos;</span></div><div class="line">./.gradle/caches/modules-2/files-2.1/org.apache.commons/commons-pool2/2.2/bd1a6e384f3cf0f9b9a60e1e6c1c1ecbbee7e0b7/commons-pool2-2.2.jar</div></pre></td></tr></table></figure></p>
<p></p><h5 id="redis&#x914D;&#x7F6E;">redis&#x914D;&#x7F6E;</h5><br>&#x4FEE;&#x6539;&#x914D;&#x7F6E;&#x4F7F;&#x7528; tomcat-redis-session-manager-master &#x4F5C;&#x4E3A; tomcat session &#x7BA1;&#x7406;&#x5668;<p></p>
<ol>
<li>&#x5206;&#x522B;&#x5C06;&#x751F;&#x6210;&#x7684; tomcat-redis-session-manager-master &#x53CA;&#x4F9D;&#x8D56;jar&#x5305;&#x8986;&#x76D6;&#x5230; tomcat &#x5B89;&#x88C5;&#x76EE;&#x5F55;&#x7684; lib &#x6587;&#x4EF6;&#x5939;</li>
<li>&#x5206;&#x522B;&#x4FEE;&#x6539;2&#x53F0; tomcat &#x7684; context.xml &#x6587;&#x4EF6;&#xFF0C;&#x4F7F; tomcat-redis-session-manager-master &#x4F5C;&#x4E3A;session&#x7BA1;&#x7406;&#x5668;&#xFF0C;&#x540C;&#x65F6;&#x6307;&#x5B9A;redis&#x5730;&#x5740;&#x548C;&#x7AEF;&#x53E3;&#x3002;<br>&#x7F16;&#x8F91;context.xml&#x914D;&#x7F6E;&#x6587;&#x4EF6;<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">vim conf/context.xml</div><div class="line">&lt;Context&gt;</div><div class="line">    &lt;Valve className=<span class="string">&quot;com.orangefunction.tomcat.redissessions.RedisSessionHandlerValve&quot;</span> /&gt;</div><div class="line">    &lt;Manager className=<span class="string">&quot;com.orangefunction.tomcat.redissessions.RedisSessionManager&quot;</span></div><div class="line">        host=<span class="string">&quot;127.0.0.1&quot;</span>  &lt;!-- &#x53EF;&#x9009;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;<span class="string">&quot;localhost&quot;</span> --&gt;</div><div class="line">truetruepassword=<span class="string">&quot;abc&quot;</span>    &lt;!-- &#x53EF;&#x9009; --&gt;</div><div class="line">        port=<span class="string">&quot;6379&quot;</span>       &lt;!-- &#x53EF;&#x9009;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F; <span class="string">&quot;6379&quot;</span> --&gt;</div><div class="line">        database=<span class="string">&quot;0&quot;</span>      &lt;!-- &#x53EF;&#x9009;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F; <span class="string">&quot;0&quot;</span> --&gt; </div><div class="line">        maxInactiveInterval=<span class="string">&quot;60&quot;</span>/&gt;    &lt;!-- &#x53EF;&#x9009;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F; <span class="string">&quot;60&quot;</span> &#xFF08;&#x5355;&#x4F4D;&#xFF1A;&#x79D2;&#xFF09;--&gt; /&gt;</div><div class="line">&lt;/Context&gt;</div></pre></td></tr></table></figure>
</li>
</ol>
<p><code>&#x8FD9;&#x91CC;&#x63D0;&#x9192;&#x4E0B;&#xFF0C;&#x4E00;&#x5B9A;&#x8981;&#x6CE8;&#x610F;tomcat&#x7684;&#x7248;&#x672C;&#xFF0C;jdk&#x7684;&#x7248;&#x672C;&#xFF0C;&#x8981;&#x548C;&#x7F16;&#x8BD1;&#x7684;&#x914D;&#x7F6E;&#x586B;&#x7684;&#x7248;&#x672C;&#x4E00;&#x81F4;&#xFF0C;&#x5426;&#x5219;tomcat&#x53EF;&#x80FD;&#x4F1A;&#x62A5;&#x9519;</code><br>redis&#x5B89;&#x88C5;&#x542F;&#x52A8;&#x540E;&#xFF0C;tomcat&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7F16;&#x8F91;&#x5B8C;&#x6210;&#x4E4B;&#x540E;&#xFF0C;&#x5219;&#x91CD;&#x65B0;&#x542F;&#x52A8;tomcat&#x5373;&#x53EF;</p>
<p></p><h5 id="&#x9A8C;&#x8BC1;3">&#x9A8C;&#x8BC1;3</h5><br>&#x8BBF;&#x95EE;&#x7F51;&#x9875;&#x67E5;&#x770B; session id<br><img src="/uploads/tomcat4.png" class="blockquote-center"><br>&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x6211;&#x4EEC;&#x7684; session id &#x4E3A; <code>764A35AC567302EDBA2AC05C4EACC7E7.Tomcat111</code><p></p>
<p>&#x76F4;&#x63A5;&#x5230;&#x540E;&#x7AEF;redis &#x770B;&#x770B;&#x6B64;session&#x662F;&#x5426;&#x4FDD;&#x5B58;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">/usr/<span class="built_in">local</span>/redis-3.0.0/src/redis-cli</div><div class="line">127.0.0.1:6379&gt; get 764A35AC567302EDBA2AC05C4EACC7E7.Tomcat111</div><div class="line"><span class="string">&quot;\xac\xed\x00\x05sr\x00Dcom.orangefunction.tomcat.redissessions.SessionSerializationMetadataB\xd9\xd9\xf7v\xa2\xdbL\x03\x00\x01[\x00\x15sessionAttributesHasht\x00\x02[Bxpw\x14\x00\x00\x00\x10rG\x034\xbe\x9a&gt;F\xd2KN\xf2}\xdb\xde\x7fxsr\x00\x0ejava.lang.Long;\x8b\xe4\x90\xcc\x8f#\xdf\x02\x00\x01J\x00\x05valuexr\x00\x10java.lang.Number\x86\xac\x95\x1d\x0b\x94\xe0\x8b\x02\x00\x00xp\x00\x00\x01Y\xa5)\x96\xccsq\x00~\x00\x03\x00\x00\x01Y\xa5)\x96\xccsr\x00\x11java.lang.Integer\x12\xe2\xa0\xa4\xf7\x81\x878\x02\x00\x01I\x00\x05valuexq\x00~\x00\x04\x00\x00\a\bsr\x00\x11java.lang.Boolean\xcd r\x80\xd5\x9c\xfa\xee\x02\x00\x01Z\x00\x05valuexp\x01q\x00~\x00\nsq\x00~\x00\x03\x00\x00\x01Y\xa5)\x96\xd8t\x00*764A35AC567302EDBA2AC05C4EACC7E7.Tomcat111sq\x00~\x00\a\x00\x00\x00\x01t\x00\x0fchen-hao.com.cnq\x00~\x00\x0ew\b\x00\x00\x01Y\xa5)\x96\xcc&quot;</span></div></pre></td></tr></table></figure></p>
<p>&#x7531;&#x6B64;&#x53EF;&#x89C1;&#xFF0C;session&#x5DF2;&#x7ECF;&#x4FDD;&#x5B58;&#x5728;redis&#x5F53;&#x4E2D;&#xFF0C;&#x8FD9;&#x91CC;&#x6682;&#x4E14;&#x6F14;&#x793A;&#x4E00;&#x53F0;&#xFF0C;&#x81F3;&#x4E8E;&#x591A;&#x53F0;&#xFF0C;&#x540C;&#x6837;&#x914D;&#x7F6E;&#x5373;&#x53EF;&#xFF0C;&#x518D;&#x52A0;&#x4E0A;&#x524D;&#x7AEF;nginx&#xFF0C;tomcat&#x7684;&#x96C6;&#x7FA4;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;多个&lt;code&gt;tomcat&lt;/code&gt;要一起协同工作有多种办法，这里总结一下几种方案的优缺点，以及各自的实现方法。&lt;br&gt;
    
    </summary>
    
      <category term="集群" scheme="http://www.chen-hao.com.cn/categories/%E9%9B%86%E7%BE%A4/"/>
    
    
      <category term="Tomcat" scheme="http://www.chen-hao.com.cn/tags/Tomcat/"/>
    
  </entry>
  
  <entry>
    <title>MongoDB3-x-权限配置</title>
    <link href="http://www.chen-hao.com.cn/mongodb3-x-%E6%9D%83%E9%99%90%E9%85%8D%E7%BD%AE.html"/>
    <id>http://www.chen-hao.com.cn/mongodb3-x-权限配置.html</id>
    <published>2017-01-10T07:35:11.000Z</published>
    <updated>2017-01-10T07:35:56.224Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p><code>MongoDB3.x</code> &#x5B89;&#x5168;&#x6743;&#x9650;&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#xFF0C;&#x5728;&#x6DFB;&#x52A0;&#x7528;&#x6237;&#x4E0A;&#x548C;3.0&#x4E4B;&#x524D;&#x7684;&#x7248;&#x672C;&#x6709;&#x5F88;&#x5927;&#x7684;&#x533A;&#x522B;&#xFF0C;&#x7531;&#x4E8E;&#x521A;&#x63A5;&#x89E6;mongodb&#xFF0C;&#x53EF;&#x662F;&#x5728;&#x8FD9;&#x65B9;&#x9762;&#x8D70;&#x4E86;&#x8BB8;&#x591A;&#x5F2F;&#x8DEF;&#xFF0C;&#x8FD9;&#x91CC;&#x8BF4;&#x660E;&#x4E0B;3.x&#x7684;&#x7528;&#x6237;&#x914D;&#x7F6E;&#x3002;<br><a id="more"></a></p>
</blockquote>
<p></p><h4 id="&#x521B;&#x5EFA;&#x7528;&#x6237;">&#x521B;&#x5EFA;&#x7528;&#x6237;</h4><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&gt; use admin</div><div class="line">switched to db admin</div><div class="line">&gt; db.createUser(</div><div class="line">...   {</div><div class="line">...     user: <span class="string">&quot;dba&quot;</span>,</div><div class="line">...     <span class="built_in">pwd</span>: <span class="string">&quot;dba&quot;</span>,</div><div class="line">...     roles: [ { role: <span class="string">&quot;userAdminAnyDatabase&quot;</span>, db: <span class="string">&quot;admin&quot;</span> } ]</div><div class="line">...   }</div><div class="line">... )</div><div class="line">Successfully added user: {</div><div class="line">    <span class="string">&quot;user&quot;</span> : <span class="string">&quot;dba&quot;</span>,</div><div class="line">    <span class="string">&quot;roles&quot;</span> : [</div><div class="line">        {</div><div class="line">            <span class="string">&quot;role&quot;</span> : <span class="string">&quot;userAdminAnyDatabase&quot;</span>,</div><div class="line">            <span class="string">&quot;db&quot;</span> : <span class="string">&quot;admin&quot;</span></div><div class="line">        }</div><div class="line">    ]</div><div class="line">}</div></pre></td></tr></table></figure><p></p>
<ul>
<li>user&#xFF1A;&#x7528;&#x6237;&#x540D;</li>
<li>pwd&#xFF1A;&#x5BC6;&#x7801;</li>
<li>db : &#x6570;&#x636E;&#x5E93;&#x540D;&#x5B57;</li>
<li>roles&#xFF1A;&#x6307;&#x5B9A;&#x7528;&#x6237;&#x7684;&#x89D2;&#x8272;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x4E00;&#x4E2A;&#x7A7A;&#x6570;&#x7EC4;&#x7ED9;&#x65B0;&#x7528;&#x6237;&#x8BBE;&#x5B9A;&#x7A7A;&#x89D2;&#x8272;&#xFF1B;&#x5728;roles&#x5B57;&#x6BB5;,&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x5185;&#x7F6E;&#x89D2;&#x8272;&#x548C;&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x7684;&#x89D2;&#x8272;&#x3002;</li>
</ul>
<p>role&#x91CC;&#x7684;&#x89D2;&#x8272;&#x53EF;&#x4EE5;&#x9009;&#xFF1A;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">Built-In Roles&#xFF08;&#x5185;&#x7F6E;&#x89D2;&#x8272;&#xFF09;&#xFF1A;</div><div class="line">1. &#x6570;&#x636E;&#x5E93;&#x7528;&#x6237;&#x89D2;&#x8272;&#xFF1A;<span class="built_in">read</span>&#x3001;<span class="built_in">read</span>Write;</div><div class="line">2. &#x6570;&#x636E;&#x5E93;&#x7BA1;&#x7406;&#x89D2;&#x8272;&#xFF1A;dbAdmin&#x3001;dbOwner&#x3001;userAdmin&#xFF1B;</div><div class="line">3. &#x96C6;&#x7FA4;&#x7BA1;&#x7406;&#x89D2;&#x8272;&#xFF1A;clusterAdmin&#x3001;clusterManager&#x3001;clusterMonitor&#x3001;hostManager&#xFF1B;</div><div class="line">4. &#x5907;&#x4EFD;&#x6062;&#x590D;&#x89D2;&#x8272;&#xFF1A;backup&#x3001;restore&#xFF1B;</div><div class="line">5. &#x6240;&#x6709;&#x6570;&#x636E;&#x5E93;&#x89D2;&#x8272;&#xFF1A;<span class="built_in">read</span>AnyDatabase&#x3001;<span class="built_in">read</span>WriteAnyDatabase&#x3001;userAdminAnyDatabase&#x3001;dbAdminAnyDatabase</div><div class="line">6. &#x8D85;&#x7EA7;&#x7528;&#x6237;&#x89D2;&#x8272;&#xFF1A;root  </div><div class="line">// &#x8FD9;&#x91CC;&#x8FD8;&#x6709;&#x51E0;&#x4E2A;&#x89D2;&#x8272;&#x95F4;&#x63A5;&#x6216;&#x76F4;&#x63A5;&#x63D0;&#x4F9B;&#x4E86;&#x7CFB;&#x7EDF;&#x8D85;&#x7EA7;&#x7528;&#x6237;&#x7684;&#x8BBF;&#x95EE;&#xFF08;dbOwner &#x3001;userAdmin&#x3001;userAdminAnyDatabase&#xFF09;</div><div class="line">7. &#x5185;&#x90E8;&#x89D2;&#x8272;&#xFF1A;__system</div><div class="line">&#x5177;&#x4F53;&#x89D2;&#x8272;&#xFF1A;</div><div class="line"><span class="built_in">read</span>&#xFF1A;&#x5141;&#x8BB8;&#x7528;&#x6237;&#x8BFB;&#x53D6;&#x6307;&#x5B9A;&#x6570;&#x636E;&#x5E93;</div><div class="line"><span class="built_in">read</span>Write&#xFF1A;&#x5141;&#x8BB8;&#x7528;&#x6237;&#x8BFB;&#x5199;&#x6307;&#x5B9A;&#x6570;&#x636E;&#x5E93;</div><div class="line">dbAdmin&#xFF1A;&#x5141;&#x8BB8;&#x7528;&#x6237;&#x5728;&#x6307;&#x5B9A;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x6267;&#x884C;&#x7BA1;&#x7406;&#x51FD;&#x6570;&#xFF0C;&#x5982;&#x7D22;&#x5F15;&#x521B;&#x5EFA;&#x3001;&#x5220;&#x9664;&#xFF0C;&#x67E5;&#x770B;&#x7EDF;&#x8BA1;&#x6216;&#x8BBF;&#x95EE;system.profile</div><div class="line">userAdmin&#xFF1A;&#x5141;&#x8BB8;&#x7528;&#x6237;&#x5411;system.users&#x96C6;&#x5408;&#x5199;&#x5165;&#xFF0C;&#x53EF;&#x4EE5;&#x627E;&#x6307;&#x5B9A;&#x6570;&#x636E;&#x5E93;&#x91CC;&#x521B;&#x5EFA;&#x3001;&#x5220;&#x9664;&#x548C;&#x7BA1;&#x7406;&#x7528;&#x6237;</div><div class="line">clusterAdmin&#xFF1A;&#x53EA;&#x5728;admin&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x53EF;&#x7528;&#xFF0C;&#x8D4B;&#x4E88;&#x7528;&#x6237;&#x6240;&#x6709;&#x5206;&#x7247;&#x548C;&#x590D;&#x5236;&#x96C6;&#x76F8;&#x5173;&#x51FD;&#x6570;&#x7684;&#x7BA1;&#x7406;&#x6743;&#x9650;&#x3002;</div><div class="line"><span class="built_in">read</span>AnyDatabase&#xFF1A;&#x53EA;&#x5728;admin&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x53EF;&#x7528;&#xFF0C;&#x8D4B;&#x4E88;&#x7528;&#x6237;&#x6240;&#x6709;&#x6570;&#x636E;&#x5E93;&#x7684;&#x8BFB;&#x6743;&#x9650;</div><div class="line"><span class="built_in">read</span>WriteAnyDatabase&#xFF1A;&#x53EA;&#x5728;admin&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x53EF;&#x7528;&#xFF0C;&#x8D4B;&#x4E88;&#x7528;&#x6237;&#x6240;&#x6709;&#x6570;&#x636E;&#x5E93;&#x7684;&#x8BFB;&#x5199;&#x6743;&#x9650;</div><div class="line">userAdminAnyDatabase&#xFF1A;&#x53EA;&#x5728;admin&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x53EF;&#x7528;&#xFF0C;&#x8D4B;&#x4E88;&#x7528;&#x6237;&#x6240;&#x6709;&#x6570;&#x636E;&#x5E93;&#x7684;userAdmin&#x6743;&#x9650;</div><div class="line">dbAdminAnyDatabase&#xFF1A;&#x53EA;&#x5728;admin&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x53EF;&#x7528;&#xFF0C;&#x8D4B;&#x4E88;&#x7528;&#x6237;&#x6240;&#x6709;&#x6570;&#x636E;&#x5E93;&#x7684;dbAdmin&#x6743;&#x9650;&#x3002;</div><div class="line">root&#xFF1A;&#x53EA;&#x5728;admin&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x53EF;&#x7528;&#x3002;&#x8D85;&#x7EA7;&#x8D26;&#x53F7;&#xFF0C;&#x8D85;&#x7EA7;&#x6743;&#x9650;</div></pre></td></tr></table></figure></p>
<p></p><h4 id="&#x5F00;&#x542F;&#x7528;&#x6237;&#x9A8C;&#x8BC1;">&#x5F00;&#x542F;&#x7528;&#x6237;&#x9A8C;&#x8BC1;</h4><br>&#x65B0;&#x5EFA;mongodb.conf&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x52A0;&#x5165;&#x201C;auth=true&#x201D;<br>&#x4ECE;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x542F;&#x52A8;mongodb&#x670D;&#x52A1;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./bin/mongod <span class="_">-f</span> mongodb.conf</div></pre></td></tr></table></figure><p></p>
<p></p><h4 id="&#x7528;&#x6237;&#x9A8C;&#x8BC1;">&#x7528;&#x6237;&#x9A8C;&#x8BC1;</h4><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[chenhao@localhost mongodb3.2.10]$ ./bin/mongo </div><div class="line">MongoDB shell version: 3.2.10</div><div class="line">connecting to: <span class="built_in">test</span></div><div class="line">&gt; use caideyang</div><div class="line">switched to db caideyang</div><div class="line">&gt; db.auth(<span class="string">&apos;dba&apos;</span>,<span class="string">&apos;dba&apos;</span>)</div><div class="line">1</div></pre></td></tr></table></figure><p></p>
<p></p><h4 id="&#x67E5;&#x8BE2;&#x7528;&#x6237;">&#x67E5;&#x8BE2;&#x7528;&#x6237;</h4><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&gt; show users</div><div class="line">{</div><div class="line">true<span class="string">&quot;_id&quot;</span> : <span class="string">&quot;test.dba&quot;</span>,</div><div class="line">true<span class="string">&quot;user&quot;</span> : <span class="string">&quot;dba&quot;</span>,</div><div class="line">true<span class="string">&quot;db&quot;</span> : <span class="string">&quot;test&quot;</span>,</div><div class="line">true<span class="string">&quot;roles&quot;</span> : [</div><div class="line">truetrue{</div><div class="line">truetruetrue<span class="string">&quot;role&quot;</span> : <span class="string">&quot;userAdminAnyDatabase&quot;</span>,</div><div class="line">truetruetrue<span class="string">&quot;db&quot;</span> : <span class="string">&quot;admin&quot;</span></div><div class="line">truetrue}</div><div class="line">true]</div><div class="line">}</div></pre></td></tr></table></figure><p></p>
<p></p><h4 id="&#x5220;&#x9664;&#x7528;&#x6237;">&#x5220;&#x9664;&#x7528;&#x6237;</h4><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&gt; db.system.users.remove({user:<span class="string">&quot;dba&quot;</span>})</div></pre></td></tr></table></figure><p></p>
<p></p><h4 id="&#x5907;&#x4EFD;&#x6570;&#x636E;&#x5E93;">&#x5907;&#x4EFD;&#x6570;&#x636E;&#x5E93;</h4><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mongodump --port=27020 -u admin -p admin --db=admin -o /root/backup </div><div class="line"><span class="comment">#&#x53C2;&#x6570;&#x8BF4;&#x660E;</span></div><div class="line">--port: mongodb&#x7684;&#x7AEF;&#x53E3;&#x53F7;</div><div class="line">-u:  &#x6267;&#x884C;&#x5907;&#x4EFD;&#x7684;&#x7528;&#x6237;</div><div class="line">-p:  &#x6267;&#x884C;&#x5907;&#x4EFD;&#x7528;&#x6237;&#x7684;&#x5BC6;&#x7801;</div><div class="line">--db&#xFF1A; &#x9700;&#x8981;&#x5907;&#x4EFD;&#x7684;&#x6570;&#x636E;&#x5E93;&#x5B9E;&#x4F8B;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;admin</div><div class="line">-o&#xFF1A; &#x5907;&#x4EFD;&#x7684;&#x6570;&#x636E;&#x5B58;&#x653E;&#x4F4D;&#x7F6E;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;/root/backup</div></pre></td></tr></table></figure><p></p>
<p></p><h4 id="&#x8FD8;&#x539F;&#x6570;&#x636E;&#x5E93;">&#x8FD8;&#x539F;&#x6570;&#x636E;&#x5E93;</h4><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mongorestore --port=27020 -u admin -p admin  --db=admin backup/<span class="built_in">test</span>/</div></pre></td></tr></table></figure><p></p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;MongoDB3.x&lt;/code&gt; 安全权限访问控制，在添加用户上和3.0之前的版本有很大的区别，由于刚接触mongodb，可是在这方面走了许多弯路，这里说明下3.x的用户配置。&lt;br&gt;
    
    </summary>
    
      <category term="NoSQL" scheme="http://www.chen-hao.com.cn/categories/NoSQL/"/>
    
    
      <category term="mongodb" scheme="http://www.chen-hao.com.cn/tags/mongodb/"/>
    
  </entry>
  
  <entry>
    <title>MongoDB3.x-配置文件</title>
    <link href="http://www.chen-hao.com.cn/MongoDB3-x-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6.html"/>
    <id>http://www.chen-hao.com.cn/MongoDB3-x-配置文件.html</id>
    <published>2017-01-10T06:24:00.000Z</published>
    <updated>2017-01-10T07:17:28.526Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p><code>mongodb 3.0</code> &#x6539;&#x53D8;&#x5F88;&#x591A;&#xFF0C;3.0&#x5728;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x4E0A;&#x66F4;&#x6362;&#x6210;&#x4E86;wiredTiger&#xFF0C;&#x5728;&#x6570;&#x636E;&#x538B;&#x7F29;&#x65B9;&#x9762;&#x5F88;&#x6709;&#x6548;&#xFF0C;&#x89E3;&#x51B3;&#x5927;&#x6570;&#x636E;&#x91CF;&#x95EE;&#x9898;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x78C1;&#x76D8;&#x4E0D;&#x591F;&#x7528;&#x7684;&#x95EE;&#x9898;&#x3002;<br>mongodb 3.0 &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x91C7;&#x7528;&#x7684;&#x662F;YAML&#x683C;&#x5F0F;&#xFF0C;&#x53EA;&#x80FD;&#x4F7F;&#x7528;&#x7A7A;&#x683C;&#xFF0C;<code>&#x4E0D;&#x652F;&#x6301;tab&#x952E;</code>&#x3002;<br><a id="more"></a></p>
</blockquote>
<p></p><h4 id="&#x542F;&#x52A8;&#x65B9;&#x5F0F;">&#x542F;&#x52A8;&#x65B9;&#x5F0F;</h4><p></p>
<p></p><h5 id="&#x76F4;&#x63A5;&#x542F;&#x52A8;">&#x76F4;&#x63A5;&#x542F;&#x52A8;</h5><br>&#x76F4;&#x63A5;&#x542F;&#x52A8;&#xFF0C;&#x914D;&#x7F6E;&#x53C2;&#x6570;&#x5199;&#x5728;&#x547D;&#x4EE4;&#x4E2D;&#xFF1A;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mongod --dbpath=data/db --logpath=<span class="built_in">log</span>/log.txt --fork</div></pre></td></tr></table></figure><p></p>
<p></p><h5 id="&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x542F;&#x52A8;">&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x542F;&#x52A8;</h5><br>&#x9996;&#x5148;&#x7F16;&#x8F91;&#x597D;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x4EE5;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x542F;&#x52A8;&#xFF1A;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mongod <span class="_">-f</span> /etc/mongod.conf</div></pre></td></tr></table></figure><p></p>
<p>&#x6216;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mongod --config /etc/mongod.conf</div></pre></td></tr></table></figure></p>
<p></p><h4 id="mongodb&#x76EE;&#x5F55;&#x7ED3;&#x6784;">mongodb&#x76EE;&#x5F55;&#x7ED3;&#x6784;</h4><br>&#x4E00;&#x4E2A;mongod&#x8FDB;&#x7A0B;&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;&#x5DE5;&#x4F5C;&#x76EE;&#x5F55;&#xFF0C;&#x5305;&#x542B;data&#x3001;etc&#x3001;logs 3&#x4E2A;&#x76EE;&#x5F55;&#xFF0C;&#x5206;&#x522B;&#x5B58;&#x50A8;&#x6570;&#x636E;&#x3001;&#x914D;&#x7F6E;&#x3001;&#x4EE5;&#x53CA;&#x8FD0;&#x884C;&#x65E5;&#x5FD7;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">|-- <span class="variable">$mymongo</span></div><div class="line">   |-- data</div><div class="line">      -- ***</div><div class="line">   |-- etc </div><div class="line">      -- keyfile</div><div class="line">      -- mongod.conf</div><div class="line">   |-- logs</div><div class="line">      -- mongod.pid</div><div class="line">      -- mongod.log</div></pre></td></tr></table></figure><p></p>
<p></p><h4 id="mongodb&#x914D;&#x7F6E;&#x6A21;&#x677F;">mongodb&#x914D;&#x7F6E;&#x6A21;&#x677F;</h4><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">systemLog:</div><div class="line">  destination: file</div><div class="line">  <span class="built_in">log</span>Append: <span class="literal">true</span></div><div class="line">  <span class="built_in">log</span>Rotate: rename</div><div class="line">  path: <span class="variable">$mymongo</span>/logs/mongod.log</div><div class="line">  timeStampFormat: iso8601-local</div><div class="line">  traceAllExceptions: <span class="literal">false</span></div><div class="line">  verbosity: 0</div><div class="line"></div><div class="line">processManagement:</div><div class="line">  fork: <span class="literal">true</span></div><div class="line">  pidFilePath: <span class="variable">$mymongo</span>/logs/mongod.pid</div><div class="line"></div><div class="line">net:    </div><div class="line">  <span class="comment">#bindIp: 127.0.0.1</span></div><div class="line">  port: 3001</div><div class="line">  http:</div><div class="line">    enabled: <span class="literal">false</span></div><div class="line">  maxIncomingConnections: 1000</div><div class="line">  unixDomainSocket:</div><div class="line">    enabled: <span class="literal">false</span></div><div class="line"></div><div class="line">operationProfiling:</div><div class="line">  mode: slowOp</div><div class="line">  slowOpThresholdMs: 100    </div><div class="line"></div><div class="line">security:</div><div class="line">  authorization: enabled</div><div class="line">  keyFile: <span class="variable">$mymongo</span>/etc/keyfile</div><div class="line">  javascriptEnabled: <span class="literal">false</span></div><div class="line"></div><div class="line">replication:</div><div class="line">  oplogSizeMB: 5120</div><div class="line">  replSetName: myreplset</div><div class="line"></div><div class="line">storage:</div><div class="line">  dbPath: <span class="variable">$mymongo</span>/data</div><div class="line">  directoryPerDB: <span class="literal">true</span></div><div class="line">  syncPeriodSecs: 60</div><div class="line">  engine: wiredTiger</div><div class="line">  journal:</div><div class="line">    enabled: <span class="literal">true</span></div><div class="line">    commitIntervalMs: 100</div><div class="line">  wiredTiger:</div><div class="line">    engineConfig:</div><div class="line">      cacheSizeGB: 4</div></pre></td></tr></table></figure><p></p>
<ul>
<li>&#x57FA;&#x4E8E;&#x4E0A;&#x8FF0;&#x6A21;&#x677F;&#xFF0C;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x81EA;&#x5DF1;&#x7684;&#x5B9E;&#x9645;&#x60C5;&#x51B5;&#x7A0D;&#x52A0;&#x4FEE;&#x6539;&#xFF0C;&#x4E3B;&#x8981;&#x5173;&#x6CE8;&#x5982;&#x4E0B;&#x53C2;&#x6570;</li>
</ul>
<table>
<thead>
<tr>
<th>&#x53C2;&#x6570;</th>
<th>&#x542B;&#x4E49;</th>
<th>&#x8BF4;&#x660E;</th>
</tr>
</thead>
<tbody>
<tr>
<td>systemLog.verbosity</td>
<td>&#x65E5;&#x5FD7;&#x7EA7;&#x522B;</td>
<td>&#x5EFA;&#x8BAE;&#x8BBE;&#x7F6E;&#x4E3A;0&#xFF0C;&#x5982;&#x60F3;&#x8BB0;&#x5F55;&#x66F4;&#x591A;debug&#x4FE1;&#x606F;&#xFF0C;&#x53EF;&#x4FEE;&#x6539;&#x8BE5;&#x503C;&#x4E3A;1-5&#xFF0C;&#x8D8A;&#x5927;&#x65E5;&#x5FD7;&#x8D8A;&#x8BE6;&#x7EC6;</td>
</tr>
<tr>
<td>net.bindIp</td>
<td>&#x76D1;&#x542C;&#x7684;ip&#x5730;&#x5740;&#x5217;&#x8868;</td>
<td>&#x9ED8;&#x8BA4;&#x76D1;&#x542C;&#x6240;&#x6709;&#x7684;ip&#xFF0C;&#x5982;&#x679C;&#x6709;&#x591A;&#x5757;&#x7F51;&#x5361;&#xFF0C;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x6027;&#x7684;&#x7ED1;&#x5B9A;&#xFF0C;&#x4EE5;&#x9650;&#x5236;&#x4E0D;&#x53EF;&#x4FE1;&#x7684;&#x7F51;&#x7EDC;&#x8BBF;&#x95EE;</td>
</tr>
<tr>
<td>net.port</td>
<td>&#x76D1;&#x542C;&#x65AD;&#x5F00;</td>
<td>&#x9ED8;&#x8BA4;27017&#xFF0C;&#x6839;&#x636E;&#x9700;&#x8981;&#x5B9A;&#x5236;</td>
</tr>
<tr>
<td>net.maxIncomingConnections</td>
<td>&#x6700;&#x5927;&#x8FDE;&#x63A5;&#x6570;</td>
<td>&#x6839;&#x636E;&#x9700;&#x8981;&#x914D;&#x7F6E;&#xFF0C;&#x4FDD;&#x8BC1;&#x7CFB;&#x7EDF;&#x6700;&#x5927;&#x6587;&#x4EF6;&#x53E5;&#x67C4;&#x6570;&#x5927;&#x4E8E;&#x8BE5;&#x503C;&#xFF08;ulimit -n&#xFF09;</td>
</tr>
<tr>
<td>operationProfiling.slowOpThresholdMs</td>
<td>&#x6162;&#x8BF7;&#x6C42;&#x9608;&#x503C;</td>
<td>&#x5982;&#x65E0;&#x7279;&#x6B8A;&#x9700;&#x6C42;&#xFF0C;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528;&#x9ED8;&#x8BA4;&#x7684;100ms&#xFF0C;&#x8D85;&#x8FC7;&#x8BE5;&#x503C;&#x7684;&#x8BF7;&#x6C42;&#x4F1A;&#x8BB0;&#x5F55;&#x5230;&#x5BF9;&#x5E94;db&#x7684;system.profile&#x96C6;&#x5408;&#x91CC;</td>
</tr>
<tr>
<td>replication.replSetName</td>
<td>&#x590D;&#x5236;&#x96C6;&#x540D;&#x5B57;</td>
<td>&#x5F3A;&#x70C8;&#x5EFA;&#x8BAE;&#x90E8;&#x7F72;&#x590D;&#x5236;&#x96C6;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#xFF0C;&#x540D;&#x5B57;&#x968F;&#x4FBF;&#x5B9A;&#x5236;</td>
</tr>
<tr>
<td>replication.oplogSizeMB</td>
<td>oplog&#x5927;&#x5C0F;</td>
<td>&#x9ED8;&#x8BA4;&#x4E3A;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;5%&#xFF0C;&#x65E0;&#x7279;&#x6B8A;&#x9700;&#x6C42;&#x5EFA;&#x8BAE;&#x4FDD;&#x6301;&#x9ED8;&#x8BA4;&#x503C;</td>
</tr>
<tr>
<td>security.authorization</td>
<td>&#x662F;&#x5426;&#x5F00;&#x542F;&#x9274;&#x6743;</td>
<td>&#x5F3A;&#x70C8;&#x5EFA;&#x8BAE;&#x5F00;&#x542F;</td>
</tr>
<tr>
<td>security.keyFile</td>
<td>&#x590D;&#x5236;&#x96C6;&#x5185;&#x90E8;&#x9274;&#x6743;&#x7684;keyfile&#x8DEF;&#x5F84;</td>
<td>&#x590D;&#x5236;&#x96C6;&#x8981;&#x5F00;&#x542F;&#x9274;&#x6743;&#xFF0C;&#x5FC5;&#x987B;&#x914D;&#x7F6E;keyfile&#xFF0C;&#x7528;&#x4E8E;&#x590D;&#x5236;&#x96C6;&#x6210;&#x5458;&#x95F4;&#x7684;&#x9274;&#x6743;</td>
</tr>
<tr>
<td>security.javascriptEnabled</td>
<td>&#x662F;&#x5426;&#x652F;&#x6301;server&#x7AEF;js&#xFF0C;&#x6BD4;&#x5982;$where&#x3001;mapreduce&#x9700;&#x8981;server&#x7AEF;js&#x7684;&#x652F;&#x6301;</td>
<td>&#x5982;&#x65E0;&#x5FC5;&#x8981;&#xFF0C;&#x5EFA;&#x8BAE;&#x5173;&#x95ED;</td>
</tr>
<tr>
<td>storage.directoryPerDB</td>
<td>&#x6BCF;&#x4E2A;db&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684;&#x76EE;&#x5F55;&#x5B58;&#x50A8;</td>
<td>&#x5F3A;&#x70C8;&#x5EFA;&#x8BAE;&#xFF0C;&#x4EE5;&#x5145;&#x5206;&#x53D1;&#x6325;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x4F18;&#x52BF;</td>
</tr>
<tr>
<td>storage.engine</td>
<td>&#x5B58;&#x50A8;&#x5F15;&#x64CE;</td>
<td>&#x5F3A;&#x70C8;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528;wiredtiger&#xFF0C;&#x4F4E;&#x6210;&#x672C; + &#x9AD8;&#x6027;&#x80FD;</td>
</tr>
<tr>
<td>storage.wiredTiger.engineConfig</td>
<td>wireditger cache&#x5927;&#x5C0F;</td>
<td>&#x9ED8;&#x8BA4; max(1, 0.6 * RAM)</td>
</tr>
<tr>
<td>storage.journal.enabled</td>
<td>&#x662F;&#x5426;&#x5F00;&#x542F;journal</td>
<td>&#x5F3A;&#x70C8;&#x5EFA;&#x8BAE;&#x5F00;&#x542F;</td>
</tr>
<tr>
<td>storage.journal.commitIntervalMs    journal</td>
<td>&#x5237;&#x76D8;&#x95F4;&#x9694;</td>
<td>&#x9ED8;&#x8BA4;100ms&#xFF0C;&#x5EFA;&#x8BAE;&#x4FDD;&#x6301;&#x9ED8;&#x8BA4;&#x503C;</td>
</tr>
</tbody>
</table>
<p>&#x66F4;&#x52A0;&#x8BE6;&#x7EC6;&#x8BF7;&#x53C2;&#x8003;&#xFF1A; <a href="https://yq.aliyun.com/articles/68488" target="_blank" rel="external">https://yq.aliyun.com/articles/68488</a></p>
<p></p><h4 id="&#x5176;&#x4ED6;&#x914D;&#x7F6E;&#x53C2;&#x6570;">&#x5176;&#x4ED6;&#x914D;&#x7F6E;&#x53C2;&#x6570;</h4><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line">--quiet    <span class="comment"># &#x5B89;&#x9759;&#x8F93;&#x51FA;</span></div><div class="line">--port arg    <span class="comment"># &#x6307;&#x5B9A;&#x670D;&#x52A1;&#x7AEF;&#x53E3;&#x53F7;&#xFF0C;&#x9ED8;&#x8BA4;&#x7AEF;&#x53E3;27017</span></div><div class="line">--bind_ip arg    <span class="comment"># &#x7ED1;&#x5B9A;&#x670D;&#x52A1;IP&#xFF0C;&#x82E5;&#x7ED1;&#x5B9A;127.0.0.1&#xFF0C;&#x5219;&#x53EA;&#x80FD;&#x672C;&#x673A;&#x8BBF;&#x95EE;&#xFF0C;&#x4E0D;&#x6307;&#x5B9A;&#x9ED8;&#x8BA4;&#x672C;&#x5730;&#x6240;&#x6709;IP</span></div><div class="line">--logpath arg    <span class="comment"># &#x6307;&#x5B9A;MongoDB&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#xFF0C;&#x6CE8;&#x610F;&#x662F;&#x6307;&#x5B9A;&#x6587;&#x4EF6;&#x4E0D;&#x662F;&#x76EE;&#x5F55;</span></div><div class="line">--logappend    <span class="comment"># &#x4F7F;&#x7528;&#x8FFD;&#x52A0;&#x7684;&#x65B9;&#x5F0F;&#x5199;&#x65E5;&#x5FD7;</span></div><div class="line">--pidfilepath arg    <span class="comment"># PID File &#x7684;&#x5B8C;&#x6574;&#x8DEF;&#x5F84;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x8BBE;&#x7F6E;&#xFF0C;&#x5219;&#x6CA1;&#x6709;PID&#x6587;&#x4EF6;</span></div><div class="line">--keyFile arg    <span class="comment"># &#x96C6;&#x7FA4;&#x7684;&#x79C1;&#x94A5;&#x7684;&#x5B8C;&#x6574;&#x8DEF;&#x5F84;&#xFF0C;&#x53EA;&#x5BF9;&#x4E8E;Replica Set &#x67B6;&#x6784;&#x6709;&#x6548;</span></div><div class="line">--unixSocketPrefix arg    <span class="comment"># UNIX&#x57DF;&#x5957;&#x63A5;&#x5B57;&#x66FF;&#x4EE3;&#x76EE;&#x5F55;,(&#x9ED8;&#x8BA4;&#x4E3A; /tmp)</span></div><div class="line">--fork    <span class="comment"># &#x4EE5;&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x7684;&#x65B9;&#x5F0F;&#x8FD0;&#x884C;MongoDB&#xFF0C;&#x521B;&#x5EFA;&#x670D;&#x52A1;&#x5668;&#x8FDB;&#x7A0B;</span></div><div class="line">--auth    <span class="comment"># &#x542F;&#x7528;&#x9A8C;&#x8BC1;</span></div><div class="line">--cpu    <span class="comment"># &#x5B9A;&#x671F;&#x663E;&#x793A;CPU&#x7684;CPU&#x5229;&#x7528;&#x7387;&#x548C;iowait</span></div><div class="line">--dbpath arg    <span class="comment"># &#x6307;&#x5B9A;&#x6570;&#x636E;&#x5E93;&#x8DEF;&#x5F84;</span></div><div class="line">--diaglog arg    <span class="comment"># diaglog&#x9009;&#x9879; 0=off 1=W 2=R 3=both 7=W+some reads</span></div><div class="line">--directoryperdb    <span class="comment"># &#x8BBE;&#x7F6E;&#x6BCF;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x5C06;&#x88AB;&#x4FDD;&#x5B58;&#x5728;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684;&#x76EE;&#x5F55;</span></div><div class="line">--journal    <span class="comment"># &#x542F;&#x7528;&#x65E5;&#x5FD7;&#x9009;&#x9879;&#xFF0C;MongoDB&#x7684;&#x6570;&#x636E;&#x64CD;&#x4F5C;&#x5C06;&#x4F1A;&#x5199;&#x5165;&#x5230;journal&#x6587;&#x4EF6;&#x5939;&#x7684;&#x6587;&#x4EF6;&#x91CC;</span></div><div class="line">--journalOptions arg    <span class="comment"># &#x542F;&#x7528;&#x65E5;&#x5FD7;&#x8BCA;&#x65AD;&#x9009;&#x9879;</span></div><div class="line">--ipv6    <span class="comment"># &#x542F;&#x7528;IPv6&#x9009;&#x9879;</span></div><div class="line">--jsonp    <span class="comment"># &#x5141;&#x8BB8;JSONP&#x5F62;&#x5F0F;&#x901A;&#x8FC7;HTTP&#x8BBF;&#x95EE;&#xFF08;&#x6709;&#x5B89;&#x5168;&#x5F71;&#x54CD;&#xFF09;</span></div><div class="line">--maxConns arg    <span class="comment"># &#x6700;&#x5927;&#x540C;&#x65F6;&#x8FDE;&#x63A5;&#x6570; &#x9ED8;&#x8BA4;2000</span></div><div class="line">--noauth    <span class="comment"># &#x4E0D;&#x542F;&#x7528;&#x9A8C;&#x8BC1;</span></div><div class="line">--nohttpinterface    <span class="comment"># &#x5173;&#x95ED;http&#x63A5;&#x53E3;&#xFF0C;&#x9ED8;&#x8BA4;&#x5173;&#x95ED;27018&#x7AEF;&#x53E3;&#x8BBF;&#x95EE;</span></div><div class="line">--noprealloc    <span class="comment"># &#x7981;&#x7528;&#x6570;&#x636E;&#x6587;&#x4EF6;&#x9884;&#x5206;&#x914D;(&#x5F80;&#x5F80;&#x5F71;&#x54CD;&#x6027;&#x80FD;)</span></div><div class="line">--noscripting    <span class="comment"># &#x7981;&#x7528;&#x811A;&#x672C;&#x5F15;&#x64CE;</span></div><div class="line">--notablescan    <span class="comment"># &#x4E0D;&#x5141;&#x8BB8;&#x8868;&#x626B;&#x63CF;</span></div><div class="line">--nounixsocket    <span class="comment"># &#x7981;&#x7528;Unix&#x5957;&#x63A5;&#x5B57;&#x76D1;&#x542C;</span></div><div class="line">--nssize arg (=16)    <span class="comment"># &#x8BBE;&#x7F6E;&#x4FE1;&#x6570;&#x636E;&#x5E93;.ns&#x6587;&#x4EF6;&#x5927;&#x5C0F;(MB)</span></div><div class="line">--objcheck    <span class="comment"># &#x5728;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x6570;&#x636E;,&#x68C0;&#x67E5;&#x7684;&#x6709;&#x6548;&#x6027;&#xFF0C;</span></div><div class="line">--profile arg    <span class="comment"># &#x6863;&#x6848;&#x53C2;&#x6570; 0=off 1=slow, 2=all</span></div><div class="line">--quota    <span class="comment"># &#x9650;&#x5236;&#x6BCF;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x7684;&#x6587;&#x4EF6;&#x6570;&#xFF0C;&#x8BBE;&#x7F6E;&#x9ED8;&#x8BA4;&#x4E3A;8</span></div><div class="line">--quotaFiles arg    <span class="comment"># number of files allower per db, requires --quota</span></div><div class="line">--rest    <span class="comment"># &#x5F00;&#x542F;&#x7B80;&#x5355;&#x7684;rest API</span></div><div class="line">--repair    <span class="comment"># &#x4FEE;&#x590D;&#x6240;&#x6709;&#x6570;&#x636E;&#x5E93;run repair on all dbs</span></div><div class="line">--repairpath arg    <span class="comment"># &#x4FEE;&#x590D;&#x5E93;&#x751F;&#x6210;&#x7684;&#x6587;&#x4EF6;&#x7684;&#x76EE;&#x5F55;,&#x9ED8;&#x8BA4;&#x4E3A;&#x76EE;&#x5F55;&#x540D;&#x79F0;dbpath</span></div><div class="line">--slowms arg (=100)    <span class="comment"># value of slow for profile and console log</span></div><div class="line">--smallfiles    <span class="comment"># &#x4F7F;&#x7528;&#x8F83;&#x5C0F;&#x7684;&#x9ED8;&#x8BA4;&#x6587;&#x4EF6;</span></div><div class="line">--syncdelay arg (=60)    <span class="comment"># &#x6570;&#x636E;&#x5199;&#x5165;&#x78C1;&#x76D8;&#x7684;&#x65F6;&#x95F4;&#x79D2;&#x6570;(0=never,&#x4E0D;&#x63A8;&#x8350;)</span></div><div class="line">--sysinfo    <span class="comment"># &#x6253;&#x5370;&#x4E00;&#x4E9B;&#x8BCA;&#x65AD;&#x7CFB;&#x7EDF;&#x4FE1;&#x606F;</span></div><div class="line">--upgrade    <span class="comment"># &#x5982;&#x679C;&#x9700;&#x8981;&#x5347;&#x7EA7;&#x6570;&#x636E;&#x5E93; * Replicaton &#x53C2;&#x6570;</span></div><div class="line"></div><div class="line">--------------------------------------------------------------------------------</div><div class="line"></div><div class="line">--fastsync    <span class="comment"># &#x4ECE;&#x4E00;&#x4E2A;dbpath&#x91CC;&#x542F;&#x7528;&#x4ECE;&#x5E93;&#x590D;&#x5236;&#x670D;&#x52A1;&#xFF0C;&#x8BE5;dbpath&#x7684;&#x6570;&#x636E;&#x5E93;&#x662F;&#x4E3B;&#x5E93;&#x7684;&#x5FEB;&#x7167;&#xFF0C;&#x53EF;&#x7528;&#x4E8E;&#x5FEB;&#x901F;&#x542F;&#x7528;&#x540C;&#x6B65;</span></div><div class="line">--autoresync    <span class="comment"># &#x5982;&#x679C;&#x4ECE;&#x5E93;&#x4E0E;&#x4E3B;&#x5E93;&#x540C;&#x6B65;&#x6570;&#x636E;&#x5DEE;&#x5F97;&#x591A;&#xFF0C;&#x81EA;&#x52A8;&#x91CD;&#x65B0;&#x540C;&#x6B65;&#xFF0C;</span></div><div class="line">--oplogSize arg    <span class="comment"># &#x8BBE;&#x7F6E;oplog&#x7684;&#x5927;&#x5C0F;(MB) * &#x4E3B;/&#x4ECE;&#x53C2;&#x6570;</span></div><div class="line"></div><div class="line">--------------------------------------------------------------------------------</div><div class="line"></div><div class="line">--master    <span class="comment"># &#x4E3B;&#x5E93;&#x6A21;&#x5F0F;</span></div><div class="line">--slave    <span class="comment"># &#x4ECE;&#x5E93;&#x6A21;&#x5F0F;</span></div><div class="line">--source arg    <span class="comment"># &#x4ECE;&#x5E93; &#x7AEF;&#x53E3;&#x53F7;</span></div><div class="line">--only arg    <span class="comment"># &#x6307;&#x5B9A;&#x5355;&#x4E00;&#x7684;&#x6570;&#x636E;&#x5E93;&#x590D;&#x5236;</span></div><div class="line">--slavedelay arg    <span class="comment"># &#x8BBE;&#x7F6E;&#x4ECE;&#x5E93;&#x540C;&#x6B65;&#x4E3B;&#x5E93;&#x7684;&#x5EF6;&#x8FDF;&#x65F6;&#x95F4; * Replica set(&#x526F;&#x672C;&#x96C6;)&#x9009;&#x9879;&#xFF1A;</span></div><div class="line"></div><div class="line">--------------------------------------------------------------------------------</div><div class="line"></div><div class="line">--replSet arg    <span class="comment"># &#x8BBE;&#x7F6E;&#x526F;&#x672C;&#x96C6;&#x540D;&#x79F0; * Sharding(&#x5206;&#x7247;)&#x9009;&#x9879;</span></div><div class="line"></div><div class="line">--------------------------------------------------------------------------------</div><div class="line">--configsvr    <span class="comment"># &#x58F0;&#x660E;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x96C6;&#x7FA4;&#x7684;config&#x670D;&#x52A1;,&#x9ED8;&#x8BA4;&#x7AEF;&#x53E3;27019&#xFF0C;&#x9ED8;&#x8BA4;&#x76EE;&#x5F55;/data/configdb</span></div><div class="line">--shardsvr    <span class="comment"># &#x58F0;&#x660E;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x96C6;&#x7FA4;&#x7684;&#x5206;&#x7247;,&#x9ED8;&#x8BA4;&#x7AEF;&#x53E3;27018</span></div><div class="line">--noMoveParanoia    <span class="comment"># &#x5173;&#x95ED;&#x504F;&#x6267;&#x4E3A;moveChunk&#x6570;&#x636E;&#x4FDD;&#x5B58;</span></div></pre></td></tr></table></figure><p></p>
<p>&#x66F4;&#x52A0;&#x8BE6;&#x7EC6;&#x8BF7;&#x53C2;&#x8003;&#xFF1A; <a href="http://www.jianshu.com/p/5844fdfa9511" target="_blank" rel="external">http://www.jianshu.com/p/5844fdfa9511</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;mongodb 3.0&lt;/code&gt; 改变很多，3.0在数据存储引擎上更换成了wiredTiger，在数据压缩方面很有效，解决大数据量问题的情况下，磁盘不够用的问题。&lt;br&gt;mongodb 3.0 配置文件采用的是YAML格式，只能使用空格，&lt;code&gt;不支持tab键&lt;/code&gt;。&lt;br&gt;
    
    </summary>
    
      <category term="NoSQL" scheme="http://www.chen-hao.com.cn/categories/NoSQL/"/>
    
    
      <category term="mongodb" scheme="http://www.chen-hao.com.cn/tags/mongodb/"/>
    
  </entry>
  
  <entry>
    <title>优化内核参数提高服务器并发处理能力</title>
    <link href="http://www.chen-hao.com.cn/%E4%BC%98%E5%8C%96%E5%86%85%E6%A0%B8%E5%8F%82%E6%95%B0%E6%8F%90%E9%AB%98%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%B9%B6%E5%8F%91%E5%A4%84%E7%90%86%E8%83%BD%E5%8A%9B.html"/>
    <id>http://www.chen-hao.com.cn/优化内核参数提高服务器并发处理能力.html</id>
    <published>2017-01-06T02:49:22.000Z</published>
    <updated>2017-01-06T02:59:57.479Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>&#x5728;&#x670D;&#x52A1;&#x5668;&#x786C;&#x4EF6;&#x8D44;&#x6E90;&#x989D;&#x5B9A;&#x6709;&#x9650;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6700;&#x5927;&#x7684;&#x538B;&#x69A8;&#x670D;&#x52A1;&#x5668;&#x7684;&#x6027;&#x80FD;&#xFF0C;&#x63D0;&#x9AD8;&#x670D;&#x52A1;&#x5668;&#x7684;&#x5E76;&#x53D1;&#x5904;&#x7406;&#x80FD;&#x529B;&#xFF0C;&#x662F;&#x5F88;&#x591A;&#x8FD0;&#x7EF4;&#x6280;&#x672F;&#x4EBA;&#x5458;&#x601D;&#x8003;&#x7684;&#x95EE;&#x9898;&#x3002;&#x5728;&#x8003;&#x8651;&#x8282;&#x7701;&#x6210;&#x672C;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x53EF;&#x4EE5;&#x4FEE;&#x6539;Linux&#x7684;&#x5185;&#x6838;&#x76F8;&#x5173;TCP&#x53C2;&#x6570;&#xFF0C;&#x6765;&#x6700;&#x5927;&#x7684;&#x63D0;&#x9AD8;&#x670D;&#x52A1;&#x5668;&#x6027;&#x80FD;&#x3002;&#x5F53;&#x7136;&#xFF0C;&#x6700;&#x57FA;&#x7840;&#x7684;&#x63D0;&#x9AD8;&#x8D1F;&#x8F7D;&#x95EE;&#x9898;&#xFF0C;&#x8FD8;&#x662F;&#x5347;&#x7EA7;&#x670D;&#x52A1;&#x5668;&#x786C;&#x4EF6;&#x4E86;&#xFF0C;&#x8FD9;&#x662F;&#x6700;&#x6839;&#x672C;&#x7684;&#x3002;<br><a id="more"></a></p>
</blockquote>
<p></p><h4 id="&#x4F18;&#x5316;time_wait&#x72B6;&#x6001;&#x8FDE;&#x63A5;">&#x4F18;&#x5316;TIME_WAIT&#x72B6;&#x6001;&#x8FDE;&#x63A5;</h4><br>Linux&#x7CFB;&#x7EDF;&#x4E0B;&#xFF0C;TCP&#x8FDE;&#x63A5;&#x65AD;&#x5F00;&#x540E;&#xFF0C;&#x4F1A;&#x4EE5;TIME_WAIT&#x72B6;&#x6001;&#x4FDD;&#x7559;&#x4E00;&#x5B9A;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x7136;&#x540E;&#x624D;&#x4F1A;&#x91CA;&#x653E;&#x7AEF;&#x53E3;&#x3002;&#x5F53;&#x5E76;&#x53D1;&#x8BF7;&#x6C42;&#x8FC7;&#x591A;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x4F1A;&#x4EA7;&#x751F;&#x5927;&#x91CF;&#x7684;TIME_WAIT&#x72B6;&#x6001;&#x7684;&#x8FDE;&#x63A5;&#xFF0C;&#x65E0;&#x6CD5;&#x53CA;&#x65F6;&#x65AD;&#x5F00;&#x7684;&#x8BDD;&#xFF0C;&#x4F1A;&#x5360;&#x7528;&#x5927;&#x91CF;&#x7684;&#x7AEF;&#x53E3;&#x8D44;&#x6E90;&#x548C;&#x670D;&#x52A1;&#x5668;&#x8D44;&#x6E90;&#x3002;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F18;&#x5316;TCP&#x7684;&#x5185;&#x6838;&#x53C2;&#x6570;&#xFF0C;&#x6765;&#x53CA;&#x65F6;&#x5C06;TIME_WAIT&#x72B6;&#x6001;&#x7684;&#x7AEF;&#x53E3;&#x6E05;&#x7406;&#x6389;&#x3002;<p></p>
<p>&#x672C;&#x6587;&#x4ECB;&#x7ECD;&#x7684;&#x65B9;&#x6CD5;&#x53EA;&#x5BF9;&#x62E5;&#x6709;&#x5927;&#x91CF;TIME_WAIT&#x72B6;&#x6001;&#x7684;&#x8FDE;&#x63A5;&#x5BFC;&#x81F4;&#x7CFB;&#x7EDF;&#x8D44;&#x6E90;&#x6D88;&#x8017;&#x6709;&#x6548;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x662F;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6548;&#x679C;&#x53EF;&#x80FD;&#x4E0D;&#x660E;&#x663E;&#x3002;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;netstat&#x547D;&#x4EE4;&#x53BB;&#x67E5;TIME_WAIT&#x72B6;&#x6001;&#x7684;&#x8FDE;&#x63A5;&#x72B6;&#x6001;&#xFF0C;&#x8F93;&#x5165;&#x4E0B;&#x9762;&#x7684;&#x7EC4;&#x5408;&#x547D;&#x4EE4;&#xFF0C;&#x67E5;&#x770B;&#x5F53;&#x524D;TCP&#x8FDE;&#x63A5;&#x7684;&#x72B6;&#x6001;&#x548C;&#x5BF9;&#x5E94;&#x7684;&#x8FDE;&#x63A5;&#x6570;&#x91CF;&#xFF1A;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">netstat -n | awk <span class="string">&apos;/^tcp/ {++S[$NF]} END {for(a in S) print a, S[a]}&apos;</span></div></pre></td></tr></table></figure></p>
<p>&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#x4F1A;&#x8F93;&#x51FA;&#x7C7B;&#x4F3C;&#x4E0B;&#x9762;&#x7684;&#x7ED3;&#x679C;&#xFF1A;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">LAST_ACK 16</div><div class="line">SYN_RECV 348</div><div class="line">ESTABLISHED 70</div><div class="line">FIN_WAIT1 229</div><div class="line">FIN_WAIT2 30</div><div class="line">CLOSING 33</div><div class="line">TIME_WAIT 18098</div></pre></td></tr></table></figure></p>
<p>&#x6211;&#x4EEC;&#x53EA;&#x7528;&#x5173;&#x5FC3;TIME_WAIT&#x7684;&#x4E2A;&#x6570;&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x6709;18000&#x591A;&#x4E2A;TIME_WAIT&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x5360;&#x7528;&#x4E86;18000&#x591A;&#x4E2A;&#x7AEF;&#x53E3;&#x3002;&#x8981;&#x77E5;&#x9053;&#x7AEF;&#x53E3;&#x7684;&#x6570;&#x91CF;&#x53EA;&#x6709;65535&#x4E2A;&#xFF0C;&#x5360;&#x7528;&#x4E00;&#x4E2A;&#x5C11;&#x4E00;&#x4E2A;&#xFF0C;&#x4F1A;&#x4E25;&#x91CD;&#x7684;&#x5F71;&#x54CD;&#x5230;&#x540E;&#x7EE7;&#x7684;&#x65B0;&#x8FDE;&#x63A5;&#x3002;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x6709;&#x5FC5;&#x8981;&#x8C03;&#x6574;&#x4E0B;Linux&#x7684;TCP&#x5185;&#x6838;&#x53C2;&#x6570;&#xFF0C;&#x8BA9;&#x7CFB;&#x7EDF;&#x66F4;&#x5FEB;&#x7684;&#x91CA;&#x653E;TIME_WAIT&#x8FDE;&#x63A5;&#x3002;</p>
<p>&#x7528;vim&#x6253;&#x5F00;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF1A;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vim /etc/sysctl.conf</div></pre></td></tr></table></figure></p>
<p>&#x5728;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x52A0;&#x5165;&#x4E0B;&#x9762;&#x7684;&#x51E0;&#x884C;&#x5185;&#x5BB9;&#xFF1A;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">net.ipv4.tcp_syncookies = 1</div><div class="line">net.ipv4.tcp_tw_reuse = 1</div><div class="line">net.ipv4.tcp_tw_recycle = 1</div><div class="line">net.ipv4.tcp_fin_timeout = 30</div></pre></td></tr></table></figure></p>
<p>&#x8F93;&#x5165;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x8BA9;&#x5185;&#x6838;&#x53C2;&#x6570;&#x751F;&#x6548;&#xFF1A;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sysctl -p</div></pre></td></tr></table></figure></p>
<p>&#x7B80;&#x5355;&#x7684;&#x8BF4;&#x660E;&#x4E0A;&#x9762;&#x7684;&#x53C2;&#x6570;&#x7684;&#x542B;&#x4E49;&#xFF1A;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">net.ipv4.tcp_syncookies = 1</div><div class="line"><span class="comment">#&#x8868;&#x793A;&#x5F00;&#x542F;SYN Cookies&#x3002;&#x5F53;&#x51FA;&#x73B0;SYN&#x7B49;&#x5F85;&#x961F;&#x5217;&#x6EA2;&#x51FA;&#x65F6;&#xFF0C;&#x542F;&#x7528;cookies&#x6765;&#x5904;&#x7406;&#xFF0C;&#x53EF;&#x9632;&#x8303;&#x5C11;&#x91CF;SYN&#x653B;&#x51FB;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;0&#xFF0C;&#x8868;&#x793A;&#x5173;&#x95ED;&#xFF1B;</span></div><div class="line">net.ipv4.tcp_tw_reuse = 1</div><div class="line"><span class="comment">#&#x8868;&#x793A;&#x5F00;&#x542F;&#x91CD;&#x7528;&#x3002;&#x5141;&#x8BB8;&#x5C06;TIME-WAIT sockets&#x91CD;&#x65B0;&#x7528;&#x4E8E;&#x65B0;&#x7684;TCP&#x8FDE;&#x63A5;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;0&#xFF0C;&#x8868;&#x793A;&#x5173;&#x95ED;&#xFF1B;</span></div><div class="line">net.ipv4.tcp_tw_recycle = 1</div><div class="line"><span class="comment">#&#x8868;&#x793A;&#x5F00;&#x542F;TCP&#x8FDE;&#x63A5;&#x4E2D;TIME-WAIT sockets&#x7684;&#x5FEB;&#x901F;&#x56DE;&#x6536;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;0&#xFF0C;&#x8868;&#x793A;&#x5173;&#x95ED;&#xFF1B;</span></div><div class="line">net.ipv4.tcp_fin_timeout</div><div class="line"><span class="comment">#&#x4FEE;&#x6539;&#x7CFB;&#x7D71;&#x9ED8;&#x8BA4;&#x7684; TIMEOUT &#x65F6;&#x95F4;&#x3002;</span></div></pre></td></tr></table></figure></p>
<p>&#x5728;&#x7ECF;&#x8FC7;&#x8FD9;&#x6837;&#x7684;&#x8C03;&#x6574;&#x4E4B;&#x540E;&#xFF0C;&#x9664;&#x4E86;&#x4F1A;&#x8FDB;&#x4E00;&#x6B65;&#x63D0;&#x5347;&#x670D;&#x52A1;&#x5668;&#x7684;&#x8D1F;&#x8F7D;&#x80FD;&#x529B;&#x4E4B;&#x5916;&#xFF0C;&#x8FD8;&#x80FD;&#x591F;&#x9632;&#x5FA1;&#x5C0F;&#x6D41;&#x91CF;&#x7A0B;&#x5EA6;&#x7684;DoS&#x3001;CC&#x548C;SYN&#x653B;&#x51FB;&#x3002;</p>
<p>&#x6B64;&#x5916;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x7684;&#x8FDE;&#x63A5;&#x6570;&#x672C;&#x8EAB;&#x5C31;&#x5F88;&#x591A;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x518D;&#x4F18;&#x5316;&#x4E00;&#x4E0B;TCP&#x7684;&#x53EF;&#x4F7F;&#x7528;&#x7AEF;&#x53E3;&#x8303;&#x56F4;&#xFF0C;&#x8FDB;&#x4E00;&#x6B65;&#x63D0;&#x5347;&#x670D;&#x52A1;&#x5668;&#x7684;&#x5E76;&#x53D1;&#x80FD;&#x529B;&#x3002;&#x4F9D;&#x7136;&#x662F;&#x5F80;&#x4E0A;&#x9762;&#x7684;&#x53C2;&#x6570;&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x52A0;&#x5165;&#x4E0B;&#x9762;&#x8FD9;&#x4E9B;&#x914D;&#x7F6E;&#xFF1A;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">net.ipv4.tcp_keepalive_time = 1200</div><div class="line">net.ipv4.ip_<span class="built_in">local</span>_port_range = 10000 65000</div><div class="line">net.ipv4.tcp_max_syn_backlog = 8192</div><div class="line">net.ipv4.tcp_max_tw_buckets = 5000</div><div class="line"><span class="comment">#&#x8FD9;&#x51E0;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x5EFA;&#x8BAE;&#x53EA;&#x5728;&#x6D41;&#x91CF;&#x975E;&#x5E38;&#x5927;&#x7684;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x5F00;&#x542F;&#xFF0C;&#x4F1A;&#x6709;&#x663E;&#x8457;&#x7684;&#x6548;&#x679C;&#x3002;&#x4E00;&#x822C;&#x7684;&#x6D41;&#x91CF;&#x5C0F;&#x7684;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#xFF0C;&#x6CA1;&#x6709;&#x5FC5;&#x8981;&#x53BB;&#x8BBE;&#x7F6E;&#x8FD9;&#x51E0;&#x4E2A;&#x53C2;&#x6570;&#x3002;</span></div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">net.ipv4.tcp_keepalive_time = 1200</div><div class="line"><span class="comment">#&#x8868;&#x793A;&#x5F53;keepalive&#x8D77;&#x7528;&#x7684;&#x65F6;&#x5019;&#xFF0C;TCP&#x53D1;&#x9001;keepalive&#x6D88;&#x606F;&#x7684;&#x9891;&#x5EA6;&#x3002;&#x7F3A;&#x7701;&#x662F;2&#x5C0F;&#x65F6;&#xFF0C;&#x6539;&#x4E3A;20&#x5206;&#x949F;&#x3002;</span></div><div class="line">net.ipv4.ip_<span class="built_in">local</span>_port_range = 10000 65000</div><div class="line"><span class="comment">#&#x8868;&#x793A;&#x7528;&#x4E8E;&#x5411;&#x5916;&#x8FDE;&#x63A5;&#x7684;&#x7AEF;&#x53E3;&#x8303;&#x56F4;&#x3002;&#x7F3A;&#x7701;&#x60C5;&#x51B5;&#x4E0B;&#x5F88;&#x5C0F;&#xFF1A;32768&#x5230;61000&#xFF0C;&#x6539;&#x4E3A;10000&#x5230;65000&#x3002;&#xFF08;&#x6CE8;&#x610F;&#xFF1A;&#x8FD9;&#x91CC;&#x4E0D;&#x8981;&#x5C06;&#x6700;&#x4F4E;&#x503C;&#x8BBE;&#x7684;&#x592A;&#x4F4E;&#xFF0C;&#x5426;&#x5219;&#x53EF;&#x80FD;&#x4F1A;&#x5360;&#x7528;&#x6389;&#x6B63;&#x5E38;&#x7684;&#x7AEF;&#x53E3;&#xFF01;&#xFF09;</span></div><div class="line">net.ipv4.tcp_max_syn_backlog = 8192</div><div class="line"><span class="comment">#&#x8868;&#x793A;SYN&#x961F;&#x5217;&#x7684;&#x957F;&#x5EA6;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;1024&#xFF0C;&#x52A0;&#x5927;&#x961F;&#x5217;&#x957F;&#x5EA6;&#x4E3A;8192&#xFF0C;&#x53EF;&#x4EE5;&#x5BB9;&#x7EB3;&#x66F4;&#x591A;&#x7B49;&#x5F85;&#x8FDE;&#x63A5;&#x7684;&#x7F51;&#x7EDC;&#x8FDE;&#x63A5;&#x6570;&#x3002;</span></div><div class="line">net.ipv4.tcp_max_tw_buckets = 6000</div><div class="line"><span class="comment">#&#x8868;&#x793A;&#x7CFB;&#x7EDF;&#x540C;&#x65F6;&#x4FDD;&#x6301;TIME_WAIT&#x7684;&#x6700;&#x5927;&#x6570;&#x91CF;&#xFF0C;&#x5982;&#x679C;&#x8D85;&#x8FC7;&#x8FD9;&#x4E2A;&#x6570;&#x5B57;&#xFF0C;TIME_WAIT&#x5C06;&#x7ACB;&#x523B;&#x88AB;&#x6E05;&#x9664;&#x5E76;&#x6253;&#x5370;&#x8B66;&#x544A;&#x4FE1;&#x606F;&#x3002;&#x9ED8; &#x8BA4;&#x4E3A;180000&#xFF0C;&#x6539;&#x4E3A;6000&#x3002;&#x5BF9;&#x4E8E;Apache&#x3001;Nginx&#x7B49;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x4E0A;&#x51E0;&#x884C;&#x7684;&#x53C2;&#x6570;&#x53EF;&#x4EE5;&#x5F88;&#x597D;&#x5730;&#x51CF;&#x5C11;TIME_WAIT&#x5957;&#x63A5;&#x5B57;&#x6570;&#x91CF;&#xFF0C;&#x4F46;&#x662F;&#x5BF9;&#x4E8E; Squid&#xFF0C;&#x6548;&#x679C;&#x5374;&#x4E0D;&#x5927;&#x3002;&#x6B64;&#x9879;&#x53C2;&#x6570;&#x53EF;&#x4EE5;&#x63A7;&#x5236;TIME_WAIT&#x7684;&#x6700;&#x5927;&#x6570;&#x91CF;&#xFF0C;&#x907F;&#x514D;Squid&#x670D;&#x52A1;&#x5668;&#x88AB;&#x5927;&#x91CF;&#x7684;TIME_WAIT&#x62D6;&#x6B7B;&#x3002;</span></div></pre></td></tr></table></figure>
<p></p><h4 id="&#x5185;&#x6838;&#x5176;&#x4ED6;tcp&#x53C2;&#x6570;&#x8BF4;&#x660E;">&#x5185;&#x6838;&#x5176;&#x4ED6;TCP&#x53C2;&#x6570;&#x8BF4;&#x660E;</h4><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">net.ipv4.tcp_max_syn_backlog = 65536</div><div class="line"><span class="comment">#&#x8BB0;&#x5F55;&#x7684;&#x90A3;&#x4E9B;&#x5C1A;&#x672A;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x786E;&#x8BA4;&#x4FE1;&#x606F;&#x7684;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#x7684;&#x6700;&#x5927;&#x503C;&#x3002;&#x5BF9;&#x4E8E;&#x6709;128M&#x5185;&#x5B58;&#x7684;&#x7CFB;&#x7EDF;&#x800C;&#x8A00;&#xFF0C;&#x7F3A;&#x7701;&#x503C;&#x662F;1024&#xFF0C;&#x5C0F;&#x5185;&#x5B58;&#x7684;&#x7CFB;&#x7EDF;&#x5219;&#x662F;128&#x3002;</span></div><div class="line">net.core.netdev_max_backlog = 32768</div><div class="line"><span class="comment">#&#x6BCF;&#x4E2A;&#x7F51;&#x7EDC;&#x63A5;&#x53E3;&#x63A5;&#x6536;&#x6570;&#x636E;&#x5305;&#x7684;&#x901F;&#x7387;&#x6BD4;&#x5185;&#x6838;&#x5904;&#x7406;&#x8FD9;&#x4E9B;&#x5305;&#x7684;&#x901F;&#x7387;&#x5FEB;&#x65F6;&#xFF0C;&#x5141;&#x8BB8;&#x9001;&#x5230;&#x961F;&#x5217;&#x7684;&#x6570;&#x636E;&#x5305;&#x7684;&#x6700;&#x5927;&#x6570;&#x76EE;&#x3002;</span></div><div class="line">net.core.somaxconn = 32768</div><div class="line"><span class="comment">#web&#x5E94;&#x7528;&#x4E2D;listen&#x51FD;&#x6570;&#x7684;backlog&#x9ED8;&#x8BA4;&#x4F1A;&#x7ED9;&#x6211;&#x4EEC;&#x5185;&#x6838;&#x53C2;&#x6570;&#x7684;net.core.somaxconn&#x9650;&#x5236;&#x5230;128&#xFF0C;&#x800C;nginx&#x5B9A;&#x4E49;&#x7684;NGX_LISTEN_BACKLOG&#x9ED8;&#x8BA4;&#x4E3A;511&#xFF0C;&#x6240;&#x4EE5;&#x6709;&#x5FC5;&#x8981;&#x8C03;&#x6574;&#x8FD9;&#x4E2A;&#x503C;&#x3002;</span></div><div class="line"></div><div class="line"></div><div class="line">net.core.wmem_default = 8388608</div><div class="line">net.core.rmem_default = 8388608</div><div class="line">net.core.rmem_max = 16777216           </div><div class="line"><span class="comment">#&#x6700;&#x5927;socket&#x8BFB;buffer,&#x53EF;&#x53C2;&#x8003;&#x7684;&#x4F18;&#x5316;&#x503C;:873200</span></div><div class="line">net.core.wmem_max = 16777216           </div><div class="line"><span class="comment">#&#x6700;&#x5927;socket&#x5199;buffer,&#x53EF;&#x53C2;&#x8003;&#x7684;&#x4F18;&#x5316;&#x503C;:873200</span></div><div class="line">net.ipv4.tcp_timestsmps = 0</div><div class="line"><span class="comment">#&#x65F6;&#x95F4;&#x6233;&#x53EF;&#x4EE5;&#x907F;&#x514D;&#x5E8F;&#x5217;&#x53F7;&#x7684;&#x5377;&#x7ED5;&#x3002;&#x4E00;&#x4E2A;1Gbps&#x7684;&#x94FE;&#x8DEF;&#x80AF;&#x5B9A;&#x4F1A;&#x9047;&#x5230;&#x4EE5;&#x524D;&#x7528;&#x8FC7;&#x7684;&#x5E8F;&#x5217;&#x53F7;&#x3002;&#x65F6;&#x95F4;&#x6233;&#x80FD;&#x591F;&#x8BA9;&#x5185;&#x6838;&#x63A5;&#x53D7;&#x8FD9;&#x79CD;&#x201C;&#x5F02;&#x5E38;&#x201D;&#x7684;&#x6570;&#x636E;&#x5305;&#x3002;&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x5C06;&#x5176;&#x5173;&#x6389;&#x3002;</span></div><div class="line">net.ipv4.tcp_synack_retries = 2</div><div class="line"><span class="comment">#&#x4E3A;&#x4E86;&#x6253;&#x5F00;&#x5BF9;&#x7AEF;&#x7684;&#x8FDE;&#x63A5;&#xFF0C;&#x5185;&#x6838;&#x9700;&#x8981;&#x53D1;&#x9001;&#x4E00;&#x4E2A;SYN&#x5E76;&#x9644;&#x5E26;&#x4E00;&#x4E2A;&#x56DE;&#x5E94;&#x524D;&#x9762;&#x4E00;&#x4E2A;SYN&#x7684;ACK&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x6240;&#x8C13;&#x4E09;&#x6B21;&#x63E1;&#x624B;&#x4E2D;&#x7684;&#x7B2C;&#x4E8C;&#x6B21;&#x63E1;&#x624B;&#x3002;&#x8FD9;&#x4E2A;&#x8BBE;&#x7F6E;&#x51B3;&#x5B9A;&#x4E86;&#x5185;&#x6838;&#x653E;&#x5F03;&#x8FDE;&#x63A5;&#x4E4B;&#x524D;&#x53D1;&#x9001;SYN+ACK&#x5305;&#x7684;&#x6570;&#x91CF;&#x3002;</span></div><div class="line">net.ipv4.tcp_syn_retries = 2</div><div class="line"><span class="comment">#&#x5728;&#x5185;&#x6838;&#x653E;&#x5F03;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x4E4B;&#x524D;&#x53D1;&#x9001;SYN&#x5305;&#x7684;&#x6570;&#x91CF;&#x3002;</span></div><div class="line"><span class="comment">#net.ipv4.tcp_tw_len = 1</span></div><div class="line">net.ipv4.tcp_tw_reuse = 1</div><div class="line"><span class="comment"># &#x5F00;&#x542F;&#x91CD;&#x7528;&#x3002;&#x5141;&#x8BB8;&#x5C06;TIME-WAIT sockets&#x91CD;&#x65B0;&#x7528;&#x4E8E;&#x65B0;&#x7684;TCP&#x8FDE;&#x63A5;&#x3002;</span></div><div class="line"></div><div class="line"></div><div class="line">net.ipv4.tcp_wmem = 8192 436600 873200</div><div class="line"><span class="comment"># TCP&#x5199;buffer,&#x53EF;&#x53C2;&#x8003;&#x7684;&#x4F18;&#x5316;&#x503C;: 8192 436600 873200</span></div><div class="line">net.ipv4.tcp_rmem  = 32768 436600 873200</div><div class="line"><span class="comment"># TCP&#x8BFB;buffer,&#x53EF;&#x53C2;&#x8003;&#x7684;&#x4F18;&#x5316;&#x503C;: 32768 436600 873200</span></div><div class="line">net.ipv4.tcp_mem = 94500000 91500000 92700000</div><div class="line"><span class="comment"># &#x540C;&#x6837;&#x6709;3&#x4E2A;&#x503C;,&#x610F;&#x601D;&#x662F;:</span></div><div class="line">net.ipv4.tcp_mem[0]:&#x4F4E;&#x4E8E;&#x6B64;&#x503C;&#xFF0C;TCP&#x6CA1;&#x6709;&#x5185;&#x5B58;&#x538B;&#x529B;&#x3002;</div><div class="line">net.ipv4.tcp_mem[1]:&#x5728;&#x6B64;&#x503C;&#x4E0B;&#xFF0C;&#x8FDB;&#x5165;&#x5185;&#x5B58;&#x538B;&#x529B;&#x9636;&#x6BB5;&#x3002;</div><div class="line">net.ipv4.tcp_mem[2]:&#x9AD8;&#x4E8E;&#x6B64;&#x503C;&#xFF0C;TCP&#x62D2;&#x7EDD;&#x5206;&#x914D;socket&#x3002;</div><div class="line">&#x4E0A;&#x8FF0;&#x5185;&#x5B58;&#x5355;&#x4F4D;&#x662F;&#x9875;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5B57;&#x8282;&#x3002;&#x53EF;&#x53C2;&#x8003;&#x7684;&#x4F18;&#x5316;&#x503C;&#x662F;:786432 1048576 1572864</div><div class="line"></div><div class="line"></div><div class="line">net.ipv4.tcp_max_orphans = 3276800</div><div class="line"><span class="comment">#&#x7CFB;&#x7EDF;&#x4E2D;&#x6700;&#x591A;&#x6709;&#x591A;&#x5C11;&#x4E2A;TCP&#x5957;&#x63A5;&#x5B57;&#x4E0D;&#x88AB;&#x5173;&#x8054;&#x5230;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x6587;&#x4EF6;&#x53E5;&#x67C4;&#x4E0A;&#x3002;</span></div><div class="line">&#x5982;&#x679C;&#x8D85;&#x8FC7;&#x8FD9;&#x4E2A;&#x6570;&#x5B57;&#xFF0C;&#x8FDE;&#x63A5;&#x5C06;&#x5373;&#x523B;&#x88AB;&#x590D;&#x4F4D;&#x5E76;&#x6253;&#x5370;&#x51FA;&#x8B66;&#x544A;&#x4FE1;&#x606F;&#x3002;</div><div class="line">&#x8FD9;&#x4E2A;&#x9650;&#x5236;&#x4EC5;&#x4EC5;&#x662F;&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x7B80;&#x5355;&#x7684;DoS&#x653B;&#x51FB;&#xFF0C;&#x4E0D;&#x80FD;&#x8FC7;&#x5206;&#x4F9D;&#x9760;&#x5B83;&#x6216;&#x8005;&#x4EBA;&#x4E3A;&#x5730;&#x51CF;&#x5C0F;&#x8FD9;&#x4E2A;&#x503C;&#xFF0C;</div><div class="line">&#x66F4;&#x5E94;&#x8BE5;&#x589E;&#x52A0;&#x8FD9;&#x4E2A;&#x503C;(&#x5982;&#x679C;&#x589E;&#x52A0;&#x4E86;&#x5185;&#x5B58;&#x4E4B;&#x540E;)&#x3002;</div><div class="line">net.ipv4.tcp_fin_timeout = 30</div><div class="line"><span class="comment">#&#x5982;&#x679C;&#x5957;&#x63A5;&#x5B57;&#x7531;&#x672C;&#x7AEF;&#x8981;&#x6C42;&#x5173;&#x95ED;&#xFF0C;&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x51B3;&#x5B9A;&#x4E86;&#x5B83;&#x4FDD;&#x6301;&#x5728;FIN-WAIT-2&#x72B6;&#x6001;&#x7684;&#x65F6;&#x95F4;&#x3002;&#x5BF9;&#x7AEF;&#x53EF;&#x4EE5;&#x51FA;&#x9519;&#x5E76;&#x6C38;&#x8FDC;&#x4E0D;&#x5173;&#x95ED;&#x8FDE;&#x63A5;&#xFF0C;&#x751A;&#x81F3;&#x610F;&#x5916;&#x5F53;&#x673A;&#x3002;&#x7F3A;&#x7701;&#x503C;&#x662F;60&#x79D2;&#x3002;2.2 &#x5185;&#x6838;&#x7684;&#x901A;&#x5E38;&#x503C;&#x662F;180&#x79D2;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x6309;&#x8FD9;&#x4E2A;&#x8BBE;&#x7F6E;&#xFF0C;&#x4F46;&#x8981;&#x8BB0;&#x4F4F;&#x7684;&#x662F;&#xFF0C;&#x5373;&#x4F7F;&#x4F60;&#x7684;&#x673A;&#x5668;&#x662F;&#x4E00;&#x4E2A;&#x8F7B;&#x8F7D;&#x7684;WEB&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x4E5F;&#x6709;&#x56E0;&#x4E3A;&#x5927;&#x91CF;&#x7684;&#x6B7B;&#x5957;&#x63A5;&#x5B57;&#x800C;&#x5185;&#x5B58;&#x6EA2;&#x51FA;&#x7684;&#x98CE;&#x9669;&#xFF0C;FIN- WAIT-2&#x7684;&#x5371;&#x9669;&#x6027;&#x6BD4;FIN-WAIT-1&#x8981;&#x5C0F;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x6700;&#x591A;&#x53EA;&#x80FD;&#x5403;&#x6389;1.5K&#x5185;&#x5B58;&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x4EEC;&#x7684;&#x751F;&#x5B58;&#x671F;&#x957F;&#x4E9B;&#x3002;</span></div></pre></td></tr></table></figure><p></p>
<p>&#x7ECF;&#x8FC7;&#x8FD9;&#x6837;&#x7684;&#x4F18;&#x5316;&#x914D;&#x7F6E;&#x4E4B;&#x540E;&#xFF0C;&#x4F60;&#x7684;&#x670D;&#x52A1;&#x5668;&#x7684;TCP&#x5E76;&#x53D1;&#x5904;&#x7406;&#x80FD;&#x529B;&#x4F1A;&#x663E;&#x8457;&#x63D0;&#x9AD8;&#x3002;&#x4EE5;&#x4E0A;&#x914D;&#x7F6E;&#x4EC5;&#x4F9B;&#x53C2;&#x8003;&#xFF0C;&#x7528;&#x4E8E;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x8BF7;&#x6839;&#x636E;&#x81EA;&#x8EAB;&#x670D;&#x52A1;&#x5668;&#x60C5;&#x51B5;&#x5408;&#x7406;&#x914D;&#x7F6E;&#x3002;</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;在服务器硬件资源额定有限的情况下，最大的压榨服务器的性能，提高服务器的并发处理能力，是很多运维技术人员思考的问题。在考虑节省成本的情况下，可以修改Linux的内核相关TCP参数，来最大的提高服务器性能。当然，最基础的提高负载问题，还是升级服务器硬件了，这是最根本的。&lt;br&gt;
    
    </summary>
    
      <category term="性能优化" scheme="http://www.chen-hao.com.cn/categories/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
    
      <category term="内核" scheme="http://www.chen-hao.com.cn/tags/%E5%86%85%E6%A0%B8/"/>
    
  </entry>
  
  <entry>
    <title>网站架构演化</title>
    <link href="http://www.chen-hao.com.cn/%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E6%BC%94%E5%8C%96.html"/>
    <id>http://www.chen-hao.com.cn/网站架构演化.html</id>
    <published>2017-01-04T08:19:56.000Z</published>
    <updated>2017-01-05T01:01:24.095Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>&#x672C;&#x6587;&#x5C06;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#x7F51;&#x7AD9;&#x67B6;&#x6784;&#x7684;&#x6F14;&#x5316;&#x5386;&#x7A0B;&#xFF0C;&#x4ECE;&#x4E00;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x5230;&#x4E00;&#x5806;&#x670D;&#x52A1;&#x5668;&#x3002;<br> <a id="more"></a></p>
</blockquote>
<p></p><h4 id="&#x521D;&#x59CB;&#x9636;&#x6BB5;">&#x521D;&#x59CB;&#x9636;&#x6BB5;</h4><br>&#x5927;&#x578B;&#x7F51;&#x7AD9;&#x90FD;&#x662F;&#x4ECE;&#x5C0F;&#x578B;&#x7F51;&#x7AD9;&#x53D1;&#x5C55;&#x800C;&#x6765;&#xFF0C;&#x7F51;&#x7AD9;&#x67B6;&#x6784;&#x4E5F;&#x662F;&#x4E00;&#x6837;&#xFF0C;&#x662F;&#x4ECE;&#x5C0F;&#x578B;&#x7F51;&#x7AD9;&#x67B6;&#x6784;&#x9010;&#x6B65;&#x6F14;&#x5316;&#x800C;&#x6765;&#x3002;&#x5C0F;&#x578B;&#x7F51;&#x7AD9;&#x6700;&#x5F00;&#x59CB;&#x65F6;&#x6CA1;&#x6709;&#x592A;&#x591A;&#x4EBA;&#x8BBF;&#x95EE;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x4E00;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x5C31;&#x7EF0;&#x7EF0;&#x6709;&#x4F59;&#xFF0C;&#x8FD9;&#x65F6;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3001;&#x6570;&#x636E;&#x5E93;&#x3001;&#x6587;&#x4EF6;&#x7B49;&#x6240;&#x6709;&#x7684;&#x8D44;&#x6E90;&#x90FD;&#x5728;&#x4E00;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x3002;&#x901A;&#x5E38;&#x670D;&#x52A1;&#x5668;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x4F7F;&#x7528;Linux&#xFF0C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4F7F;&#x7528;PHP&#x5F00;&#x53D1;&#xFF0C;&#x7136;&#x540E;&#x90E8;&#x7F72;&#x5728;Apache&#x4E0A;&#xFF0C;&#x6570;&#x636E;&#x5E93;&#x4F7F;&#x7528;MySQL&#xFF0C;&#x6C47;&#x96C6;&#x5404;&#x79CD;&#x514D;&#x8D39;&#x5F00;&#x6E90;&#x8F6F;&#x4EF6;&#x53CA;&#x4E00;&#x53F0;&#x5EC9;&#x4EF7;&#x670D;&#x52A1;&#x5668;&#x5C31;&#x53EF;&#x4EE5;&#x5F00;&#x59CB;&#x7F51;&#x7AD9;&#x7684;&#x53D1;&#x5C55;&#x4E4B;&#x8DEF;&#x4E86;<br><img src="/uploads/wangzhan1.png" class="blockquote-center"> <p></p>
<p></p><h4 id="&#x5206;&#x79BB;&#x9636;&#x6BB5;">&#x5206;&#x79BB;&#x9636;&#x6BB5;</h4><br>&#x968F;&#x7740;&#x7F51;&#x7AD9;&#x4E1A;&#x52A1;&#x7684;&#x53D1;&#x5C55;&#xFF0C;&#x4E00;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x9010;&#x6E10;&#x4E0D;&#x80FD;&#x6EE1;&#x8DB3;&#x9700;&#x6C42;&#xFF1A;&#x8D8A;&#x6765;&#x8D8A;&#x591A;&#x7684;&#x7528;&#x6237;&#x8BBF;&#x95EE;&#x5BFC;&#x81F4;&#x6027;&#x80FD;&#x8D8A;&#x6765;&#x8D8A;&#x5DEE;&#xFF0C;&#x8D8A;&#x6765;&#x8D8A;&#x591A;&#x7684;&#x6570;&#x636E;&#x5BFC;&#x81F4;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;&#x4E0D;&#x8DB3;&#x3002;&#x8FD9;&#x65F6;&#x5C31;&#x9700;&#x8981;&#x5C06;&#x5E94;&#x7528;&#x548C;&#x6570;&#x636E;&#x5206;&#x79BB;&#x3002;&#x5E94;&#x7528;&#x548C;&#x6570;&#x636E;&#x5206;&#x79BB;&#x540E;&#x6574;&#x4E2A;&#x7F51;&#x7AD9;&#x4F7F;&#x7528;&#x4E09;&#x53F0;&#x670D;&#x52A1;&#x5668;&#xFF1A;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#x3001;&#x6587;&#x4EF6;&#x670D;&#x52A1;&#x5668;&#x548C;&#x6570;&#x636E;&#x5E93;&#x670D;&#x52A1;&#x5668;&#x3002;&#x8FD9;&#x4E09;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x5BF9;&#x786C;&#x4EF6;&#x8D44;&#x6E90;&#x7684;&#x8981;&#x6C42;&#x5404;&#x4E0D;&#x76F8;&#x540C;&#xFF0C;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#x9700;&#x8981;&#x5904;&#x7406;&#x5927;&#x91CF;&#x7684;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x66F4;&#x5FEB;&#x66F4;&#x5F3A;&#x5927;&#x7684;CPU&#xFF1B;&#x6570;&#x636E;&#x5E93;&#x670D;&#x52A1;&#x5668;&#x9700;&#x8981;&#x5FEB;&#x901F;&#x78C1;&#x76D8;&#x68C0;&#x7D22;&#x548C;&#x6570;&#x636E;&#x7F13;&#x5B58;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x66F4;&#x5FEB;&#x7684;&#x786C;&#x76D8;&#x548C;&#x66F4;&#x5927;&#x7684;&#x5185;&#x5B58;&#xFF1B;&#x6587;&#x4EF6;&#x670D;&#x52A1;&#x5668;&#x9700;&#x8981;&#x5B58;&#x50A8;&#x5927;&#x91CF;&#x7528;&#x6237;&#x4E0A;&#x4F20;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x66F4;&#x5927;&#x7684;&#x786C;&#x76D8;<br><img src="/uploads/wangzhan2.png" class="blockquote-center"> <p></p>
<p></p><h4 id="&#x7F13;&#x5B58;&#x9636;&#x6BB5;">&#x7F13;&#x5B58;&#x9636;&#x6BB5;</h4><br>&#x7F51;&#x7AD9;&#x8BBF;&#x95EE;&#x7279;&#x70B9;&#x548C;&#x73B0;&#x5B9E;&#x4E16;&#x754C;&#x7684;&#x8D22;&#x5BCC;&#x5206;&#x914D;&#x4E00;&#x6837;&#x9075;&#x5FAA;&#x4E8C;&#x516B;&#x5B9A;&#x5F8B;&#xFF1A;80%&#x7684;&#x4E1A;&#x52A1;&#x8BBF;&#x95EE;&#x96C6;&#x4E2D;&#x5728;20%&#x7684;&#x6570;&#x636E;&#x4E0A;&#x3002;&#x65E2;&#x7136;&#x5927;&#x90E8;&#x5206;&#x7684;&#x4E1A;&#x52A1;&#x8BBF;&#x95EE;&#x96C6;&#x4E2D;&#x5728;&#x4E00;&#x5C0F;&#x90E8;&#x5206;&#x6570;&#x636E;&#x4E0A;&#xFF0C;&#x90A3;&#x4E48;&#x5982;&#x679C;&#x628A;&#x8FD9;&#x4E00;&#x5C0F;&#x90E8;&#x5206;&#x6570;&#x636E;&#x7F13;&#x5B58;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x51CF;&#x5C11;&#x6570;&#x636E;&#x5E93;&#x7684;&#x8BBF;&#x95EE;&#x538B;&#x529B;&#xFF0C;&#x63D0;&#x9AD8;&#x6574;&#x4E2A;&#x7F51;&#x7AD9;&#x7684;&#x6570;&#x636E;&#x8BBF;&#x95EE;&#x901F;&#x5EA6;&#xFF0C;&#x6539;&#x5584;&#x6570;&#x636E;&#x5E93;&#x7684;&#x5199;&#x5165;&#x6027;&#x80FD;<p></p>
<p>&#x3000;&#x3000;&#x7F51;&#x7AD9;&#x4F7F;&#x7528;&#x7684;&#x7F13;&#x5B58;&#x53EF;&#x4EE5;&#x5206;&#x4E3A;&#x4E24;&#x79CD;&#xFF1A;&#x7F13;&#x5B58;&#x5728;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x7684;&#x672C;&#x5730;&#x7F13;&#x5B58;&#x548C;&#x7F13;&#x5B58;&#x5728;&#x4E13;&#x95E8;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x7F13;&#x5B58;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x7684;&#x8FDC;&#x7A0B;&#x7F13;&#x5B58;&#x3002;&#x672C;&#x5730;&#x7F13;&#x5B58;&#x7684;&#x8BBF;&#x95EE;&#x901F;&#x5EA6;&#x66F4;&#x5FEB;&#x4E00;&#x4E9B;&#xFF0C;&#x4F46;&#x662F;&#x53D7;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#x5185;&#x5B58;&#x9650;&#x5236;&#xFF0C;&#x5176;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x91CF;&#x6709;&#x9650;&#xFF0C;&#x800C;&#x4E14;&#x4F1A;&#x51FA;&#x73B0;&#x548C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E89;&#x7528;&#x5185;&#x5B58;&#x7684;&#x60C5;&#x51B5;&#x3002;&#x8FDC;&#x7A0B;&#x5206;&#x5E03;&#x5F0F;&#x7F13;&#x5B58;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x96C6;&#x7FA4;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x90E8;&#x7F72;&#x5927;&#x5185;&#x5B58;&#x7684;&#x670D;&#x52A1;&#x5668;&#x4F5C;&#x4E3A;&#x4E13;&#x95E8;&#x7684;&#x7F13;&#x5B58;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x7406;&#x8BBA;&#x4E0A;&#x505A;&#x5230;&#x4E0D;&#x53D7;&#x5185;&#x5B58;&#x5185;&#x5BB9;&#x9650;&#x5236;&#x7684;&#x7F13;&#x5B58;&#x670D;&#x52A1;<br><img src="/uploads/wangzhan3.png" class="blockquote-center"> </p>
<p></p><h4 id="&#x96C6;&#x7FA4;&#x9636;&#x6BB5;">&#x96C6;&#x7FA4;&#x9636;&#x6BB5;</h4><br>&#x4F7F;&#x7528;&#x7F13;&#x5B58;&#x540E;&#xFF0C;&#x6570;&#x636E;&#x8BBF;&#x95EE;&#x538B;&#x529B;&#x5F97;&#x5230;&#x6709;&#x6548;&#x7F13;&#x89E3;&#xFF0C;&#x4F46;&#x662F;&#x5355;&#x4E00;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#x80FD;&#x591F;&#x5904;&#x7406;&#x7684;&#x8BF7;&#x6C42;&#x8FDE;&#x63A5;&#x6709;&#x9650;&#xFF0C;&#x5728;&#x7F51;&#x7AD9;&#x8BBF;&#x95EE;&#x9AD8;&#x5CF0;&#x671F;&#xFF0C;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#x6210;&#x4E3A;&#x6574;&#x4E2A;&#x7F51;&#x7AD9;&#x7684;&#x74F6;&#x9888;<p></p>
<p>&#x3000;&#x3000;&#x4F7F;&#x7528;&#x96C6;&#x7FA4;&#x662F;&#x7F51;&#x7AD9;&#x89E3;&#x51B3;&#x9AD8;&#x5E76;&#x53D1;&#x3001;&#x6D77;&#x91CF;&#x6570;&#x636E;&#x95EE;&#x9898;&#x7684;&#x5E38;&#x7528;&#x624B;&#x6BB5;&#x3002;&#x5F53;&#x4E00;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x7684;&#x5904;&#x7406;&#x80FD;&#x529B;&#x3001;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;&#x4E0D;&#x8DB3;&#x65F6;&#xFF0C;&#x901A;&#x8FC7;&#x589E;&#x52A0;&#x4E00;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x5206;&#x62C5;&#x539F;&#x6709;&#x670D;&#x52A1;&#x5668;&#x7684;&#x8BBF;&#x95EE;&#x53CA;&#x5B58;&#x50A8;&#x538B;&#x529B;&#x3002;&#x5BF9;&#x7F51;&#x7AD9;&#x67B6;&#x6784;&#x800C;&#x8A00;&#xFF0C;&#x53EA;&#x8981;&#x80FD;&#x901A;&#x8FC7;&#x589E;&#x52A0;&#x4E00;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x7684;&#x65B9;&#x5F0F;&#x6539;&#x5584;&#x8D1F;&#x8F7D;&#x538B;&#x529B;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x4EE5;&#x540C;&#x6837;&#x7684;&#x65B9;&#x5F0F;&#x6301;&#x7EED;&#x589E;&#x52A0;&#x670D;&#x52A1;&#x5668;&#x4E0D;&#x65AD;&#x6539;&#x5584;&#x7CFB;&#x7EDF;&#x6027;&#x80FD;&#xFF0C;&#x4ECE;&#x800C;&#x5B9E;&#x73B0;&#x7CFB;&#x7EDF;&#x7684;&#x53EF;&#x4F38;&#x7F29;&#x6027;&#x3002;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#x5B9E;&#x73B0;&#x96C6;&#x7FA4;&#x662F;&#x7F51;&#x7AD9;&#x53EF;&#x4F38;&#x7F29;&#x96C6;&#x7FA4;&#x67B6;&#x6784;&#x8BBE;&#x8BA1;&#x4E2D;&#x8F83;&#x4E3A;&#x7B80;&#x5355;&#x6210;&#x719F;&#x7684;&#x4E00;&#x79CD;</p>
<p>&#x3000;&#x3000;&#x901A;&#x8FC7;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x8C03;&#x5EA6;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x53EF;&#x5C06;&#x6765;&#x81EA;&#x7528;&#x6237;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x8BBF;&#x95EE;&#x8BF7;&#x6C42;&#x5206;&#x53D1;&#x5230;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#x96C6;&#x7FA4;&#x4E2D;&#x7684;&#x4EFB;&#x4F55;&#x4E00;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x66F4;&#x591A;&#x7684;&#x7528;&#x6237;&#xFF0C;&#x5C31;&#x5728;&#x96C6;&#x7FA4;&#x4E2D;&#x52A0;&#x5165;&#x66F4;&#x591A;&#x7684;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x4F7F;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#x7684;&#x8D1F;&#x8F7D;&#x538B;&#x529B;&#x4E0D;&#x518D;&#x6210;&#x4E3A;&#x6574;&#x4E2A;&#x7F51;&#x7AD9;&#x7684;&#x74F6;&#x9888;<br><img src="/uploads/wangzhan4.png" class="blockquote-center"> </p>
<p></p><h4 id="&#x6570;&#x636E;&#x5E93;&#x5206;&#x79BB;">&#x6570;&#x636E;&#x5E93;&#x5206;&#x79BB;</h4><br>&#x7F51;&#x7AD9;&#x5728;&#x4F7F;&#x7528;&#x7F13;&#x5B58;&#x540E;&#xFF0C;&#x4F7F;&#x7EDD;&#x5927;&#x90E8;&#x5206;&#x6570;&#x636E;&#x8BFB;&#x64CD;&#x4F5C;&#x8BBF;&#x95EE;&#x90FD;&#x53EF;&#x4EE5;&#x4E0D;&#x901A;&#x8FC7;&#x6570;&#x636E;&#x5E93;&#x5C31;&#x80FD;&#x5B8C;&#x6210;&#xFF0C;&#x4F46;&#x662F;&#x4ECD;&#x6709;&#x4E00;&#x90E8;&#x5206;&#x8BFB;&#x64CD;&#x4F5C;(&#x7F13;&#x5B58;&#x8BBF;&#x95EE;&#x4E0D;&#x547D;&#x4E2D;&#x3001;&#x7F13;&#x5B58;&#x8FC7;&#x671F;)&#x548C;&#x5168;&#x90E8;&#x7684;&#x5199;&#x64CD;&#x4F5C;&#x9700;&#x8981;&#x8BBF;&#x95EE;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x5728;&#x7F51;&#x7AD9;&#x7684;&#x7528;&#x6237;&#x8FBE;&#x5230;&#x4E00;&#x5B9A;&#x89C4;&#x6A21;&#x540E;&#xFF0C;&#x6570;&#x636E;&#x5E93;&#x56E0;&#x4E3A;&#x8D1F;&#x8F7D;&#x538B;&#x529B;&#x8FC7;&#x9AD8;&#x800C;&#x6210;&#x4E3A;&#x7F51;&#x7AD9;&#x7684;&#x74F6;&#x9888;<p></p>
<p>&#x3000;&#x3000;&#x76EE;&#x524D;&#x5927;&#x90E8;&#x5206;&#x7684;&#x4E3B;&#x6D41;&#x6570;&#x636E;&#x5E93;&#x90FD;&#x63D0;&#x4F9B;&#x4E3B;&#x4ECE;&#x70ED;&#x5907;&#x529F;&#x80FD;&#xFF0C;&#x901A;&#x8FC7;&#x914D;&#x7F6E;&#x7F51;&#x53F0;&#x6570;&#x636E;&#x5E93;&#x4E3B;&#x4ECE;&#x5173;&#x7CFB;&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;&#x4E00;&#x53F0;&#x6570;&#x636E;&#x5E93;&#x670D;&#x52A1;&#x5668;&#x7684;&#x6570;&#x636E;&#x66F4;&#x65B0;&#x540C;&#x6B65;&#x5230;&#x53E6;&#x4E00;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x3002;&#x7F51;&#x7AD9;&#x5229;&#x7528;&#x6570;&#x636E;&#x5E93;&#x7684;&#x8FD9;&#x4E00;&#x529F;&#x80FD;&#xFF0C;&#x5B9E;&#x73B0;&#x6570;&#x636E;&#x5E93;&#x8BFB;&#x5199;&#x5206;&#x79BB;&#xFF0C;&#x4ECE;&#x800C;&#x6539;&#x5584;&#x6570;&#x636E;&#x5E93;&#x8D1F;&#x8F7D;&#x538B;&#x529B;</p>
<p>&#x3000;&#x3000;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#x5728;&#x5199;&#x6570;&#x636E;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8BBF;&#x95EE;&#x4E3B;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x4E3B;&#x6570;&#x636E;&#x5E93;&#x901A;&#x8FC7;&#x4E3B;&#x4ECE;&#x590D;&#x5236;&#x673A;&#x5236;&#x5C06;&#x6570;&#x636E;&#x66F4;&#x65B0;&#x540C;&#x6B65;&#x5230;&#x4ECE;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x8FD9;&#x6837;&#x5F53;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#x8BFB;&#x6570;&#x636E;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4ECE;&#x6570;&#x636E;&#x5E93;&#x83B7;&#x5F97;&#x6570;&#x636E;&#x3002;&#x4E3A;&#x4E86;&#x4FBF;&#x4E8E;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x8BBF;&#x95EE;&#x8BFB;&#x5199;&#x5206;&#x79BB;&#x540E;&#x7684;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x901A;&#x5E38;&#x5728;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x4F7F;&#x7528;&#x4E13;&#x95E8;&#x7684;&#x6570;&#x636E;&#x8BBF;&#x95EE;&#x6A21;&#x5757;&#xFF0C;&#x4F7F;&#x6570;&#x636E;&#x5E93;&#x8BFB;&#x5199;&#x5206;&#x79BB;&#x5BF9;&#x5E94;&#x7528;&#x900F;&#x660E;<br><img src="/uploads/wangzhan5.png" class="blockquote-center"></p>
<p></p><h4 id="&#x53CD;&#x5411;&#x4EE3;&#x7406;&#x548C;cdn">&#x53CD;&#x5411;&#x4EE3;&#x7406;&#x548C;CDN</h4><br>&#x968F;&#x7740;&#x7F51;&#x7AD9;&#x4E1A;&#x52A1;&#x4E0D;&#x65AD;&#x53D1;&#x5C55;&#xFF0C;&#x7528;&#x6237;&#x89C4;&#x6A21;&#x8D8A;&#x6765;&#x8D8A;&#x5927;&#xFF0C;&#x7531;&#x4E8E;&#x590D;&#x6742;&#x7684;&#x7F51;&#x7EDC;&#x73AF;&#x5883;&#xFF0C;&#x4E0D;&#x540C;&#x5730;&#x533A;&#x7684;&#x7528;&#x6237;&#x8BBF;&#x95EE;&#x7F51;&#x7AD9;&#x65F6;&#xFF0C;&#x901F;&#x5EA6;&#x5DEE;&#x522B;&#x4E5F;&#x6781;&#x5927;&#x3002;&#x4E3A;&#x4E86;&#x63D0;&#x4F9B;&#x66F4;&#x597D;&#x7684;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#xFF0C;&#x7559;&#x4F4F;&#x7528;&#x6237;&#xFF0C;&#x7F51;&#x7AD9;&#x9700;&#x8981;&#x52A0;&#x901F;&#x7F51;&#x7AD9;&#x8BBF;&#x95EE;&#x901F;&#x5EA6;&#x3002;&#x4E3B;&#x8981;&#x624B;&#x6BB5;&#x6709;&#x4F7F;&#x7528;CDN&#x548C;&#x53CD;&#x5411;&#x4EE3;&#x7406;<p></p>
<p>&#x3000;&#x3000;CDN&#x548C;&#x53CD;&#x5411;&#x4EE3;&#x7406;&#x7684;&#x57FA;&#x672C;&#x539F;&#x7406;&#x90FD;&#x662F;&#x7F13;&#x5B58;&#xFF0C;&#x533A;&#x522B;&#x5728;&#x4E8E;CDN&#x90E8;&#x7F72;&#x5728;&#x7F51;&#x7EDC;&#x63D0;&#x4F9B;&#x5546;&#x7684;&#x673A;&#x623F;&#xFF0C;&#x4F7F;&#x7528;&#x6237;&#x5728;&#x8BF7;&#x6C42;&#x7F51;&#x7AD9;&#x670D;&#x52A1;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x4ECE;&#x8DDD;&#x79BB;&#x81EA;&#x5DF1;&#x6700;&#x8FD1;&#x7684;&#x7F51;&#x7EDC;&#x63D0;&#x4F9B;&#x5546;&#x673A;&#x623F;&#x83B7;&#x53D6;&#x6570;&#x636E;&#xFF1B;&#x800C;&#x53CD;&#x5411;&#x4EE3;&#x7406;&#x5219;&#x90E8;&#x7F72;&#x5728;&#x7F51;&#x7AD9;&#x7684;&#x4E2D;&#x5FC3;&#x673A;&#x623F;&#xFF0C;&#x5F53;&#x7528;&#x6237;&#x8BF7;&#x6C42;&#x5230;&#x8FBE;&#x4E2D;&#x5FC3;&#x673A;&#x623F;&#x540E;&#xFF0C;&#x9996;&#x5148;&#x8BBF;&#x95EE;&#x7684;&#x670D;&#x52A1;&#x5668;&#x662F;&#x53CD;&#x5411;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x5982;&#x679C;&#x53CD;&#x5411;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#x4E2D;&#x7F13;&#x5B58;&#x7740;&#x7528;&#x6237;&#x8BF7;&#x6C42;&#x7684;&#x8D44;&#x6E90;&#xFF0C;&#x5C31;&#x5C06;&#x5176;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x7ED9;&#x7528;&#x6237;</p>
<p>&#x3000;&#x3000;&#x4F7F;&#x7528;CDN&#x548C;&#x53CD;&#x5411;&#x4EE3;&#x7406;&#x7684;&#x76EE;&#x7684;&#x90FD;&#x662F;&#x5C3D;&#x65E9;&#x8FD4;&#x56DE;&#x6570;&#x636E;&#x7ED9;&#x7528;&#x6237;&#xFF0C;&#x4E00;&#x65B9;&#x9762;&#x52A0;&#x5FEB;&#x7528;&#x6237;&#x8BBF;&#x95EE;&#x901F;&#x5EA6;&#xFF0C;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#x4E5F;&#x51CF;&#x8F7B;&#x540E;&#x7AEF;&#x670D;&#x52A1;&#x5668;&#x7684;&#x8D1F;&#x8F7D;&#x538B;&#x529B;<br><img src="/uploads/wangzhan6.png" class="blockquote-center"></p>
<p></p><h4 id="&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;">&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;</h4><br>&#x4EFB;&#x4F55;&#x5F3A;&#x5927;&#x7684;&#x5355;&#x4E00;&#x670D;&#x52A1;&#x5668;&#x90FD;&#x6EE1;&#x8DB3;&#x4E0D;&#x4E86;&#x5927;&#x578B;&#x7F51;&#x7AD9;&#x6301;&#x7EED;&#x589E;&#x957F;&#x7684;&#x4E1A;&#x52A1;&#x9700;&#x6C42;&#x3002;&#x6570;&#x636E;&#x5E93;&#x7ECF;&#x8FC7;&#x8BFB;&#x5199;&#x5206;&#x79BB;&#x540E;&#xFF0C;&#x4ECE;&#x4E00;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x62C6;&#x5206;&#x6210;&#x4E24;&#x53F0;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x4F46;&#x662F;&#x968F;&#x7740;&#x7F51;&#x7AD9;&#x4E1A;&#x52A1;&#x7684;&#x53D1;&#x5C55;&#x4F9D;&#x7136;&#x4E0D;&#x80FD;&#x6EE1;&#x8DB3;&#x9700;&#x6C42;&#xFF0C;&#x8FD9;&#x65F6;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x5206;&#x5E03;&#x5F0F;&#x6570;&#x636E;&#x5E93;&#x3002;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x4E5F;&#x662F;&#x4E00;&#x6837;&#xFF0C;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x5206;&#x5E03;&#x5F0F;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;<p></p>
<p>&#x3000;&#x3000;&#x5206;&#x5E03;&#x5F0F;&#x6570;&#x636E;&#x5E93;&#x662F;&#x7F51;&#x7AD9;&#x6570;&#x636E;&#x5E93;&#x62C6;&#x5206;&#x7684;&#x6700;&#x540E;&#x624B;&#x6BB5;&#xFF0C;&#x53EA;&#x6709;&#x5728;&#x5355;&#x8868;&#x6570;&#x636E;&#x89C4;&#x6A21;&#x975E;&#x5E38;&#x5E9E;&#x5927;&#x7684;&#x65F6;&#x5019; &#x624D;&#x4F7F;&#x7528;&#x3002;&#x4E0D;&#x5230;&#x4E0D;&#x5F97;&#x5DF2;&#x65F6;&#xFF0C;&#x7F51;&#x7AD9;&#x66F4;&#x5E38;&#x7528;&#x7684;&#x6570;&#x636E;&#x5E93;&#x62C6;&#x5206;&#x624B;&#x6BB5;&#x662F;&#x4E1A;&#x52A1;&#x5206;&#x5E93;&#xFF0C;&#x5C06;&#x4E0D;&#x540C;&#x4E1A;&#x52A1;&#x7684;&#x6570;&#x636E;&#x5E93;&#x90E8;&#x7F72;&#x5728;&#x4E0D;&#x540C;&#x7684;&#x7269;&#x7406;&#x670D;&#x52A1;&#x5668;&#x4E0A;<br><img src="/uploads/wangzhan7.png" class="blockquote-center"></p>
<p></p><h4 id="nosql&#x548C;&#x641C;&#x7D22;&#x5F15;&#x64CE;">NoSQL&#x548C;&#x641C;&#x7D22;&#x5F15;&#x64CE;</h4><br>&#x968F;&#x7740;&#x7F51;&#x7AD9;&#x4E1A;&#x52A1;&#x8D8A;&#x6765;&#x8D8A;&#x590D;&#x6742;&#xFF0C;&#x5BF9;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x548C;&#x68C0;&#x7D22;&#x7684;&#x9700;&#x6C42;&#x4E5F;&#x8D8A;&#x6765;&#x8D8A;&#x590D;&#x6742;&#xFF0C;&#x7F51;&#x7AD9;&#x9700;&#x8981;&#x91C7;&#x7528;&#x4E00;&#x4E9B;&#x975E;&#x5173;&#x7CFB;&#x6570;&#x636E;&#x5E93;&#x6280;&#x672F;&#x5982;NoSQL&#x548C;&#x975E;&#x6570;&#x636E;&#x5E93;&#x67E5;&#x8BE2;&#x6280;&#x672F;&#x5982;&#x641C;&#x7D22;&#x5F15;&#x64CE;<p></p>
<p>&#x3000;&#x3000;NoSQL&#x548C;&#x641C;&#x7D22;&#x5F15;&#x64CE;&#x90FD;&#x662F;&#x6E90;&#x81EA;&#x4E92;&#x8054;&#x7F51;&#x7684;&#x6280;&#x672F;&#x624B;&#x6BB5;&#xFF0C;&#x5BF9;&#x53EF;&#x4F38;&#x7F29;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x7279;&#x6027;&#x5177;&#x6709;&#x66F4;&#x597D;&#x7684;&#x652F;&#x6301;&#x3002;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#x5219;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x7EDF;&#x4E00;&#x6570;&#x636E;&#x8BBF;&#x95EE;&#x6A21;&#x5757;&#x8BBF;&#x95EE;&#x5404;&#x79CD;&#x6570;&#x636E;&#xFF0C;&#x51CF;&#x8F7B;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7BA1;&#x7406;&#x8BF8;&#x591A;&#x6570;&#x636E;&#x6E90;&#x7684;&#x9EBB;&#x70E6;<br><img src="/uploads/wangzhan8.png" class="blockquote-center"></p>
<p></p><h4 id="&#x4E1A;&#x52A1;&#x62C6;&#x5206;">&#x4E1A;&#x52A1;&#x62C6;&#x5206;</h4><br>&#x5927;&#x578B;&#x7F51;&#x7AD9;&#x4E3A;&#x4E86;&#x5E94;&#x5BF9;&#x65E5;&#x76CA;&#x590D;&#x6742;&#x7684;&#x4E1A;&#x52A1;&#x573A;&#x666F;&#xFF0C;&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x5206;&#x800C;&#x6CBB;&#x4E4B;&#x7684;&#x624B;&#x6BB5;&#x5C06;&#x6574;&#x4E2A;&#x7F51;&#x7AD9;&#x4E1A;&#x52A1;&#x5206;&#x6210;&#x4E0D;&#x540C;&#x7684;&#x4EA7;&#x54C1;&#x7EBF;&#xFF0C;&#x5982;&#x5927;&#x578B;&#x8D2D;&#x7269;&#x4EA4;&#x6613;&#x7F51;&#x7AD9;&#x5C31;&#x4F1A;&#x5C06;&#x9996;&#x9875;&#x3001;&#x5546;&#x94FA;&#x3001;&#x8BA2;&#x5355;&#x3001;&#x4E70;&#x5BB6;&#x3001;&#x5356;&#x5BB6;&#x7B49;&#x62C6;&#x5206;&#x6210;&#x4E0D;&#x540C;&#x7684;&#x4EA7;&#x54C1;&#x7EBF;&#xFF0C;&#x5206;&#x5F52;&#x4E0D;&#x540C;&#x7684;&#x4E1A;&#x52A1;&#x56E2;&#x961F;&#x8D1F;&#x8D23;<p></p>
<p>&#x3000;&#x3000;&#x5177;&#x4F53;&#x5230;&#x6280;&#x672F;&#x4E0A;&#xFF0C;&#x4E5F;&#x4F1A;&#x6839;&#x636E;&#x4EA7;&#x54C1;&#x7EBF;&#x5212;&#x5206;&#xFF0C;&#x5C06;&#x4E00;&#x4E2A;&#x7F51;&#x7AD9;&#x62C6;&#x5206;&#x6210;&#x8BB8;&#x591A;&#x4E0D;&#x540C;&#x7684;&#x5E94;&#x7528;&#xFF0C;&#x6BCF;&#x4E2A;&#x5E94;&#x7528;&#x72EC;&#x7ACB;&#x90E8;&#x7F72;&#x7EF4;&#x62A4;&#x3002;&#x5E94;&#x7528;&#x4E4B;&#x95F4;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x8D85;&#x94FE;&#x63A5;&#x5EFA;&#x7ACB;&#x5173;&#x7CFB;(&#x5728;&#x9996;&#x9875;&#x4E0A;&#x7684;&#x5BFC;&#x822A;&#x94FE;&#x63A5;&#x6BCF;&#x4E2A;&#x90FD;&#x6307;&#x5411;&#x4E0D;&#x540C;&#x7684;&#x5E94;&#x7528;&#x5730;&#x5740;)&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6D88;&#x606F;&#x961F;&#x5217;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x5206;&#x53D1;&#xFF0C;&#x5F53;&#x7136;&#x6700;&#x591A;&#x7684;&#x8FD8;&#x662F;&#x901A;&#x8FC7;&#x8BBF;&#x95EE;&#x540C;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x7CFB;&#x7EDF;&#x6765;&#x6784;&#x6210;&#x4E00;&#x4E2A;&#x5173;&#x8054;&#x7684;&#x5B8C;&#x6574;&#x7CFB;&#x7EDF;<br><img src="/uploads/wangzhan9.png" class="blockquote-center"></p>
<p></p><h4 id="&#x5206;&#x5E03;&#x5F0F;&#x670D;&#x52A1;">&#x5206;&#x5E03;&#x5F0F;&#x670D;&#x52A1;</h4><br>&#x968F;&#x7740;&#x4E1A;&#x52A1;&#x62C6;&#x5206;&#x8D8A;&#x6765;&#x8D8A;&#x5C0F;&#xFF0C;&#x5B58;&#x50A8;&#x7CFB;&#x7EDF;&#x8D8A;&#x6765;&#x8D8A;&#x5E9E;&#x5927;&#xFF0C;&#x5E94;&#x7528;&#x7CFB;&#x7EDF;&#x7684;&#x6574;&#x4F53;&#x590D;&#x6742;&#x5EA6;&#x5448;&#x6307;&#x6570;&#x7EA7;&#x589E;&#x52A0;&#xFF0C;&#x90E8;&#x7F72;&#x7EF4;&#x62A4;&#x8D8A;&#x6765;&#x8D8A;&#x56F0;&#x96BE;&#x3002;&#x7531;&#x4E8E;&#x6240;&#x6709;&#x5E94;&#x7528;&#x8981;&#x548C;&#x6240;&#x6709;&#x6570;&#x636E;&#x5E93;&#x7CFB;&#x7EDF;&#x8FDE;&#x63A5;&#xFF0C;&#x5728;&#x6570;&#x4E07;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x89C4;<br>&#x6A21;&#x7684;&#x7F51;&#x7AD9;&#x4E2D;&#xFF0C;&#x8FD9;&#x4E9B;&#x8FDE;&#x63A5;&#x7684;&#x6570;&#x76EE;&#x662F;&#x670D;&#x52A1;&#x5668;&#x89C4;&#x6A21;&#x7684;&#x5E73;&#x65B9;&#xFF0C;&#x5BFC;&#x81F4;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#x8D44;&#x6E90;&#x4E0D;&#x8DB3;&#xFF0C;&#x62D2;&#x7EDD;&#x670D;&#x52A1;<p></p>
<p>&#x3000;&#x3000;&#x65E2;&#x7136;&#x6BCF;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#x7CFB;&#x7EDF;&#x90FD;&#x9700;&#x8981;&#x6267;&#x884C;&#x8BB8;&#x591A;&#x76F8;&#x540C;&#x7684;&#x4E1A;&#x52A1;&#x64CD;&#x4F5C;&#xFF0C;&#x6BD4;&#x5982;&#x7528;&#x6237;&#x7BA1;&#x7406;&#x3001;&#x5546;&#x54C1;&#x7BA1;&#x7406;&#x7B49;&#xFF0C;&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x5C06;&#x8FD9;&#x4E9B;&#x5171;&#x7528;&#x7684;&#x4E1A;&#x52A1;&#x63D0;&#x53D6;&#x51FA;&#x6765;&#xFF0C;&#x72EC;&#x7ACB;&#x90E8;&#x7F72;&#x3002;&#x7531;&#x8FD9;&#x4E9B;&#x53EF;&#x590D;&#x7528;&#x7684;&#x4E1A;&#x52A1;&#x8FDE;&#x63A5;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x63D0;&#x4F9B;&#x5171;&#x7528;&#x4E1A;&#x52A1;&#x670D;&#x52A1;&#xFF0C;&#x800C;&#x5E94;&#x7528;&#x7CFB;&#x7EDF;&#x53EA;&#x9700;&#x8981;&#x7BA1;&#x7406;&#x7528;&#x6237;&#x754C;&#x9762;&#xFF0C;&#x901A;&#x8FC7;&#x5206;&#x5E03;&#x5F0F;&#x670D;&#x52A1;&#x8C03;&#x7528;&#x5171;&#x7528;&#x4E1A;&#x52A1;&#x670D;&#x52A1;&#x5B8C;&#x6210;&#x5177;&#x4F53;&#x4E1A;&#x52A1;&#x64CD;&#x4F5C;<br><img src="/uploads/wangzhan10.png" class="blockquote-center"></p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;本文将详细介绍网站架构的演化历程，从一台服务器到一堆服务器。&lt;br&gt;
    
    </summary>
    
      <category term="运维" scheme="http://www.chen-hao.com.cn/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="架构" scheme="http://www.chen-hao.com.cn/tags/%E6%9E%B6%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>Codis3.1 集群安装部署</title>
    <link href="http://www.chen-hao.com.cn/Codis3-1-%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2.html"/>
    <id>http://www.chen-hao.com.cn/Codis3-1-集群安装部署.html</id>
    <published>2016-12-20T06:33:08.000Z</published>
    <updated>2016-12-20T09:19:52.920Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p><code>Codis</code> &#x662F;&#x4E00;&#x4E2A;&#x5206;&#x5E03;&#x5F0F; Redis &#x89E3;&#x51B3;&#x65B9;&#x6848;, &#x5BF9;&#x4E8E;&#x4E0A;&#x5C42;&#x7684;&#x5E94;&#x7528;&#x6765;&#x8BF4;, &#x8FDE;&#x63A5;&#x5230; Codis Proxy &#x548C;&#x8FDE;&#x63A5;&#x539F;&#x751F;&#x7684; Redis Server &#x6CA1;&#x6709;&#x663E;&#x8457;&#x533A;&#x522B;, &#x4E0A;&#x5C42;&#x5E94;&#x7528;&#x53EF;&#x4EE5;&#x50CF;&#x4F7F;&#x7528;&#x5355;&#x673A;&#x7684; Redis &#x4E00;&#x6837;&#x4F7F;&#x7528;, Codis &#x5E95;&#x5C42;&#x4F1A;&#x5904;&#x7406;&#x8BF7;&#x6C42;&#x7684;&#x8F6C;&#x53D1;, &#x4E0D;&#x505C;&#x673A;&#x7684;&#x6570;&#x636E;&#x8FC1;&#x79FB;&#x7B49;&#x5DE5;&#x4F5C;, &#x6240;&#x6709;&#x540E;&#x8FB9;&#x7684;&#x4E00;&#x5207;&#x4E8B;&#x60C5;, &#x5BF9;&#x4E8E;&#x524D;&#x9762;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x6765;&#x8BF4;&#x662F;&#x900F;&#x660E;&#x7684;, &#x53EF;&#x4EE5;&#x7B80;&#x5355;&#x7684;&#x8BA4;&#x4E3A;&#x540E;&#x8FB9;&#x8FDE;&#x63A5;&#x7684;&#x662F;&#x4E00;&#x4E2A;&#x5185;&#x5B58;&#x65E0;&#x9650;&#x5927;&#x7684; Redis &#x670D;&#x52A1;&#x3002;<br> <a id="more"></a></p>
</blockquote>
<p></p><h3 id="&#x73AF;&#x5883;&#x8BF4;&#x660E;">&#x73AF;&#x5883;&#x8BF4;&#x660E;</h3><p></p>
<h4 id="codis&#x67B6;&#x6784;&#x56FE;">codis&#x67B6;&#x6784;&#x56FE;</h4><br><img src="/uploads/codis1.png" class="blockquote-center"><br><br><h4 id="&#x5206;&#x914D;&#x89D2;&#x8272;">&#x5206;&#x914D;&#x89D2;&#x8272;</h4>

<table>
<thead>
<tr>
<th>&#x4E3B;&#x673A;&#x540D;</th>
<th>IP&#x5730;&#x5740;</th>
<th>&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;</th>
<th>&#x7528;&#x9014;</th>
</tr>
</thead>
<tbody>
<tr>
<td>codis-1</td>
<td>10.16.20.62</td>
<td>CentOS 6.5</td>
<td>codis-dashboard&#x3001;codis-fe&#x3001;codis-ha&#x3001;codis-proxy1&#x3001;codis_group1_M(6379)&#x3001;codis_group3_S(6380)</td>
</tr>
<tr>
<td>codis-2</td>
<td>10.16.20.63</td>
<td>CentOS 6.5</td>
<td>codis-proxy2&#x3001;codis_group2_M(6379)&#x3001;codis_group1_S(6380)</td>
</tr>
<tr>
<td>codis-3</td>
<td>10.16.20.64</td>
<td>CentOS 6.5</td>
<td>codis-proxy3&#x3001;codis_group3_M(6379)&#x3001;codis_group2_S(6380)</td>
</tr>
</tbody>
</table>
<p></p><h4 id="&#x8F6F;&#x4EF6;&#x7248;&#x672C;">&#x8F6F;&#x4EF6;&#x7248;&#x672C;</h4><p></p>
<ul>
<li><a href="https://github.com/CodisLabs/codis/releases" target="_blank" rel="external">Codis3.1</a></li>
<li><a href="https://storage.googleapis.com/golang/go1.6.2.linux-amd64.tar.gz" target="_blank" rel="external">go1.6.2</a></li>
<li><a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" target="_blank" rel="external">jdk1.8</a></li>
<li><a href="http://apache.fayea.com/zookeeper/zookeeper-3.4.8/zookeeper-3.4.8.tar.gz" target="_blank" rel="external">zookeeper3.4.8</a>
</li>
</ul>
<p></p><h4 id="codis3x&#x7EC4;&#x4EF6;&#x8BF4;&#x660E;">codis3.x&#x7EC4;&#x4EF6;&#x8BF4;&#x660E;</h4><p></p>
<ul>
<li><p><strong><em>Codis Server</em></strong>&#xFF1A;&#x57FA;&#x4E8E; redis-2.8.21 &#x5206;&#x652F;&#x5F00;&#x53D1;&#x3002;&#x589E;&#x52A0;&#x4E86;&#x989D;&#x5916;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x4EE5;&#x652F;&#x6301; slot &#x6709;&#x5173;&#x7684;&#x64CD;&#x4F5C;&#x4EE5;&#x53CA;&#x6570;&#x636E;&#x8FC1;&#x79FB;&#x6307;&#x4EE4;&#xFF0C;&#x5177;&#x4F53;&#x7684;&#x4FEE;&#x6539;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x6587;&#x6863; redis&#x7684;&#x4FEE;&#x6539;&#x3002; </p>
</li>
<li><p><strong><em>Codis Proxy</em></strong>&#xFF1A;&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;&#x7684; Redis &#x4EE3;&#x7406;&#x670D;&#x52A1;, &#x5B9E;&#x73B0;&#x4E86; Redis &#x534F;&#x8BAE;&#x3002;&#x9664;&#x90E8;&#x5206;&#x547D;&#x4EE4;&#x4E0D;&#x652F;&#x6301;&#x4EE5;&#x5916;&#xFF0C;&#x8868;&#x73B0;&#x7684;&#x548C;&#x539F;&#x751F;&#x7684; Redis &#x6CA1;&#x6709;&#x533A;&#x522B;&#xFF08;&#x5C31;&#x50CF; Twemproxy&#xFF09;&#x3002; &#x5BF9;&#x4E8E;&#x540C;&#x4E00;&#x4E2A;&#x4E1A;&#x52A1;&#x96C6;&#x7FA4;&#x800C;&#x8A00;&#xFF0C;&#x53EF;&#x4EE5;&#x540C;&#x65F6;&#x90E8;&#x7F72;&#x591A;&#x4E2A;codis-proxy&#x5B9E;&#x4F8B;&#xFF0C;&#x4E0D;&#x540C; codis-proxy &#x4E4B;&#x95F4;&#x7531; codis-dashboard &#x4FDD;&#x8BC1;&#x72B6;&#x6001;&#x540C;&#x6B65;&#x3002;</p>
</li>
<li><p><strong><em>Codis Dashboard</em></strong>&#xFF1A;&#x96C6;&#x7FA4;&#x7BA1;&#x7406;&#x5DE5;&#x5177;&#xFF0C;&#x652F;&#x6301; codis-proxy&#x3001;codis-server &#x7684;&#x6DFB;&#x52A0;&#x3001;&#x5220;&#x9664;&#x4EE5;&#x53CA;&#x6570;&#x636E;&#x8FC1;&#x79FB;&#x7B49;&#x64CD;&#x4F5C;&#x3002;&#x5728;&#x96C6;&#x7FA4;&#x72B6;&#x6001;&#x53D1;&#x751F;&#x6539;&#x53D8;&#x65F6;&#xFF0C;codis-dashboard &#x7EF4;&#x62A4;&#x96C6;&#x7FA4;&#x4E0B;&#x6240;&#x6709; codis-proxy &#x7684;&#x72B6;&#x6001;&#x4E00;&#x81F4;&#x6027;&#x3002; &#x5BF9;&#x4E8E;&#x540C;&#x4E00;&#x4E2A;&#x96C6;&#x7FA4;&#x800C;&#x8A00;&#xFF0C;&#x540C;&#x4E00;&#x4E2A;&#x65F6;&#x523B; codis-dashboard &#x53EA;&#x80FD;&#x6709; 0&#x4E2A;&#x6216;&#x8005;1&#x4E2A;&#xFF0C;&#x6240;&#x6709;&#x5BF9;&#x96C6;&#x7FA4;&#x7684;&#x4FEE;&#x6539;&#x90FD;&#x5FC5;&#x987B;&#x901A;&#x8FC7; codis-dashboard &#x5B8C;&#x6210;&#x3002;</p>
</li>
<li><p><strong><em>Codis Admin</em></strong>&#xFF1A;&#x96C6;&#x7FA4;&#x7BA1;&#x7406;&#x7684;&#x547D;&#x4EE4;&#x884C;&#x5DE5;&#x5177;&#xFF0C;&#x53EF;&#x7528;&#x4E8E;&#x63A7;&#x5236;codis-proxy&#x3001;codis-dashboard&#x72B6;&#x6001;&#x4EE5;&#x53CA;&#x8BBF;&#x95EE;&#x5916;&#x90E8;&#x5B58;&#x50A8;&#x3002;</p>
</li>
<li><p><strong><em>Codis FE</em></strong>&#xFF1A;&#x96C6;&#x7FA4;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x3002;&#x591A;&#x4E2A;&#x96C6;&#x7FA4;&#x53EF;&#x4EE5;&#x5171;&#x4EAB;&#x540C;&#x4E00;&#x4E2A;&#x524D;&#x7AEF;&#x5C55;&#x793A;&#x9875;&#x9762;&#xFF0C;&#x901A;&#x8FC7;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7BA1;&#x7406;&#x540E;&#x7AEF; codis-dashboard &#x5217;&#x8868;&#xFF0C;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x53EF;&#x81EA;&#x52A8;&#x66F4;&#x65B0;&#x3002;</p>
</li>
<li><p><strong><em>Codis HA</em></strong>&#xFF1A;&#x4E3A;&#x96C6;&#x7FA4;&#x63D0;&#x4F9B;&#x9AD8;&#x53EF;&#x7528;&#xFF0C;&#x4F9D;&#x8D56; codis-dashboard &#x5B9E;&#x4F8B;&#xFF0C;&#x81EA;&#x52A8;&#x6293;&#x53D6;&#x96C6;&#x7FA4;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x4F1A;&#x6839;&#x636E;&#x5F53;&#x524D;&#x96C6;&#x7FA4;&#x72B6;&#x6001;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x4E3B;&#x4ECE;&#x5207;&#x6362;&#x7B56;&#x7565;&#xFF0C;&#x5E76;&#x5728;&#x9700;&#x8981;&#x65F6;&#x901A;&#x8FC7; codis-dashboard &#x5B8C;&#x6210;&#x4E3B;&#x4ECE;&#x5207;&#x6362;&#x3002;</p>
</li>
<li><p><strong><em>Storage</em></strong>&#xFF1A;&#x4E3A;&#x96C6;&#x7FA4;&#x72B6;&#x6001;&#x63D0;&#x4F9B;&#x5916;&#x90E8;&#x5B58;&#x50A8;&#xFF0C;&#x63D0;&#x4F9B;Namespace&#x6982;&#x5FF5;&#xFF0C;&#x4E0D;&#x540C;&#x96C6;&#x7FA4;&#x4F1A;&#x6309;&#x7167;&#x4E0D;&#x540C;product name&#x8FDB;&#x884C;&#x7EC4;&#x7EC7;&#xFF1B;&#x76EE;&#x524D;&#x4EC5;&#x63D0;&#x4F9B;&#x4E86;Zookeeper &#x548C;Etcd&#x4E24;&#x79CD;&#x5B9E;&#x73B0;&#xFF0C;&#x4F46;&#x662F;&#x63D0;&#x4F9B;&#x4E86;&#x62BD;&#x8C61;&#x7684;interface&#x53EF;&#x81EA;&#x884C;&#x6269;&#x5C55;&#x3002;</p>
</li>
</ul>
<p></p><h3 id="&#x73AF;&#x5883;&#x51C6;&#x5907;">&#x73AF;&#x5883;&#x51C6;&#x5907;</h3><br>codis&#x96C6;&#x7FA4;&#x7684;&#x642D;&#x5EFA;&#xFF0C;&#x9700;&#x8981;&#x4F9D;&#x8D56;zookeeper&#x96C6;&#x7FA4;<p></p>
<p></p><h4 id="zookeeper&#x96C6;&#x7FA4;">zookeeper&#x96C6;&#x7FA4;</h4><br>&#x800C;zookeeper&#x662F;&#x9700;&#x8981;&#x4F9D;&#x8D56;java jdk&#x7684;<p></p>
<p></p><h5 id="jdk-18&#x5B89;&#x88C5;">jdk 1.8&#x5B89;&#x88C5;</h5><br>&#x8FD9;&#x91CC;&#x76F4;&#x63A5;&#x53BB;&#x5B98;&#x7F51;&#x4E0B;&#x8F7D;jdk 1.8&#x7684;rpm&#x5305;&#xFF0C;<a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" target="_blank" rel="external">http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">yum -y install jdk-8u112-linux-x64.rpm</div><div class="line"><span class="comment"># &#x4E0B;&#x8F7D;&#x5B8C;&#x5B89;&#x88C5;jdk&#x5373;&#x53EF;</span></div><div class="line">vim /etc/profile.d/java.sh</div><div class="line"><span class="comment"># &#x4FEE;&#x6539;java&#x73AF;&#x5883;&#x53D8;&#x91CF;</span></div><div class="line"><span class="built_in">export</span> JAVA_HOME=/usr/java/jdk1.8.0_11</div><div class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></div><div class="line"></div><div class="line"><span class="built_in">source</span> /etc/profile.d/java.sh</div><div class="line"><span class="comment"># &#x91CD;&#x8F7D;&#x73AF;&#x5883;&#x53D8;&#x91CF;</span></div></pre></td></tr></table></figure><p></p>
<p></p><h5 id="zookeeper&#x96C6;&#x7FA4;&#x5B89;&#x88C5;">zookeeper&#x96C6;&#x7FA4;&#x5B89;&#x88C5;</h5><br>&#x4E0B;&#x8F7D;&#x5B8C;zookeeper&#x4E4B;&#x540E;&#xFF0C;&#x89E3;&#x538B;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">tar -xvf zookeeper-3.4.8.tar.gz </div><div class="line">mv zookeeper-3.4.8 /usr/<span class="built_in">local</span>/</div><div class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/zookeeper-3.4.8/conf/</div><div class="line">mv zoo_sample.cfg{,.bak}</div><div class="line">vim zoo.cfg</div><div class="line">lientCnxns=50</div><div class="line">tickTime=2000</div><div class="line">initLimit=10</div><div class="line">syncLimit=5</div><div class="line">dataDir=/work/zookeeper/</div><div class="line">clientPort=2181</div><div class="line">server.1=10.16.20.63:2888:3888 </div><div class="line">server.2=10.16.20.64:2888:3888 </div><div class="line">server.3=10.16.20.62:2888:3888</div></pre></td></tr></table></figure><p></p>
<p>&#x8BF4;&#x660E;&#xFF1A;server.A=B&#xFF1A;C&#xFF1A;D&#xFF1A;&#x5176;&#x4E2D; A &#x662F;&#x4E00;&#x4E2A;&#x6570;&#x5B57;&#xFF0C;&#x8868;&#x793A;&#x8FD9;&#x4E2A;&#x662F;&#x7B2C;&#x51E0;&#x53F7;&#x670D;&#x52A1;&#x5668;&#xFF1B;B &#x662F;&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#x5668;&#x7684; ip &#x5730;&#x5740;&#xFF1B;C &#x8868;&#x793A;&#x7684;&#x662F;&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#x5668;&#x4E0E;&#x96C6;&#x7FA4;&#x4E2D;&#x7684; Leader &#x670D;&#x52A1;&#x5668;&#x4EA4;&#x6362;&#x4FE1;&#x606F;&#x7684;&#x7AEF;&#x53E3;&#xFF1B;D &#x8868;&#x793A;&#x7684;&#x662F;&#x4E07;&#x4E00;&#x96C6;&#x7FA4;&#x4E2D;&#x7684; Leader &#x670D;&#x52A1;&#x5668;&#x6302;&#x4E86;&#xFF0C;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x7AEF;&#x53E3;&#x6765;&#x91CD;&#x65B0;&#x8FDB;&#x884C;&#x9009;&#x4E3E;&#xFF0C;&#x9009;&#x51FA;&#x4E00;&#x4E2A;&#x65B0;&#x7684; Leader&#xFF0C;&#x800C;&#x8FD9;&#x4E2A;&#x7AEF;&#x53E3;&#x5C31;&#x662F;&#x7528;&#x6765;&#x6267;&#x884C;&#x9009;&#x4E3E;&#x65F6;&#x670D;&#x52A1;&#x5668;&#x76F8;&#x4E92;&#x901A;&#x4FE1;&#x7684;&#x7AEF;&#x53E3;&#x3002;&#x5982;&#x679C;&#x662F;&#x4F2A;&#x96C6;&#x7FA4;&#x7684;&#x914D;&#x7F6E;&#x65B9;&#x5F0F;&#xFF0C;&#x7531;&#x4E8E; B &#x90FD;&#x662F;&#x4E00;&#x6837;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x540C;&#x7684; Zookeeper &#x5B9E;&#x4F8B;&#x901A;&#x4FE1;&#x7AEF;&#x53E3;&#x53F7;&#x4E0D;&#x80FD;&#x4E00;&#x6837;&#xFF0C;&#x6240;&#x4EE5;&#x8981;&#x7ED9;&#x5B83;&#x4EEC;&#x5206;&#x914D;&#x4E0D;&#x540C;&#x7684;&#x7AEF;&#x53E3;&#x53F7;&#x3002;</p>
<p>&#x521B;&#x5EFA;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x76EE;&#x5F55;&#xFF0C;&#x5E76;&#x8BBE;&#x7F6E;&#x5F53;&#x524D;zk&#x7684;&#x7ED3;&#x70B9;ID<br>&#x670D;&#x52A1;&#x5668;1<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mkdir -pv /work/zookeeper </div><div class="line"><span class="built_in">echo</span> <span class="string">&quot;1&quot;</span> &gt; /work/zookeeper/myid</div></pre></td></tr></table></figure></p>
<p>&#x670D;&#x52A1;&#x5668;2<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mkdir -pv /work/zookeeper </div><div class="line"><span class="built_in">echo</span> <span class="string">&quot;2&quot;</span> &gt; /work/zookeeper/myid</div></pre></td></tr></table></figure></p>
<p>&#x670D;&#x52A1;&#x5668;3<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mkdir -pv /work/zookeeper </div><div class="line"><span class="built_in">echo</span> <span class="string">&quot;3&quot;</span> &gt; /work/zookeeper/myid</div></pre></td></tr></table></figure></p>
<p>&#x542F;&#x52A8;zookeeper,&#x5206;&#x522B;&#x5728;&#x4E09;&#x53F0;&#x673A;&#x5668;&#x4E0A;&#x542F;&#x52A8;zookeepe<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">/usr/<span class="built_in">local</span>/zookeeper-3.4.8/bin/zkServer.sh start </div><div class="line">ZooKeeper JMX enabled by default</div><div class="line">Using config: /usr/<span class="built_in">local</span>/zookeeper-3.4.8/bin/../conf/zoo.cfg</div><div class="line">Starting zookeeper ... STARTED</div></pre></td></tr></table></figure></p>
<p>&#x786E;&#x4FDD;zookeeper&#x96C6;&#x7FA4;&#x662F;&#x5426;&#x542F;&#x52A8;&#x6210;&#x529F;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">/usr/<span class="built_in">local</span>/zookeeper-3.4.8/bin/zkServer.sh status</div><div class="line">JMX enabled by default</div><div class="line">Using config: /usr/<span class="built_in">local</span>/zookeeper-3.4.8/bin/../conf/zoo.cfg</div><div class="line">Mode: follower</div></pre></td></tr></table></figure></p>
<p></p><h4 id="go&#x8BED;&#x8A00;&#x73AF;&#x5883;&#x642D;&#x5EFA;">go&#x8BED;&#x8A00;&#x73AF;&#x5883;&#x642D;&#x5EFA;</h4><br>&#x4E0B;&#x8F7D;go&#x8BED;&#x8A00;&#x5305;&#xFF0C;&#x7531;&#x4E8E;&#x56FD;&#x5185;&#x7684;&#x7279;&#x6B8A;&#x60C5;&#x51B5;&#xFF0C;&#x6709;&#x4E9B;&#x7F51;&#x7AD9;&#x662F;&#x8BBF;&#x95EE;&#x4E0D;&#x4E86;&#x7684;&#x3002;&#x6240;&#x4EE5;&#x8FD8;&#x662F;&#x8981;&#x81EA;&#x884C;&#x53BB;&#x7F51;&#x7AD9;&#x4E0B;&#x8F7D;&#xFF0C;&#x7F51;&#x5740;&#xFF1A;<a href="http://www.golangtc.com/download/" target="_blank" rel="external">http://www.golangtc.com/download/</a> &#xFF0C;  &#x4E0B;&#x8F7D;&#x5B8C;&#x6BD5;&#x540E;&#x89E3;&#x538B;&#x5230;/usr/local&#x5982;&#x4E0B;&#xFF1A;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">tar -zxf go1.6.2.linux-amd64.tar.gz -C /usr/<span class="built_in">local</span>/</div><div class="line">vim /etc/profile.d/go.sh</div><div class="line"><span class="comment"># &#x8BBE;&#x7F6E;go&#x8BED;&#x8A00;&#x73AF;&#x5883;&#x53D8;&#x91CF;</span></div><div class="line"><span class="built_in">export</span> GOROOT=/usr/<span class="built_in">local</span>/go</div><div class="line"><span class="built_in">export</span> GOPATH=/usr/<span class="built_in">local</span>/codis</div><div class="line"><span class="built_in">export</span> PATH=<span class="variable">$GOPATH</span>/bin:<span class="variable">$GOROOT</span>/bin:<span class="variable">$PATH</span></div><div class="line"><span class="built_in">source</span> /etc/profile.d/go.sh</div><div class="line"><span class="comment"># &#x91CD;&#x8F7D;&#x73AF;&#x5883;&#x53D8;&#x91CF;</span></div><div class="line">go version</div><div class="line">go version go1.6.2 linux/amd64</div></pre></td></tr></table></figure><p></p>
<p></p><h3 id="codis&#x96C6;&#x7FA4;&#x5B89;&#x88C5;">codis&#x96C6;&#x7FA4;&#x5B89;&#x88C5;</h3><p></p>
<p></p><h4 id="codis&#x5B89;&#x88C5;">codis&#x5B89;&#x88C5;</h4><p></p>
<p></p><h5 id="&#x8BBE;&#x7F6E;&#x7F16;&#x8BD1;&#x73AF;&#x5883;">&#x8BBE;&#x7F6E;&#x7F16;&#x8BD1;&#x73AF;&#x5883;</h5><br>&#x6DFB;&#x52A0; <code>$GOPATH/bin</code> &#x5230; $PATH&#xFF0C;&#x5B89;&#x88C5; godep &#x5DE5;&#x5177;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">go get -u github.com/tools/godep &amp;&amp; <span class="built_in">which</span> godep</div><div class="line">/usr/<span class="built_in">local</span>/codis/bin/godep</div></pre></td></tr></table></figure><p></p>
<p></p><h5 id="&#x4E0B;&#x8F7D;-codis-&#x6E90;&#x4EE3;&#x7801;">&#x4E0B;&#x8F7D; Codis &#x6E90;&#x4EE3;&#x7801;</h5><br>Codis &#x6E90;&#x4EE3;&#x7801;&#x9700;&#x8981;&#x4E0B;&#x8F7D;&#x5230; <code>$GOPATH/src/github.com/CodisLabs/codis</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mkdir -p <span class="variable">$GOPATH</span>/src/github.com/CodisLabs</div><div class="line"><span class="built_in">cd</span> <span class="variable">$_</span> &amp;&amp; git <span class="built_in">clone</span> https://github.com/CodisLabs/codis.git -b release3.1</div></pre></td></tr></table></figure><p></p>
<p></p><h5 id="&#x7F16;&#x8BD1;-codis-&#x6E90;&#x4EE3;&#x7801;">&#x7F16;&#x8BD1; Codis &#x6E90;&#x4EE3;&#x7801;</h5><br>Codis &#x7F16;&#x8BD1;&#x8FC7;&#x7A0B;&#x4F7F;&#x7528;&#x4E86; godep&#xFF0C;&#x8BF7;&#x786E;&#x5B9A;&#x7F16;&#x8BD1;&#x4E4B;&#x524D; godep &#x80FD;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;<br>&#x76F4;&#x63A5;&#x901A;&#x8FC7; make &#x8FDB;&#x884C;&#x7F16;&#x8BD1;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> <span class="variable">$GOPATH</span>/src/github.com/CodisLabs/codis</div><div class="line">make</div><div class="line">make -j -C extern/redis-2.8.21/</div><div class="line">... ...</div><div class="line">go build -i -o bin/codis-dashboard ./cmd/dashboard</div><div class="line">go build -i -o bin/codis-proxy ./cmd/proxy</div><div class="line">go build -i -o bin/codis-admin ./cmd/admin</div><div class="line">go build -i -o bin/codis-ha ./cmd/ha</div><div class="line">go build -i -o bin/codis-fe ./cmd/fe</div></pre></td></tr></table></figure><p></p>
<p>&#x7F16;&#x8BD1;&#x6210;&#x529F;&#x540E;&#x5728;codis&#x4E0B;&#x9762;&#x7684;bin&#x76EE;&#x5F55;&#x4E0B;&#x4F1A;&#x6709;assets  codis-admin  codis-dashboard  codis-fe  codis-ha  codis-proxy  codis-server   redis-benchmark  redis-cli  version&#x7B49;&#x6587;&#x4EF6;&#xFF0C;assets&#x662F;codis-dashboard http&#x670D;&#x52A1;&#x9700;&#x8981;&#x7684;&#x524D;&#x7AEF;&#x8D44;&#x6E90;&#xFF0C;&#x9700;&#x8981;&#x548C;codis-dashboard&#x653E;&#x7F6E;&#x5728;&#x540C;&#x4E00;&#x76EE;&#x5F55;&#x4E0B;&#x3002;</p>
<p></p><h4 id="&#x7F16;&#x8F91;redis&#x914D;&#x7F6E;&#x6587;&#x4EF6;">&#x7F16;&#x8F91;redis&#x914D;&#x7F6E;&#x6587;&#x4EF6;</h4><br>&#x6BCF;&#x53F0;codis&#x670D;&#x52A1;&#x5668;&#x4E0A;&#xFF0C;&#x8981;&#x542F;&#x52A8;&#x4E24;&#x4E2A;redis&#x5B9E;&#x4F8B;&#xFF08;&#x4E5F;&#x53EF;&#x4EE5;&#x542F;&#x52A8;&#x591A;&#x4E2A;redis&#x5B9E;&#x4F8B;&#xFF09;&#xFF0C;&#x5148;&#x914D;&#x7F6E;&#x4E24;&#x4E2A;&#x5B9E;&#x4F8B;&#xFF0C;&#x4ECE;redis&#x5B9E;&#x4F8B;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x627E;&#x5230;&#x4E0B;&#x5217;&#x53C2;&#x6570;&#x9009;&#x9879;&#x5E76;&#x6309;&#x5982;&#x4E0B;&#x8FDB;&#x884C;&#x4FEE;&#x6539;&#xFF1A;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">mkdir -pv /work/codis</div><div class="line">mkdir -pv /var/<span class="built_in">log</span>/redis</div><div class="line">vim /usr/<span class="built_in">local</span>/codis/src/github.com/CodisLabs/codis/extern/redis-test/conf/6379.conf</div><div class="line">daemonize  yes</div><div class="line">pidfile  /var/run/redis6379.pid</div><div class="line">port  6379</div><div class="line">logfile  /var/<span class="built_in">log</span>/redis/6379.log</div><div class="line">dbfilename  dump6379.rdb</div><div class="line">dir /work/codis</div></pre></td></tr></table></figure><p></p>
<p>&#x914D;&#x7F6E;&#x7B2C;&#x4E8C;&#x4E2A;redis&#x5B9E;&#x4F8B;6380.conf&#x540C;&#x4E0A;&#x8BBE;&#x7F6E;&#x3002;<br>&#x6BCF;&#x53F0;codis&#x670D;&#x52A1;&#x5668;&#x4E0A;redis&#x914D;&#x7F6E;&#x5B8C;&#x6BD5;&#x540E;&#xFF0C;&#x542F;&#x52A8;redis&#x5B9E;&#x4F8B;&#xFF0C;&#x5982;&#x4E0B;&#xFF1A;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/codis/src/github.com/CodisLabs/codis/bin/</div><div class="line">./codis-server ../extern/redis-test/conf/6379.conf &amp;</div><div class="line">./codis-server ../extern/redis-test/conf/6380.conf &amp;</div><div class="line">ps  -ef |grep  codis-server</div><div class="line"><span class="comment"># &#x786E;&#x8BA4;6379&#x548C;6380&#x4E24;&#x4E2A;&#x8FDB;&#x7A0B;&#x6B63;&#x5728;&#x8DD1;</span></div></pre></td></tr></table></figure></p>
<p></p><h4 id="codis-dashboard">Codis Dashboard</h4><br>Coddis3.0&#x7684;dashboard&#x4E0E;codis 2.0&#x6709;&#x6240;&#x4E0D;&#x540C;&#xFF0C;&#x4F5C;&#x4E3A;&#x96C6;&#x7FA4;&#x7BA1;&#x7406;&#x5DE5;&#x5177;&#xFF0C;&#x5B83;&#x652F;&#x6301;codis-proxy,codis-server&#x7684;&#x6DFB;&#x52A0;&#x3001;&#x5220;&#x9664;&#x4EE5;&#x53CA;&#x6570;&#x636E;&#x8FC1;&#x79FB;&#x7B49;&#x64CD;&#x4F5C;&#x3002;&#x5728;&#x96C6;&#x7FA4;&#x72B6;&#x6001;&#x53D1;&#x751F;&#x6539;&#x53D8;&#x65F6;&#xFF0C;codis-dashboard &#x7EF4;&#x62A4;&#x96C6;&#x7FA4;&#x4E0B;&#x6240;&#x6709; codis-proxy &#x7684;&#x72B6;&#x6001;&#x4E00;&#x81F4;&#x6027;&#x3002;&#x6709;&#x4EE5;&#x4E0B;&#x4E24;&#x70B9;&#x6CE8;&#x610F;&#x4E8B;&#x9879;&#xFF1A;<p></p>
<ol>
<li>&#x5BF9;&#x4E8E;&#x540C;&#x4E00;&#x4E2A;&#x4E1A;&#x52A1;&#x96C6;&#x7FA4;&#x800C;&#x8A00;&#xFF0C;&#x540C;&#x4E00;&#x4E2A;&#x65F6;&#x523B;codis-dashboard&#x53EA;&#x80FD;&#x6709;0&#x4E2A;&#x6216;&#x8005;1&#x4E2A;&#xFF1B;</li>
<li>&#x6240;&#x6709;&#x5BF9;&#x96C6;&#x7FA4;&#x7684;&#x4FEE;&#x6539;&#x90FD;&#x5FC5;&#x987B;&#x901A;&#x8FC7;codis-dashboard&#x5B8C;&#x6210;&#x3002;</li>
</ol>
<p>&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;&#x6587;&#x4EF6;dashboard.toml&#x53EF;&#x7531;codis-dashboard&#x751F;&#x6210;&#x3002;</p>
<p>#bin/codis-dashboard  &#x2013;default-config | tee  dashboard.toml&#xFF08;&#x5C31;&#x662F;dashboard.conf&#xFF09;<br> &#x751F;&#x6210;dashboard.toml&#x6587;&#x4EF6;&#xFF0C;&#x53EF;&#x81EA;&#x884C;&#x914D;&#x7F6E;&#x3002;<br><figure class="highlight nix"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">vim dashboard.toml</div><div class="line"><span class="attr">coordinator_name</span> = <span class="string">&quot;zookeeper&quot;</span></div><div class="line"><span class="attr">coordinator_addr</span> = <span class="string">&quot;10.16.20.62:2181,10.16.20.63:2181,10.16.20.64:2181&quot;</span></div><div class="line"></div><div class="line"><span class="comment"># Set Codis Product Name/Auth.</span></div><div class="line"><span class="attr">product_name</span> = <span class="string">&quot;codis-demo&quot;</span></div><div class="line"><span class="attr">product_auth</span> = <span class="string">&quot;&quot;</span></div><div class="line"></div><div class="line"><span class="comment"># Set bind address for admin(rpc), tcp only.</span></div><div class="line"><span class="attr">admin_addr</span> = <span class="string">&quot;0.0.0.0:18080&quot;</span></div><div class="line"><span class="comment"># coordinator_name              &#x5916;&#x90E8;&#x5B58;&#x50A8;&#x7C7B;&#x578B;&#xFF0C;&#x63A5;&#x53D7; zookeeper/etcd</span></div><div class="line"><span class="comment"># coordinator_addr                &#x5916;&#x90E8;&#x5B58;&#x50A8;&#x5730;&#x5740;</span></div><div class="line"><span class="comment"># product_name                    &#x96C6;&#x7FA4;&#x540D;&#x79F0;&#xFF0C;&#x6EE1;&#x8DB3;&#x6B63;&#x5219; \w[\w\.\-]*</span></div><div class="line"><span class="comment"># product_auth                      &#x96C6;&#x7FA4;&#x5BC6;&#x7801;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;&#x7A7A;</span></div><div class="line"><span class="comment"># admin_addr                        RESTful API &#x7AEF;&#x53E3;</span></div><div class="line">```bash</div><div class="line">&#x542F;&#x52A8;dashboard</div><div class="line">```bash</div><div class="line">nohup bin/codis-dashboard <span class="attr">--ncpu=4</span> <span class="attr">--config=dashboard.toml</span> <span class="attr">--log=dashboard.log</span> <span class="attr">--log-level=WARN</span> &amp;</div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Usage:</div><div class="line">codis-dashboard [--ncpu=N][--config=CONF] [--log=FILE] [--log-level=LEVEL] [--host-admin=ADDR]</div><div class="line">codis-dashboard  --default-config</div><div class="line">codis-dashboard  --version</div><div class="line">&#x8BF4;&#x660E;&#xFF1A;</div><div class="line"> --ncpu=N                               &#x6700;&#x5927;&#x4F7F;&#x7528; CPU &#x4E2A;&#x6570;</div><div class="line"> -c  CONF, --config=CONF      &#x6307;&#x5B9A;&#x542F;&#x52A8;&#x914D;&#x7F6E;&#x6587;&#x4EF6;</div><div class="line"> <span class="_">-l</span>   FILE, --log=FILE                 &#x8BBE;&#x7F6E; <span class="built_in">log</span> &#x8F93;&#x51FA;&#x6587;&#x4EF6;</div><div class="line">--log-level=LEVEL             &#x8BBE;&#x7F6E;<span class="built_in">log</span>&#x8F93;&#x51FA;&#x7B49;&#x7EA7;&#xFF1A;INFO,WARN,DEBUG,ERROR&#xFF1B;&#x9ED8;&#x8BA4;INFO&#xFF0C;&#x63A8;&#x8350;WARN</div><div class="line">&#x6B63;&#x5E38;&#x5173;&#x95ED;dashboard&#x547D;&#x4EE4;&#xFF1A;     bin/codis-admin   --dashboard=192.168.33.6:18080   --shutdown</div></pre></td></tr></table></figure>
<p></p><h4 id="codis-proxy">Codis Proxy</h4><br>&#x5BF9;&#x4E8E;&#x540C;&#x4E00;&#x4E2A;&#x4E1A;&#x52A1;&#x96C6;&#x7FA4;&#x800C;&#x8A00;&#xFF0C;&#x53EF;&#x4EE5;&#x540C;&#x65F6;&#x90E8;&#x7F72;&#x591A;&#x4E2A;codis-proxy &#x5B9E;&#x4F8B;;<br>&#x4E0D;&#x540C; codis-proxy &#x4E4B;&#x95F4;&#x7531; codis-dashboard &#x4FDD;&#x8BC1;&#x72B6;&#x6001;&#x540C;&#x6B65;&#x3002;<br>&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;&#x6587;&#x4EF6; proxy.toml &#x53EF;&#x7531; codis-proxy &#x751F;&#x6210;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bin/codis-proxy --default-config | tee proxy.toml</div></pre></td></tr></table></figure><p></p>
<p>&#x751F;&#x6210;proxy.toml&#x53EF;&#x81EA;&#x884C;&#x914D;&#x7F6E;<br><figure class="highlight vala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">vim proxy.toml</div><div class="line"><span class="meta"># Set Codis Product {Name/Auth}.</span></div><div class="line">product_name = <span class="string">&quot;codis-demo&quot;</span></div><div class="line">product_auth = <span class="string">&quot;&quot;</span></div><div class="line"><span class="meta"># Set bind address for admin(rpc), tcp only.</span></div><div class="line">admin_addr = <span class="string">&quot;0.0.0.0:11080&quot;</span></div><div class="line"><span class="meta"># Set bind address for proxy, proto_type can be &quot;tcp&quot;,&quot;tcp4&quot;, &quot;tcp6&quot;, &quot;unix&quot; or &quot;unixpacket&quot;.</span></div><div class="line">proto_type = <span class="string">&quot;tcp4&quot;</span></div><div class="line">proxy_addr = <span class="string">&quot;0.0.0.0:19000&quot;</span></div><div class="line"> # Set jodis address &amp; session timeout.</div><div class="line">jodis_addr = <span class="string">&quot;&quot;</span></div><div class="line">jodis_timeout = <span class="number">10</span></div><div class="line"><span class="meta"># Proxy will ping-pong backend redis periodly to keep-alive</span></div><div class="line">backend_ping_period = <span class="number">5</span></div><div class="line"><span class="meta"># If there is no request from client for a long time, the connectionwill be droped. Set 0 to disable.</span></div><div class="line">session_max_timeout = <span class="number">1800</span></div><div class="line"><span class="meta"># Buffer size for each client connection.</span></div><div class="line">session_max_bufsize = <span class="number">131072</span></div><div class="line"><span class="meta"># Number of buffered requests for each client connection.</span></div><div class="line"><span class="meta"># Make sure this is higher than the max number of requests for eachpipeline request, or your client may be blocked.</span></div><div class="line">session_max_pipeline = <span class="number">1024</span></div><div class="line"><span class="meta"># Set period between keep alives. Set 0 to disable.</span></div><div class="line">session_keepalive_period = <span class="number">60</span></div><div class="line"></div><div class="line"><span class="meta">#product_name                                 &#x96C6;&#x7FA4;&#x540D;&#x79F0;&#xFF0C;&#x53C2;&#x8003;dashboard&#x53C2;&#x6570;&#x8BF4;&#x660E;</span></div><div class="line"><span class="meta">#product_auth                                   &#x96C6;&#x7FA4;&#x5BC6;&#x7801;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;&#x7A7A;</span></div><div class="line"><span class="meta">#admin_addr                                     RESTfulAPI &#x7AEF;&#x53E3;</span></div><div class="line"><span class="meta">#proto_type                                       Redis &#x7AEF;&#x53E3;&#x7C7B;&#x578B;&#xFF0C;&#x63A5;&#x53D7;tcp/tcp4/tcp6/unix/unixpacket</span></div><div class="line"><span class="meta">#proxy_addr                                      Redis &#x7AEF;&#x53E3;&#x5730;&#x5740;&#x6216;&#x8005;&#x8DEF;&#x5F84;</span></div><div class="line"><span class="meta">#jodis_addr                                       Jodis&#x6CE8;&#x518C;zookeeper&#x5730;&#x5740;</span></div><div class="line"><span class="meta">#jodis_timeout                                  Jodis&#x6CE8;&#x518C;sessiontimeout&#x65F6;&#x95F4;&#xFF0C;&#x5355;&#x4F4D;second</span></div><div class="line"><span class="meta">#jodis_compatible                             Jodis&#x6CE8;&#x518C; zookeeper &#x7684;&#x8DEF;&#x5F84;</span></div><div class="line"><span class="meta">#backend_ping_period                     &#x4E0E;codis-server &#x63A2;&#x6D3B;&#x5468;&#x671F;&#xFF0C;&#x5355;&#x4F4D;second&#xFF0C;0&#x8868;&#x793A;&#x7981;&#x6B62;</span></div><div class="line"><span class="meta">#session_max_timeout                     &#x4E0E;client &#x8FDE;&#x63A5;&#x6700;&#x5927;&#x8BFB;&#x8D85;&#x65F6;&#xFF0C;&#x5355;&#x4F4D;second&#xFF0C;0&#x8868;&#x793A;&#x7981;&#x6B62;</span></div><div class="line"><span class="meta">#session_max_bufsize                      &#x4E0E;client &#x8FDE;&#x63A5;&#x8BFB;&#x5199;&#x7F13;&#x51B2;&#x533A;&#x5927;&#x5C0F;&#xFF0C;&#x5355;&#x4F4D;byte</span></div><div class="line"><span class="meta">#session_max_pipeline                     &#x4E0E;client &#x8FDE;&#x63A5;&#x6700;&#x5927;&#x7684;pipeline&#x5927;&#x5C0F;</span></div><div class="line"><span class="meta">#session_keepalive_period               &#x4E0E;client &#x7684; tcp keepalive&#x5468;&#x671F;&#xFF0C;&#x4EC5;tcp&#x6709;&#x6548;&#xFF0C;0&#x8868;&#x793A;&#x7981;&#x6B62;</span></div></pre></td></tr></table></figure></p>
<p>&#x542F;&#x52A8;proxy<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nohup bin/codis-proxy --ncpu=4 --config=proxy.toml --log=proxy.log --log-level=WARN &amp;</div></pre></td></tr></table></figure></p>
<p>codis-proxy&#x542F;&#x52A8;&#x540E;&#xFF0C;&#x5904;&#x4E8E; waiting &#x72B6;&#x6001;&#xFF0C;&#x76D1;&#x542C;proxy_addr &#x5730;&#x5740;&#xFF0C;&#x4F46;&#x662F;&#x4E0D;&#x4F1A;accept&#x8FDE;&#x63A5;&#x3002;&#x6DFB;&#x52A0;&#x5230;&#x96C6;&#x7FA4;&#x5E76;&#x5B8C;&#x6210;&#x96C6;&#x7FA4;&#x72B6;&#x6001;&#x7684;&#x540C;&#x6B65;&#xFF0C;&#x624D;&#x80FD;&#x6539;&#x53D8;&#x72B6;&#x6001;&#x4E3A;online&#x3002;&#x6DFB;&#x52A0;&#x7684;&#x65B9;&#x6CD5;&#x6709;&#x4EE5;&#x4E0B;&#x4E24;&#x79CD;&#xFF1A;<br>&#x901A;&#x8FC7;codis-fe&#x6DFB;&#x52A0;&#xFF1A;&#x901A;&#x8FC7;Add Proxy&#x6309;&#x94AE;&#xFF0C;&#x5C06;admin_addr&#x52A0;&#x5165;&#x5230;&#x96C6;&#x7FA4;&#x4E2D;&#xFF1B;(&#x8FD9;&#x4E2A;&#x6211;&#x4EEC;&#x7A0D;&#x540E;&#x518D;&#x8BF4;)<br>&#x901A;&#x8FC7;codis-admin&#x547D;&#x4EE4;&#x884C;&#x5DE5;&#x5177;&#x6DFB;&#x52A0;&#xFF0C;&#x65B9;&#x6CD5;&#x5982;&#x4E0B;&#xFF1A;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">bin/codis-admin --dashboard=10.16.20.62:18080 --create-proxy -x 10.16.20.62:11080</div><div class="line">bin/codis-admin --dashboard=10.16.20.62:18080 --create-proxy -x 10.16.20.63:11080</div><div class="line">bin/codis-admin --dashboard=10.16.20.62:18080 --create-proxy -x 10.16.20.64:11080</div></pre></td></tr></table></figure></p>
<p>&#x5176;&#x4E2D;10.16.20.62:18080 &#x4EE5;&#x53CA;10.16.20.63:11080 &#x5206;&#x522B;&#x4E3A;dashboard&#x548C;proxy&#x7684;admin_addr &#x5730;&#x5740;&#x3002;<br>&#x6DFB;&#x52A0;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;dashboard&#x4F1A;&#x5B8C;&#x6210;&#x5982;&#x4E0B;&#x4E00;&#x7CFB;&#x5217;&#x52A8;&#x4F5C;&#xFF1A;</p>
<ol>
<li>&#x83B7;&#x53D6; proxy &#x4FE1;&#x606F;&#xFF0C;&#x5BF9;&#x96C6;&#x7FA4;name&#x4EE5;&#x53CA;auth&#x8FDB;&#x884C;&#x9A8C;&#x8BC1;&#xFF0C;&#x5E76;&#x5C06;&#x5176;&#x4FE1;&#x606F;&#x5199;&#x5165;&#x5230;&#x5916;&#x90E8;&#x5B58;&#x50A8;&#x4E2D;&#xFF1B;</li>
<li>&#x540C;&#x6B65;slots&#x72B6;&#x6001;&#xFF1B;</li>
<li>&#x6807;&#x8BB0;proxy&#x72B6;&#x6001;&#x4E3A;online&#xFF0C;&#x6B64;&#x540E;proxy&#x5F00;&#x59CB;accept&#x8FDE;&#x63A5;&#x5E76;&#x5F00;&#x59CB;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x3002;</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#bin/codis-proxy   -h</span></div><div class="line">Usage:</div><div class="line">codis-proxy [--ncpu=N][--config=CONF] [--log=FILE] [--log-level=LEVEL] [--host-admin=ADDR]</div><div class="line">[--host-proxy=ADDR] [--ulimit=NLIMIT]</div><div class="line">codis-proxy   --default-config</div><div class="line">codis-proxy   --version</div><div class="line"> Options:</div><div class="line">    --ncpu=N                              &#x6700;&#x5927;&#x4F7F;&#x7528; CPU &#x4E2A;&#x6570;</div><div class="line">    -c CONF, --config=CONF      &#x6307;&#x5B9A;&#x542F;&#x52A8;&#x914D;&#x7F6E;&#x6587;&#x4EF6;</div><div class="line">    <span class="_">-l</span> FILE, --log=FILE                 &#x8BBE;&#x7F6E; <span class="built_in">log</span> &#x8F93;&#x51FA;&#x6587;&#x4EF6;</div><div class="line">    --log-level=LEVEL         &#x8BBE;&#x7F6E; <span class="built_in">log</span> &#x8F93;&#x51FA;&#x7B49;&#x7EA7;&#xFF1A;INFO,WARN,DEBUG,ERROR&#xFF1B;&#x9ED8;&#x8BA4;INFO&#xFF0C;&#x63A8;&#x8350;WARN</div><div class="line">    --ulimit=NLIMIT            &#x68C0;&#x67E5;<span class="built_in">ulimit</span> -n&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x786E;&#x4FDD;&#x8FD0;&#x884C;&#x65F6;&#x6700;&#x5927;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x4E0D;&#x5C11;&#x4E8E;NLIMIT</div></pre></td></tr></table></figure>
<p></p><h4 id="codis-fe"> Codis FE</h4><br>&#x96C6;&#x7FA4;&#x7BA1;&#x7406;&#x754C;&#x9762;:<p></p>
<ul>
<li>&#x591A;&#x4E2A;&#x96C6;&#x7FA4;&#x5B9E;&#x4F8B;&#x53EF;&#x4EE5;&#x5171;&#x4EAB;&#x540C;&#x4E00;&#x4E2A;&#x524D;&#x7AEF;&#x5C55;&#x793A;&#x9875;&#x9762;</li>
<li>&#x901A;&#x8FC7;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7BA1;&#x7406;&#x540E;&#x7AEF;codis-dashboard&#x5217;&#x8868;&#xFF0C;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x53EF;&#x81EA;&#x52A8;&#x66F4;&#x65B0;</li>
</ul>
<p>&#x914D;&#x7F6E;codis-fe<br>&#x914D;&#x7F6E;&#x6587;&#x4EF6;codis.json&#xFF08;fe.conf&#xFF09;&#x53EF;&#x4EE5;&#x624B;&#x52A8;&#x7F16;&#x8F91;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;codis-admin&#x4ECE;&#x5916;&#x90E8;&#x5B58;&#x50A8;&#x4E2D;&#x62C9;&#x53D6;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">bin/codis-admin --dashboard-list   --zookeeper=10.16.20.62:2181 | tee codis.json</div><div class="line">2016/12/20 16:51:50 zkclient.go:23: [INFO] zookeeper - zkclient setup new connection to 10.16.20.62:2181</div><div class="line">2016/12/20 16:51:50 zkclient.go:23: [INFO] zookeeper - Connected to 10.16.20.62:2181</div><div class="line">2016/12/20 16:51:50 zkclient.go:23: [INFO] zookeeper - Authenticated: id=97138763315609600, timeout=40000</div><div class="line">[</div><div class="line">    {</div><div class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;codis-demo&quot;</span>,</div><div class="line">        <span class="string">&quot;dashboard&quot;</span>: <span class="string">&quot;10.16.20.62:18080&quot;</span></div><div class="line">    }</div><div class="line">]</div><div class="line">2016/12/20 16:51:50 zkclient.go:23: [INFO] zookeeper - Recv loop terminated: err=EOF</div><div class="line">2016/12/20 16:51:50 zkclient.go:23: [INFO] zookeeper - Send loop terminated: err=&lt;nil&gt;</div></pre></td></tr></table></figure></p>
<p>&#x542F;&#x52A8;codis-fe<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">nohup bin/codis-fe --ncpu=4 --log=fe.log --log-level=WARN --dashboard-list=codis.json   --listen=0.0.0.0:18090   &amp;</div><div class="line"><span class="comment"># &#x8FD9;&#x91CC;&#x6307;&#x5B9A;&#x7AEF;&#x53E3;&#x53F7;&#x4E3A;18090&#x662F;&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x548C;codis-dashboard&#x7684;&#x7AEF;&#x53E3;&#x53F7;18080&#x51B2;&#x7A81;</span></div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#bin/codis-fe  -h</span></div><div class="line">Usage:</div><div class="line">    codis-fe [--ncpu=N][--log=FILE] [--log-level=LEVEL] --dashboard-list=LIST --listen=ADDR</div><div class="line">    codis-fe  --version</div><div class="line">Options:</div><div class="line">--ncpu=N                                  &#x6700;&#x5927;&#x4F7F;&#x7528; CPU &#x4E2A;&#x6570;</div><div class="line"><span class="_">-d</span> LIST,--dashboard-list=LIST   &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x80FD;&#x591F;&#x81EA;&#x52A8;&#x5237;&#x65B0;</div><div class="line"><span class="_">-l</span> FILE, --log=FILE                     &#x8BBE;&#x7F6E; <span class="built_in">log</span> &#x8F93;&#x51FA;&#x6587;&#x4EF6;</div><div class="line">--log-level=LEVEL        &#x8BBE;&#x7F6E; <span class="built_in">log</span> &#x8F93;&#x51FA;&#x7B49;&#x7EA7;&#xFF1A;INFO,WARN,DEBUG,ERROR&#xFF1B;&#x9ED8;&#x8BA4;INFO&#xFF0C;&#x63A8;&#x8350;WARN</div><div class="line">--listen=ADDR                         HTTP &#x670D;&#x52A1;&#x7AEF;&#x53E3;</div></pre></td></tr></table></figure>
<p>&#x6253;&#x5F00;&#x6D4F;&#x89C8;&#x5668;&#xFF0C;&#x5728;&#x5730;&#x5740;&#x680F;&#x91CC;&#x8F93;&#x5165;<a href="http://192.168.4.157:18090/&#xFF0C;&#x901A;&#x8FC7;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x64CD;&#x4F5C;Codis" target="_blank" rel="external">http://192.168.4.157:18090/&#xFF0C;&#x901A;&#x8FC7;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x64CD;&#x4F5C;Codis</a><br><img src="/uploads/codis2.png" class="blockquote-center"> </p>
<p>&#x9664;&#x4E86;&#x56FE;&#x5F62;&#x754C;&#x9762;&#x8FDB;&#x884C;&#x5982;&#x4E0A;&#x64CD;&#x4F5C;&#x5916;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x547D;&#x4EE4;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#x3002;<br>&#x521B;&#x5EFA;&#x7EC4;:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#bin/codis-admin   --dashboard=192.168.33.6:18080   --create-group    --gid=1</span></div><div class="line"><span class="comment">#bin/codis-admin   --dashboard=192.168.33.6:18080   --create-group    --gid=2</span></div></pre></td></tr></table></figure></p>
<p>&#x7EC4;&#x6DFB;&#x52A0;&#x670D;&#x52A1;&#x5668;&#xFF1A;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#bin/codis-admin  --dashboard=192.168.33.6:18080  --group-add  --gid=1 --addr=192.168.33.6:6379</span></div><div class="line"><span class="comment">#bin/codis-admin   --dashboard=192.168.33.6:18080  --group-add  --gid=1 --addr=192.168.33.6:6380</span></div></pre></td></tr></table></figure></p>
<p>&#x628A;&#x4ECE;&#x5E93;&#x8DDF;&#x4E3B;&#x5E93;&#x540C;&#x6B65;&#xFF08;&#x540C;&#x4E00;&#x7EC4;&#x7684;&#x4E24;&#x4E2A;&#x5B9E;&#x4F8B;&#x90FD;&#x8981;&#x6267;&#x884C;&#xFF09;&#xFF1A;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#bin/codis-admin  --dashboard=192.168.33.6:18080   --sync-action  --create --addr=192.168.33.6:6379</span></div><div class="line"><span class="comment">#bin/codis-admin  --dashboard=192.168.33.6:18080   --sync-action  --create --addr=192.168.33.6:6380</span></div></pre></td></tr></table></figure></p>
<p>&#x82E5;&#x4ECE;&#x5E93;&#x9700;&#x8981;&#x63D0;&#x5347;&#x4E3A;master&#xFF0C;&#x64CD;&#x4F5C;&#x5982;&#x4E0B;:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#bin/codis-admin  --dashboard=192.168.33.6:18080   --promote-server  --gid=1 --addr=192.168.33.6:6380(&#x4ECE;&#x5E93;ip&#x548C;&#x7AEF;&#x53E3;)</span></div></pre></td></tr></table></figure></p>
<p>&#x521D;&#x59CB;&#x5316; slots&#x5E76;&#x8BBE;&#x7F6E; server group&#x670D;&#x52A1;&#x7684;slot&#x8303;&#x56F4;((&#x53EA;&#x5728;&#x4E00;&#x8282;&#x70B9;&#x6267;&#x884C;&#x4E00;&#x6B21;)sid&#x662F;slot&#x7684;&#x7F16;&#x53F7;&#x3002;Codis&#x91C7;&#x7528;Pre-sharding&#x6280;&#x672F;&#x6765;&#x5B9E;&#x73B0;&#x6570;&#x636E;&#x7684;&#x5206;&#x7247;, &#x9ED8;&#x8BA4;&#x5206;&#x6210;1024&#x4E2A;slots (0-1023), &#x5BF9;&#x4E8E;&#x6BCF;&#x4E2A;key&#x6765;&#x8BF4;&#xFF0C;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x516C;&#x5F0F;&#x786E;&#x5B9A;&#x6240;&#x5C5E;&#x7684;Slot Id : SlotId = crc32(key) % 1024&#x6BCF;&#x4E00;&#x4E2A;slot&#x90FD;&#x4F1A;&#x6709;&#x4E00;&#x4E2A;&#x4E14;&#x5FC5;&#x987B;&#x6709;&#x4E00;&#x4E2A;&#x7279;&#x5B9A;&#x7684;server group id&#x6765;&#x8868;&#x793A;&#x8FD9;&#x4E2A;slot&#x7684;&#x6570;&#x636E;&#x7531;&#x54EA;&#x4E2A;server group&#x6765;&#x63D0;&#x4F9B;&#x3002;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#bin/codis-admin   --dashboard=192.168.33.6:18080   --slot-action   --create-range   --beg=0  --end=300   --gid=1</span></div><div class="line"><span class="comment">#bin/codis-admin   --dashboard=192.168.33.6:18080   --slot-action   --create-range   --beg=301 --end=601   --gid=2</span></div></pre></td></tr></table></figure></p>
<p></p><h4 id="codis-ha">Codis HA</h4><br>&#x6CE8;&#x610F;&#xFF1A;Codis HA&#x5DE5;&#x5177;&#x4EC5;&#x4EC5;&#x662F;Codis &#x96C6;&#x7FA4;HA &#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x5355;&#x72EC;&#x5DE5;&#x4F5C;&#x80FD;&#x529B;&#x6709;&#x9650;&#x3002;<p></p>
<ul>
<li>&#x9ED8;&#x8BA4;&#x4EE5; 5s&#x4E3A;&#x5468;&#x671F;&#xFF0C;codis-ha&#x4F1A;&#x4ECE;codis-dashboard&#x4E2D;&#x62C9;&#x53D6;&#x96C6;&#x7FA4;&#x72B6;&#x6001;&#xFF0C;&#x5E76;&#x8FDB;&#x884C;&#x4E3B;&#x4ECE;&#x5207;&#x6362;&#xFF1B;</li>
</ul>
<p>codis-ha &#x5728;&#x4EE5;&#x4E0B;&#x72B6;&#x6001;&#x4E0B;&#x4F1A;&#x9000;&#x51FA;&#xFF1A;</p>
<ul>
<li>&#x4ECE; codis-dashboard &#x83B7;&#x53D6;&#x96C6;&#x7FA4;&#x72B6;&#x6001;&#x5931;&#x8D25;&#x65F6;&#xFF1B;</li>
<li>&#x5411;codis-dashboard&#x53D1;&#x9001;&#x4E3B;&#x4ECE;&#x5207;&#x6362;&#x6307;&#x4EE4;&#x5931;&#x8D25;&#x65F6;&#x3002;</li>
</ul>
<p>odis-ha&#x5728;&#x4EE5;&#x4E0B;&#x72B6;&#x6001;&#x4E0B;&#x4E0D;&#x4F1A;&#x8FDB;&#x884C;&#x4E3B;&#x4ECE;&#x5207;&#x6362;&#xFF1A;</p>
<ul>
<li>&#x5B58;&#x5728;proxy&#x72B6;&#x6001;&#x5F02;&#x5E38;&#xFF1A;&#x56E0;&#x4E3A;&#x63D0;&#x5347;&#x4E3B;&#x4ECE;&#x9700;&#x8981;&#x5F97;&#x5230;&#x6240;&#x6709;proxy&#x7684;&#x786E;&#x8BA4;&#xFF0C;&#x56E0;&#x6B64;&#x5FC5;&#x987B;&#x786E;&#x4FDD;&#x64CD;&#x4F5C;&#x65F6;&#x6240;&#x6709;proxy&#x90FD;&#x80FD;&#x6B63;&#x5E38;&#x54CD;&#x5E94;&#x64CD;&#x4F5C;&#x6307;&#x4EE4;&#xFF1B;</li>
<li>&#x7F51;&#x7EDC;&#x539F;&#x56E0;&#x9020;&#x6210;&#x7684;master&#x5F02;&#x5E38;&#xFF1A;&#x82E5;&#x5B58;&#x5728;slave&#x6EE1;&#x8DB3;slave.master_link_status == up&#xFF0C;&#x901A;&#x5E38;&#x53EF;&#x4EE5;&#x8BA4;&#x4E3A;master&#x5E76;&#x6CA1;&#x6709;&#x771F;&#x7684;&#x9000;&#x51FA;&#xFF0C;&#x800C;&#x662F;&#x7531;&#x4E8E;&#x7F51;&#x7EDC;&#x539F;&#x56E0;&#x6216;&#x8005;&#x54CD;&#x5E94;&#x5EF6;&#x8FDF;&#x9020;&#x6210;&#x7684;master&#x72B6;&#x6001;&#x83B7;&#x53D6;&#x5931;&#x8D25;&#xFF0C;&#x6B64;&#x65F6;codis-ha&#x4E0D;&#x4F1A;&#x5BF9;&#x8BE5;group&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#xFF1B;<br>n&#x6CA1;&#x6709;&#x6EE1;&#x8DB3;&#x6761;&#x4EF6;&#x7684;slave&#x65F6;&#x3002;&#x63D0;&#x5347;&#x8FC7;&#x7A0B;&#x4F1A;&#x9009;&#x62E9;&#x6EE1;&#x8DB3;slave.master_link_status == down&#xFF0C;&#x5E76;&#x4E14;slave.master_link_down_since_seconds&#x6700;&#x5C0F;&#x7684;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#x3002;&#x8FD9;&#x5C31;&#x8981;&#x6C42;&#x88AB;&#x9009;&#x62E9;&#x7684;slave&#x81F3;&#x5C11;&#x5728;&#x8FC7;&#x53BB;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x5185;&#x4E0E;master&#x662F;&#x6210;&#x529F;&#x540C;&#x6B65;&#x72B6;&#x6001;&#xFF0C;&#x8FD9;&#x4E2A;&#x65F6;&#x95F4;&#x95F4;&#x9694;&#x662F;2d+5&#xFF0C;&#x5176;&#x4E2D;d&#x662F;codis-ha&#x68C0;&#x67E5;&#x5468;&#x671F;&#x9ED8;&#x8BA4;5&#x79D2;&#x3002;</li>
</ul>
<p><strong><em>&#x6CE8;&#x610F;&#xFF1A;&#x5E94;&#x7528;codis-ha&#x65F6;&#x8FD8;&#x9700;&#x8981;&#x7ED3;&#x5408;&#x5BF9;codis-proxy&#x548C;codis-server&#x7684;&#x53EF;&#x7528;&#x6027;&#x76D1;&#x63A7;&#xFF0C;&#x5426;&#x5219;codis-ha&#x65E0;&#x6CD5;&#x4FDD;&#x8BC1;&#x53EF;&#x9760;&#x6027;&#x3002;</em></strong></p>
<p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#xFF1A;codis-ha&#x5C06;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;slave&#x5347;&#x7EA7;&#x4E3A;master&#x65F6;&#xFF0C;&#x8BE5;&#x7EC4;&#x5185;&#x5176;&#x4ED6;slave&#x662F;&#x4E0D;&#x4F1A;&#x81EA;&#x52A8;&#x6539;&#x53D8;&#x72B6;&#x6001;&#x7684;&#xFF0C;&#x8FD9;&#x4E9B;slave&#x4ECD;&#x5C06;&#x8BD5;&#x56FE;&#x4ECE;&#x65E7;&#x7684;master&#x4E0A;&#x540C;&#x6B65;&#x6570;&#x636E;&#xFF0C;&#x56E0;&#x800C;&#x4F1A;&#x5BFC;&#x81F4;&#x7EC4;&#x5185;&#x65B0;&#x7684;master&#x548C;&#x5176;&#x4ED6;slave&#x4E4B;&#x95F4;&#x7684;&#x6570;&#x636E;&#x4E0D;&#x4E00;&#x81F4;&#x3002;&#x56E0;&#x4E3A;redis&#x7684;slaveof&#x547D;&#x4EE4;&#x5207;&#x6362;master&#x65F6;&#x4F1A;&#x4E22;&#x5F03;slave&#x4E0A;&#x7684;&#x5168;&#x90E8;&#x6570;&#x636E;&#xFF0C;&#x4ECE;&#x65B0;master&#x5B8C;&#x6574;&#x540C;&#x6B65;&#xFF0C;&#x4F1A;&#x6D88;&#x8017;&#x8D44;&#x6E90;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5F53;&#x51FA;&#x73B0;&#x4E3B;&#x4ECE;&#x5207;&#x6362;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x7BA1;&#x7406;&#x5458;&#x624B;&#x52A8;&#x521B;&#x5EFA;&#x65B0;&#x7684;sync action&#x6765;&#x5B8C;&#x6210;&#x65B0;master&#x4E0E;slave&#x4E4B;&#x95F4;&#x7684;&#x6570;&#x636E;&#x540C;&#x6B65;&#x3002;</p>
<p>&#x542F;&#x52A8;codis-ha<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nohup   bin/codis-ha   --log=ha.log  --log-level=WARN   --dashboard=10.16.20.62:18080 &amp;</div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Usage:</div><div class="line">    codis-ha [--log=FILE][--log-level=LEVEL] --dashboard=ADDR</div><div class="line">    codis-ha  --version</div><div class="line"> Options:</div><div class="line"><span class="_">-l</span> FILE, --log=FILE          &#x8BBE;&#x7F6E; <span class="built_in">log</span> &#x8F93;&#x51FA;&#x6587;&#x4EF6;</div><div class="line">--log-level=LEVEL          &#x8BBE;&#x7F6E; <span class="built_in">log</span> &#x8F93;&#x51FA;&#x7B49;&#x7EA7;&#xFF1A;INFO,WARN,DEBUG,ERROR&#xFF1B;&#x9ED8;&#x8BA4;INFO&#xFF0C;&#x63A8;&#x8350;WARN</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;Codis&lt;/code&gt; 是一个分布式 Redis 解决方案, 对于上层的应用来说, 连接到 Codis Proxy 和连接原生的 Redis Server 没有显著区别, 上层应用可以像使用单机的 Redis 一样使用, Codis 底层会处理请求的转发, 不停机的数据迁移等工作, 所有后边的一切事情, 对于前面的客户端来说是透明的, 可以简单的认为后边连接的是一个内存无限大的 Redis 服务。&lt;br&gt;
    
    </summary>
    
      <category term="NoSQL" scheme="http://www.chen-hao.com.cn/categories/NoSQL/"/>
    
    
      <category term="Codis" scheme="http://www.chen-hao.com.cn/tags/Codis/"/>
    
  </entry>
  
  <entry>
    <title>Linux系统初始化脚本</title>
    <link href="http://www.chen-hao.com.cn/Linux%E7%B3%BB%E7%BB%9F%E5%88%9D%E5%A7%8B%E5%8C%96%E8%84%9A%E6%9C%AC.html"/>
    <id>http://www.chen-hao.com.cn/Linux系统初始化脚本.html</id>
    <published>2016-12-13T07:37:27.000Z</published>
    <updated>2017-01-10T01:26:13.016Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p><code>CentOS</code>&#x7CFB;&#x7EDF;&#x5B89;&#x88C5;&#x4E4B;&#x540E;&#x5E76;&#x4E0D;&#x80FD;&#x7ACB;&#x5373;&#x6295;&#x5165;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4F7F;&#x7528;&#xFF0C;&#x5F80;&#x5F80;&#x9700;&#x8981;&#x5148;&#x7ECF;&#x8FC7;&#x6211;&#x4EEC;&#x8FD0;&#x7EF4;&#x4EBA;&#x5458;&#x7684;&#x4F18;&#x5316;&#x624D;&#x884C;&#xFF0C;&#x6240;&#x4EE5;&#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#x7701;&#x4E8B;&#xFF0C;&#x5F04;&#x4E00;&#x4E2A;&#x521D;&#x59CB;&#x5316;&#x811A;&#x672C;&#x52BF;&#x5728;&#x5FC5;&#x884C;&#x3002;<br> <a id="more"></a></p>
</blockquote>
<p>&#x8FD9;&#x91CC;&#x5C31;&#x76F4;&#x63A5;&#x8D34;&#x51FA;&#x811A;&#x672C;&#xFF0C;&#x5982;&#x4E0D;&#x60F3;&#x590D;&#x5236;&#x7C98;&#x8D34;&#x7684;&#x8BDD;&#xFF0C;&#x53EF;&#x76F4;&#x63A5;&#x5728;&#x6211;&#x7684;&#x767E;&#x5EA6;&#x7F51;&#x76D8;&#x7684;&#x94FE;&#x63A5;&#x4E0B;&#x8F7D;&#xFF1A;<br><a href="http://pan.baidu.com/s/1i5PrAz7" target="_blank" rel="external">http://pan.baidu.com/s/1i5PrAz7</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># Author: CH  18201620971@163.com</span></div><div class="line"><span class="comment"># 2016-12-13</span></div><div class="line"><span class="comment"># &#x6B64;&#x811A;&#x672C;&#x7528;&#x4E8E;&#x521D;&#x59CB;&#x5316; Centos6.5&#xFF0C;&#x5176;&#x4ED6;&#x7CFB;&#x7EDF;&#x8BF7;&#x81EA;&#x884C;&#x6D4B;&#x8BD5;</span></div><div class="line"></div><div class="line"><span class="comment"># &#x5B9A;&#x4E49;&#x57FA;&#x7840;&#x914D;&#x7F6E;</span></div><div class="line">PASSWD=123.com</div><div class="line">HOSTNAME=chenhao</div><div class="line">DNS1=114.114.114.114</div><div class="line">DNS2=8.8.8.8</div><div class="line">SSH_PORT=22122</div><div class="line">CHATTR=chenhao</div><div class="line"><span class="comment"># &#x6B64;&#x7A0B;&#x5E8F;&#x522B;&#x540D;&#xFF0C;&#x9632;&#x6B62;&#x4ED6;&#x4EBA;&#x4FEE;&#x6539;&#x5173;&#x952E;&#x6587;&#x4EF6;</span></div><div class="line">PORTS=80,22,21,8088</div><div class="line"><span class="comment"># &#x7528;&#x4E8E; iptables input &#x5F00;&#x653E;&#x7684;&#x7AEF;&#x53E3;</span></div><div class="line">HISTDIR=/usr/etc/.history</div><div class="line"><span class="comment"># &#x7528;&#x4E8E;&#x8BB0;&#x5F55;&#x767B;&#x5F55;&#x8FC7;&#x7CFB;&#x7EDF;&#x7684;&#x7528;&#x6237;&#x3001;IP&#x5730;&#x5740;&#x3001;shell&#x547D;&#x4EE4;&#x4EE5;&#x53CA;&#x8BE6;&#x7EC6;&#x64CD;&#x4F5C;&#x65F6;&#x95F4;</span></div><div class="line"></div><div class="line">cat &lt;&lt; EOF</div><div class="line">+------------------------------------------------------------------+</div><div class="line">|     **********  Welcome to CentOS 6.5 System init  **********    |</div><div class="line">+------------------------------------------------------------------+</div><div class="line">EOF</div><div class="line"></div><div class="line">[ `whoami` != <span class="string">&quot;root&quot;</span> ] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;please use root&quot;</span> &amp;&amp; <span class="built_in">exit</span> 1 </div><div class="line"></div><div class="line"><span class="keyword">function</span> <span class="function"><span class="title">format</span></span>() {</div><div class="line">    <span class="built_in">echo</span> <span class="_">-e</span> <span class="string">&quot;\033[32m Success!!!\033[0m\n&quot;</span></div><div class="line">    <span class="built_in">echo</span> <span class="string">&quot;#########################################################&quot;</span></div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">###&#x4FEE;&#x6539;root&#x7528;&#x6237;&#x5BC6;&#x7801;</span></div><div class="line"><span class="built_in">echo</span> <span class="string">&quot;set root passwd&quot;</span></div><div class="line"><span class="built_in">echo</span> <span class="variable">$PASSWD</span> | passwd root --stdin &amp;&gt; /dev/null</div><div class="line">format</div><div class="line"></div><div class="line"><span class="comment">###&#x4FEE;&#x6539;&#x4E3B;&#x673A;&#x540D;</span></div><div class="line"><span class="built_in">echo</span> <span class="string">&quot;set hostname&quot;</span></div><div class="line">hostname <span class="variable">$HOSTNAME</span> &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;HOSTNAME=<span class="variable">$HOSTNAME</span>&quot;</span> &gt;&gt; /etc/sysconfig/network</div><div class="line">format</div><div class="line"></div><div class="line"><span class="comment">###&#x914D;&#x7F6E;DNS&#x89E3;&#x6790;</span></div><div class="line"><span class="built_in">echo</span> <span class="string">&quot;set DNS&quot;</span></div><div class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span> &gt; /etc/resolv.conf     </div><div class="line"><span class="built_in">echo</span> <span class="string">&quot;nameserver <span class="variable">$DNS1</span>&quot;</span> &gt; /etc/resolv.conf</div><div class="line"><span class="built_in">echo</span> <span class="string">&quot;nameserver <span class="variable">$DNS2</span>&quot;</span> &gt;&gt; /etc/resolv.conf</div><div class="line">ping -c 3 www.baidu.com &amp;&gt; /dev/null || <span class="built_in">echo</span> <span class="string">&quot;&#x8BF7;&#x68C0;&#x67E5;&#x7F51;&#x7EDC;&#x8FDE;&#x63A5;,&#x6B64;&#x811A;&#x672C;&#x9700;&#x8981;&#x8BBF;&#x95EE;&#x5916;&#x7F51;&quot;</span> || <span class="built_in">exit</span> 3</div><div class="line">format</div><div class="line"></div><div class="line"><span class="comment">###&#x5173;&#x95ED;Selinux&#x670D;&#x52A1;</span></div><div class="line"><span class="built_in">echo</span> <span class="string">&quot;disable selinux&quot;</span></div><div class="line">[ `getenforce` != <span class="string">&quot;Disabled&quot;</span> ] &amp;&amp; setenforce 0 &amp;&gt; /dev/null &amp;&amp; sed -i s/<span class="string">&quot;^SELINUX=.*$&quot;</span>/<span class="string">&quot;SELINUX=disabled&quot;</span>/g /etc/sysconfig/selinux</div><div class="line">format</div><div class="line"></div><div class="line"><span class="comment">###&#x66F4;&#x65B0;yum&#x6E90;&#x4E3A;&#x963F;&#x91CC;&#x4E91;</span></div><div class="line"><span class="built_in">echo</span> <span class="string">&quot;set yum mirrirs&quot;</span></div><div class="line"><span class="built_in">cd</span> /etc/yum.repos.d/</div><div class="line">mv CentOS-Base.repo CentOS-Base.repo.bak</div><div class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-6.repo &amp;&gt; /dev/null</div><div class="line">wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-6.repo &amp;&gt; /dev/null</div><div class="line">yum clean all &amp;&gt; /dev/null &amp;&amp; yum makecache &amp;&gt; /dev/null</div><div class="line">format</div><div class="line"></div><div class="line"><span class="comment">###&#x66F4;&#x6539;ssh&#x7684;&#x670D;&#x52A1;&#x7AEF;&#x53E3;</span></div><div class="line"><span class="built_in">echo</span> <span class="string">&quot;set sshd&quot;</span></div><div class="line">cp /etc/ssh/sshd_config /etc/ssh/sshd_config.bak</div><div class="line">sed -i s/<span class="string">&quot;^Port 22&quot;</span>/<span class="string">&quot;Port <span class="variable">$SSH_PORT</span>&quot;</span>/g /etc/ssh/sshd_config</div><div class="line">sed -i s/<span class="string">&quot;^UseDNS yes&quot;</span>/<span class="string">&quot;UseDNS no&quot;</span>/g /etc/ssh/sshd_config</div><div class="line">service sshd restart &amp;&gt; /dev/null</div><div class="line">format</div><div class="line"></div><div class="line"><span class="comment">###&#x9501;&#x5B9A;&#x5173;&#x952E;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;($CHATTR -i&#x53EF;&#x4EE5;&#x6062;&#x590D;)</span></div><div class="line"><span class="built_in">echo</span> <span class="string">&quot;chattr files&quot;</span></div><div class="line">chattr +i /etc/passwd</div><div class="line">chattr +i /etc/inittab</div><div class="line">chattr +i /etc/group</div><div class="line">chattr +i /etc/shadow</div><div class="line">chattr +i /etc/gshadow</div><div class="line">chattr +i /etc/resolv.conf</div><div class="line">chattr +i /etc/hosts</div><div class="line">chattr +i /etc/fstab</div><div class="line">mv /usr/bin/chattr /usr/bin/<span class="variable">$CHATTR</span></div><div class="line">format</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">###&#x8BBE;&#x7F6E;&#x5B57;&#x7B26;&#x96C6;&#x4E3A;&#x4E2D;&#x6587;</span></div><div class="line"><span class="built_in">echo</span> <span class="string">&quot;set LANG&quot;</span></div><div class="line">yum -y groupinstall chinese-support &amp;&gt; /dev/null</div><div class="line">sed -i s/<span class="string">&quot;^LANG=.*$&quot;</span>/<span class="string">&quot;LANG=zh_CN.UTF-8&quot;</span>/ /etc/sysconfig/i18n</div><div class="line"><span class="built_in">echo</span> <span class="string">&apos;SUPPORTED=&quot;zh_CN:zh:en_US.UTF-8:en_US:en:zh_CN.GB18030&quot;&apos;</span> &gt;&gt; /etc/sysconfig/i18n</div><div class="line"><span class="built_in">source</span> /etc/sysconfig/i18n</div><div class="line">format</div><div class="line"></div><div class="line"><span class="comment">###&#x81EA;&#x52A8;&#x66F4;&#x65B0;&#x670D;&#x52A1;&#x5668;&#x65F6;&#x95F4;</span></div><div class="line"><span class="built_in">echo</span> <span class="string">&quot;set ntptime&quot;</span></div><div class="line">ntpdate cn.pool.ntp.org &amp;&gt; /dev/null</div><div class="line"><span class="built_in">echo</span> <span class="string">&apos;*/5 * * * * /usr/sbin/ntpdate cn.pool.ntp.org &amp;&gt;/dev/null&apos;</span> &gt;&gt; /etc/crontab</div><div class="line">hwclock -w</div><div class="line">format</div><div class="line"></div><div class="line"><span class="comment">###&#x8BBE;&#x7F6E;&#x6587;&#x4EF6;&#x53E5;&#x67C4;&#x6570;</span></div><div class="line"><span class="built_in">echo</span> <span class="string">&quot;Set ulimit 65535&quot;</span></div><div class="line"> </div><div class="line">cat &lt;&lt; EOF &gt; /etc/security/limits.conf</div><div class="line">*    soft    nofile  65535</div><div class="line">*    hard    nofile  65535</div><div class="line">*    soft    nproc 65535</div><div class="line">*    hard    nproc 65535</div><div class="line">EOF</div><div class="line">sed -i <span class="string">&apos;s/65535/1024000/g&apos;</span> /etc/security/limits.d/90-nproc.conf</div><div class="line">format</div><div class="line"></div><div class="line"><span class="comment">###&#x7CFB;&#x7EDF;&#x5BA1;&#x8BA1;&#x548C;&#x6545;&#x969C;&#x6392;&#x67E5;</span></div><div class="line"><span class="built_in">echo</span> <span class="string">&quot;set history&quot;</span></div><div class="line">cat &gt;&gt; /etc/profile &lt;&lt; EOF</div><div class="line">USER_IP=`who -u am i 2&gt;/dev/null| awk <span class="string">&apos;{print $NF}&apos;</span>|sed <span class="_">-e</span> <span class="string">&apos;s/[()]//g&apos;</span>`</div><div class="line"><span class="keyword">if</span> [ -z <span class="variable">$USER_IP</span> ]</div><div class="line"><span class="keyword">then</span></div><div class="line">USER_IP=`hostname`</div><div class="line"><span class="keyword">fi</span></div><div class="line"><span class="keyword">if</span> [ ! <span class="_">-d</span> <span class="variable">$HISTDIR</span> ]</div><div class="line"><span class="keyword">then</span></div><div class="line">mkdir -p <span class="variable">$HISTDIR</span></div><div class="line">chmod 777 <span class="variable">$HISTDIR</span></div><div class="line"><span class="keyword">fi</span></div><div class="line"><span class="keyword">if</span> [ ! <span class="_">-d</span> <span class="variable">$HISTDIR</span>/<span class="variable">${LOGNAME}</span> ]</div><div class="line"><span class="keyword">then</span></div><div class="line">mkdir -p <span class="variable">$HISTDIR</span>/<span class="variable">${LOGNAME}</span></div><div class="line">chmod 300 <span class="variable">$HISTDIR</span>/<span class="variable">${LOGNAME}</span></div><div class="line"><span class="keyword">fi</span></div><div class="line"><span class="built_in">export</span> HISTSIZE=2000</div><div class="line">DT=`date +%Y%m%d_%H%M%S`</div><div class="line"><span class="built_in">export</span> HISTFILE=<span class="string">&quot;<span class="variable">$HISTDIR</span>/<span class="variable">${LOGNAME}</span>/<span class="variable">${USER_IP}</span>.history.<span class="variable">$DT</span>&quot;</span></div><div class="line"><span class="built_in">export</span> HISTTIMEFORMAT=<span class="string">&quot;[%Y.%m.%d %H:%M:%S] &quot;</span></div><div class="line">chmod 600 <span class="variable">$HISTDIR</span>/<span class="variable">${LOGNAME}</span>/*.history* 2&gt;/dev/null</div><div class="line"> </div><div class="line"><span class="built_in">ulimit</span> -SHn 65535</div><div class="line"><span class="built_in">ulimit</span> -SHu unlimited</div><div class="line"><span class="built_in">ulimit</span> -SHd unlimited</div><div class="line"><span class="built_in">ulimit</span> -SHm unlimited</div><div class="line"><span class="built_in">ulimit</span> -SHs unlimited</div><div class="line"><span class="built_in">ulimit</span> -SHt unlimited</div><div class="line"><span class="built_in">ulimit</span> -SHv unlimited</div><div class="line">EOF</div><div class="line"><span class="built_in">source</span> /etc/profile</div><div class="line">format</div><div class="line"></div><div class="line"><span class="comment">###&#x8BBE;&#x7F6E;vim</span></div><div class="line"><span class="comment">#echo &quot;Set Vim.&quot;</span></div><div class="line"><span class="comment">#cat &lt;&lt; EOF &gt; ~/.vimrc</span></div><div class="line"><span class="comment">#set number</span></div><div class="line"><span class="comment">#set laststatus=2</span></div><div class="line"><span class="comment">#set shiftwidth=4</span></div><div class="line"><span class="comment">#set tabstop=4</span></div><div class="line"><span class="comment">#set noexpandtab</span></div><div class="line"><span class="comment">#set softtabstop=4</span></div><div class="line"><span class="comment">#set cmdheight=3</span></div><div class="line"><span class="comment">#set cursorline</span></div><div class="line"><span class="comment">#set formatoptions=tcrqn </span></div><div class="line"><span class="comment">#set encoding=utf-8</span></div><div class="line"><span class="comment">#syntax on</span></div><div class="line"><span class="comment">#colorscheme desert</span></div><div class="line"><span class="comment">#color ron</span></div><div class="line"><span class="comment">#set background=dark </span></div><div class="line"><span class="comment">#set ruler </span></div><div class="line"><span class="comment">#set rulerformat=%20(%2*%&lt;%f%=\ %m%r\ %3l\ %c\ %p%%%)</span></div><div class="line"><span class="comment">#set statusline=%F%m%r%h%w\ [FORMAT=%{&amp;ff}]\ [TYPE=%Y]\ [POS=%l,%v][%p%%]\ %{strftime(\&quot;%d/%m/%y\ -\ %H:%M\&quot;)}</span></div><div class="line"><span class="comment">#nmap z :x&lt;cr&gt;</span></div><div class="line"><span class="comment">#nmap sp :set paste&lt;cr&gt;i</span></div><div class="line"><span class="comment">#EOF </span></div><div class="line"><span class="comment">#format</span></div><div class="line"><span class="comment"># vim&#x8BBE;&#x7F6E;&#x8FD9;&#x91CC;&#x6211;&#x8FD8;&#x662F;&#x6BD4;&#x8F83;&#x559C;&#x6B22;&#x9ED8;&#x8BA4;&#x7684;&#xFF0C;&#x8FD9;&#x4E2A;&#x914D;&#x7F6E;&#x53EF;&#x4EE5;&#x81EA;&#x884C;&#x6D4B;&#x8BD5;</span></div><div class="line"></div><div class="line"><span class="comment">###&#x9690;&#x85CF;&#x670D;&#x52A1;&#x5668;&#x7CFB;&#x7EDF;&#x4FE1;&#x606F;</span></div><div class="line"><span class="built_in">echo</span> <span class="string">&quot;mv issue&quot;</span></div><div class="line">mv  /etc/issue /etc/issue.bak</div><div class="line">mv  /etc/issue.net   /etc/issue.net.bak</div><div class="line">format</div><div class="line"></div><div class="line"><span class="comment">###&#x8BBE;&#x7F6E;&#x767B;&#x5F55;&#x65F6;&#x663E;&#x793A;&#x7684;&#x4FE1;&#x606F;</span></div><div class="line"><span class="comment">#echo &quot;Set login message.&quot;</span></div><div class="line"><span class="comment">#echo &quot;This is chen-hao&apos;s Server&quot; &gt; /etc/issue</span></div><div class="line"><span class="comment">#echo &quot;This is chen-hao&apos;s Server&quot; &gt; /etc/redhat-release</span></div><div class="line"><span class="comment">#format</span></div><div class="line"><span class="comment"># &#x4EE5;&#x4E0A;2&#x9009;1</span></div><div class="line"></div><div class="line"><span class="comment">###&#x7981;&#x7528;IPV6</span></div><div class="line"><span class="built_in">echo</span> <span class="string">&quot;Disable ipv6.&quot;</span></div><div class="line">cat &lt;&lt; EOF &gt; /etc/modprobe.conf</div><div class="line"><span class="built_in">alias</span> net-pf-10 off</div><div class="line"><span class="built_in">alias</span> ipv6 off</div><div class="line">EOF</div><div class="line">chkconfig --level 2235 ip6tables off</div><div class="line">format</div><div class="line"></div><div class="line"><span class="comment">###&#x8BBE;&#x7F6E;iptables</span></div><div class="line"><span class="built_in">echo</span> <span class="string">&quot;set iptables&quot;</span></div><div class="line">iptables -F</div><div class="line">iptables -A INPUT -p tcp -m multiport --dports <span class="variable">$SSH_PORT</span>,<span class="variable">$PORTS</span> -j ACCEPT</div><div class="line">iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT</div><div class="line">iptables -A INPUT -i lo -j ACCEPT</div><div class="line">iptables -A OUTPUT -m state --state NEW,ESTABLISHED -j ACCEPT</div><div class="line">iptables -P INPUT DROP</div><div class="line">iptables -P FORWARD DROP</div><div class="line">iptables -P OUTPUT ACCEPT</div><div class="line">service iptables save &amp;&gt; /dev/null</div><div class="line">format</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">###&#x5185;&#x6838;&#x4F18;&#x5316;</span></div><div class="line"><span class="built_in">echo</span> <span class="string">&quot;Set sysctl.conf&quot;</span></div><div class="line">cat &gt; /etc/sysctl.conf &lt;&lt; EOF</div><div class="line">net.ipv4.ip_forward = 0        </div><div class="line"><span class="comment">#&#x5F00;&#x542F;&#x8DEF;&#x7531;&#x529F;&#x80FD;</span></div><div class="line">net.ipv4.conf.all.rp_filter = 1</div><div class="line"><span class="comment">#&#x52A0;&#x5F3A;&#x5165;&#x7AD9;&#x8FC7;&#x6EE4;&#x548C;&#x51FA;&#x7AD9;&#x8FC7;&#x6EE4;</span></div><div class="line">net.ipv4.conf.default.rp_filter = 1</div><div class="line"><span class="comment">#&#x5F00;&#x542F;&#x53CD;&#x5411;&#x8DEF;&#x5F84;&#x8FC7;&#x6EE4;</span></div><div class="line">net.ipv4.conf.default.accept_<span class="built_in">source</span>_route = 0</div><div class="line"><span class="comment">#&#x5904;&#x7406;&#x65E0;&#x6E90;&#x8DEF;&#x7531;&#x7684;&#x5305;</span></div><div class="line">kernel.sysrq = 0</div><div class="line"><span class="comment">#&#x63A7;&#x5236;&#x7CFB;&#x7EDF;&#x8C03;&#x8BD5;&#x5185;&#x6838;&#x7684;&#x529F;&#x80FD;&#x8981;&#x6C42;</span></div><div class="line">kernel.core_uses_pid = 1</div><div class="line"><span class="comment">#&#x7528;&#x4E8E;&#x8C03;&#x8BD5;&#x591A;&#x7EBF;&#x7A0B;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;</span></div><div class="line">net.bridge.bridge-nf-call-ip6tables = 0</div><div class="line">net.bridge.bridge-nf-call-iptables = 0</div><div class="line">net.bridge.bridge-nf-call-arptables = 0</div><div class="line">kernel.msgmnb = 65536</div><div class="line"><span class="comment">#&#x6240;&#x6709;&#x5728;&#x6D88;&#x606F;&#x961F;&#x5217;&#x4E2D;&#x7684;&#x6D88;&#x606F;&#x603B;&#x548C;&#x7684;&#x6700;&#x5927;&#x503C;</span></div><div class="line">kernel.msgmax = 65536</div><div class="line"><span class="comment"># &#x6307;&#x5B9A;&#x5185;&#x6838;&#x4E2D;&#x6D88;&#x606F;&#x961F;&#x5217;&#x4E2D;&#x6D88;&#x606F;&#x7684;&#x6700;&#x5927;&#x503C;</span></div><div class="line">kernel.shmmax = 68719476736</div><div class="line"><span class="comment">#&#x4E8E;&#x5B9A;&#x4E49;&#x5355;&#x4E2A;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x6BB5;&#x7684;&#x6700;&#x5927;&#x503C;&#xFF0C;64&#x4F4D;linux&#x7CFB;&#x7EDF;&#xFF1A;&#x53EF;&#x53D6;&#x7684;&#x6700;&#x5927;&#x503C;&#x4E3A;&#x7269;&#x7406;&#x5185;&#x5B58;&#x503C;-1byte&#xFF0C;&#x5EFA;&#x8BAE;&#x503C;&#x4E3A;&#x591A;&#x4E8E;&#x7269;&#x7406;&#x5185;&#x5B58;&#x7684;&#x4E00;&#x534A;&#xFF0C;&#x4E00;&#x822C;&#x53D6;&#x503C;&#x5927;&#x4E8E;SGA_MAX_SIZE&#x5373;&#x53EF;&#xFF0C;&#x53EF;&#x4EE5;&#x53D6;&#x7269;&#x7406;&#x5185;&#x5B58;-1byte&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x4E3A;64GB&#x7269;&#x7406;&#x5185;&#x5B58;&#xFF0C;&#x53EF;&#x53D6;64*1024*1024*1024-1=68719476735</span></div><div class="line">kernel.shmall = 4294967296</div><div class="line"><span class="comment">#inux&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x9875;&#x5927;&#x5C0F;&#x4E3A;4KB,&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x6BB5;&#x7684;&#x5927;&#x5C0F;&#x90FD;&#x662F;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x9875;&#x5927;&#x5C0F;&#x7684;&#x6574;&#x6570;&#x500D;&#x3002;&#x4E00;&#x4E2A;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x6BB5;&#x7684;&#x6700;&#x5927;&#x5927;&#x5C0F;&#x662F; 16G&#xFF0C;&#x90A3;&#x4E48;&#x9700;&#x8981;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x9875;&#x6570;&#x662F;16GB/4KB=16777216KB /4KB=4194304&#xFF08;&#x9875;&#xFF09;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;64Bit&#x7CFB;&#x7EDF;&#x4E0B;16GB&#x7269;&#x7406;&#x5185;&#x5B58;&#xFF0C;&#x8BBE;&#x7F6E;kernel.shmall = 4194304&#x624D;&#x7B26;&#x5408;&#x8981;&#x6C42;(&#x51E0;&#x4E4E;&#x662F;&#x539F;&#x6765;&#x8BBE;&#x7F6E;2097152&#x7684;&#x4E24;&#x500D;)</span></div><div class="line">net.ipv6.conf.all.disable_ipv6 = 1</div><div class="line">net.ipv6.conf.default.disable_ipv6 = 1</div><div class="line">net.ipv4.neigh.default.gc_stale_time = 120</div><div class="line">net.ipv4.conf.default.arp_announce = 2</div><div class="line">net.ipv4.conf.all.arp_announce = 2</div><div class="line">net.ipv4.conf.lo.arp_announce = 2</div><div class="line"></div><div class="line"><span class="comment">###&#x5185;&#x5B58;&#x8D44;&#x6E90;&#x4F7F;&#x7528;&#x76F8;&#x5173;&#x8BBE;&#x5B9A;</span></div><div class="line">net.core.wmem_default = 8388608 </div><div class="line">net.core.rmem_default = 8388608 </div><div class="line">net.core.rmem_max = 16777216 </div><div class="line">net.core.wmem_max = 16777216 </div><div class="line">net.ipv4.tcp_rmem = 4096 65536 16777216</div><div class="line">net.ipv4.tcp_wmem = 4096 65536 16777216     </div><div class="line">net.ipv4.tcp_mem = 8388608 8388608 8388608</div><div class="line"></div><div class="line"><span class="comment">##&#x5E94;&#x5BF9;DDOS&#x653B;&#x51FB;,TCP&#x8FDE;&#x63A5;&#x5EFA;&#x7ACB;&#x8BBE;&#x7F6E;</span></div><div class="line">net.ipv4.tcp_syncookies = 1</div><div class="line"><span class="comment">#&#x9632;&#x6B62;syn flood&#x653B;&#x51FB;</span></div><div class="line">net.ipv4.tcp_synack_retries = 1 </div><div class="line">net.ipv4.tcp_syn_retries = 1 </div><div class="line">net.ipv4.tcp_max_syn_backlog = 262144</div><div class="line"><span class="comment">#SYN&#x961F;&#x5217;&#x7684;&#x957F;&#x5EA6;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;1024&#xFF0C;&#x52A0;&#x5927;&#x961F;&#x5217;&#x957F;&#x5EA6;&#x4E3A;262144&#xFF0C;&#x53EF;&#x4EE5;&#x5BB9;&#x7EB3;&#x66F4;&#x591A;&#x7B49;&#x5F85;&#x8FDE;&#x63A5;&#x7684;&#x7F51;&#x7EDC;&#x8FDE;&#x63A5;&#x6570;</span></div><div class="line"></div><div class="line"><span class="comment">##&#x5E94;&#x5BF9;timewait&#x8FC7;&#x9AD8;,TCP&#x8FDE;&#x63A5;&#x65AD;&#x5F00;&#x8BBE;&#x7F6E;</span></div><div class="line">net.ipv4.tcp_max_tw_buckets = 10000 </div><div class="line"><span class="comment">#&#x9ED8;&#x8BA4;&#x662F;180000&#x3002;&#x8868;&#x793A;&#x7CFB;&#x7EDF;&#x540C;&#x65F6;&#x4FDD;&#x6301;TIME_WAIT&#x7684;&#x6700;&#x5927;&#x6570;&#x91CF;&#xFF0C;&#x5982;&#x679C;&#x8D85;&#x8FC7;&#x8FD9;&#x4E2A;&#x6570;&#x5B57;&#xFF0C;TIME_WAIT&#x5C06;&#x7ACB;&#x523B;&#x88AB;&#x6E05;&#x9664;&#x5E76;&#x6253;&#x5370;&#x8B66;&#x544A;&#x4FE1;&#x606F;</span></div><div class="line">net.ipv4.tcp_tw_recycle = 1 </div><div class="line"><span class="comment">#&#x8868;&#x793A;&#x5F00;&#x542F;TCP&#x8FDE;&#x63A5;&#x4E2D;TIME-WAIT sockets&#x7684;&#x5FEB;&#x901F;&#x6536;&#x56DE;&#x529F;&#x80FD;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A; 0 &#xFF0C;&#x8868;&#x793A;&#x5173;&#x95ED;&#x3002;</span></div><div class="line">net.ipv4.tcp_tw_reuse = 1 </div><div class="line"><span class="comment">#&#x8868;&#x793A;&#x5F00;&#x542F;&#x91CD;&#x7528;&#x3002;&#x5141;&#x8BB8;&#x5C06;TIME-WAIT sockets&#x91CD;&#x65B0;&#x7528;&#x4E8E;&#x65B0;&#x7684; TCP &#x8FDE;&#x63A5;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A; 0 &#x8868;&#x793A;&#x5173;&#x95ED;</span></div><div class="line">net.ipv4.tcp_timestamps = 0 </div><div class="line"><span class="comment">#&#x65F6;&#x95F4;&#x6233;&#x53EF;&#x4EE5;&#x907F;&#x514D;&#x5E8F;&#x5217;&#x53F7;&#x7684;&#x5377;&#x7ED5;</span></div><div class="line">net.ipv4.tcp_fin_timeout = 5</div><div class="line"><span class="comment"># &#x8868;&#x793A;&#x5982;&#x679C;&#x5957;&#x63A5;&#x5B57;&#x7531;&#x672C;&#x7AEF;&#x8981;&#x6C42;&#x5173;&#x95ED;&#xFF0C;&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x51B3;&#x5B9A;&#x4E86;&#x5B83;&#x4FDD;&#x6301;&#x5728;FIN-WAIT-2&#x72B6;&#x6001;&#x7684;&#x65F6;&#x95F4;&#x3002;&#x5BF9;&#x7AEF;&#x53EF;&#x4EE5;&#x51FA;&#x9519;&#x5E76;&#x6C38;&#x8FDC;&#x4E0D;&#x5173;&#x95ED;&#x8FDE;&#x63A5;&#xFF0C;&#x751A;&#x81F3;&#x610F;&#x5916;&#x5F53;&#x673A;&#x3002;&#x7F3A;&#x7701;&#x503C;&#x662F;60  &#x79D2;&#x3002;2.2 &#x5185;&#x6838;&#x7684;&#x901A;&#x5E38;&#x503C;&#x662F;180 &#x79D2;&#xFF0C;3&#x4F60;&#x53EF;&#x4EE5;&#x6309;&#x8FD9;&#x4E2A;&#x8BBE;&#x7F6E;&#xFF0C;&#x4F46;&#x8981;&#x8BB0;&#x4F4F;&#x7684;&#x662F;&#xFF0C;&#x5373;&#x4F7F;&#x4F60;&#x7684;&#x673A;&#x5668;&#x662F;&#x4E00;&#x4E2A;&#x8F7B;&#x8F7D;&#x7684;WEB  &#x670D;&#x52A1;&#x5668;&#xFF0C;&#x4E5F;&#x6709;&#x56E0;&#x4E3A;&#x5927;&#x91CF;&#x7684;&#x6B7B;&#x5957;&#x63A5;&#x5B57;&#x800C;&#x5185;&#x5B58;&#x6EA2;&#x51FA;&#x7684;&#x98CE;&#x9669;&#xFF0C;FIN- WAIT-2 &#x7684;&#x5371;&#x9669;&#x6027;&#x6BD4;FIN-WAIT-1 &#x8981;&#x5C0F;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x6700;&#x591A;&#x53EA;&#x80FD;&#x5403;&#x6389;1.5K  &#x5185;&#x5B58;&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x4EEC;&#x7684;&#x751F;&#x5B58;&#x671F;&#x957F;&#x4E9B;</span></div><div class="line">net.ipv4.ip_<span class="built_in">local</span>_port_range = 4000 65000</div><div class="line"><span class="comment"># &#x8868;&#x793A;&#x7528;&#x4E8E;&#x5411;&#x5916;&#x8FDE;&#x63A5;&#x7684;&#x7AEF;&#x53E3;&#x8303;&#x56F4;</span></div><div class="line"></div><div class="line"><span class="comment">###TCP keepalived &#x8FDE;&#x63A5;&#x4FDD;&#x9C9C;&#x8BBE;&#x7F6E;</span></div><div class="line"></div><div class="line">net.ipv4.tcp_keepalive_time = 1200</div><div class="line"><span class="comment">#&#x8868;&#x793A;&#x5F53;keepalive&#x8D77;&#x7528;&#x7684;&#x65F6;&#x5019;&#xFF0C;TCP&#x53D1;&#x9001;keepalive&#x6D88;&#x606F;&#x7684;&#x9891;&#x5EA6;&#x3002;&#x7F3A;&#x7701;&#x662F;2&#x5C0F;&#x65F6;&#xFF0C;&#x6539;&#x4E3A;20&#x5206;&#x949F;</span></div><div class="line">net.ipv4.tcp_keepalive_intvl = 15</div><div class="line"><span class="comment"># &#x5F53;&#x63A2;&#x6D4B;&#x6CA1;&#x6709;&#x786E;&#x8BA4;&#x65F6;&#xFF0C;&#x91CD;&#x65B0;&#x53D1;&#x9001;&#x63A2;&#x6D4B;&#x7684;&#x9891;&#x5EA6;&#x3002;&#x7F3A;&#x7701;&#x662F;75</span></div><div class="line">net.ipv4.tcp_keepalive_probes = 5</div><div class="line"><span class="comment"># &#x5728;&#x8BA4;&#x5B9A;&#x8FDE;&#x63A5;&#x5931;&#x6548;&#x4E4B;&#x524D;&#xFF0C;&#x53D1;&#x9001;&#x591A;&#x5C11;&#x4E2A;TCP&#x7684;keepalive&#x63A2;&#x6D4B;&#x5305;&#x3002;&#x7F3A;&#x7701;&#x503C;&#x662F;9&#x3002;&#x8FD9;&#x4E2A;&#x503C;&#x4E58;&#x4EE5;tcp_keepalive_intvl&#x4E4B;&#x540E;&#x51B3;&#x5B9A;&#x4E86;&#xFF0C;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#x53D1;&#x9001;&#x4E86;keepalive&#x4E4B;&#x540E;&#x53EF;&#x4EE5;&#x6709;&#x591A;&#x5C11;&#x65F6;&#x95F4;&#x6CA1;&#x6709;&#x56DE;&#x5E94;</span></div><div class="line"></div><div class="line"><span class="comment">###&#x5176;&#x4ED6;TCP&#x76F8;&#x5173;&#x8C03;&#x8282;</span></div><div class="line">net.core.somaxconn = 262144</div><div class="line"><span class="comment">#isten(&#x51FD;&#x6570;)&#x7684;&#x9ED8;&#x8BA4;&#x53C2;&#x6570;,&#x6302;&#x8D77;&#x8BF7;&#x6C42;&#x7684;&#x6700;&#x5927;&#x6570;&#x91CF;&#x9650;&#x5236;&#x3002;web &#x5E94;&#x7528;&#x4E2D;listen &#x51FD;&#x6570;&#x7684;backlog &#x9ED8;&#x8BA4;&#x4F1A;&#x7ED9;&#x6211;&#x4EEC;&#x5185;&#x6838;&#x53C2;&#x6570;&#x7684;net.core.somaxconn &#x9650;&#x5236;&#x5230;128&#xFF0C;&#x800C;nginx &#x5B9A;&#x4E49;&#x7684;NGX_LISTEN_BACKLOG &#x9ED8;&#x8BA4;&#x4E3A;511&#xFF0C;&#x6240;&#x4EE5;&#x6709;&#x5FC5;&#x8981;&#x8C03;&#x6574;&#x8FD9;&#x4E2A;&#x503C;</span></div><div class="line">net.ipv4.tcp_sack = 1</div><div class="line">net.ipv4.tcp_window_scaling = 1</div><div class="line">EOF</div><div class="line">sysctl -p </div><div class="line"><span class="comment"># &#x751F;&#x4EA7;&#x73AF;&#x5883;&#x5404;&#x4E0D;&#x76F8;&#x540C;&#xFF0C;&#x5185;&#x6838;&#x4F18;&#x5316;&#x9700;&#x614E;&#x91CD;&#xFF0C;&#x8BF7;&#x4E00;&#x4E2A;&#x4E2A;&#x53C2;&#x6570;&#x9010;&#x4E00;&#x6D4B;&#x8BD5;</span></div><div class="line">format</div><div class="line"></div><div class="line"><span class="comment">#&#x5B89;&#x88C5;&#x7CFB;&#x7EDF;&#x5FC5;&#x9700;&#x8F6F;&#x4EF6;&#x5305;</span></div><div class="line"><span class="built_in">echo</span> <span class="string">&quot;install pack&quot;</span></div><div class="line">yum -y install make gcc-c++ cmake bison-devel ncurses-devel net-snmp sysstat dstat iotop lrzsz flex byacc libpcap libpcap-devel nfs-utils ntp zip unzip xz wget vim lsof bison openssh-clients htop lftp &amp;&gt; /dev/null</div><div class="line">format</div><div class="line">yum -y groupinstall <span class="string">&quot;Development Tools&quot;</span> <span class="string">&quot;Server Platform Development&quot;</span> &amp;&gt; /dev/null</div><div class="line"></div><div class="line"><span class="built_in">read</span> -p <span class="string">&quot;&#x7CFB;&#x7EDF;&#x521D;&#x59CB;&#x5316;&#x5B8C;&#x6BD5;,&#x662F;&#x5426;&#x9700;&#x8981;&#x91CD;&#x542F;(y/n)?&quot;</span> TT</div><div class="line">    <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$TT</span>&quot;</span> == <span class="string">&quot;y&quot;</span> ];<span class="keyword">then</span></div><div class="line">        reboot</div><div class="line">    <span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$TT</span>&quot;</span> == <span class="string">&quot;n&quot;</span> ];<span class="keyword">then</span></div><div class="line">        <span class="built_in">exit</span> 4</div><div class="line">    <span class="keyword">else</span></div><div class="line">        <span class="built_in">echo</span> <span class="string">&quot;&#x8BF7;&#x8F93;&#x5165;y/n&quot;</span></div><div class="line">    <span class="keyword">fi</span></div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;CentOS&lt;/code&gt;系统安装之后并不能立即投入生产环境使用，往往需要先经过我们运维人员的优化才行，所以为了方便省事，弄一个初始化脚本势在必行。&lt;br&gt;
    
    </summary>
    
      <category term="Shell" scheme="http://www.chen-hao.com.cn/categories/Shell/"/>
    
    
      <category term="shell" scheme="http://www.chen-hao.com.cn/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>搭建项目管理系统-JIRA汉化破解版</title>
    <link href="http://www.chen-hao.com.cn/%E6%90%AD%E5%BB%BA%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-JIRA%E6%B1%89%E5%8C%96%E7%A0%B4%E8%A7%A3%E7%89%88.html"/>
    <id>http://www.chen-hao.com.cn/搭建项目管理系统-JIRA汉化破解版.html</id>
    <published>2016-12-12T06:27:04.000Z</published>
    <updated>2016-12-13T01:03:42.571Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p> <code>JIRA</code>&#x662F;&#x4E00;&#x4E2A;&#x9879;&#x76EE;&#x8DDF;&#x8E2A;&#x7BA1;&#x7406;&#x5DE5;&#x5177;&#xFF0C;&#x5E2E;&#x52A9;&#x56E2;&#x961F;&#x521B;&#x5EFA;&#x8BA1;&#x5212;&#x4EFB;&#x52A1;&#x3001;&#x6784;&#x5EFA;&#x5E76;&#x53D1;&#x5E03;&#x4F18;&#x79C0;&#x7684;&#x4EA7;&#x54C1;&#x3002;&#x5168;&#x7403;&#x6210;&#x5343;&#x4E0A;&#x4E07;&#x7684;&#x56E2;&#x961F;&#x9009;&#x62E9;JIRA&#xFF0C;&#x7528;JIRA&#x6765;&#x6355;&#x83B7;&#x3001;&#x7EC4;&#x7EC7;&#x7BA1;&#x7406;&#x7F3A;&#x9677;&#x3001;&#x5206;&#x914D;&#x4EFB;&#x52A1;&#xFF0C;&#x8DDF;&#x8E2A;&#x56E2;&#x961F;&#x7684;&#x6D3B;&#x52A8;&#x3002;&#x4E0D;&#x8BBA;&#x5728;&#x684C;&#x9762;PC&#x8FD8;&#x662F;&#x79FB;&#x52A8;&#x7EC8;&#x7AEF;&#x8BBE;&#x5907;&#x4E0A;&#xFF0C;JIRA&#x90FD;&#x80FD;&#x5B8C;&#x7F8E;&#x7684;&#x8FD0;&#x884C;&#xFF0C;&#x5E2E;&#x52A9;&#x56E2;&#x961F;&#x5B8C;&#x6210;&#x5DE5;&#x4F5C;&#x3002;<br><a id="more"></a></p>
</blockquote>
<p></p><h3 id="&#x73AF;&#x5883;&#x51C6;&#x5907;">&#x73AF;&#x5883;&#x51C6;&#x5907;</h3><p></p>
<ul>
<li>CentOS 6.5</li>
<li>java jdk 1.8</li>
<li>mysql-server 5.6</li>
<li><p>jira-6.3.6.tar.gz</p>
<p>&#x7834;&#x89E3;&#x5305;&#x4E0B;&#x8F7D;&#xFF1A;<br><a href="http://pan.baidu.com/s/1c2DWvYS" target="_blank" rel="external">http://pan.baidu.com/s/1c2DWvYS</a> </p>
</li>
</ul>
<p></p><h3 id="&#x521B;&#x5EFA;&#x6570;&#x636E;&#x5E93;">&#x521B;&#x5EFA;&#x6570;&#x636E;&#x5E93;</h3><br>&#x5728;&#x5B89;&#x88C5;JIRA&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x5DF2;&#x7ECF;&#x5B89;&#x88C5;&#x597D;&#x4E86;mysql5.6&#x7684;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x5E76;&#x4E14;&#x521B;&#x5EFA;&#x4E86;&#x6570;&#x636E;&#x5E93;&#x548C;&#x7528;&#x6237;&#xFF0C;&#x8BED;&#x53E5;&#x5982;&#x4E0B;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mysql&gt; create database jira character <span class="built_in">set</span> utf8;</div><div class="line">mysql&gt; grant all on jira.* to <span class="string">&apos;jira&apos;</span>@<span class="string">&apos;localhost&apos;</span> identified by <span class="string">&apos;jirapass&apos;</span>;</div><div class="line">mysql&gt; FLUSH PRIVILEGES;</div></pre></td></tr></table></figure><p></p>
<p></p><h3 id="&#x5B89;&#x88C5;jira">&#x5B89;&#x88C5;jira</h3><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">chmod +x atlassian-jira-6.2.3-x64.bin</div><div class="line">./atlassian-jira-6.2.3-x64.bin</div><div class="line">cp mysql-connector-java-5.1.38-bin.jar /opt/atlassian/jira/atlassian-jira/WEB-INF/lib/</div></pre></td></tr></table></figure><p></p>
<p><img src="/uploads/jira1.png" class="blockquote-center"><br>&#x8BBF;&#x95EE; <a href="http://192.168.16.109:8080" target="_blank" rel="external">http://192.168.16.109:8080</a><br><img src="/uploads/jira2.png" class="blockquote-center"><br><img src="/uploads/jira3.png" class="blockquote-center"><br><img src="/uploads/jira4.png" class="blockquote-center"><br><img src="/uploads/jira5.png" class="blockquote-center"><br>&#x5B89;&#x88C5;&#x5B8C;&#x6210;&#x540E;&#x663E;&#x793A;&#x5982;&#x4E0B;&#xFF1A;<br><img src="/uploads/jira6.png" class="blockquote-center"></p>
<p></p><h3 id="&#x6C49;&#x5316;&#x7834;&#x89E3;">&#x6C49;&#x5316;&#x7834;&#x89E3;</h3><p></p>
<ol>
<li><p>&#x9009;&#x62E9;&#x63D2;&#x4EF6;<br><img src="/uploads/jira7.png" class="blockquote-center"></p>
</li>
<li><p>&#x4E0A;&#x4F20;&#x4E2D;&#x6587;&#x8BED;&#x8A00;&#x5305;<br><img src="/uploads/jira8.png" class="blockquote-center"><br>&#x4E2D;&#x6587;&#x63D2;&#x4EF6;&#x4E0A;&#x4F20;&#x5B8C;&#x6210;&#x4E4B;&#x540E;&#x4F1A;&#x9ED8;&#x8BA4;&#x53D8;&#x5230;&#x4E2D;&#x6587;&#x5B57;&#x4F53;&#xFF0C;&#x56E0;&#x4E3A;&#x4E0A;&#x4F20;&#x4E2D;&#x6587;&#x8BED;&#x8A00;&#x5305;&#x4E4B;&#x540E;&#x9ED8;&#x8BA4;&#x8BED;&#x8A00;&#x4F1A;&#x53D8;&#x4E3A;&#x4E2D;&#x6587;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x53D8;&#xFF0C;&#x53EF;&#x4EE5;&#x81EA;&#x884C;&#x5728;&#x7CFB;&#x7EDF;&#x8BBE;&#x7F6E;&#x4FEE;&#x6539;</p>
</li>
<li><p>&#x7834;&#x89E3;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">service jira stop</div><div class="line">cp atlassian-extras-2.2.2.jar atlassian-universal-plugin-manager-plugin-2.17.13.jar /opt/atlassian/jira/atlassian-jira/WEB-INF/lib/</div><div class="line">service jira start</div></pre></td></tr></table></figure>
</li>
</ol>
<p>&#x542F;&#x52A8;jira&#xFF0C;&#x767B;&#x5F55;&#x540E;&#x53F0;&#xFF0C;&#x8FDB;&#x5165;&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;&#x2014;&#x2014;&gt;&#x6388;&#x6743;&#x8F93;&#x5165;&#x4E0B;&#x9762;&#x7684;&#x6388;&#x6743;&#x7801;&#xFF0C;&#x70B9;&#x51FB;&#x589E;&#x52A0;&#xFF0C;&#x7136;&#x540E;&#x5C31;&#x770B;&#x5230;jira&#x7684;&#x4F7F;&#x7528;&#x671F;&#x9650;&#x5230;&#x4E86;2099&#x5E74;&#xFF0C;&#x8BF4;&#x660E;&#x7834;&#x89E3;&#x6210;&#x529F;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">Description=JIRA: Commercial,</div><div class="line">CreationDate=2014-09-20,</div><div class="line">jira.LicenseEdition=ENTERPRISE,</div><div class="line">Evaluation=<span class="literal">false</span>,</div><div class="line">jira.LicenseTypeName=COMMERCIAL,</div><div class="line">jira.active=<span class="literal">true</span>,</div><div class="line">licenseVersion=2,</div><div class="line">MaintenanceExpiryDate=2099-12-31,</div><div class="line">Organisation=pl,</div><div class="line"><span class="comment"># &#x4FEE;&#x6539;&#x4E0B;&#x9762;2&#x5904;&#x5373;&#x53EF;</span></div><div class="line">SEN=SEN-L4572887,</div><div class="line">ServerID=BPT3-4QRK-FCRR-HEP3,</div><div class="line"></div><div class="line">jira.NumberOfUsers=-1,</div><div class="line">LicenseID=AAABBw0ODAoPeNptkFtLxDAQhd/zKwI+R9Kwy66FPKxthGhvtF0p4kuso0a6sUwvuP/edissyj4MD</div><div class="line">HPOfHOYqzu0tICWeoJy4a+FzzkNwpIK7q1ICF2Ntu3tl5P3Ot89+1SNphnMPCEBwqkJTQ9y9jN+w</div><div class="line">zxBPi2a68jW4DpQr/a0rZJS5VmuC0XOBNnjAH/s5bGFxBxABmkcqzzQu2jRTd3bEZaFZvE+AnYzR</div><div class="line">JDYWNeDM64G9d1aPJ4TeXxOlOK7cbZbjrbNgkyGwwtg+rbvJpBkHikAR0Adytt0XzFV7R5Y+qQzV</div><div class="line">kWZIoVK5FQsWq03YrvdkN/Ekz3S4SXlcpRswPrDdPD/aT+P1nzDMC0CFQCM9+0LlHVNnZQnSTwuR</div><div class="line">O3eK+2gVgIUCteTs4Q3khIgrnsY64hxYB/d8bM=X02dh,</div><div class="line">LicenseExpiryDate=2099-12-31,</div><div class="line">PurchaseDate=2014-09-20</div></pre></td></tr></table></figure></p>
<p><img src="/uploads/jira9.png" class="blockquote-center"></p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt; &lt;code&gt;JIRA&lt;/code&gt;是一个项目跟踪管理工具，帮助团队创建计划任务、构建并发布优秀的产品。全球成千上万的团队选择JIRA，用JIRA来捕获、组织管理缺陷、分配任务，跟踪团队的活动。不论在桌面PC还是移动终端设备上，JIRA都能完美的运行，帮助团队完成工作。&lt;br&gt;
    
    </summary>
    
      <category term="自动化" scheme="http://www.chen-hao.com.cn/categories/%E8%87%AA%E5%8A%A8%E5%8C%96/"/>
    
    
      <category term="jira" scheme="http://www.chen-hao.com.cn/tags/jira/"/>
    
  </entry>
  
  <entry>
    <title>搭建公司wiki系统-confluence 汉化破解版</title>
    <link href="http://www.chen-hao.com.cn/%E6%90%AD%E5%BB%BA%E5%85%AC%E5%8F%B8wiki%E7%B3%BB%E7%BB%9F-confluence-%E6%B1%89%E5%8C%96%E7%A0%B4%E8%A7%A3%E7%89%88.html"/>
    <id>http://www.chen-hao.com.cn/搭建公司wiki系统-confluence-汉化破解版.html</id>
    <published>2016-12-12T02:18:24.000Z</published>
    <updated>2016-12-13T01:03:28.269Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p><code>Confluence</code>&#x662F;&#x4E00;&#x4E2A;&#x4E13;&#x4E1A;&#x7684;<code>wiki</code>&#x7A0B;&#x5E8F;&#x3002;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x77E5;&#x8BC6;&#x7BA1;&#x7406;&#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x901A;&#x8FC7;&#x5B83;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x56E2;&#x961F;&#x6210;&#x5458;&#x4E4B;&#x95F4;&#x7684;&#x534F;&#x4F5C;&#x548C;&#x77E5;&#x8BC6;&#x5171;&#x4EAB;&#x3002;Confluence&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x5F00;&#x6E90;&#x8F6F;&#x4EF6;&#xFF0C;&#x975E;&#x5546;&#x4E1A;&#x7528;&#x9014;&#x53EF;&#x4EE5;&#x514D;&#x8D39;&#x4F7F;&#x7528;&#x3002;<br>Confluence&#x4F7F;&#x7528;&#x7B80;&#x5355;&#xFF0C;&#x4F46;&#x5B83;&#x5F3A;&#x5927;&#x7684;&#x7F16;&#x8F91;&#x548C;&#x7AD9;&#x70B9;&#x7BA1;&#x7406;&#x7279;&#x5F81;&#x80FD;&#x591F;&#x5E2E;&#x52A9;&#x56E2;&#x961F;&#x6210;&#x5458;&#x4E4B;&#x95F4;&#x5171;&#x4EAB;&#x4FE1;&#x606F;&#xFF0C;&#x6587;&#x6863;&#x534F;&#x4F5C;&#xFF0C;&#x96C6;&#x4F53;&#x8BA8;&#x8BBA;&#x3002;<br><a id="more"></a></p>
</blockquote>
<p></p><h3 id="&#x73AF;&#x5883;&#x51C6;&#x5907;">&#x73AF;&#x5883;&#x51C6;&#x5907;</h3><p></p>
<ul>
<li>CentOS 6.5</li>
<li>java jdk 1.8</li>
<li>mysql-server 5.6</li>
<li>confluence 5.6.6</li>
</ul>
<p></p><h3 id="&#x4E0B;&#x8F7D;confiluence&#x53CA;&#x5176;&#x7834;&#x89E3;&#x5305;">&#x4E0B;&#x8F7D;confiluence&#x53CA;&#x5176;&#x7834;&#x89E3;&#x5305;</h3><br>confluence&#x6709;&#x5F88;&#x591A;&#x7248;&#x672C;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x901A;&#x8FC7;&#x5982;&#x4E0B;&#x8FDE;&#x63A5;&#x8FDB;&#x884C;&#x67E5;&#x770B;<br><a href="https://www.atlassian.com/software/confluence/download-archives" target="_blank" rel="external">https://www.atlassian.com/software/confluence/download-archives</a><br><img src="/uploads/confluence1.png" class="blockquote-center"><br>&#x901A;&#x8FC7;&#x4E0A;&#x56FE;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x51FA;confluence&#x5BF9;&#x4E8E;windows&#x548C;linux&#x5E73;&#x53F0;&#x6BCF;&#x4E00;&#x4E2A;&#x7248;&#x672C;&#x6709;&#x591A;&#x79CD;&#x5B89;&#x88C5;&#x5305;&#xFF0C;&#x5728;&#x6B64;&#x6211;&#x4EEC;&#x9009;&#x62E9;&#x7684;&#x662F;bin&#x65B9;&#x5F0F;&#x3002;&#x9664;&#x6B64;&#x4E4B;&#x5916;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x76EE;&#x524D;confluence&#x6700;&#x65B0;&#x7248;&#x672C;&#x662F;6.0.1&#x3002;<br>&#x4E0B;&#x8F7D;confluence5.6.6<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -o atlassian-confluence-5.6.6-x64.bin https://downloads.atlassian.com/software/confluence/downloads/atlassian-confluence-5.6.6-x64.bin</div></pre></td></tr></table></figure><p></p>
<p>&#x4E0B;&#x8F7D;confluence&#x7834;&#x89E3;&#x5305;<br>&#x8FD9;&#x91CC;&#x662F;&#x7F51;&#x4E0A;&#x7684;&#x8D44;&#x6E90;&#xFF0C;&#x6211;&#x5C31;&#x4FDD;&#x5B58;&#x5230;&#x767E;&#x5EA6;&#x7F51;&#x76D8;&#x4E86;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4E0B;&#x8F7D;<br><a href="https://pan.baidu.com/s/1kVK3Hm3" target="_blank" rel="external">https://pan.baidu.com/s/1kVK3Hm3</a></p>
<p></p><h3 id="&#x521B;&#x5EFA;&#x6570;&#x636E;&#x5E93;">&#x521B;&#x5EFA;&#x6570;&#x636E;&#x5E93;</h3><br>&#x5728;&#x5B89;&#x88C5;confluence&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x5DF2;&#x7ECF;&#x5B89;&#x88C5;&#x597D;&#x4E86;mysql5.6&#x7684;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x5E76;&#x4E14;&#x521B;&#x5EFA;&#x4E86;&#x6570;&#x636E;&#x5E93;&#x548C;&#x7528;&#x6237;&#xFF0C;&#x8BED;&#x53E5;&#x5982;&#x4E0B;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mysql&gt; CREATE DATABASE confluence CHARACTER SET utf8 COLLATE utf8_bin;</div><div class="line">mysql&gt; GRANT ALL PRIVILEGES ON confluence.* TO <span class="string">&apos;confluence&apos;</span>@<span class="string">&apos;localhost&apos;</span> IDENTIFIED BY <span class="string">&apos;123.com&apos;</span>;</div><div class="line">mysql&gt; GRANT ALL PRIVILEGES ON confluence.* TO <span class="string">&apos;confluence&apos;</span>@<span class="string">&apos;10.16.10.44&apos;</span> IDENTIFIED BY <span class="string">&apos;123.com&apos;</span>;</div><div class="line">mysql&gt; FLUSH PRIVILEGES;</div></pre></td></tr></table></figure><p></p>
<p></p><h3 id="&#x5B89;&#x88C5;confluence">&#x5B89;&#x88C5;confluence</h3><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">chmod +x atlassian-confluence-5.6.6-x64.bin</div><div class="line">./atlassian-confluence-5.6.6-x64.bin</div></pre></td></tr></table></figure><p></p>
<p><img src="/uploads/confluence2.png" class="blockquote-center"><br>&#x901A;&#x8FC7;&#x4E0A;&#x56FE;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F88;&#x660E;&#x663E;&#x7684;&#x770B;&#x51FA;confluence&#x5B89;&#x88C5;&#x5230;&#x4E86;/opt/atlassian/confluence&#x548C;/var/atlassian/application-data/confluence&#x76EE;&#x5F55;&#x4E0B;&#xFF0C;&#x5E76;&#x4E14;confluence&#x76D1;&#x542C;&#x7684;&#x7AEF;&#x53E3;&#x662F;8090<br>&#x4E0B;&#x9762;&#x8BBF;&#x95EE;&#x5730;&#x5740; 192.168.4.38:8090<br><img src="/uploads/confluence3.png" class="blockquote-center"></p>
<p></p><h3 id="&#x7834;&#x89E3;confluence">&#x7834;&#x89E3;confluence</h3><p></p>
<p></p><h4 id="&#x5173;&#x95ED;confluence">&#x5173;&#x95ED;confluence</h4><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">service confluence stop</div></pre></td></tr></table></figure><p></p>
<p></p><h4 id="&#x5220;&#x9664;jar&#x6587;&#x4EF6;">&#x5220;&#x9664;jar&#x6587;&#x4EF6;</h4><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /opt/atlassian/confluence/confluence/WEB-INF/lib/</div><div class="line">ll | grep atlassian-extras | wc <span class="_">-l</span></div><div class="line">6</div><div class="line">rm -fr atlassian-extra*</div></pre></td></tr></table></figure><p></p>
<p></p><h4 id="&#x89E3;&#x538B;&#x7834;&#x89E3;&#x5305;&#x5E76;&#x5BFC;&#x5165;">&#x89E3;&#x538B;&#x7834;&#x89E3;&#x5305;&#x5E76;&#x5BFC;&#x5165;</h4><br>&#x89E3;&#x538B;&#x7834;&#x89E3;&#x5305;&#xFF0C;&#x628A;&#x91CC;&#x9762;&#x7684;atlassian-extras-3.2.jar&#x3001;Confluence-5.6.6-language-pack-zh_CN.jar&#x3001;mysql-connector-java-5.1.39-bin.jar&#x4E09;&#x4E2A;jar&#x6587;&#x4EF6;&#x590D;&#x5236;&#x5230;/opt/atlassian/confluence/confluence/WEB-INF/lib&#x76EE;&#x5F55;&#x4E0B;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /work/confluence5.6.6-crack/jar/</div><div class="line">cp ./* /opt/atlassian/confluence/confluence/WEB-INF/lib/</div><div class="line">service confluence start</div><div class="line"><span class="comment"># &#x5E76;&#x542F;&#x52A8;&#x670D;&#x52A1;</span></div></pre></td></tr></table></figure><p></p>
<p>&#x5176;&#x4E2D;atlassian-extras-3.2.jar&#x6587;&#x4EF6;&#x662F;&#x548C;license&#x76F8;&#x5173;&#x7684;&#xFF0C;Confluence-5.6.6-language-pack-zh_CN.jar&#x662F;confluence&#x4E2D;&#x6587;&#x8BED;&#x8A00;&#x5305;&#xFF0C;&#x800C;mysql-connector-java-5.1.39-bin.jar&#x662F;confluence&#x8FDE;&#x63A5;mysql&#x6570;&#x636E;&#x5E93;&#x76F8;&#x5173;&#x7684;jar&#x5305;&#x3002;</p>
<p></p><h4 id="&#x8FD0;&#x884C;&#x7834;&#x89E3;jar&#x5305;">&#x8FD0;&#x884C;&#x7834;&#x89E3;jar&#x5305;</h4><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">java -jar confluence_keygen.jar</div></pre></td></tr></table></figure><p></p>
<p>&#x628A;&#x4E0A;&#x8FF0;&#x590D;&#x5236;&#x7684;Server ID&#x7C98;&#x8D34;&#x8FDB;&#x53BB;&#xFF0C;&#x7136;&#x540E;&#x70B9;&#x51FB; gen<br><img src="/uploads/confluence4.png" class="blockquote-center"></p>
<p></p><h4 id="&#x5F00;&#x59CB;&#x5B89;&#x88C5;confluence">&#x5F00;&#x59CB;&#x5B89;&#x88C5;confluence</h4><br><img src="/uploads/confluence5.png" class="blockquote-center"><br><img src="/uploads/confluence6.png" class="blockquote-center"><br><img src="/uploads/confluence7.png" class="blockquote-center"><br><img src="/uploads/confluence8.png" class="blockquote-center"><br><img src="/uploads/confluence9.png" class="blockquote-center"><br><img src="/uploads/confluence10.png" class="blockquote-center"><p></p>
<p></p><h4 id="&#x5B89;&#x88C5;&#x5B8C;&#x6210;">&#x5B89;&#x88C5;&#x5B8C;&#x6210;</h4><br><img src="/uploads/confluence11.png" class="blockquote-center"><p></p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;Confluence&lt;/code&gt;是一个专业的&lt;code&gt;wiki&lt;/code&gt;程序。它是一个知识管理的工具，通过它可以实现团队成员之间的协作和知识共享。Confluence不是一个开源软件，非商业用途可以免费使用。&lt;br&gt;Confluence使用简单，但它强大的编辑和站点管理特征能够帮助团队成员之间共享信息，文档协作，集体讨论。&lt;br&gt;
    
    </summary>
    
      <category term="自动化" scheme="http://www.chen-hao.com.cn/categories/%E8%87%AA%E5%8A%A8%E5%8C%96/"/>
    
    
      <category term="wiki" scheme="http://www.chen-hao.com.cn/tags/wiki/"/>
    
  </entry>
  
  <entry>
    <title>利用logrotate服务切割日志</title>
    <link href="http://www.chen-hao.com.cn/%E5%88%A9%E7%94%A8logrotate%E6%9C%8D%E5%8A%A1%E5%88%87%E5%89%B2%E6%97%A5%E5%BF%97.html"/>
    <id>http://www.chen-hao.com.cn/利用logrotate服务切割日志.html</id>
    <published>2016-12-02T06:10:44.000Z</published>
    <updated>2016-12-02T08:12:00.397Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p><code>logrotate</code> &#x662F;&#x4E00;&#x4E2A;&#x65E5;&#x5FD7;&#x7BA1;&#x7406;&#x7A0B;&#x5E8F;&#xFF0C;&#x7528;&#x6765;&#x628A;&#x65E7;&#x7684;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x5220;&#x9664;&#xFF08;&#x5907;&#x4EFD;&#xFF09;&#xFF0C;&#x5E76;&#x521B;&#x5EFA;&#x65B0;&#x7684;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#xFF0C;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x79F0;&#x4E3A;&#x201D;&#x8F6C;&#x50A8;&#x201D;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x65E5;&#x5FD7;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x6216;&#x8005;&#x6839;&#x636E;&#x5176;&#x4F7F;&#x7528;&#x7684;&#x5929;&#x6570;&#x6765;&#x8F6C;&#x50A8;&#x3002;<br> <a id="more"></a></p>
</blockquote>
<p></p><h3 id="&#x542F;&#x52A8;&#x65B9;&#x5F0F;">&#x542F;&#x52A8;&#x65B9;&#x5F0F;</h3><br>logrotate &#x7684;&#x6267;&#x884C;&#x7531;crond&#x670D;&#x52A1;&#x5B9E;&#x73B0;&#x3002;&#x5728; <code>/etc/cron.daily</code> &#x76EE;&#x5F55;&#x4E2D;&#xFF0C;&#x6709;&#x4E2A;&#x6587;&#x4EF6;logrotate&#xFF0C;&#x5B83;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x4E2A;shell script&#xFF0C;&#x7528;&#x6765;&#x542F;&#x52A8;logrotate&#x3002;logrotate&#x7A0B;&#x5E8F;&#x6BCF;&#x5929;&#x7531;cron&#x5728;&#x6307;&#x5B9A;&#x7684;&#x65F6;&#x95F4; <code>&#xFF08;/etc/crontab&#xFF09;</code> &#x542F;&#x52A8;&#x3002;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># cat /etc/cron.daily/logrotate </span></div><div class="line"><span class="meta">#!/bin/sh</span></div><div class="line"></div><div class="line">/usr/sbin/logrotate /etc/logrotate.conf &gt;/dev/null 2&gt;&amp;1</div><div class="line">EXITVALUE=$?</div><div class="line"><span class="keyword">if</span> [ <span class="variable">$EXITVALUE</span> != 0 ]; <span class="keyword">then</span></div><div class="line">    /usr/bin/logger -t logrotate <span class="string">&quot;ALERT exited abnormally with [<span class="variable">$EXITVALUE</span>]&quot;</span></div><div class="line"><span class="keyword">fi</span></div><div class="line"><span class="built_in">exit</span> 0</div></pre></td></tr></table></figure><p></p>
<p>&#x5728;&#x6267;&#x884C;logrotate&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x6307;&#x5B9A;&#x5176;&#x914D;&#x7F6E;&#x6587;&#x4EF6;/etc/logrotate.conf</p>
<p>&#x8FD9;&#x4E2A;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x6CE8;&#x91CA;&#x5199;&#x5F97;&#x5F88;&#x6E05;&#x695A;&#xFF0C;&#x6CA1;&#x6709;&#x5FC5;&#x8981;&#x518D;&#x7F57;&#x55E6;&#x4E86;&#x3002;&#x53EA;&#x60F3;&#x5F3A;&#x8C03;&#x4E0B;&#x9762;&#x8FD9;&#x884C;&#xFF0C;&#x5B83;&#x7684;&#x4F5C;&#x7528;&#x5305;&#x542B;&#x5B58;&#x653E;&#x5728;/etc/logrotate.d&#x76EE;&#x5F55;&#x4E0B;&#x9762;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x4E0D;&#x53EF;&#x6216;&#x7F3A;&#x3002;&#x5982;&#x679C;&#x4F60;&#x5B89;&#x88C5;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x5B83;&#x7684;&#x65E5;&#x5FD7;&#x8F6C;&#x50A8;&#x7684;&#x89C4;&#x5219;&#x53EF;&#x4EE5;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x4E13;&#x95E8;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x653E;&#x5728;/etc/logrotate.d&#x4E0B;&#x9762;&#x3002;&#x5B83;&#x5176;&#x5B9E;&#x4E5F;&#x56E0;&#x4E3A;&#x4E0B;&#x9762;&#x7684;&#x8FD9;&#x53E5;&#x8BDD;&#xFF0C;&#x5728; logrotate&#x670D;&#x52A1;&#x542F;&#x52A8;&#x65F6;&#x88AB;&#x8BFB;&#x53D6;&#x3002;</p>
<p>&#x6BCF;&#x4E2A;&#x5B58;&#x653E;&#x5728;/etc/logrotate.d&#x76EE;&#x5F55;&#x91CC;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x90FD;&#x6709;&#x4E0A;&#x9762;&#x683C;&#x5F0F;&#x7684;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#x3002;&#x5728;{}&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x89C4;&#x5219;&#xFF0C;&#x5982;&#x679C;&#x4E0E;logrotate.conf&#x4E2D;&#x7684;&#x51B2;&#x7A81;&#xFF0C;&#x4EE5;/etc/logrotatate.d/&#x4E2D;&#x7684;&#x6587;&#x4EF6;&#x5B9A;&#x4E49;&#x7684;&#x4E3A;&#x51C6;&#x3002;</p>
<p></p><h3 id="&#x53C2;&#x6570;&#x8BF4;&#x660E;">&#x53C2;&#x6570;&#x8BF4;&#x660E;</h3><br>&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x5339;&#x914D;&#x89C4;&#x5219;&#x4E2D;&#xFF0C;&#x4E0D;&#x8981;&#x4F7F;&#x7528;/var/log/news/<em>&#xFF0C;&#x8FD9;&#x4F1A;&#x5339;&#x914D;&#x5DF2;&#x7ECF;&#x5207;&#x6362;&#x8FC7;&#x7684;&#x65E5;&#x5FD7;&#xFF0C;&#x5E94;&#x4F7F;&#x7528;/var/log/news/</em>.log<p></p>
<table>
<thead>
<tr>
<th>&#x9009;&#x9879;</th>
<th>&#x7528;&#x9014;</th>
</tr>
</thead>
<tbody>
<tr>
<td>nocompress/compress</td>
<td>&#x4E0D;&#x538B;&#x7F29;/&#x538B;&#x7F29;</td>
</tr>
<tr>
<td>delaycompress</td>
<td>&#x4E0D;&#x538B;&#x7F29;&#x524D;&#x4E00;&#x4E2A;&#x622A;&#x65AD;&#x7684;&#x6587;&#x4EF6;&#xFF08;&#x9700;&#x8981;&#x4E0E;compress&#x4E00;&#x8D77;&#x7528;&#xFF09;</td>
</tr>
<tr>
<td>daily/weekly/monthly</td>
<td>&#x6BCF;&#x5929;/&#x5468;/&#x6708;&#x8F6E;&#x8F6C;&#x4E00;&#x6B21;</td>
</tr>
<tr>
<td>copytruncate</td>
<td>&#x6E05;&#x7A7A;&#x539F;&#x6709;&#x6587;&#x4EF6;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x6587;&#x4EF6;</td>
</tr>
<tr>
<td>create 0644 root utmp</td>
<td>&#x65B0;&#x5EFA;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#xFF0C;&#x6743;&#x9650;&#x3001;&#x5C5E;&#x4E3B;&#x3001;&#x7EC4;</td>
</tr>
<tr>
<td>ifempty</td>
<td>&#x5373;&#x4F7F;&#x7528;&#x7A7A;&#x6587;&#x4EF6;&#x4E5F;&#x8F6C;&#x50A8;</td>
</tr>
<tr>
<td>notifempty</td>
<td>&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x4E3A;&#x7A7A;&#x4E0D;&#x8FDB;&#x884C;&#x8F6C;&#x50A8;</td>
</tr>
<tr>
<td>olddir <dir></dir></td>
<td>&#x8F6C;&#x50A8;&#x540E;&#x7684;&#x65E5;&#x5FD7;&#x5B58;&#x653E;&#x76EE;&#x5F55;&#xFF0C;&#x5FC5;&#x987B;&#x548C;&#x5F53;&#x524D;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;</td>
</tr>
<tr>
<td>rotate 5</td>
<td>&#x4FDD;&#x7559;&#x6700;&#x8FD1;&#x7684;5&#x4E2A;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;</td>
</tr>
<tr>
<td>minisize 1M</td>
<td>&#x5FC5;&#x987B;&#x5927;&#x4E8E;1MB&#x624D;&#x4F1A;&#x8F6C;&#x50A8;</td>
</tr>
<tr>
<td>size 50M</td>
<td>&#x8D85;&#x8FC7;50MB&#x540E;&#x8F6E;&#x8F6C;&#x65E5;&#x5FD7;</td>
</tr>
<tr>
<td>mail www@my.org</td>
<td>&#x8F6E;&#x6362;&#x540E;&#x7684;&#x628A;&#x65E5;&#x5FD7;&#x53D1;&#x7ED9;&#x90AE;&#x7BB1;</td>
</tr>
<tr>
<td>missingok</td>
<td>&#x5982;&#x679C;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x4E0D;&#x62A5;&#x9519;</td>
</tr>
<tr>
<td>prerotate,endscript</td>
<td>&#x5728;logrotate&#x4E4B;&#x524D;&#x6267;&#x884C;&#x7684;&#x547D;&#x4EE4;</td>
</tr>
<tr>
<td>postrotate,endscript</td>
<td>&#x5728;logrotate&#x4E4B;&#x540E;&#x6267;&#x884C;&#x7684;&#x547D;&#x4EE4;</td>
</tr>
<tr>
<td>sharedscripts</td>
<td>&#x5171;&#x4EAB;&#x811A;&#x672C;&#xFF0C;&#x8868;&#x793A;&#x5207;&#x6362;&#x65F6;&#x53EA;&#x6267;&#x884C;&#x4E00;&#x6B21;&#x811A;&#x672C;</td>
</tr>
<tr>
<td>dateext</td>
<td>&#x589E;&#x52A0;&#x65E5;&#x671F;&#x4F5C;&#x4E3A;&#x540E;&#x7F00;&#xFF0C;&#x4E0D;&#x7136;&#x4F1A;&#x662F;&#x4E00;&#x4E32;&#x65E0;&#x610F;&#x4E49;&#x7684;&#x6570;&#x5B57;</td>
</tr>
<tr>
<td>dateformat .%s</td>
<td>&#x5207;&#x6362;&#x540E;&#x6587;&#x4EF6;&#x540D;&#xFF0C;&#x5FC5;&#x987B;&#x914D;&#x5408;dateext&#x4F7F;&#x7528;</td>
</tr>
</tbody>
</table>
<p></p><h4 id="logrotateconf&#x8303;&#x4F8B;">logrotate.conf&#x8303;&#x4F8B;</h4><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># sample logrotate configuration file</span></div><div class="line">compress     <span class="comment"># &#x5168;&#x5C40;&#x8BBE;&#x7F6E;, &#x538B;&#x7F29;</span></div><div class="line"> </div><div class="line">/var/<span class="built_in">log</span>/messages {</div><div class="line">    rotate 5     <span class="comment"># &#x4FDD;&#x7559;5&#x4EFD;&#x65E5;&#x5FD7;</span></div><div class="line">    weekly       <span class="comment"># &#x6BCF;&#x5468;&#x8F6E;&#x6362;&#x4E00;&#x6B21;</span></div><div class="line">    postrotate   <span class="comment"># &#x8F6E;&#x6362;&#x4E4B;&#x540E;&#x91CD;&#x542F;syslogd&#x670D;&#x52A1;</span></div><div class="line">    /usr/bin/killall -HUP syslogd</div><div class="line">    <span class="comment"># rhel6&#x4E2D;&#x4E3A;:/bin/kill -HUP `cat /var/run/syslogd.pid 2&gt; /dev/null` 2&gt; /dev/null || true</span></div><div class="line">    <span class="comment"># &#x53EF;&#x67E5;&#x770B;/etc/logrotate.d/&#x4E0B;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;</span></div><div class="line">    endscript</div><div class="line">}</div><div class="line"> </div><div class="line"><span class="string">&quot;/var/log/httpd/access.log&quot;</span> /var/<span class="built_in">log</span>/httpd/error.log {   <span class="comment">#  &#x6307;&#x5B9A;&#x591A;&#x4E2A;&#x6587;&#x4EF6;, &#x5982;&#x679C;&#x6709;&#x7279;&#x6B8A;&#x5B57;&#x7B26;&#x9700;&#x8981;&#x7528;&#x5355;&#x5F15;&#x53F7;</span></div><div class="line">    rotate 5</div><div class="line">    mail www@my.org</div><div class="line">    size 100k        <span class="comment"># &#x8D85;&#x8FC7;100k&#x540E;&#x5207;&#x6362;&#x65E5;&#x5FD7;, &#x5E76;&#x628A;&#x8001;&#x7684;&#x65E5;&#x5FD7;&#x53D1;&#x9001;&#x90AE;&#x4EF6;&#x7ED9;www@my.org</span></div><div class="line">    sharedscripts    <span class="comment"># &#x5171;&#x4EAB;&#x811A;&#x672C;.&#x4E0B;&#x9762;&#x7684;postrotate&#x811A;&#x672C;&#x53EA;&#x8FD0;&#x884C;&#x4E00;&#x6B21;.</span></div><div class="line">    postrotate</div><div class="line">    /usr/bin/killall -HUP httpd</div><div class="line">    endscript</div><div class="line">}</div><div class="line"> </div><div class="line">/var/<span class="built_in">log</span>/news/* {    <span class="comment"># &#x5C11;&#x7528;&#x901A;&#x914D;&#x7B26;, &#x56E0;&#x4F1A;&#x5B83;&#x4F1A;&#x5305;&#x62EC;&#x5DF2;&#x7ECF;&#x5207;&#x6362;&#x8FC7;&#x7684;&#x65E5;&#x5FD7;, &#x8981;&#x7528;&#x7684;&#x8BDD;&#x6700;&#x597D;&#x5728;*&#x53F7;&#x540E;&#x52A0;&#x4E0A;&#x6269;&#x5C55;&#x540D;, &#x5982;*.log</span></div><div class="line">    monthly</div><div class="line">    rotate 2</div><div class="line">    olddir /var/<span class="built_in">log</span>/news/old</div><div class="line">    missingok</div><div class="line">    postrotate</div><div class="line">    <span class="built_in">kill</span> -HUP <span class="string">&apos;cat /var/run/inn.pid&apos;</span></div><div class="line">    endscript</div><div class="line">    nocompress</div><div class="line">}</div><div class="line"> </div><div class="line">/var/<span class="built_in">log</span>/ipwall/messages.log {   <span class="comment">#&#x65E5;&#x5FD7;&#x8DEF;&#x5F84;&#x4E00;&#x5B9A;&#x8981;&#x548C;rsyslog&#x5B9A;&#x4E49;&#x7684;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x4E00;&#x81F4;</span></div><div class="line">    rotate 65535             <span class="comment">#&#x6EDA;&#x52A8;65535&#x6B21;</span></div><div class="line">    create 0777 syslog adm   <span class="comment">#&#x8BBE;&#x7F6E;&#x6743;&#x9650;&#xFF0C;&#x65B9;&#x4FBF;windows&#x8FDE;&#x63A5;samba&#x670D;&#x52A1;&#x5668;</span></div><div class="line">    compress                 <span class="comment">#&#x91C7;&#x7528;&#x538B;&#x7F29;</span></div><div class="line">    size 50M                 <span class="comment">#&#x6587;&#x4EF6;&#x5927;&#x5C0F;50M&#x4EE5;&#x4E0A;&#x7684;&#x5206;&#x5272;&#x65E5;&#x5FD7;</span></div><div class="line">    dateext</div><div class="line">    dateformat .%s           <span class="comment">#&#x5B9A;&#x4E49;&#x6587;&#x4EF6;&#x5207;&#x5272;&#x540E;&#x7684;&#x6587;&#x4EF6;&#x540D;&#xFF0C;&#x5FC5;&#x987B;&#x914D;&#x5408;dateext&#x4F7F;&#x7528;</span></div><div class="line"> </div><div class="line">    <span class="comment">#posrotate/endscript&#x8FD9;&#x6BB5;&#x811A;&#x672C;&#x4F7F;rsyslog&#x7A0B;&#x5E8F;&#x91CD;&#x65B0;&#x8BFB;&#x53D6;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x7A0B;&#x5E8F;&#x91CA;&#x653E;&#x5BF9;messages.log&#x6587;&#x4EF6;&#x6301;&#x6709;&#x7684;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;</span></div><div class="line">    postrotate</div><div class="line">    /bin/<span class="built_in">kill</span> -HUP $(/bin/cat /var/run/rsyslogd.pid 2&gt;/dev/null) &amp;&gt;/dev/null</div><div class="line">    endscript</div><div class="line">}</div></pre></td></tr></table></figure><p></p>
<p></p><h4 id="&#x5F3A;&#x5236;&#x8F6E;&#x8F6C;">&#x5F3A;&#x5236;&#x8F6E;&#x8F6C;</h4><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">logrotate <span class="_">-f</span> /etc/logrotate.conf     <span class="comment"># &#x2013;&#x5F3A;&#x5236;&#x8F6E;&#x8F6C;</span></div><div class="line">logrotate -vf /etc/logrotate.conf    <span class="comment"># &#x2013;&#x518D;&#x52A0;&#x4E00;&#x4E2A;-v&#x53C2;&#x6570;&#x67E5;&#x770B;&#x8F6E;&#x8F6C;&#x7684;&#x8FC7;&#x7A0B;</span></div><div class="line"> </div><div class="line">logger -t <span class="string">&apos;aaaa&apos;</span> <span class="string">&apos;bbbbbb&apos;</span>            <span class="comment">#&#x2013;&#x5728;&#x65E5;&#x5FD7;&#x91CC;&#x52A0;&#x4E00;&#x4E2A;&#x5185;&#x5BB9;tag&#x548C;&#x5185;&#x5BB9;</span></div><div class="line">tail /var/<span class="built_in">log</span>/messages</div><div class="line"><span class="comment"># Jun 12 20:34:22 kadefor aaaa: bbbbbb</span></div></pre></td></tr></table></figure><p></p>
<p></p><h3 id="nginx&#x65E5;&#x5FD7;&#x5207;&#x5272;">Nginx&#x65E5;&#x5FD7;&#x5207;&#x5272;</h3><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">/var/<span class="built_in">log</span>/nginx/*<span class="built_in">log</span> {</div><div class="line">    daily</div><div class="line">    rotate 10</div><div class="line">    missingok</div><div class="line">    notifempty</div><div class="line">    compress</div><div class="line">    sharedscripts</div><div class="line">    su root</div><div class="line">    postrotate</div><div class="line">        /bin/<span class="built_in">kill</span> -USR1 $(cat /var/run/nginx.pid 2&gt;/dev/null) 2&gt;/dev/null || :</div><div class="line">    endscript</div><div class="line">}</div></pre></td></tr></table></figure><p></p>
<p></p><h3 id="php&#x65E5;&#x5FD7;&#x5207;&#x5272;">PHP&#x65E5;&#x5FD7;&#x5207;&#x5272;</h3><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">/var/<span class="built_in">log</span>/php-fpm/*<span class="built_in">log</span> {</div><div class="line">    missingok</div><div class="line">    notifempty</div><div class="line">    sharedscripts</div><div class="line">    delaycompress</div><div class="line">    create 0664 www www</div><div class="line">    postrotate</div><div class="line">        /bin/<span class="built_in">kill</span> -SIGUSR1 `cat /var/run/php-fpm/php-fpm.pid 2&gt;/dev/null` 2&gt;/dev/null || <span class="literal">true</span></div><div class="line">    endscript</div><div class="line">}</div></pre></td></tr></table></figure><p></p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;logrotate&lt;/code&gt; 是一个日志管理程序，用来把旧的日志文件删除（备份），并创建新的日志文件，这个过程称为”转储”。我们可以根据日志的大小，或者根据其使用的天数来转储。&lt;br&gt;
    
    </summary>
    
      <category term="工具" scheme="http://www.chen-hao.com.cn/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="日志切割" scheme="http://www.chen-hao.com.cn/tags/%E6%97%A5%E5%BF%97%E5%88%87%E5%89%B2/"/>
    
  </entry>
  
  <entry>
    <title>Shell中set和shopt命令选项含义</title>
    <link href="http://www.chen-hao.com.cn/Shell%E4%B8%ADset%E5%92%8Cshopt%E5%91%BD%E4%BB%A4%E9%80%89%E9%A1%B9%E5%90%AB%E4%B9%89.html"/>
    <id>http://www.chen-hao.com.cn/Shell中set和shopt命令选项含义.html</id>
    <published>2016-12-01T02:58:40.000Z</published>
    <updated>2016-12-01T03:35:23.332Z</updated>
    
    <content type="html"><![CDATA[<p></p><h3 id="set&#x547D;&#x4EE4;&#x9009;&#x9879;">set&#x547D;&#x4EE4;&#x9009;&#x9879;</h3><br>set&#x547D;&#x4EE4;&#x4F5C;&#x7528;&#x4E3B;&#x8981;&#x662F;&#x663E;&#x793A;&#x7CFB;&#x7EDF;&#x4E2D;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x7684;shell&#x53D8;&#x91CF;&#xFF0C;&#x4EE5;&#x53CA;&#x8BBE;&#x7F6E;shell&#x53D8;&#x91CF;&#x7684;&#x65B0;&#x53D8;&#x91CF;&#x503C;&#x3002;&#x4F7F;&#x7528;set&#x66F4;&#x6539;shell&#x7279;&#x6027;&#x65F6;&#xFF0C;&#x7B26;&#x53F7;<code>&quot;+&quot;</code>&#x548C;<code>&quot;-&quot;</code>&#x7684;&#x4F5C;&#x7528;&#x5206;&#x522B;&#x662F;&#x6253;&#x5F00;&#x548C;&#x5173;&#x95ED;&#x6307;&#x5B9A;&#x7684;&#x6A21;&#x5F0F;&#x3002;set&#x547D;&#x4EE4;&#x4E0D;&#x80FD;&#x591F;&#x5B9A;&#x4E49;&#x65B0;&#x7684;shell&#x53D8;&#x91CF;&#x3002;&#x5982;&#x679C;&#x8981;&#x5B9A;&#x4E49;&#x65B0;&#x7684;&#x53D8;&#x91CF;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;declare&#x547D;&#x4EE4;&#x4EE5;&#x53D8;&#x91CF;&#x540D;=&#x503C;&#x7684;&#x683C;&#x5F0F;&#x8FDB;&#x884C;&#x5B9A;&#x4E49;&#x5373;&#x53EF;&#x3002;<br> <a id="more"></a><p></p>
<blockquote>
<p><code>&#x5185;&#x7F6E;set&#x547D;&#x4EE4;&#x9009;&#x9879;</code></p>
</blockquote>
<table>
<thead>
<tr>
<th>&#x9009;&#x9879;&#x540D;</th>
<th>&#x5FEB;&#x6377;&#x5F00;&#x5173;</th>
<th>&#x542B;&#x4E49;</th>
</tr>
</thead>
<tbody>
<tr>
<td>allexport</td>
<td>-a</td>
<td>&#x4ECE;&#x8FD9;&#x4E2A;&#x9009;&#x9879;&#x4E2D;&#x88AB;&#x8BBE;&#x7F6E;&#x5F00;&#x59CB;&#x5C31;&#x81EA;&#x52A8;&#x6807;&#x660E;&#x8981;&#x8F93;&#x51FA;&#x7684;&#x65B0;&#x53D8;&#x91CF;&#x6216;&#x4FEE;&#x6539;&#x8FC7;&#x7684;&#x53D8;&#x91CF;&#xFF0C;&#x76F4;&#x81F3;&#x9009;&#x9879;&#x88AB;&#x590D;&#x4F4D;</td>
</tr>
<tr>
<td>braceexpand</td>
<td>-B</td>
<td>&#x6253;&#x5F00;&#x82B1;&#x62EC;&#x53F7;&#x6269;&#x5C55;&#xFF0C;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x9ED8;&#x8BA4;&#x8BBE;&#x7F6E;</td>
</tr>
<tr>
<td>emacs</td>
<td></td>
<td>&#x4F7F;&#x7528;emacs&#x5185;&#x7F6E;&#x7F16;&#x8F91;&#x5668;&#x8FDB;&#x884C;&#x547D;&#x4EE4;&#x884C;&#x7F16;&#x8F91;&#xFF0C;&#x662F;&#x4E00;&#x4E2A;&#x9ED8;&#x8BA4;&#x8BBE;&#x7F6E;</td>
</tr>
<tr>
<td>errexit</td>
<td>-e</td>
<td>&#x5F53;&#x547D;&#x4EE4;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x975E;&#x96F6;&#x9000;&#x51FA;&#x72B6;&#x6001;&#xFF08;&#x5931;&#x8D25;&#xFF09;&#x65F6;&#x9000;&#x51FA;&#x3002;&#x8BFB;&#x53D6;&#x521D;&#x59CB;&#x5316;&#x6587;&#x4EF6;&#x65F6;&#x4E0D;&#x8BBE;&#x7F6E;</td>
</tr>
<tr>
<td>histexpand</td>
<td>-H</td>
<td>&#x6267;&#x884C;&#x5386;&#x53F2;&#x66FF;&#x6362;&#x65F6;&#x6253;&#x5F00;!&#x548C;!!&#x6269;&#x5C55;&#xFF0C;&#x662F;&#x4E00;&#x4E2A;&#x9ED8;&#x8BA4;&#x8BBE;&#x7F6E;</td>
</tr>
<tr>
<td>history</td>
<td></td>
<td>&#x6253;&#x5F00;&#x547D;&#x4EE4;&#x884C;&#x5386;&#x53F2;&#x3001;&#x9ED8;&#x8BA4;&#x4E3A;&#x6253;&#x5F00;</td>
</tr>
<tr>
<td>ignoreeof</td>
<td></td>
<td>&#x7981;&#x6B62;&#x7528;EOF(Ctrl+D)&#x952E;&#x9000;&#x51FA;shell&#x3002;&#x5FC5;&#x987B;&#x952E;&#x5165;exit&#x624D;&#x80FD;&#x9000;&#x51FA;&#x3002;&#x7B49;&#x4EF7;&#x4E8E;&#x8BBE;&#x7F6E;shell&#x53D8;&#x91CF;IGNOREEOF=10</td>
</tr>
<tr>
<td>keyword</td>
<td>-k</td>
<td>&#x5C06;&#x5173;&#x952E;&#x5B57;&#x53C2;&#x6570;&#x653E;&#x5230;&#x547D;&#x4EE4;&#x7684;&#x73AF;&#x5883;&#x4E2D;</td>
</tr>
<tr>
<td>interactive-comments</td>
<td></td>
<td>&#x5BF9;&#x4E8E;&#x4EA4;&#x4E92;&#x5F0F;shell&#xFF0C;&#x628A;#&#x7B26;&#x540E;&#x9762;&#x7684;&#x6587;&#x672C;&#x4F5C;&#x4E3A;&#x6CE8;&#x91CA;</td>
</tr>
<tr>
<td>monitor</td>
<td>-m</td>
<td>&#x8BBE;&#x7F6E;&#x4F5C;&#x4E1A;&#x63A7;&#x5236;</td>
</tr>
<tr>
<td>noclobber</td>
<td>-C</td>
<td>&#x9632;&#x6B62;&#x6587;&#x4EF6;&#x5728;&#x91CD;&#x5B9A;&#x5411;&#x65F6;&#x88AB;&#x91CD;&#x5199;</td>
</tr>
<tr>
<td>noexec</td>
<td>-n</td>
<td>&#x8BFB;&#x547D;&#x4EE4;&#xFF0C;&#x4F46;&#x4E0D;&#x6267;&#x884C;&#x3002;&#x7528;&#x6765;&#x68C0;&#x67E5;&#x811A;&#x672C;&#x7684;&#x8BED;&#x6CD5;&#x3002;&#x4EA4;&#x4E92;&#x5F0F;&#x8FD0;&#x884C;&#x65F6;&#x4E0D;&#x5F00;&#x542F;</td>
</tr>
<tr>
<td>noglob</td>
<td>-d</td>
<td>&#x7981;&#x6B62;&#x7528;&#x8DEF;&#x5F84;&#x540D;&#x6269;&#x5C55;&#x3002;&#x5373;&#x5173;&#x95ED;&#x901A;&#x914D;&#x7B26;</td>
</tr>
<tr>
<td>notify</td>
<td>-b</td>
<td>&#x540E;&#x53F0;&#x4F5C;&#x4E1A;&#x5B8C;&#x6210;&#x65F6;&#x901A;&#x77E5;&#x7528;&#x6237;</td>
</tr>
<tr>
<td>nounset</td>
<td>-u</td>
<td>&#x6269;&#x5C55;&#x4E00;&#x4E2A;&#x672A;&#x8BBE;&#x7F6E;&#x7684;&#x53D8;&#x91CF;&#x65F6;&#x663E;&#x793A;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#x4FE1;&#x606F;</td>
</tr>
<tr>
<td>onecmd</td>
<td>-t</td>
<td>&#x5728;&#x8BFB;&#x53D6;&#x548C;&#x6267;&#x884C;&#x547D;&#x4EE4;&#x540E;&#x9000;&#x51FA;</td>
</tr>
<tr>
<td>physical</td>
<td>-P</td>
<td>&#x8BBE;&#x7F6E;&#x65F6;&#xFF0C;&#x5728;&#x952E;&#x5165;cd&#x6216;pwd&#x7981;&#x6B62;&#x7B26;&#x53F7;&#x94FE;&#x63A5;&#x3002;&#x7528;&#x7269;&#x7406;&#x76EE;&#x5F55;&#x4EE3;&#x66FF;</td>
</tr>
<tr>
<td>privileged</td>
<td>-p</td>
<td>&#x8BBE;&#x7F6E;&#x540E;&#xFF0C;shell&#x4E0D;&#x8BFB;&#x53D6;.profile&#x6216;ENV&#x6587;&#x4EF6;&#xFF0C;&#x4E14;&#x4E0D;&#x4ECE;&#x73AF;&#x5883;&#x7EE7;&#x627F;shell&#x51FD;&#x6570;&#xFF0C;&#x5C06;&#x81EA;&#x52A8;&#x4E3A;setuid&#x811A;&#x672C;&#x5F00;&#x542F;&#x7279;&#x6743;</td>
</tr>
<tr>
<td>verbose</td>
<td>-v</td>
<td>&#x4E3A;&#x8C03;&#x8BD5;&#x6253;&#x5F00;verbose&#x6A21;&#x5F0F;</td>
</tr>
<tr>
<td>vi</td>
<td></td>
<td>&#x4F7F;&#x7528;vi&#x5185;&#x7F6E;&#x7F16;&#x8F91;&#x5668;&#x8FDB;&#x884C;&#x547D;&#x4EE4;&#x884C;&#x7F16;&#x8F91;</td>
</tr>
<tr>
<td>xtrace</td>
<td>-x</td>
<td>&#x4E3A;&#x8C03;&#x8BD5;&#x6253;&#x5F00;echo&#x6A21;&#x5F0F;</td>
</tr>
</tbody>
</table>
<p></p><h3 id="shopt&#x547D;&#x4EE4;&#x9009;&#x9879;">shopt&#x547D;&#x4EE4;&#x9009;&#x9879;</h3><br>shopt&#x547D;&#x4EE4;&#x662F;set&#x547D;&#x4EE4;&#x7684;&#x4E00;&#x79CD;&#x66FF;&#x4EE3;&#xFF0C;&#x5F88;&#x591A;&#x65B9;&#x9762;&#x90FD;&#x548C;set&#x547D;&#x4EE4;&#x4E00;&#x6837;&#xFF0C;&#x4F46;&#x5B83;&#x589E;&#x52A0;&#x4E86;&#x5F88;&#x591A;&#x9009;&#x9879;&#x3002;&#x53EF;&#x6709;&#x4F7F;&#x7528;<code>&#x201C;-p&#x201D;</code>&#x9009;&#x9879;&#x6765;&#x67E5;&#x770B;shopt&#x9009;&#x9879;&#x7684;&#x8BBE;&#x7F6E;&#x3002;<code>&#x201C;-u&#x201D;</code>&#x5F00;&#x5173;&#x8868;&#x793A;&#x4E00;&#x4E2A;&#x590D;&#x4F4D;&#x7684;&#x9009;&#x9879;&#xFF0C;<code>&#x201C;-s&#x201D;</code>&#x8868;&#x793A;&#x9009;&#x9879;&#x5F53;&#x524D;&#x88AB;&#x8BBE;&#x7F6E;&#x3002;<p></p>
<blockquote>
<p><code>shopt&#x547D;&#x4EE4;&#x53C2;&#x6570;&#x7528;&#x6CD5;</code></p>
</blockquote>
<table>
<thead>
<tr>
<th>&#x9009;&#x9879;</th>
<th>&#x542B;&#x4E49;</th>
</tr>
</thead>
<tbody>
<tr>
<td>cdable_vars</td>
<td>&#x5982;&#x679C;&#x7ED9;cd&#x5185;&#x7F6E;&#x547D;&#x4EE4;&#x7684;&#x53C2;&#x6570;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x76EE;&#x5F55;,&#x5C31;&#x5047;&#x8BBE;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;&#x540D;,&#x53D8;&#x91CF;&#x7684;&#x503C;&#x662F;&#x5C06;&#x8981;&#x8F6C;&#x6362;&#x5230;&#x7684;&#x76EE;&#x5F55;</td>
</tr>
<tr>
<td>cdspell</td>
<td>&#x7EA0;&#x6B63;cd&#x547D;&#x4EE4;&#x4E2D;&#x76EE;&#x5F55;&#x540D;&#x7684;&#x8F83;&#x5C0F;&#x62FC;&#x5199;&#x9519;&#x8BEF;.&#x68C0;&#x67E5;&#x7684;&#x9519;&#x8BEF;&#x5305;&#x62EC;&#x98A0;&#x5012;&#x987A;&#x5E8F;&#x7684;&#x5B57;&#x7B26;,&#x9057;&#x6F0F;&#x7684;&#x5B57;&#x7B26;&#x4EE5;&#x53CA;&#x91CD;&#x590D;&#x7684;&#x5B57;&#x7B26;.&#x5982;&#x679C;&#x627E;&#x5230;&#x4E00;&#x5904;&#x9700;&#x4FEE;&#x6539;&#x4E4B;&#x5904;,&#x6B63;&#x786E;&#x7684;&#x8DEF;&#x5F84;&#x5C06;&#x6253;&#x5370;&#x51FA;,&#x547D;&#x4EE4;&#x5C06;&#x7EE7;&#x7EED;.&#x53EA;&#x7528;&#x4E8E;&#x4EA4;&#x4E92;&#x5F0F;shell</td>
</tr>
<tr>
<td>checkhash</td>
<td>bash&#x5728;&#x8BD5;&#x56FE;&#x6267;&#x884C;&#x4E00;&#x4E2A;&#x547D;&#x4EE4;&#x524D;,&#x5148;&#x5728;&#x54C8;&#x5E0C;&#x8868;&#x4E2D;&#x5BFB;&#x627E;,&#x4EE5;&#x786E;&#x5B9A;&#x547D;&#x4EE4;&#x662F;&#x5426;&#x5B58;&#x5728;.&#x5982;&#x679C;&#x547D;&#x4EE4;&#x4E0D;&#x5B58;&#x5728;,&#x5C31;&#x6267;&#x884C;&#x6B63;&#x5E38;&#x7684;&#x8DEF;&#x5F84;&#x641C;&#x7D22;</td>
</tr>
<tr>
<td>checkwinsize</td>
<td>bash&#x5728;&#x6BCF;&#x4E2A;&#x547D;&#x4EE4;&#x540E;&#x68C0;&#x67E5;&#x7A97;&#x53E3;&#x5927;&#x5C0F;,&#x5982;&#x679C;&#x6709;&#x5FC5;&#x8981;,&#x5C31;&#x66F4;&#x65B0;LINES&#x548C;COLUMNS&#x7684;&#x503C;</td>
</tr>
<tr>
<td>cmdhist</td>
<td>bash&#x8BD5;&#x56FE;&#x5C06;&#x4E00;&#x4E2A;&#x591A;&#x884C;&#x547D;&#x4EE4;&#x7684;&#x6240;&#x6709;&#x884C;&#x4FDD;&#x5B58;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x5386;&#x53F2;&#x9879;&#x4E2D;.&#x8FD9;&#x662F;&#x7684;&#x591A;&#x884C;&#x547D;&#x4EE4;&#x7684;&#x91CD;&#x65B0;&#x7F16;&#x8F91;&#x66F4;&#x65B9;&#x4FBF;</td>
</tr>
<tr>
<td>dotglob</td>
<td>Bash&#x5728;&#x6587;&#x4EF6;&#x540D;&#x6269;&#x5C55;&#x7684;&#x7ED3;&#x679C;&#x4E2D;&#x5305;&#x62EC;&#x4EE5;&#x70B9;(.)&#x5F00;&#x5934;&#x7684;&#x6587;&#x4EF6;&#x540D;</td>
</tr>
<tr>
<td>execfail</td>
<td>&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x975E;&#x4EA4;&#x4E92;&#x5F0F;shell&#x4E0D;&#x80FD;&#x6267;&#x884C;&#x6307;&#x5B9A;&#x7ED9;exec&#x5185;&#x7F6E;&#x547D;&#x4EE4;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x7684;&#x6587;&#x4EF6;,&#x5B83;&#x4E0D;&#x4F1A;&#x9000;&#x51FA;.&#x5982;&#x679C;exec&#x5931;&#x8D25;,&#x4E00;&#x4E2A;&#x4EA4;&#x4E92;&#x5F0F;shell&#x4E0D;&#x4F1A;&#x9000;&#x51FA;</td>
</tr>
<tr>
<td>expand_aliases</td>
<td>&#x522B;&#x540D;&#x88AB;&#x6269;&#x5C55;.&#x7F3A;&#x7701;&#x4E3A;&#x6253;&#x5F00;</td>
</tr>
<tr>
<td>extglob</td>
<td>&#x6253;&#x5F00;&#x6269;&#x5C55;&#x7684;&#x6A21;&#x5F0F;&#x5339;&#x914D;&#x7279;&#x6027;(&#x6B63;&#x5E38;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x5143;&#x5B57;&#x7B26;&#x6765;&#x81EA;Korn shell&#x7684;&#x6587;&#x4EF6;&#x540D;&#x6269;&#x5C55;)</td>
</tr>
<tr>
<td>histappend</td>
<td>&#x5982;&#x679C;readline&#x6B63;&#x88AB;&#x4F7F;&#x7528;,&#x7528;&#x6237;&#x6709;&#x673A;&#x4F1A;&#x91CD;&#x65B0;&#x7F16;&#x8F91;&#x4E00;&#x4E2A;&#x5931;&#x8D25;&#x7684;&#x5386;&#x53F2;&#x66FF;&#x6362;</td>
</tr>
<tr>
<td>histverify</td>
<td>&#x5982;&#x679C;&#x8BBE;&#x7F6E;,&#x4E14;readline&#x6B63;&#x88AB;&#x4F7F;&#x7528;,&#x5386;&#x53F2;&#x66FF;&#x6362;&#x7684;&#x7ED3;&#x679C;&#x4E0D;&#x4F1A;&#x7ACB;&#x5373;&#x4F20;&#x9012;&#x7ED9;shell&#x89E3;&#x91CA;&#x5668;.&#x800C;&#x662F;&#x5C06;&#x7ED3;&#x679C;&#x884C;&#x88C5;&#x5165;readline&#x7F16;&#x8F91;&#x7F13;&#x51B2;&#x533A;&#x4E2D;,&#x5141;&#x8BB8;&#x8FDB;&#x4E00;&#x6B65;&#x4FEE;&#x6539;</td>
</tr>
<tr>
<td>hostcomplete</td>
<td>&#x5982;&#x679C;&#x8BBE;&#x7F6E;,&#x4E14;readline&#x6B63;&#x88AB;&#x4F7F;&#x7528;,&#x5F53;&#x6B63;&#x5728;&#x5B8C;&#x6210;&#x4E00;&#x4E2A;&#x5305;&#x542B;@&#x7684;&#x8BCD;&#x65F6;bash&#x5C06;&#x8BD5;&#x56FE;&#x6267;&#x884C;&#x4E3B;&#x673A;&#x540D;&#x8865;&#x5168;.&#x7F3A;&#x7701;&#x4E3A;&#x6253;&#x5F00;</td>
</tr>
<tr>
<td>huponexit</td>
<td>&#x5982;&#x679C;&#x8BBE;&#x7F6E;,&#x5F53;&#x4E00;&#x4E2A;&#x4EA4;&#x4E92;&#x5F0F;&#x767B;&#x5F55;shell&#x9000;&#x51FA;&#x65F6;,bash&#x5C06;&#x53D1;&#x9001;&#x4E00;&#x4E2A;SIGHUP(&#x6302;&#x8D77;&#x4FE1;&#x53F7;)&#x7ED9;&#x6240;&#x6709;&#x7684;&#x4F5C;&#x4E1A;</td>
</tr>
<tr>
<td>interactive_comments</td>
<td>&#x5728;&#x4E00;&#x4E2A;&#x4EA4;&#x4E92;&#x5F0F;shell&#x4E2D;.&#x5141;&#x8BB8;&#x4EE5;#&#x5F00;&#x5934;&#x7684;&#x8BCD;&#x4EE5;&#x53CA;&#x540C;&#x4E00;&#x884C;&#x4E2D;&#x5176;&#x4ED6;&#x7684;&#x5B57;&#x7B26;&#x88AB;&#x5FFD;&#x7565;.&#x7F3A;&#x7701;&#x4E3A;&#x6253;&#x5F00;</td>
</tr>
<tr>
<td>lithist</td>
<td>&#x5982;&#x679C;&#x6253;&#x5F00;,&#x4E14;cmdhist&#x9009;&#x9879;&#x4E5F;&#x6253;&#x5F00;,&#x591A;&#x884C;&#x547D;&#x4EE4;&#x8BB2;&#x7528;&#x5D4C;&#x5165;&#x7684;&#x6362;&#x884C;&#x7B26;&#x4FDD;&#x5B58;&#x5230;&#x5386;&#x53F2;&#x4E2D;,&#x800C;&#x65E0;&#x9700;&#x5728;&#x53EF;&#x80FD;&#x7684;&#x5730;&#x65B9;&#x7528;&#x5206;&#x53F7;&#x6765;&#x5206;&#x9694;</td>
</tr>
<tr>
<td>mailwarn</td>
<td>&#x5982;&#x679C;&#x8BBE;&#x7F6E;,&#x4E14;bash&#x7528;&#x6765;&#x68C0;&#x67E5;&#x90AE;&#x4EF6;&#x7684;&#x6587;&#x4EF6;&#x81EA;&#x4ECE;&#x4E0A;&#x6B21;&#x68C0;&#x67E5;&#x540E;&#x5DF2;&#x7ECF;&#x88AB;&#x8BBF;&#x95EE;,&#x5C06;&#x663E;&#x793A;&#x6D88;&#x606F;&#x201D;The mail in mailfile has been read&#x201D;</td>
</tr>
<tr>
<td>nocaseglob</td>
<td>&#x5982;&#x679C;&#x8BBE;&#x7F6E;,&#x5F53;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x540D;&#x6269;&#x5C55;&#x65F6;,bash&#x5728;&#x4E0D;&#x533A;&#x5206;&#x5927;&#x5C0F;&#x5199;&#x7684;&#x65B9;&#x5F0F;&#x4E0B;&#x5339;&#x914D;&#x6587;&#x4EF6;&#x540D;</td>
</tr>
<tr>
<td>nullglob</td>
<td>&#x5982;&#x679C;&#x8BBE;&#x7F6E;,bash&#x5141;&#x8BB8;&#x6CA1;&#x6709;&#x5339;&#x914D;&#x4EFB;&#x4F55;&#x6587;&#x4EF6;&#x7684;&#x6587;&#x4EF6;&#x540D;&#x6A21;&#x5F0F;&#x6269;&#x5C55;&#x6210;&#x4E00;&#x4E2A;&#x7A7A;&#x4E32;,&#x800C;&#x4E0D;&#x662F;&#x4ED6;&#x4EEC;&#x672C;&#x8EAB;</td>
</tr>
<tr>
<td>promptvars</td>
<td>&#x5982;&#x679C;&#x8BBE;&#x7F6E;,&#x63D0;&#x793A;&#x4E32;&#x5728;&#x88AB;&#x6269;&#x5C55;&#x540E;&#x518D;&#x8FDB;&#x884C;&#x53D8;&#x91CF;&#x548C;&#x53C2;&#x91CF;&#x6269;&#x5C55;.&#x7F3A;&#x7701;&#x4E3A;&#x6253;&#x5F00;</td>
</tr>
<tr>
<td>restricted_shell</td>
<td>&#x5982;&#x679C;shell&#x5728;&#x53D7;&#x9650;&#x6A21;&#x5F0F;&#x4E0B;&#x542F;&#x52A8;&#x5C31;&#x8BBE;&#x7F6E;&#x8FD9;&#x4E2A;&#x9009;&#x9879;.&#x8BE5;&#x503C;&#x4E0D;&#x80FD;&#x88AB;&#x6539;&#x53D8;.&#x5F53;&#x6267;&#x884C;&#x542F;&#x52A8;&#x6587;&#x4EF6;&#x65F6;&#x4E0D;&#x80FD;&#x590D;&#x4F4D;&#x8BE5;&#x9009;&#x9879;,&#x5141;&#x8BB8;&#x542F;&#x52A8;&#x6587;&#x4EF6;&#x53D1;&#x73B0;shell&#x662F;&#x5426;&#x53D7;&#x9650;</td>
</tr>
<tr>
<td>shift_verbose</td>
<td>&#x5982;&#x679C;&#x8BE5;&#x9009;&#x9879;&#x8BBE;&#x7F6E;,&#x5F53;&#x79FB;&#x52A8;&#x8BA1;&#x6570;&#x8D85;&#x51FA;&#x4F4D;&#x7F6E;&#x53C2;&#x91CF;&#x4E2A;&#x6570;&#x65F6;,shift&#x5185;&#x7F6E;&#x547D;&#x4EE4;&#x5C06;&#x6253;&#x5370;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#x6D88;&#x606F;</td>
</tr>
<tr>
<td>sourcepath</td>
<td>&#x5982;&#x679C;&#x8BBE;&#x7F6E;,source&#x5185;&#x7F6E;&#x547D;&#x4EE4;&#x4F7F;&#x7528;PATH&#x7684;&#x503C;&#x6765;&#x5BFB;&#x627E;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x63D0;&#x4F9B;&#x7684;&#x6587;&#x4EF6;&#x7684;&#x76EE;&#x5F55;.&#x7F3A;&#x7701;&#x4E3A;&#x6253;&#x5F00;</td>
</tr>
<tr>
<td>source</td>
<td>&#x70B9;(.)&#x7684;&#x540C;&#x4E49;&#x8BCD;</td>
</tr>
</tbody>
</table>
<p></p><h3 id="&#x5220;&#x9664;&#x76EE;&#x5F55;&#x4E0B;&#x9664;&#x4E86;filename&#x4E4B;&#x5916;&#x7684;&#x6240;&#x6709;&#x6587;&#x4EF6;">&#x5220;&#x9664;&#x76EE;&#x5F55;&#x4E0B;&#x9664;&#x4E86;filename&#x4E4B;&#x5916;&#x7684;&#x6240;&#x6709;&#x6587;&#x4EF6;</h3><br>&#x4E0B;&#x6765;&#x5217;&#x51FA;&#x4E86;&#x4E0D;&#x540C;&#x7684;&#x6269;&#x5C55;&#x6A21;&#x5F0F;&#x5339;&#x914D;&#x64CD;&#x4F5C;&#x7B26;&#xFF0C;&#x8FD9;&#x4E9B;&#x6A21;&#x5F0F;&#x5217;&#x8868;&#x662F;&#x4E00;&#x4E2A;&#x7528; <code>|</code> &#x5206;&#x5272;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x6216;&#x8005;&#x591A;&#x4E2A;&#x6587;&#x4EF6;&#x540D;&#x7684;&#x5217;&#x8868;&#xFF1A;<p></p>
<table>
<thead>
<tr>
<th>&#x901A;&#x914D;&#x7B26;</th>
<th>&#x542B;&#x4E49;</th>
</tr>
</thead>
<tbody>
<tr>
<td>*(&#x6A21;&#x5F0F;&#x5217;&#x8868;)</td>
<td>&#x5339;&#x914D; 0 &#x4E2A;&#x6216;&#x8005;&#x591A;&#x4E2A;&#x51FA;&#x73B0;&#x7684;&#x6307;&#x5B9A;&#x6A21;&#x5F0F;</td>
</tr>
<tr>
<td>?(&#x6A21;&#x5F0F;&#x5217;&#x8868;)</td>
<td>&#x5339;&#x914D; 0 &#x4E2A;&#x6216;&#x8005; 1 &#x4E2A;&#x51FA;&#x73B0;&#x7684;&#x6307;&#x5B9A;&#x6A21;&#x5F0F;</td>
</tr>
<tr>
<td>@(&#x6A21;&#x5F0F;&#x5217;&#x8868;)</td>
<td>&#x5339;&#x914D; 1 &#x4E2A;&#x6216;&#x8005;&#x591A;&#x4E2A;&#x51FA;&#x73B0;&#x7684;&#x6307;&#x5B9A;&#x6A21;&#x5F0F;</td>
</tr>
<tr>
<td>!(&#x6A21;&#x5F0F;&#x5217;&#x8868;)</td>
<td>&#x5339;&#x914D;&#x9664;&#x4E86;&#x4E00;&#x4E2A;&#x6307;&#x5B9A;&#x6A21;&#x5F0F;&#x4E4B;&#x5916;&#x7684;&#x4EFB;&#x4F55;&#x5185;&#x5BB9;</td>
</tr>
</tbody>
</table>
<p></p><h4 id="&#x6253;&#x5F00;extglob-shell&#x9009;&#x9879;">&#x6253;&#x5F00;extglob shell&#x9009;&#x9879;</h4><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">shopt</span> <span class="_">-s</span> extglob</div></pre></td></tr></table></figure><p></p>
<p></p><h4 id="&#x5220;&#x9664;&#x76EE;&#x5F55;&#x4E0B;&#x9664;&#x4E86;filename&#x4E4B;&#x5916;&#x7684;&#x6240;&#x6709;&#x6587;&#x4EF6;">&#x5220;&#x9664;&#x76EE;&#x5F55;&#x4E0B;&#x9664;&#x4E86;filename&#x4E4B;&#x5916;&#x7684;&#x6240;&#x6709;&#x6587;&#x4EF6;</h4><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rm -v !(<span class="string">&quot;filename&quot;</span>)</div></pre></td></tr></table></figure><p></p>
<p></p><h4 id="&#x5220;&#x9664;&#x9664;&#x4E86;filename1&#x548C;filename2&#x4E4B;&#x5916;&#x7684;&#x6240;&#x6709;&#x6587;&#x4EF6;">&#x5220;&#x9664;&#x9664;&#x4E86;filename1&#x548C;filename2&#x4E4B;&#x5916;&#x7684;&#x6240;&#x6709;&#x6587;&#x4EF6;</h4><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rm -v !(<span class="string">&quot;filename1&quot;</span>|<span class="string">&quot;filename2&quot;</span>)</div></pre></td></tr></table></figure><p></p>
<p></p><h4 id="&#x5220;&#x9664;&#x9664;&#x4E86;-zip-&#x4E4B;&#x5916;&#x7684;&#x6240;&#x6709;&#x6587;&#x4EF6;">&#x5220;&#x9664;&#x9664;&#x4E86; .zip &#x4E4B;&#x5916;&#x7684;&#x6240;&#x6709;&#x6587;&#x4EF6;</h4><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rm -i !(*.zip)</div></pre></td></tr></table></figure><p></p>
<p></p><h4 id="&#x5173;&#x95ED;extglob-shell&#x9009;&#x9879;">&#x5173;&#x95ED;extglob shell&#x9009;&#x9879;</h4><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">shopt</span> -u extglob</div></pre></td></tr></table></figure><p></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;h3&gt;set命令选项&lt;/h3&gt;&lt;br&gt;set命令作用主要是显示系统中已经存在的shell变量，以及设置shell变量的新变量值。使用set更改shell特性时，符号&lt;code&gt;&amp;quot;+&amp;quot;&lt;/code&gt;和&lt;code&gt;&amp;quot;-&amp;quot;&lt;/code&gt;的作用分别是打开和关闭指定的模式。set命令不能够定义新的shell变量。如果要定义新的变量，可以使用declare命令以变量名=值的格式进行定义即可。&lt;br&gt;
    
    </summary>
    
      <category term="基础" scheme="http://www.chen-hao.com.cn/categories/%E5%9F%BA%E7%A1%80/"/>
    
    
      <category term="shell" scheme="http://www.chen-hao.com.cn/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>Expect命令使用详解</title>
    <link href="http://www.chen-hao.com.cn/Expect%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3.html"/>
    <id>http://www.chen-hao.com.cn/Expect命令使用详解.html</id>
    <published>2016-11-29T02:47:06.000Z</published>
    <updated>2016-11-29T03:08:45.190Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>&#x901A;&#x8FC7; <code>Shell</code> &#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x7B80;&#x5355;&#x7684;&#x63A7;&#x5236;&#x6D41;&#x529F;&#x80FD;&#xFF0C;&#x5982;&#xFF1A;&#x5FAA;&#x73AF;&#x3001;&#x5224;&#x65AD;&#x7B49;&#x3002;&#x4F46;&#x662F;&#x5BF9;&#x4E8E;&#x9700;&#x8981;&#x4EA4;&#x4E92;&#x7684;&#x573A;&#x5408;&#x5219;&#x5FC5;&#x987B;&#x901A;&#x8FC7;&#x4EBA;&#x5DE5;&#x6765;&#x5E72;&#x9884;&#xFF0C;&#x6709;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x53EF;&#x80FD;&#x4F1A;&#x9700;&#x8981;&#x5B9E;&#x73B0;&#x548C;&#x4EA4;&#x4E92;&#x7A0B;&#x5E8F;&#x5982; <code>ssh</code> &#x670D;&#x52A1;&#x5668;&#x7B49;&#x8FDB;&#x884C;&#x4EA4;&#x4E92;&#x7684;&#x529F;&#x80FD;&#x3002;&#x800C; <code>Expect</code> &#x5C31;&#x4F7F;&#x7528;&#x6765;&#x5B9E;&#x73B0;&#x8FD9;&#x79CD;&#x529F;&#x80FD;&#x7684;&#x5DE5;&#x5177;&#x3002;<br><a id="more"></a></p>
</blockquote>
<p></p><h3 id="&#x5B89;&#x88C5;expect">&#x5B89;&#x88C5;expect</h3><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install expect</div></pre></td></tr></table></figure><p></p>
<p></p><h3 id="&#x56DB;&#x4E2A;&#x5173;&#x952E;&#x547D;&#x4EE4;">&#x56DB;&#x4E2A;&#x5173;&#x952E;&#x547D;&#x4EE4;</h3><br>Expect&#x4E2D;&#x6700;&#x5173;&#x952E;&#x7684;&#x56DB;&#x4E2A;&#x547D;&#x4EE4;&#x662F;send,expect,spawn,interact&#x3002;<p></p>
<table>
<thead>
<tr>
<th>&#x547D;&#x4EE4;</th>
<th>&#x7528;&#x9014;</th>
</tr>
</thead>
<tbody>
<tr>
<td>send</td>
<td>&#x7528;&#x4E8E;&#x5411;&#x8FDB;&#x7A0B;&#x53D1;&#x9001;&#x5B57;&#x7B26;&#x4E32;</td>
</tr>
<tr>
<td>expect</td>
<td>&#x4ECE;&#x8FDB;&#x7A0B;&#x63A5;&#x6536;&#x5B57;&#x7B26;&#x4E32;</td>
</tr>
<tr>
<td>spawn</td>
<td>&#x542F;&#x52A8;&#x65B0;&#x7684;&#x8FDB;&#x7A0B;</td>
</tr>
<tr>
<td>interact</td>
<td>&#x5141;&#x8BB8;&#x7528;&#x6237;&#x4EA4;&#x4E92;</td>
</tr>
</tbody>
</table>
<p></p><h4 id="send&#x547D;&#x4EE4;">send&#x547D;&#x4EE4;</h4><br> <code>send</code> &#x547D;&#x4EE4;&#x63A5;&#x6536;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x53C2;&#x6570;&#xFF0C;&#x5E76;&#x5C06;&#x8BE5;&#x53C2;&#x6570;&#x53D1;&#x9001;&#x5230;&#x8FDB;&#x7A0B;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">expect1.1&gt; send <span class="string">&quot;hello world\n&quot;</span></div><div class="line">hello world</div></pre></td></tr></table></figure><p></p>
<p></p><h4 id="expect&#x547D;&#x4EE4;">expect&#x547D;&#x4EE4;</h4><p></p>
<p></p><h5 id="&#x57FA;&#x7840;&#x77E5;&#x8BC6;">&#x57FA;&#x7840;&#x77E5;&#x8BC6;</h5><br>expect&#x547D;&#x4EE4;&#x548C;send&#x547D;&#x4EE4;&#x6B63;&#x597D;&#x76F8;&#x53CD;&#xFF0C;expect&#x901A;&#x5E38;&#x662F;&#x7528;&#x6765;&#x7B49;&#x5F85;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x7684;&#x53CD;&#x9988;&#x3002;expect&#x53EF;&#x4EE5;&#x63A5;&#x6536;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x53C2;&#x6570;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x63A5;&#x6536;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;&#x53C2;&#x6570;&#x3002;&#x548C;&#x4E0A;&#x6587;&#x7684;send&#x547D;&#x4EE4;&#x7ED3;&#x5408;&#xFF0C;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x4E00;&#x4E2A;&#x6700;&#x7B80;&#x5355;&#x7684;&#x4EA4;&#x4E92;&#x5F0F;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">expect <span class="string">&quot;hi\n&quot;</span></div><div class="line">send <span class="string">&quot;hello there!\n&quot;</span></div></pre></td></tr></table></figure><p></p>
<ul>
<li>&#x8FD9;&#x4E24;&#x884C;&#x4EE3;&#x7801;&#x7684;&#x610F;&#x601D;&#x662F;&#xFF1A;&#x4ECE;&#x6807;&#x51C6;&#x8F93;&#x5165;&#x4E2D;&#x7B49;&#x5230;hi&#x548C;&#x6362;&#x884C;&#x952E;&#x540E;&#xFF0C;&#x5411;&#x6807;&#x51C6;&#x8F93;&#x51FA;&#x8F93;&#x51FA;hello there</li>
</ul>
<p>&#x6BD4;&#x5982;&#x5982;&#x4E0B;&#x7A0B;&#x5E8F;&#xFF1A;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">expect <span class="string">&quot;hi\n&quot;</span></div><div class="line">send <span class="string">&quot;you typed &lt;<span class="variable">$expect_out</span>(buffer)&gt;&quot;</span></div><div class="line">send <span class="string">&quot;but I only expected &lt;<span class="variable">$expect_out</span>(0,string)&gt;&quot;</span></div></pre></td></tr></table></figure></p>
<p>&#x5F53;&#x5728;&#x6807;&#x51C6;&#x8F93;&#x5165;&#x4E2D;&#x8F93;&#x5165;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">test</span></div><div class="line">hi</div></pre></td></tr></table></figure></p>
<p>&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#x5982;&#x4E0B;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">you typed: <span class="built_in">test</span></div><div class="line">hi</div><div class="line">I only expect: hi</div></pre></td></tr></table></figure></p>
<p></p><h5 id="&#x6A21;&#x5F0F;-&#x52A8;&#x4F5C;">&#x6A21;&#x5F0F;-&#x52A8;&#x4F5C;</h5><br>expect&#x6700;&#x5E38;&#x7528;&#x7684;&#x8BED;&#x6CD5;&#x662F;&#x6765;&#x81EA;tcl&#x8BED;&#x8A00;&#x7684;&#x6A21;&#x5F0F;-&#x52A8;&#x4F5C;&#x3002;&#x8FD9;&#x79CD;&#x8BED;&#x6CD5;&#x6781;&#x5176;&#x7075;&#x6D3B;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x5C31;&#x5404;&#x79CD;&#x8BED;&#x6CD5;&#x5206;&#x522B;&#x8BF4;&#x660E;&#x3002;<p></p>
<p>&#x5355;&#x4E00;&#x5206;&#x652F;&#x6A21;&#x5F0F;&#x8BED;&#x6CD5;&#xFF1A;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">expect <span class="string">&quot;hi&quot;</span> {send <span class="string">&quot;You said hi&quot;</span>}</div><div class="line"><span class="comment"># &#x5339;&#x914D;&#x5230;hi&#x540E;&#xFF0C;&#x4F1A;&#x8F93;&#x51FA;&quot;you said hi&quot;</span></div></pre></td></tr></table></figure></p>
<p>&#x591A;&#x5206;&#x652F;&#x6A21;&#x5F0F;&#x8BED;&#x6CD5;&#xFF1A;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">expect <span class="string">&quot;hi&quot;</span> { send <span class="string">&quot;You said hi\n&quot;</span> } \</div><div class="line"><span class="string">&quot;hello&quot;</span> { send <span class="string">&quot;Hello yourself\n&quot;</span> } \</div><div class="line"><span class="string">&quot;bye&quot;</span> { send <span class="string">&quot;That was unexpected\n&quot;</span> }</div></pre></td></tr></table></figure></p>
<p>&#x5339;&#x914D;&#x5230;hi,hello,bye&#x4EFB;&#x610F;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x65F6;&#xFF0C;&#x6267;&#x884C;&#x76F8;&#x5E94;&#x7684;&#x8F93;&#x51FA;&#x3002;&#x7B49;&#x540C;&#x4E8E;&#x5982;&#x4E0B;&#x5199;&#x6CD5;&#xFF1A;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">expect {</div><div class="line"><span class="string">&quot;hi&quot;</span> { send <span class="string">&quot;You said hi\n&quot;</span>}</div><div class="line"><span class="string">&quot;hello&quot;</span> { send <span class="string">&quot;Hello yourself\n&quot;</span>}</div><div class="line"><span class="string">&quot;bye&quot;</span> { send <span class="string">&quot;That was unexpected\n&quot;</span>}</div><div class="line">}</div></pre></td></tr></table></figure></p>
<p></p><h4 id="spawn&#x547D;&#x4EE4;">spawn&#x547D;&#x4EE4;</h4><br>&#x4E0A;&#x6587;&#x7684;&#x6240;&#x6709;demo&#x90FD;&#x662F;&#x548C;&#x6807;&#x51C6;&#x8F93;&#x5165;&#x8F93;&#x51FA;&#x8FDB;&#x884C;&#x4EA4;&#x4E92;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x8DDF;&#x5E0C;&#x671B;&#x4ED6;&#x53EF;&#x4EE5;&#x548C;&#x67D0;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x8FDB;&#x884C;&#x4EA4;&#x4E92;&#x3002;spawm&#x547D;&#x4EE4;&#x5C31;&#x662F;&#x7528;&#x6765;&#x542F;&#x52A8;&#x65B0;&#x7684;&#x8FDB;&#x7A0B;&#x7684;&#x3002;spawn&#x540E;&#x7684;send&#x548C;expect&#x547D;&#x4EE4;&#x90FD;&#x662F;&#x548C;spawn&#x6253;&#x5F00;&#x7684;&#x8FDB;&#x7A0B;&#x8FDB;&#x884C;&#x4EA4;&#x4E92;&#x7684;&#x3002;&#x7ED3;&#x5408;&#x4E0A;&#x6587;&#x7684;send&#x548C;expect&#x547D;&#x4EE4;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x4E00;&#x4E0B;&#x66F4;&#x590D;&#x6742;&#x7684;&#x7A0B;&#x5E8F;&#x6BB5;&#x4E86;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">set</span> timeout -1</div><div class="line">spawn ftp ftp.test.com      //&#x6253;&#x5F00;&#x65B0;&#x7684;&#x8FDB;&#x7A0B;&#xFF0C;&#x8BE5;&#x8FDB;&#x7A0B;&#x7528;&#x6237;&#x8FDE;&#x63A5;&#x8FDC;&#x7A0B;ftp&#x670D;&#x52A1;&#x5668;</div><div class="line">expect <span class="string">&quot;Name&quot;</span>             //&#x8FDB;&#x7A0B;&#x8FD4;&#x56DE;Name&#x65F6;</div><div class="line">send <span class="string">&quot;user\r&quot;</span>        //&#x5411;&#x8FDB;&#x7A0B;&#x8F93;&#x5165;anonymous\r</div><div class="line">expect <span class="string">&quot;Password:&quot;</span>        //&#x8FDB;&#x7A0B;&#x8FD4;&#x56DE;Password:&#x65F6;</div><div class="line">send <span class="string">&quot;123456\r&quot;</span>    //&#x5411;&#x8FDB;&#x7A0B;&#x8F93;&#x5165;don@libes.com\r</div><div class="line">expect <span class="string">&quot;ftp&gt; &quot;</span>            //&#x8FDB;&#x7A0B;&#x8FD4;&#x56DE;ftp&gt;&#x65F6;</div><div class="line">send <span class="string">&quot;binary\r&quot;</span>           //&#x5411;&#x8FDB;&#x7A0B;&#x8F93;&#x5165;binary\r</div><div class="line">expect <span class="string">&quot;ftp&gt; &quot;</span>            //&#x8FDB;&#x7A0B;&#x8FD4;&#x56DE;ftp&gt;&#x65F6;</div><div class="line">send <span class="string">&quot;get test.tar.gz\r&quot;</span>  //&#x5411;&#x8FDB;&#x7A0B;&#x8F93;&#x5165;get test.tar.gz\r</div></pre></td></tr></table></figure><p></p>
<p>&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x7684;&#x4F5C;&#x7528;&#x662F;&#x767B;&#x5F55;&#x5230;ftp&#x670D;&#x52A1;&#x5668;ftp ftp.test.com&#x4E0A;&#xFF0C;&#x5E76;&#x4EE5;&#x4E8C;&#x8FDB;&#x5236;&#x7684;&#x65B9;&#x5F0F;&#x4E0B;&#x8F7D;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x7684;&#x6587;&#x4EF6;test.tar.gz&#x3002;&#x7A0B;&#x5E8F;&#x4E2D;&#x6709;&#x8BE6;&#x7EC6;&#x7684;&#x6CE8;&#x91CA;</p>
<p></p><h4 id="interact&#x547D;&#x4EE4;">interact&#x547D;&#x4EE4;</h4><br>&#x5230;&#x73B0;&#x5728;&#x4E3A;&#x6B62;&#xFF0C;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x53EF;&#x4EE5;&#x7ED3;&#x5408;spawn&#x3001;expect&#x3001;send&#x81EA;&#x52A8;&#x5316;&#x7684;&#x5B8C;&#x6210;&#x5F88;&#x591A;&#x4EFB;&#x52A1;&#x4E86;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x5982;&#x4F55;&#x8BA9;&#x4EBA;&#x5728;&#x9002;&#x5F53;&#x7684;&#x65F6;&#x5019;&#x5E72;&#x9884;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x4E86;&#x3002;&#x6BD4;&#x5982;&#x4E0B;&#x8F7D;&#x5B8C;ftp&#x6587;&#x4EF6;&#x65F6;&#xFF0C;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x505C;&#x7559;&#x5728;ftp&#x547D;&#x4EE4;&#x884C;&#x72B6;&#x6001;&#xFF0C;&#x4EE5;&#x4FBF;&#x624B;&#x52A8;&#x7684;&#x6267;&#x884C;&#x540E;&#x7EED;&#x547D;&#x4EE4;&#x3002;interact&#x53EF;&#x4EE5;&#x8FBE;&#x5230;&#x8FD9;&#x4E9B;&#x76EE;&#x7684;&#x3002;&#x4E0B;&#x9762;&#x7684;demo&#x5728;&#x81EA;&#x52A8;&#x767B;&#x5F55;ftp&#x540E;&#xFF0C;&#x5141;&#x8BB8;&#x7528;&#x6237;&#x4EA4;&#x4E92;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">spawn ftp ftp.test.com</div><div class="line">expect <span class="string">&quot;Name&quot;</span></div><div class="line">send <span class="string">&quot;user\r&quot;</span></div><div class="line">expect <span class="string">&quot;Password:&quot;</span></div><div class="line">send <span class="string">&quot;123456\r&quot;</span></div><div class="line">interact</div></pre></td></tr></table></figure><p></p>
<p></p><h3 id="ssh&#x81EA;&#x52A8;&#x8FDC;&#x7A0B;&#x767B;&#x5F55;">ssh&#x81EA;&#x52A8;&#x8FDC;&#x7A0B;&#x767B;&#x5F55;</h3><br>&#x5982;&#x4F55;&#x4ECE;&#x673A;&#x5668;A&#x4E0A;ssh&#x5230;&#x673A;&#x5668;B&#x4E0A;&#xFF0C;&#x7136;&#x540E;&#x6267;&#x884C;&#x673A;&#x5668;B&#x4E0A;&#x7684;&#x547D;&#x4EE4;&#xFF1F;&#x5982;&#x4F55;&#x4F7F;&#x4E4B;&#x81EA;&#x52A8;&#x5316;&#x5B8C;&#x6210;&#xFF1F;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/expect</span></div><div class="line">spawn ssh root@192.168.16.111    </div><div class="line"><span class="comment"># &#x7528;root&#x7528;&#x6237;&#x767B;&#x5F55;&#x5230;192.168.16.111&#x8FD9;&#x53F0;&#x673A;&#x5668;</span></div><div class="line">expect <span class="string">&quot;*password:&quot;</span></div><div class="line">send <span class="string">&quot;123\r&quot;</span></div><div class="line"><span class="comment"># &#x5F53;&#x5339;&#x914D;&#x5230;*password &#x5219;&#x8F93;&#x5165;&#x5BC6;&#x7801;</span></div><div class="line">expect <span class="string">&quot;*#&quot;</span></div><div class="line">interact</div><div class="line"><span class="comment"># &#x5F53;&#x5339;&#x914D;&#x5230;*# &#x5B57;&#x7B26;&#x662F;&#x5219;&#x5141;&#x8BB8;&#x7528;&#x6237;&#x4EA4;&#x4E92;&#x5F0F;&#x8F93;&#x5165;&#x547D;&#x4EE4;</span></div></pre></td></tr></table></figure><p></p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;通过 &lt;code&gt;Shell&lt;/code&gt; 可以实现简单的控制流功能，如：循环、判断等。但是对于需要交互的场合则必须通过人工来干预，有时候我们可能会需要实现和交互程序如 &lt;code&gt;ssh&lt;/code&gt; 服务器等进行交互的功能。而 &lt;code&gt;Expect&lt;/code&gt; 就使用来实现这种功能的工具。&lt;br&gt;
    
    </summary>
    
      <category term="工具" scheme="http://www.chen-hao.com.cn/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="expect" scheme="http://www.chen-hao.com.cn/tags/expect/"/>
    
  </entry>
  
  <entry>
    <title>HTML状态消息</title>
    <link href="http://www.chen-hao.com.cn/HTML%E7%8A%B6%E6%80%81%E6%B6%88%E6%81%AF.html"/>
    <id>http://www.chen-hao.com.cn/HTML状态消息.html</id>
    <published>2016-11-22T01:08:26.000Z</published>
    <updated>2016-11-25T03:14:09.369Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>&#x5F53;&#x6D4F;&#x89C8;&#x5668;&#x4ECE; <code>web</code> &#x670D;&#x52A1;&#x5668;&#x8BF7;&#x6C42;&#x670D;&#x52A1;&#x65F6;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x53D1;&#x751F;&#x9519;&#x8BEF;&#x3002;&#x8FD4;&#x56DE;&#x4E0B;&#x9762;&#x7684;&#x4E00;&#x7CFB;&#x5217;&#x72B6;&#x6001;&#x6D88;&#x606F;&#xFF0C;&#x4ECE;&#x72B6;&#x6001;&#x7801;&#x7684;&#x7C7B;&#x578B;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5B9A;&#x4F4D;&#x6545;&#x969C;&#xFF0C;&#x4ECE;&#x800C;&#x89E3;&#x51B3;&#x7EBF;&#x4E0A;&#x73AF;&#x5883;&#x7684;&#x5404;&#x79CD;&#x95EE;&#x9898;&#x3002;<br><a id="more"></a></p>
</blockquote>
<h3 id="1xx-&#x4FE1;&#x606F;">1xx: &#x4FE1;&#x606F;</h3>

<table>
<thead>
<tr>
<th>&#x6D88;&#x606F;</th>
<th>&#x63CF;&#x8FF0;</th>
</tr>
</thead>
<tbody>
<tr>
<td>100 Continue</td>
<td>&#x670D;&#x52A1;&#x5668;&#x4EC5;&#x63A5;&#x6536;&#x5230;&#x90E8;&#x5206;&#x8BF7;&#x6C42;&#xFF0C;&#x4F46;&#x662F;&#x4E00;&#x65E6;&#x670D;&#x52A1;&#x5668;&#x5E76;&#x6CA1;&#x6709;&#x62D2;&#x7EDD;&#x8BE5;&#x8BF7;&#x6C42;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x5E94;&#x8BE5;&#x7EE7;&#x7EED;&#x53D1;&#x9001;&#x5176;&#x4F59;&#x7684;&#x8BF7;&#x6C42;</td>
</tr>
<tr>
<td>101 Switching Protocols</td>
<td>&#x670D;&#x52A1;&#x5668;&#x8F6C;&#x6362;&#x534F;&#x8BAE;&#xFF1A;&#x670D;&#x52A1;&#x5668;&#x5C06;&#x9075;&#x4ECE;&#x5BA2;&#x6237;&#x7684;&#x8BF7;&#x6C42;&#x8F6C;&#x6362;&#x5230;&#x53E6;&#x5916;&#x4E00;&#x79CD;&#x534F;&#x8BAE;</td>
</tr>
</tbody>
</table>
<h3 id="2xx-&#x6210;&#x529F;">2xx: &#x6210;&#x529F;</h3>

<table>
<thead>
<tr>
<th>&#x6D88;&#x606F;</th>
<th>&#x63CF;&#x8FF0;</th>
</tr>
</thead>
<tbody>
<tr>
<td>200 OK</td>
<td>&#x8BF7;&#x6C42;&#x6210;&#x529F;&#xFF08;&#x5176;&#x540E;&#x662F;&#x5BF9;GET&#x548C;POST&#x8BF7;&#x6C42;&#x7684;&#x5E94;&#x7B54;&#x6587;&#x6863;&#xFF09;</td>
</tr>
<tr>
<td>201 Created</td>
<td>&#x8BF7;&#x6C42;&#x88AB;&#x521B;&#x5EFA;&#x5B8C;&#x6210;&#xFF0C;&#x540C;&#x65F6;&#x65B0;&#x7684;&#x8D44;&#x6E90;&#x88AB;&#x521B;&#x5EFA;</td>
</tr>
<tr>
<td>202 Accepted</td>
<td>&#x4F9B;&#x5904;&#x7406;&#x7684;&#x8BF7;&#x6C42;&#x5DF2;&#x88AB;&#x63A5;&#x53D7;&#xFF0C;&#x4F46;&#x662F;&#x5904;&#x7406;&#x672A;&#x5B8C;&#x6210;</td>
</tr>
<tr>
<td>203 Non-authoritative Information</td>
<td>&#x6587;&#x6863;&#x5DF2;&#x7ECF;&#x6B63;&#x5E38;&#x5730;&#x8FD4;&#x56DE;&#xFF0C;&#x4F46;&#x4E00;&#x4E9B;&#x5E94;&#x7B54;&#x5934;&#x53EF;&#x80FD;&#x4E0D;&#x6B63;&#x786E;&#xFF0C;&#x56E0;&#x4E3A;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x6587;&#x6863;&#x7684;&#x62F7;&#x8D1D;</td>
</tr>
<tr>
<td>204 No Content</td>
<td>&#x6CA1;&#x6709;&#x65B0;&#x6587;&#x6863;&#x3002;&#x6D4F;&#x89C8;&#x5668;&#x5E94;&#x8BE5;&#x7EE7;&#x7EED;&#x663E;&#x793A;&#x539F;&#x6765;&#x7684;&#x6587;&#x6863;&#x3002;&#x5982;&#x679C;&#x7528;&#x6237;&#x5B9A;&#x671F;&#x5730;&#x5237;&#x65B0;&#x9875;&#x9762;&#xFF0C;&#x800C;Servlet&#x53EF;&#x4EE5;&#x786E;&#x5B9A;&#x7528;&#x6237;&#x6587;&#x6863;&#x8DB3;&#x591F;&#x65B0;&#xFF0C;&#x8FD9;&#x4E2A;&#x72B6;&#x6001;&#x4EE3;&#x7801;&#x662F;&#x5F88;&#x6709;&#x7528;&#x7684;</td>
</tr>
<tr>
<td>205 Reset Content</td>
<td>&#x6CA1;&#x6709;&#x65B0;&#x6587;&#x6863;&#x3002;&#x4F46;&#x6D4F;&#x89C8;&#x5668;&#x5E94;&#x8BE5;&#x91CD;&#x7F6E;&#x5B83;&#x6240;&#x663E;&#x793A;&#x7684;&#x5185;&#x5BB9;&#x3002;&#x7528;&#x6765;&#x5F3A;&#x5236;&#x6D4F;&#x89C8;&#x5668;&#x6E05;&#x9664;&#x8868;&#x5355;&#x8F93;&#x5165;&#x5185;&#x5BB9;</td>
</tr>
<tr>
<td>206 Partial Content</td>
<td>&#x5BA2;&#x6237;&#x53D1;&#x9001;&#x4E86;&#x4E00;&#x4E2A;&#x5E26;&#x6709;Range&#x5934;&#x7684;GET&#x8BF7;&#x6C42;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x5B8C;&#x6210;&#x4E86;&#x5B83;</td>
</tr>
</tbody>
</table>
<h3 id="3xx-&#x91CD;&#x5B9A;&#x5411;">3xx: &#x91CD;&#x5B9A;&#x5411;</h3>

<table>
<thead>
<tr>
<th>&#x6D88;&#x606F;</th>
<th>&#x63CF;&#x8FF0;</th>
</tr>
</thead>
<tbody>
<tr>
<td>300 Multiple Choices</td>
<td>&#x591A;&#x91CD;&#x9009;&#x62E9;&#x3002;&#x94FE;&#x63A5;&#x5217;&#x8868;&#x3002;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x67D0;&#x94FE;&#x63A5;&#x5230;&#x8FBE;&#x76EE;&#x7684;&#x5730;&#x3002;&#x6700;&#x591A;&#x5141;&#x8BB8;&#x4E94;&#x4E2A;&#x5730;&#x5740;</td>
</tr>
<tr>
<td>301 Moved Permanently</td>
<td>&#x6240;&#x8BF7;&#x6C42;&#x7684;&#x9875;&#x9762;&#x5DF2;&#x7ECF;&#x8F6C;&#x79FB;&#x81F3;&#x65B0;&#x7684;url</td>
</tr>
<tr>
<td>302 Found</td>
<td>&#x6240;&#x8BF7;&#x6C42;&#x7684;&#x9875;&#x9762;&#x5DF2;&#x7ECF;&#x4E34;&#x65F6;&#x8F6C;&#x79FB;&#x81F3;&#x65B0;&#x7684;url</td>
</tr>
<tr>
<td>303 See Other</td>
<td>&#x6240;&#x8BF7;&#x6C42;&#x7684;&#x9875;&#x9762;&#x53EF;&#x5728;&#x522B;&#x7684;url&#x4E0B;&#x88AB;&#x627E;&#x5230;</td>
</tr>
<tr>
<td>304 Not Modified</td>
<td>&#x672A;&#x6309;&#x9884;&#x671F;&#x4FEE;&#x6539;&#x6587;&#x6863;&#x3002;&#x5BA2;&#x6237;&#x7AEF;&#x6709;&#x7F13;&#x51B2;&#x7684;&#x6587;&#x6863;&#x5E76;&#x53D1;&#x51FA;&#x4E86;&#x4E00;&#x4E2A;&#x6761;&#x4EF6;&#x6027;&#x7684;&#x8BF7;&#x6C42;&#xFF08;&#x4E00;&#x822C;&#x662F;&#x63D0;&#x4F9B;If-Modified-Since&#x5934;&#x8868;&#x793A;&#x5BA2;&#x6237;&#x53EA;&#x60F3;&#x6BD4;&#x6307;&#x5B9A;&#x65E5;&#x671F;&#x66F4;&#x65B0;&#x7684;&#x6587;&#x6863;&#xFF09;&#x3002;&#x670D;&#x52A1;&#x5668;&#x544A;&#x8BC9;&#x5BA2;&#x6237;&#xFF0C;&#x539F;&#x6765;&#x7F13;&#x51B2;&#x7684;&#x6587;&#x6863;&#x8FD8;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x4F7F;&#x7528;</td>
</tr>
<tr>
<td>305 Use Proxy</td>
<td>&#x5BA2;&#x6237;&#x8BF7;&#x6C42;&#x7684;&#x6587;&#x6863;&#x5E94;&#x8BE5;&#x901A;&#x8FC7;Location&#x5934;&#x6240;&#x6307;&#x660E;&#x7684;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#x63D0;&#x53D6;</td>
</tr>
<tr>
<td>306 Unused</td>
<td>&#x6B64;&#x4EE3;&#x7801;&#x88AB;&#x7528;&#x4E8E;&#x524D;&#x4E00;&#x7248;&#x672C;&#x3002;&#x76EE;&#x524D;&#x5DF2;&#x4E0D;&#x518D;&#x4F7F;&#x7528;&#xFF0C;&#x4F46;&#x662F;&#x4EE3;&#x7801;&#x4F9D;&#x7136;&#x88AB;&#x4FDD;&#x7559;</td>
</tr>
<tr>
<td>307 Temporary Redirect</td>
<td>&#x88AB;&#x8BF7;&#x6C42;&#x7684;&#x9875;&#x9762;&#x5DF2;&#x7ECF;&#x4E34;&#x65F6;&#x79FB;&#x81F3;&#x65B0;&#x7684;url</td>
</tr>
</tbody>
</table>
<h3 id="4xx-&#x5BA2;&#x6237;&#x7AEF;&#x9519;&#x8BEF;">4xx: &#x5BA2;&#x6237;&#x7AEF;&#x9519;&#x8BEF;</h3>

<table>
<thead>
<tr>
<th>&#x6D88;&#x606F;</th>
<th>&#x63CF;&#x8FF0;</th>
</tr>
</thead>
<tbody>
<tr>
<td>400 Bad Request</td>
<td>&#x670D;&#x52A1;&#x5668;&#x672A;&#x80FD;&#x7406;&#x89E3;&#x8BF7;&#x6C42;</td>
</tr>
<tr>
<td>401 Unauthorized</td>
<td>&#x88AB;&#x8BF7;&#x6C42;&#x7684;&#x9875;&#x9762;&#x9700;&#x8981;&#x7528;&#x6237;&#x540D;&#x548C;&#x5BC6;&#x7801;</td>
</tr>
<tr>
<td>402 Payment Required    &#x6B64;&#x4EE3;&#x7801;&#x5C1A;&#x65E0;&#x6CD5;&#x4F7F;&#x7528;</td>
</tr>
<tr>
<td>403 Forbidden</td>
<td>&#x5BF9;&#x88AB;&#x8BF7;&#x6C42;&#x9875;&#x9762;&#x7684;&#x8BBF;&#x95EE;&#x88AB;&#x7981;&#x6B62;</td>
</tr>
<tr>
<td>404 Not Found</td>
<td>&#x670D;&#x52A1;&#x5668;&#x65E0;&#x6CD5;&#x627E;&#x5230;&#x88AB;&#x8BF7;&#x6C42;&#x7684;&#x9875;&#x9762;</td>
</tr>
<tr>
<td>405 Method Not Allowed</td>
<td>&#x8BF7;&#x6C42;&#x4E2D;&#x6307;&#x5B9A;&#x7684;&#x65B9;&#x6CD5;&#x4E0D;&#x88AB;&#x5141;&#x8BB8;</td>
</tr>
<tr>
<td>406 Not Acceptable</td>
<td>&#x670D;&#x52A1;&#x5668;&#x751F;&#x6210;&#x7684;&#x54CD;&#x5E94;&#x65E0;&#x6CD5;&#x88AB;&#x5BA2;&#x6237;&#x7AEF;&#x6240;&#x63A5;&#x53D7;</td>
</tr>
<tr>
<td>407 Proxy Authentication Required</td>
<td>&#x7528;&#x6237;&#x5FC5;&#x987B;&#x9996;&#x5148;&#x4F7F;&#x7528;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#x8FDB;&#x884C;&#x9A8C;&#x8BC1;&#xFF0C;&#x8FD9;&#x6837;&#x8BF7;&#x6C42;&#x624D;&#x4F1A;&#x88AB;&#x5904;&#x7406;</td>
</tr>
<tr>
<td>408 Request Timeout</td>
<td>&#x8BF7;&#x6C42;&#x8D85;&#x51FA;&#x4E86;&#x670D;&#x52A1;&#x5668;&#x7684;&#x7B49;&#x5F85;&#x65F6;&#x95F4;</td>
</tr>
<tr>
<td>409 Conflict</td>
<td>&#x7531;&#x4E8E;&#x51B2;&#x7A81;&#xFF0C;&#x8BF7;&#x6C42;&#x65E0;&#x6CD5;&#x88AB;&#x5B8C;&#x6210;</td>
</tr>
<tr>
<td>410 Gone</td>
<td>&#x88AB;&#x8BF7;&#x6C42;&#x7684;&#x9875;&#x9762;&#x4E0D;&#x53EF;&#x7528;</td>
</tr>
<tr>
<td>411 Length Required &#x201C;Content-Length&#x201D;</td>
<td>&#x672A;&#x88AB;&#x5B9A;&#x4E49;&#x3002;&#x5982;&#x679C;&#x65E0;&#x6B64;&#x5185;&#x5BB9;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x4E0D;&#x4F1A;&#x63A5;&#x53D7;&#x8BF7;&#x6C42;</td>
</tr>
<tr>
<td>412 Precondition Failed</td>
<td>&#x8BF7;&#x6C42;&#x4E2D;&#x7684;&#x524D;&#x63D0;&#x6761;&#x4EF6;&#x88AB;&#x670D;&#x52A1;&#x5668;&#x8BC4;&#x4F30;&#x4E3A;&#x5931;&#x8D25;</td>
</tr>
<tr>
<td>413 Request Entity Too Large</td>
<td>&#x7531;&#x4E8E;&#x6240;&#x8BF7;&#x6C42;&#x7684;&#x5B9E;&#x4F53;&#x7684;&#x592A;&#x5927;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x4E0D;&#x4F1A;&#x63A5;&#x53D7;&#x8BF7;&#x6C42;</td>
</tr>
<tr>
<td>414 Request-url Too Long</td>
<td>&#x7531;&#x4E8E;url&#x592A;&#x957F;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x4E0D;&#x4F1A;&#x63A5;&#x53D7;&#x8BF7;&#x6C42;&#x3002;&#x5F53;post&#x8BF7;&#x6C42;&#x88AB;&#x8F6C;&#x6362;&#x4E3A;&#x5E26;&#x6709;&#x5F88;&#x957F;&#x7684;&#x67E5;&#x8BE2;&#x4FE1;&#x606F;&#x7684;get&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x5C31;&#x4F1A;&#x53D1;&#x751F;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;</td>
</tr>
<tr>
<td>415 Unsupported Media Type</td>
<td>&#x7531;&#x4E8E;&#x5A92;&#x4ECB;&#x7C7B;&#x578B;&#x4E0D;&#x88AB;&#x652F;&#x6301;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x4E0D;&#x4F1A;&#x63A5;&#x53D7;&#x8BF7;&#x6C42;</td>
</tr>
<tr>
<td>416</td>
<td>&#x670D;&#x52A1;&#x5668;&#x4E0D;&#x80FD;&#x6EE1;&#x8DB3;&#x5BA2;&#x6237;&#x5728;&#x8BF7;&#x6C42;&#x4E2D;&#x6307;&#x5B9A;&#x7684;Range&#x5934;</td>
</tr>
</tbody>
</table>
<h3 id="5xx-&#x670D;&#x52A1;&#x5668;&#x9519;&#x8BEF;">5xx: &#x670D;&#x52A1;&#x5668;&#x9519;&#x8BEF;</h3>

<table>
<thead>
<tr>
<th>&#x6D88;&#x606F;</th>
<th>&#x63CF;&#x8FF0;</th>
</tr>
</thead>
<tbody>
<tr>
<td>500 Internal Server Error</td>
<td>&#x8BF7;&#x6C42;&#x672A;&#x5B8C;&#x6210;&#x3002;&#x670D;&#x52A1;&#x5668;&#x9047;&#x5230;&#x4E0D;&#x53EF;&#x9884;&#x77E5;&#x7684;&#x60C5;&#x51B5;</td>
</tr>
<tr>
<td>501 Not Implemented</td>
<td>&#x8BF7;&#x6C42;&#x672A;&#x5B8C;&#x6210;&#x3002;&#x670D;&#x52A1;&#x5668;&#x4E0D;&#x652F;&#x6301;&#x6240;&#x8BF7;&#x6C42;&#x7684;&#x529F;&#x80FD;</td>
</tr>
<tr>
<td>502 Bad Gateway</td>
<td>&#x8BF7;&#x6C42;&#x672A;&#x5B8C;&#x6210;&#x3002;&#x670D;&#x52A1;&#x5668;&#x4ECE;&#x4E0A;&#x6E38;&#x670D;&#x52A1;&#x5668;&#x6536;&#x5230;&#x4E00;&#x4E2A;&#x65E0;&#x6548;&#x7684;&#x54CD;&#x5E94;</td>
</tr>
<tr>
<td>503 Service Unavailable</td>
<td>&#x8BF7;&#x6C42;&#x672A;&#x5B8C;&#x6210;&#x3002;&#x670D;&#x52A1;&#x5668;&#x4E34;&#x65F6;&#x8FC7;&#x8F7D;&#x6216;&#x5F53;&#x673A;</td>
</tr>
<tr>
<td>504 Gateway Timeout</td>
<td>&#x7F51;&#x5173;&#x8D85;&#x65F6;</td>
</tr>
<tr>
<td>505 HTTP Version Not Supported</td>
<td>&#x670D;&#x52A1;&#x5668;&#x4E0D;&#x652F;&#x6301;&#x8BF7;&#x6C42;&#x4E2D;&#x6307;&#x660E;&#x7684;HTTP&#x534F;&#x8BAE;&#x7248;&#x672C;</td>
</tr>
</tbody>
</table>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;当浏览器从 &lt;code&gt;web&lt;/code&gt; 服务器请求服务时，可能会发生错误。返回下面的一系列状态消息，从状态码的类型我们可以定位故障，从而解决线上环境的各种问题。&lt;br&gt;
    
    </summary>
    
      <category term="运维" scheme="http://www.chen-hao.com.cn/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="http" scheme="http://www.chen-hao.com.cn/tags/http/"/>
    
  </entry>
  
  <entry>
    <title>Linux杀毒软件安装及使用</title>
    <link href="http://www.chen-hao.com.cn/Linux%E6%9D%80%E6%AF%92%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8.html"/>
    <id>http://www.chen-hao.com.cn/Linux杀毒软件安装及使用.html</id>
    <published>2016-11-21T02:07:21.000Z</published>
    <updated>2016-11-21T05:05:41.548Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>ClamAV &#x662F;Linux&#x5E73;&#x53F0;&#x6700;&#x53D7;&#x6B22;&#x8FCE;&#x7684;&#x6740;&#x6BD2;&#x8F6F;&#x4EF6;&#xFF0C;ClamAV &#x5C5E;&#x4E8E;&#x514D;&#x8D39;&#x5F00;&#x6E90;&#x4EA7;&#x54C1;&#xFF0C;&#x652F;&#x6301;&#x591A;&#x79CD;&#x5E73;&#x53F0;&#x3002;ClamAV&#x662F;&#x57FA;&#x4E8E;&#x75C5;&#x6BD2;&#x626B;&#x63CF;&#x7684;&#x547D;&#x4EE4;&#x884C;&#x5DE5;&#x5177;&#xFF0C;&#x4F46;&#x540C;&#x65F6;&#x4E5F;&#x6709;&#x652F;&#x6301;&#x56FE;&#x5F62;&#x754C;&#x9762;&#x7684;ClamTK&#x5DE5;&#x5177;&#x3002;ClamAV &#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x90AE;&#x4EF6;&#x670D;&#x52A1;&#x5668;&#x626B;&#x63CF;&#x90AE;&#x4EF6;&#x3002;&#x5B83;&#x6709;&#x591A;&#x79CD;&#x63A5;&#x53E3;&#x4ECE;&#x90AE;&#x4EF6;&#x670D;&#x52A1;&#x5668;&#x626B;&#x63CF;&#x90AE;&#x4EF6;&#x3002;ClamAV &#x6709;&#x81EA;&#x52A8;&#x7684;&#x6570;&#x636E;&#x5E93;&#x66F4;&#x65B0;&#x5668;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x4ECE;&#x5171;&#x4EAB;&#x5E93;&#x4E2D;&#x8FD0;&#x884C;&#x3002;&#x547D;&#x4EE4;&#x884C;&#x7684;&#x754C;&#x9762;&#x8BA9; ClamAV&#x8FD0;&#x884C;&#x6D41;&#x7545;&#x3002;<br> <a id="more"></a></p>
</blockquote>
<p></p><h3 id="yum&#x6E90;&#x5B89;&#x88C5;">YUM&#x6E90;&#x5B89;&#x88C5;</h3><br>&#x8FD9;&#x91CC;&#x76F4;&#x63A5;&#x914D;&#x7F6E;&#x597D;&#x963F;&#x91CC;&#x4E91;&#x7684;epel&#x6E90;&#x5373;&#x53EF;yum&#x4E00;&#x952E;&#x5B89;&#x88C5;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install clamav</div></pre></td></tr></table></figure><p></p>
<p></p><h3 id="&#x7F16;&#x8BD1;&#x5B89;&#x88C5;">&#x7F16;&#x8BD1;&#x5B89;&#x88C5;</h3><p></p>
<p></p><h4 id="&#x83B7;&#x53D6;&#x8F6F;&#x4EF6;&#x5305;">&#x83B7;&#x53D6;&#x8F6F;&#x4EF6;&#x5305;</h4><br>&#x63A8;&#x8350;&#x4E0A;&#x5B98;&#x7F51;&#x4E0B;&#x8F7D;&#x8F6F;&#x4EF6;&#x5305;&#xFF0C;&#x5B98;&#x7F51; <a href="http://www.clamav.net" target="_blank" rel="external">http://www.clamav.net</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget http://www.clamav.net/downloads/production/clamav-0.99.2.tar.gz</div></pre></td></tr></table></figure><p></p>
<p></p><h4 id="&#x51C6;&#x5907;&#x7F16;&#x8BD1;&#x73AF;&#x5883;&#x73AF;&#x5883;">&#x51C6;&#x5907;&#x7F16;&#x8BD1;&#x73AF;&#x5883;&#x73AF;&#x5883;</h4><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># &#x5B89;&#x88C5;&#x4F9D;&#x8D56;&#x5305;</span></div><div class="line">yum -y insatll gcc openssl openssl-devel</div><div class="line"><span class="comment"># &#x521B;&#x5EFA;clamav&#x7528;&#x6237;&#x548C;&#x7EC4;</span></div><div class="line">groupadd clamav</div><div class="line">useradd -g clamav <span class="_">-s</span> /sbin/nologin clamav</div></pre></td></tr></table></figure><p></p>
<p></p><h4 id="&#x7F16;&#x8BD1;&#x5B89;&#x88C5;clamav">&#x7F16;&#x8BD1;&#x5B89;&#x88C5;clamav</h4><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">tar -zxf clamav-0.99.2.tar.gz</div><div class="line"><span class="built_in">cd</span> clamav-0.99.2</div><div class="line">./configure --sysconfdir=/etc</div><div class="line">make &amp;&amp; make install</div></pre></td></tr></table></figure><p></p>
<p></p><h4 id="&#x7A0B;&#x5E8F;&#x8BF4;&#x660E;">&#x7A0B;&#x5E8F;&#x8BF4;&#x660E;</h4><br>&#x7F16;&#x8BD1;&#x5B89;&#x88C5;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x9ED8;&#x8BA4;&#x7A0B;&#x5E8F;&#x5B89;&#x88C5;&#x8DEF;&#x5F84;&#x4E3A;/usr/local/bin<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/bin/</div><div class="line">ls</div><div class="line">clamav-config  clambc  clamconf  clamdscan  clamscan  freshclam  sigtool</div></pre></td></tr></table></figure><p></p>
<table>
<thead>
<tr>
<th>&#x7A0B;&#x5E8F;&#x540D;&#x79F0;</th>
<th>&#x8BE6;&#x7EC6;&#x8BF4;&#x660E;</th>
</tr>
</thead>
<tbody>
<tr>
<td>clamscan</td>
<td>&#x626B;&#x63CF;&#x7A0B;&#x5E8F;&#xFF0C;&#x6700;&#x4E3B;&#x8981;&#x7684;&#x4E00;&#x4E2A;&#x7A0B;&#x5E8F;</td>
</tr>
<tr>
<td>clamd</td>
<td>daemon&#x7A0B;&#x5E8F;&#xFF0C;&#x914D;&#x5408;clamscan&#xFF0C;&#x56E0;&#x4E3A;&#x662F;&#x9884;&#x8F7D;&#xFF0C;&#x53EF;&#x4EE5;&#x66F4;&#x5FEB;&#x7684;&#x626B;&#x63CF;</td>
</tr>
<tr>
<td>clamdscan</td>
<td>&#x5FC5;&#x987B;&#x914D;&#x5408;clamd&#x4F7F;&#x7528;</td>
</tr>
<tr>
<td>clamuko</td>
<td>&#x662F;&#x914D;&#x7F6E;&#x53CA;&#x65F6;&#x626B;&#x63CF;&#x7684;&#x4E2D;&#x4ECB;&#x7A0B;&#x5E8F;&#xFF0C;&#x9700;&#x914D;&#x5408;dazuko</td>
</tr>
<tr>
<td>freshclam</td>
<td>&#x75C5;&#x6BD2;&#x7801;&#x66F4;&#x65B0;&#x7A0B;&#x5E8F;&#xFF0C;&#x9996;&#x6B21;&#x5B89;&#x88C5;&#x9700;&#x8FD0;&#x884C;&#x6B64;&#x7A0B;&#x5E8F;&#x66F4;&#x65B0;&#x75C5;&#x6BD2;&#x5E93;</td>
</tr>
<tr>
<td>sigtool</td>
<td>&#x6CA1;&#x6709;&#x88AB;clamav&#x626B;&#x63CF;&#x5230;&#x7684;&#x75C5;&#x6BD2;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x6B64;&#x7A0B;&#x5E8F;&#x65B0;&#x589E;</td>
</tr>
</tbody>
</table>
<p></p><h3 id="&#x4F7F;&#x7528;clamav&#x6740;&#x6BD2;">&#x4F7F;&#x7528;clamav&#x6740;&#x6BD2;</h3><p></p>
<p></p><h4 id="&#x4FEE;&#x6539;&#x914D;&#x7F6E;&#x6587;&#x4EF6;">&#x4FEE;&#x6539;&#x914D;&#x7F6E;&#x6587;&#x4EF6;</h4><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">cp /etc/clamd.conf.sample /etc/clamd.conf</div><div class="line">vim /etc/clamd.conf</div><div class="line">&#x5728;Example &#x524D;&#x9762;&#x52A0;<span class="comment">#</span></div><div class="line">cp /etc/freshclam.conf.sample /etc/freshclam.conf</div><div class="line">vim /etc/freshclam.conf</div><div class="line">&#x5728;Example &#x524D;&#x9762;&#x52A0;<span class="comment">#</span></div><div class="line">&#x5728; DatabaseMirror database.clamav.net &#x884C;&#x4E0B;&#x9762;&#x589E;&#x52A0;&#x51E0;&#x4E2A;&#x5730;&#x5740;</div><div class="line">DatabaseMirror clamav.inet6.fr</div><div class="line">DatabaseMirror clamav.netopia.pt</div><div class="line">DatabaseMirror clamav.sonic.net</div></pre></td></tr></table></figure><p></p>
<p></p><h4 id="&#x66F4;&#x65B0;&#x75C5;&#x6BD2;&#x5E93;">&#x66F4;&#x65B0;&#x75C5;&#x6BD2;&#x5E93;</h4><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># &#x65B0;&#x5EFA;&#x6240;&#x9700;&#x8981;&#x76EE;&#x5F55;</span></div><div class="line">mkdir /usr/<span class="built_in">local</span>/share/clamav</div><div class="line"><span class="comment"># &#x4FEE;&#x6539;&#x5C5E;&#x4E3B;&#x5C5E;&#x7EC4;</span></div><div class="line">chown clamav.clamav -R /usr/<span class="built_in">local</span>/share/clamav/</div><div class="line"><span class="comment"># &#x66F4;&#x65B0;&#x75C5;&#x6BD2;&#x5E93;</span></div><div class="line">/usr/<span class="built_in">local</span>/bin/freshclam</div></pre></td></tr></table></figure><p></p>
<p></p><h4 id="clamav&#x547D;&#x4EE4;&#x8BE6;&#x89E3;">clamav&#x547D;&#x4EE4;&#x8BE6;&#x89E3;</h4><p></p>
<p></p><h5 id="&#x547D;&#x4EE4;&#x53C2;&#x6570;">&#x547D;&#x4EE4;&#x53C2;&#x6570;</h5><p></p>
<ul>
<li>-l [&#x8DEF;&#x5F84;] [&#x6587;&#x4EF6;&#x540D;] &#x589E;&#x52A0;&#x626B;&#x63CF;&#x62A5;&#x544A;</li>
<li>&#x2013;quiet &#x5B89;&#x9759;&#x65B9;&#x5F0F;&#xFF0C;&#x4E0D;&#x53D1;&#x51FA;&#x4EFB;&#x4F55;&#x6D88;&#x606F;&#xFF0C;&#x53EA;&#x6709;&#x51FA;&#x73B0;&#x75C5;&#x6BD2;&#x624D;&#x4F1A;&#x63D0;&#x793A;</li>
<li>&#x2013;move [&#x8DEF;&#x5F84;] &#x79FB;&#x52A8;&#x75C5;&#x6BD2;&#x6587;&#x4EF6;&#x81F3;&#x2026;</li>
<li>&#x2013;remove [&#x8DEF;&#x5F84;] &#x5220;&#x9664;&#x75C5;&#x6BD2;&#x6587;&#x4EF6;</li>
<li>&#x2013;unzip(unrar) &#x89E3;&#x538B;&#x538B;&#x7F29;&#x6587;&#x4EF6;&#x626B;&#x63CF;</li>
</ul>
<p></p><h5 id="&#x547D;&#x4EE4;&#x5E38;&#x7528;&#x793A;&#x4F8B;">&#x547D;&#x4EE4;&#x5E38;&#x7528;&#x793A;&#x4F8B;</h5><p></p>
<ol>
<li><p>&#x626B;&#x63CF;&#x6307;&#x5B9A;&#x7684;&#x6587;&#x4EF6;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">clamscan file</div></pre></td></tr></table></figure>
</li>
<li><p>&#x626B;&#x63CF;/home&#x76EE;&#x5F55;&#x4E2D;&#x6240;&#x6709;&#x6587;&#x4EF6; (&#x5305;&#x62EC;&#x5B50;&#x76EE;&#x5F55;)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">clamscan -r /home</div></pre></td></tr></table></figure>
</li>
<li><p>&#x5C06;&#x626B;&#x63CF;&#x7ED3;&#x679C;&#x5B58;&#x653E;&#x5230;log&#x4E2D;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">clamscan -r /home/<span class="built_in">test</span> <span class="_">-l</span> /tmp/clamav.log</div></pre></td></tr></table></figure>
</li>
<li><p>&#x626B;&#x63CF;&#x5230;&#x6709;&#x95EE;&#x9898;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x76F4;&#x63A5;&#x5220;&#x9664;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">clamscan -r --remove /home/<span class="built_in">test</span></div><div class="line"><span class="comment"># &#x8FD9;&#x4E00;&#x6B65;&#x8981;&#x5C0F;&#x5FC3;&#xFF0C;&#x6700;&#x597D;&#x4E0D;&#x8981;&#x8FD9;&#x6837;&#x64CD;&#x4F5C;&#xFF0C;&#x5982;&#x679C;&#x5220;&#x9664;&#x4E86;&#x7CFB;&#x7EDF;&#x6587;&#x4EF6;&#x5C31;&#x9EBB;&#x70E6;&#x4E86;&#x3002;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x7CFB;&#x7EDF;&#x5D29;&#x6E83;</span></div></pre></td></tr></table></figure>
</li>
</ol>
<p></p><h4 id="&#x626B;&#x63CF;&#x8FD4;&#x56DE;&#x503C;">&#x626B;&#x63CF;&#x8FD4;&#x56DE;&#x503C;</h4><p></p>
<ul>
<li>0 : &#x65E0;&#x75C5;&#x6BD2; </li>
<li>1 : &#x53D1;&#x73B0;&#x75C5;&#x6BD2; </li>
<li>40 : &#x5DF2;&#x7ECF;&#x901A;&#x8FC7;&#x7684;&#x672A;&#x77E5;&#x9009;&#x9879; </li>
<li>50 : &#x6570;&#x636E;&#x5E93;&#x521D;&#x59CB;&#x5316;&#x9519;&#x8BEF; </li>
<li>52 : &#x4E0D;&#x652F;&#x6301;&#x7684;&#x6587;&#x4EF6;&#x683C;&#x5F0F; </li>
<li>53 : &#x65E0;&#x6CD5;&#x6253;&#x5F00;&#x76EE;&#x5F55; </li>
<li>54 : &#x4E0D;&#x80FD;&#x6253;&#x5F00;&#x6587;&#x4EF6;(ofm) </li>
<li>55 : &#x8BFB;&#x6587;&#x4EF6;&#x9519;&#x8BEF;(ofm) </li>
<li>56 : Can&#x2019;t stat input file / directory. </li>
<li>57 : Can&#x2019;t get absolute path name of current working directory </li>
<li>58 : I/O &#x9519;&#x8BEF;, &#x8BF7;&#x68C0;&#x67E5;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF; </li>
<li>59 : &#x65E0;&#x6CD5;&#x5728;/etc/passwd&#x83B7;&#x5F97;&#x5F53;&#x524D;&#x7528;&#x6237;&#x7684;&#x4FE1;&#x606F; </li>
<li>60 : &#x65E0;&#x6CD5;&#x5728;/etc/passwd&#x83B7;&#x5F97;&#x2019;clamav&#x2019;&#xFF08;&#x9ED8;&#x8BA4;&#x540D;&#xFF09;&#x7528;&#x6237;&#x7684;&#x4FE1;&#x606F; </li>
<li>61 : Can&#x2019;t fork. </li>
<li>63 : &#x4E0D;&#x80FD;&#x521B;&#x5EFA;&#x4E34;&#x65F6;&#x6587;&#x4EF6;/&#x76EE;&#x5F55;(&#x68C0;&#x67E5;&#x6743;&#x9650;). |</li>
<li>64 : &#x65E0;&#x6CD5;&#x5BF9;&#x4E34;&#x65F6;&#x76EE;&#x5F55;&#x8FDB;&#x884C;&#x5199;&#x64CD;&#x4F5C; (&#x8BF7;&#x6307;&#x5B9A;&#x53E6;&#x4E00;&#x4E2A;&#x76EE;&#x5F55;). </li>
<li>70 : &#x65E0;&#x6CD5;&#x5206;&#x914D;&#x6216;&#x91CA;&#x653E;&#x5185;&#x5B58; (calloc). </li>
<li>71 : &#x65E0;&#x6CD5;&#x5206;&#x914D;&#x5185;&#x5B58; (malloc).</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ClamAV 是Linux平台最受欢迎的杀毒软件，ClamAV 属于免费开源产品，支持多种平台。ClamAV是基于病毒扫描的命令行工具，但同时也有支持图形界面的ClamTK工具。ClamAV 主要用于邮件服务器扫描邮件。它有多种接口从邮件服务器扫描邮件。ClamAV 有自动的数据库更新器，还可以从共享库中运行。命令行的界面让 ClamAV运行流畅。&lt;br&gt;
    
    </summary>
    
      <category term="工具" scheme="http://www.chen-hao.com.cn/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="ClamAV" scheme="http://www.chen-hao.com.cn/tags/ClamAV/"/>
    
  </entry>
  
  <entry>
    <title>Linux命令小技巧</title>
    <link href="http://www.chen-hao.com.cn/Linux%E5%91%BD%E4%BB%A4%E5%B0%8F%E6%8A%80%E5%B7%A7.html"/>
    <id>http://www.chen-hao.com.cn/Linux命令小技巧.html</id>
    <published>2016-11-14T08:00:59.000Z</published>
    <updated>2016-11-15T04:05:57.505Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>&#x672C;&#x6587;&#x4E0D;&#x5BF9;&#x57FA;&#x672C;&#x7684;&#x547D;&#x4EE4;&#x4F5C;&#x8FC7;&#x591A;&#x7684;&#x63CF;&#x8FF0;&#xFF0C;&#x8BA9;&#x4F60;&#x4E86;&#x89E3;&#x4E0D;&#x4E00;&#x6837;Linux&#x547D;&#x4EE4;&#x5C0F;&#x6280;&#x5DE7;&#xFF0C;&#x539F;&#x6765;Linux&#x8FD8;&#x53EF;&#x4EE5;&#x8FD9;&#x4E48;&#x73A9;&#xFF01;<br> <a id="more"></a></p>
</blockquote>
<p></p><h3 id="&#x83B7;&#x53D6;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#x6700;&#x5927;&#x7684;&#x51E0;&#x4E2A;&#x6587;&#x4EF6;">&#x83B7;&#x53D6;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#x6700;&#x5927;&#x7684;&#x51E0;&#x4E2A;&#x6587;&#x4EF6;</h3><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">du -hsx * | sort -rh | head -8</div></pre></td></tr></table></figure><p></p>
<p>&#x547D;&#x4EE4;&#x548C;&#x9009;&#x9879;&#x7684;&#x89E3;&#x91CA;&#xFF1A;</p>
<ul>
<li>du &#x2013; &#x4F30;&#x8BA1;&#x6587;&#x4EF6;&#x7684;&#x7A7A;&#x95F4;&#x4F7F;&#x7528;&#x60C5;&#x51B5;</li>
<li>-hsx &#x2013; &#xFF08;-h&#xFF09;&#x66F4;&#x6613;&#x8BFB;&#x7684;&#x683C;&#x5F0F;&#xFF0C;&#xFF08;-s&#xFF09;&#x6C47;&#x603B;&#x8F93;&#x51FA;&#xFF0C;&#xFF08;-x&#xFF09;&#x8DF3;&#x8FC7;&#x5176;&#x4ED6;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x7684;&#x6587;&#x4EF6;</li>
<li>sort &#x2013; &#x5BF9;&#x6587;&#x672C;&#x6587;&#x4EF6;&#x6309;&#x884C;&#x6392;&#x5E8F;</li>
<li>-rf &#x2013; &#xFF08;-r&#xFF09;&#x5C06;&#x6BD4;&#x8F83;&#x7684;&#x7ED3;&#x679C;&#x9006;&#x5E8F;&#x8F93;&#x51FA;&#xFF0C;&#xFF08;-f&#xFF09;&#x5FFD;&#x7565;&#x5927;&#x5C0F;&#x5199;</li>
<li>head &#x2013; &#x8F93;&#x51FA;&#x6587;&#x4EF6;&#x7684;&#x5934;&#x51E0;&#x884C;</li>
</ul>
<p></p><h3 id="&#x663E;&#x793A;&#x5269;&#x4F59;&#x5185;&#x5B58;">&#x663E;&#x793A;&#x5269;&#x4F59;&#x5185;&#x5B58;</h3><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">free -m | grep cache | awk <span class="string">&apos;/[0-9]/{ print $4&quot; MB&quot; }&apos;</span></div></pre></td></tr></table></figure><p></p>
<p></p><h3 id="&#x6D4B;&#x8BD5;&#x78C1;&#x76D8;&#x5199;&#x5165;&#x901F;&#x5EA6;">&#x6D4B;&#x8BD5;&#x78C1;&#x76D8;&#x5199;&#x5165;&#x901F;&#x5EA6;</h3><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dd <span class="keyword">if</span>=/dev/zero of=/tmp/output.img bs=8k count=256k conv=fdatasync</div></pre></td></tr></table></figure><p></p>
<p>&#x547D;&#x4EE4;&#x548C;&#x9009;&#x9879;&#x7684;&#x89E3;&#x91CA;&#xFF1A;</p>
<ul>
<li>dd &#x2013; &#x8F6C;&#x6362;&#x548C;&#x590D;&#x5236;&#x6587;&#x4EF6;</li>
<li>if=/dev/zero &#x2013; &#x6307;&#x5B9A;&#x8F93;&#x5165;&#x6587;&#x4EF6;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;stdin&#xFF08;&#x6807;&#x51C6;&#x8F93;&#x5165;&#xFF09;</li>
<li>of=/tmp/output.img &#x2013; &#x6307;&#x5B9A;&#x8F93;&#x51FA;&#x6587;&#x4EF6;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;stdout&#xFF08;&#x6807;&#x51C6;&#x8F93;&#x51FA;&#xFF09;</li>
<li>bs &#x2013; &#x4E00;&#x6B21;&#x8BFB;&#x548C;&#x5199;&#x7684;&#x5757;&#x5927;&#x5C0F;&#xFF0C;&#x6700;&#x5927;&#x53EF;&#x4EE5;&#x4EE5;MB&#x4E3A;&#x5355;&#x4F4D;</li>
<li>count &#x2013; &#x590D;&#x5236;&#x6B21;&#x6570;</li>
<li>conv &#x2013; &#x4F7F;&#x7528;&#x9017;&#x53F7;&#x5206;&#x9694;&#x7684;&#x7B56;&#x7565;&#x6765;&#x8F6C;&#x6362;&#x6587;&#x4EF6;&#xFF08;LCTT &#x8BD1;&#x6CE8;&#xFF1A;&#x6BD4;&#x5982;&#x5C06;&#x5927;&#x5199;&#x5B57;&#x6BCD;&#x8F6C;&#x6362;&#x6210;&#x5C0F;&#x5199;&#xFF0C;echo AA | dd conv=lcase&#xFF09;</li>
</ul>
<p></p><h3 id="&#x6D4B;&#x8BD5;&#x78C1;&#x76D8;&#x8BFB;&#x53D6;&#x901F;&#x5EA6;">&#x6D4B;&#x8BD5;&#x78C1;&#x76D8;&#x8BFB;&#x53D6;&#x901F;&#x5EA6;</h3><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hdparm -Tt /dev/vda</div></pre></td></tr></table></figure><p></p>
<p>&#x547D;&#x4EE4;&#x548C;&#x9009;&#x9879;&#x7684;&#x89E3;&#x91CA;&#xFF1A;</p>
<ul>
<li>hdparm - &#x8BFB;&#x53D6;&#x548C;&#x8BBE;&#x7F6E;IDE&#x6216;SCSI&#x786C;&#x76D8;&#x53C2;&#x6570;</li>
<li>-T - &#x8BC4;&#x4F30;&#x786C;&#x76D8;&#x5FEB;&#x901F;&#x7684;&#x8BFB;&#x53D6;&#x6548;&#x7387;</li>
<li>-t - &#x8BC4;&#x4F30;&#x786C;&#x76D8;&#x7684;&#x8BFB;&#x53D6;&#x6548;&#x7387;</li>
</ul>
<p></p><h3 id="&#x5728;history&#x4E2D;&#x52A0;&#x65F6;&#x95F4;&#x548C;&#x547D;&#x4EE4;&#x6267;&#x884C;&#x8005;">&#x5728;history&#x4E2D;&#x52A0;&#x65F6;&#x95F4;&#x548C;&#x547D;&#x4EE4;&#x6267;&#x884C;&#x8005;</h3><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">vim ~/.bashrc</div><div class="line"><span class="built_in">export</span> HISTTIMEFORMAT=<span class="string">&quot;%d/%m/%y %T `whoami`&quot;</span></div><div class="line"><span class="built_in">source</span> ~/.bashrc</div></pre></td></tr></table></figure><p></p>
<p>&#x547D;&#x4EE4;&#x548C;&#x9009;&#x9879;&#x7684;&#x89E3;&#x91CA;&#xFF1A;</p>
<ul>
<li>history &#x2013; &#x67E5;&#x770B;&#x8FD0;&#x884C;&#x8FC7;&#x7684;&#x547D;&#x4EE4;</li>
<li>HISTIMEFORMAT &#x2013; &#x8BBE;&#x7F6E;&#x65F6;&#x95F4;&#x683C;&#x5F0F;&#x7684;&#x73AF;&#x5883;&#x53D8;&#x91CF;<br>-%d &#x2013; &#x5929;</li>
<li>%m &#x2013; &#x6708;</li>
<li>%y &#x2013; &#x5E74;</li>
<li>%T &#x2013; &#x65F6;&#x95F4;&#x6233;</li>
<li>whoami - &#x5F53;&#x524D;&#x6267;&#x884C;&#x547D;&#x4EE4;&#x7684;&#x7528;&#x6237;</li>
</ul>
<p></p><h3 id="&#x5B9E;&#x65F6;&#x76D1;&#x63A7;&#x5F53;&#x524D;&#x547D;&#x4EE4;&#x6267;&#x884C;&#x7684;&#x7ED3;&#x679C;">&#x5B9E;&#x65F6;&#x76D1;&#x63A7;&#x5F53;&#x524D;&#x547D;&#x4EE4;&#x6267;&#x884C;&#x7684;&#x7ED3;&#x679C;</h3><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">watch -n 2 <span class="string">&apos;cat /proc/mdstat&apos;</span></div></pre></td></tr></table></figure><p></p>
<p>&#x547D;&#x4EE4;&#x548C;&#x9009;&#x9879;&#x7684;&#x89E3;&#x91CA;:</p>
<ul>
<li>watch - &#x7528;&#x4E8E;&#x5468;&#x671F;&#x6027;&#x6267;&#x884C;&#x547D;&#x4EE4;</li>
<li>-n - &#x6307;&#x5B9A;&#x95F4;&#x9694;&#x7684;&#x65F6;&#x957F;</li>
</ul>
<p></p><h3 id="&#x9632;&#x6B62;&#x7CFB;&#x7EDF;&#x5173;&#x952E;&#x6587;&#x4EF6;&#x88AB;&#x7BE1;&#x6539;">&#x9632;&#x6B62;&#x7CFB;&#x7EDF;&#x5173;&#x952E;&#x6587;&#x4EF6;&#x88AB;&#x7BE1;&#x6539;</h3><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">chattr +i note.txt</div><div class="line">lsattr note.txt</div></pre></td></tr></table></figure><p></p>
<p>&#x547D;&#x4EE4;&#x548C;&#x9009;&#x9879;&#x7684;&#x89E3;&#x91CA;:</p>
<ul>
<li>chattr - &#x6539;&#x53D8;&#x6587;&#x4EF6;&#x5C5E;&#x6027;</li>
<li>lsattr - &#x67E5;&#x770B;&#x6587;&#x4EF6;&#x5C5E;&#x6027;</li>
<li>a - &#x8BA9;&#x6587;&#x4EF6;&#x6216;&#x76EE;&#x5F55;&#x4EC5;&#x4F9B;&#x9644;&#x52A0;&#x7528;&#x9014;</li>
<li>b - &#x4E0D;&#x66F4;&#x65B0;&#x6587;&#x4EF6;&#x6216;&#x76EE;&#x5F55;&#x7684;&#x6700;&#x540E;&#x5B58;&#x53D6;&#x65F6;&#x95F4;</li>
<li>c - &#x5C06;&#x6587;&#x4EF6;&#x6216;&#x76EE;&#x5F55;&#x538B;&#x7F29;&#x540E;&#x5B58;&#x653E;</li>
<li>d - &#x5C06;&#x6587;&#x4EF6;&#x6216;&#x76EE;&#x5F55;&#x6392;&#x9664;&#x5728;&#x503E;&#x5012;&#x64CD;&#x4F5C;&#x4E4B;&#x5916;</li>
<li>i - &#x4E0D;&#x5F97;&#x4EFB;&#x610F;&#x66F4;&#x52A8;&#x6587;&#x4EF6;&#x6216;&#x76EE;&#x5F55;</li>
<li>s - &#x4FDD;&#x5BC6;&#x6027;&#x5220;&#x9664;&#x6587;&#x4EF6;&#x6216;&#x76EE;&#x5F55;</li>
<li>S - &#x5373;&#x65F6;&#x66F4;&#x65B0;&#x6587;&#x4EF6;&#x6216;&#x76EE;&#x5F55;</li>
<li>u - &#x9884;&#x9632;&#x4EE5;&#x5916;&#x5220;&#x9664;</li>
</ul>
<p></p><h3 id="&#x7528;-wget-&#x7684;&#x9012;&#x5F52;&#x65B9;&#x5F0F;&#x4E0B;&#x8F7D;&#x6574;&#x4E2A;&#x7F51;&#x7AD9;">&#x7528; Wget &#x7684;&#x9012;&#x5F52;&#x65B9;&#x5F0F;&#x4E0B;&#x8F7D;&#x6574;&#x4E2A;&#x7F51;&#x7AD9;</h3><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget --random-wait -r -p <span class="_">-e</span> robots=off -U Mozilla www.example.com</div></pre></td></tr></table></figure><p></p>
<p>&#x547D;&#x4EE4;&#x548C;&#x9009;&#x9879;&#x7684;&#x89E3;&#x91CA;:</p>
<ul>
<li>&#x2013;random-wait &#x7B49;&#x5F85; 0.5 &#x5230; 1.5 &#x79D2;&#x7684;&#x65F6;&#x95F4;&#x6765;&#x8FDB;&#x884C;&#x4E0B;&#x4E00;&#x6B21;&#x8BF7;&#x6C42; </li>
<li>-r &#x5F00;&#x542F;&#x9012;&#x5F52;&#x68C0;&#x7D22; </li>
<li>-e robots=off &#x5FFD;&#x7565; robots.txt </li>
<li>-U Mozilla &#x8BBE;&#x7F6E; User-Agent &#x5934;&#x4E3A; Mozilla</li>
<li>&#x2013;limit-rate=20K &#x9650;&#x5236;&#x4E0B;&#x8F7D;&#x901F;&#x5EA6;&#x4E3A; 20K </li>
<li>-o logfile.txt &#x8BB0;&#x5F55;&#x4E0B;&#x8F7D;&#x65E5;&#x5FD7; </li>
<li>-l 0 &#x5220;&#x9664;&#x6DF1;&#x5EA6;&#xFF08;&#x9ED8;&#x8BA4;&#x4E3A;5&#xFF09; </li>
<li>&#x2013;wait=1h &#x6BCF;&#x4E0B;&#x8F7D;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x540E;&#x7B49;&#x5F85;1&#x5C0F;&#x65F6;</li>
</ul>
<p></p><h3 id="&#x4EA7;&#x751F;&#x968F;&#x673A;&#x7684;&#x5341;&#x516D;&#x8FDB;&#x5236;&#x6570;">&#x4EA7;&#x751F;&#x968F;&#x673A;&#x7684;&#x5341;&#x516D;&#x8FDB;&#x5236;&#x6570;</h3><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">openssl rand -hex -n</div></pre></td></tr></table></figure><p></p>
<p>&#x547D;&#x4EE4;&#x548C;&#x9009;&#x9879;&#x7684;&#x89E3;&#x91CA;:</p>
<ul>
<li>-n - &#x751F;&#x6210;&#x968F;&#x673A;&#x5B57;&#x7B26;&#x6570;&#x91CF;</li>
</ul>
<p></p><h3 id="&#x68C0;&#x67E5;&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x662F;&#x5426;&#x5BF9;&#x672C;&#x673A;&#x5F00;&#x653E;">&#x68C0;&#x67E5;&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x662F;&#x5426;&#x5BF9;&#x672C;&#x673A;&#x5F00;&#x653E;</h3><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">echo</span> &gt; /dev/tcp/8.8.8.8/53 &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;open&quot;</span></div></pre></td></tr></table></figure><p></p>
<p></p><h3 id="&#x5FEB;&#x901F;&#x5907;&#x4EFD;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;">&#x5FEB;&#x901F;&#x5907;&#x4EFD;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;</h3><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cp some_file_name{,.bkp}</div></pre></td></tr></table></figure><p></p>
<p></p><h3 id="&#x4FEE;&#x6539;&#x6587;&#x4EF6;&#x7684;&#x65F6;&#x95F4;&#x6233;&#x6216;&#x521B;&#x5EFA;&#x7A7A;&#x6587;&#x4EF6;">&#x4FEE;&#x6539;&#x6587;&#x4EF6;&#x7684;&#x65F6;&#x95F4;&#x6233;&#x6216;&#x521B;&#x5EFA;&#x7A7A;&#x6587;&#x4EF6;</h3><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">touch <span class="_">-a</span> -t 201601011111 test.sh</div></pre></td></tr></table></figure><p></p>
<p>&#x547D;&#x4EE4;&#x548C;&#x9009;&#x9879;&#x7684;&#x89E3;&#x91CA;:</p>
<ul>
<li>-t - STAMP:&#x6307;&#x660E;&#x65F6;&#x95F4; [[CC]YY]MMDDhhmm[.ss]</li>
<li>-a - &#x4EC5;&#x4FEE;&#x6539;atime</li>
<li>-m - &#x4EC5;&#x4FEE;&#x6539;mtime</li>
<li>-c - &#x4E0D;&#x521B;&#x5EFA;&#x6587;&#x4EF6;</li>
</ul>
<p></p><h3 id="&#x663E;&#x793A;&#x6587;&#x4EF6;&#x6216;&#x7CFB;&#x7EDF;&#x72B6;&#x6001;">&#x663E;&#x793A;&#x6587;&#x4EF6;&#x6216;&#x7CFB;&#x7EDF;&#x72B6;&#x6001;</h3><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">stat</span> text.txt</div></pre></td></tr></table></figure><p></p>
<p>&#x547D;&#x4EE4;&#x548C;&#x9009;&#x9879;&#x7684;&#x89E3;&#x91CA;:</p>
<ul>
<li>access time - atime,&#x6587;&#x4EF6;&#x6700;&#x8FD1;&#x4E00;&#x6B21;&#x88AB;&#x8BBF;&#x95EE;&#x7684;&#x65F6;&#x95F4;</li>
<li>modify time - mtime,&#x6587;&#x4EF6;&#x6700;&#x8FD1;&#x4E00;&#x6B21;&#x88AB;&#x4FEE;&#x6539;&#x7684;&#x65F6;&#x95F4;&#xFF08;&#x6570;&#x636E;&#xFF09;</li>
<li>change time - ctime,&#x6587;&#x4EF6;&#x6700;&#x8FD1;&#x4E00;&#x6B21;&#x6539;&#x52A8;&#x7684;&#x65F6;&#x95F4;&#xFF08;&#x5143;&#x6570;&#x636E;&#xFF09;</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;本文不对基本的命令作过多的描述，让你了解不一样Linux命令小技巧，原来Linux还可以这么玩！&lt;br&gt;
    
    </summary>
    
      <category term="基础" scheme="http://www.chen-hao.com.cn/categories/%E5%9F%BA%E7%A1%80/"/>
    
    
      <category term="文件系统" scheme="http://www.chen-hao.com.cn/tags/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/"/>
    
  </entry>
  
</feed>
